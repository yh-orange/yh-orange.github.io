(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{636:function(s,t,n){"use strict";n.r(t);var a=n(10),e=Object(a.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"nginx相关知识"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx相关知识"}},[s._v("#")]),s._v(" Nginx相关知识")]),s._v(" "),n("blockquote",[n("p",[n("code",[s._v("nginx")]),s._v(" 是一个高性能的 "),n("code",[s._v("HTTP")]),s._v(" 和"),n("code",[s._v("反向代理服务器")]),s._v("，也是一个通用的 "),n("code",[s._v("TCP/UDP")]),s._v(" 代理服务器,是众多大型网站的必用技术。")])]),s._v(" "),n("p",[n("img",{attrs:{src:"/images/nginx.png",alt:"nginx"}})]),s._v(" "),n("p",[n("strong",[n("code",[s._v("nginx")]),s._v("在应用程序中的作用")])]),s._v(" "),n("ul",[n("li",[s._v("解决跨域")]),s._v(" "),n("li",[s._v("请求过滤")]),s._v(" "),n("li",[s._v("配置 gzip")]),s._v(" "),n("li",[s._v("负载均衡")]),s._v(" "),n("li",[s._v("静态资源服务器")])]),s._v(" "),n("h2",{attrs:{id:"正向代理与反向"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#正向代理与反向"}},[s._v("#")]),s._v(" "),n("strong",[s._v("正向代理与反向")])]),s._v(" "),n("blockquote",[n("p",[n("code",[s._v("代理")]),s._v("是在服务器和客户端之间假设的一层服务器，"),n("code",[s._v("代理")]),s._v("将接收客户端的请求并将它转发给服务器，然后将服务端的响应转发给客户端。")])]),s._v(" "),n("p",[n("img",{attrs:{src:"/images/base-js83.png",alt:"正向代理与反向图文说明"}})]),s._v(" "),n("p",[n("strong",[s._v("正向代理")])]),s._v(" "),n("blockquote",[n("p",[s._v("一个位于客户端和原始服务器 ("),n("code",[s._v("origin server")]),s._v(") 之间的服务器，为了从原始服务器取得内容，客户端向代理发送一个请求并指定目标 (原始服务器)，然后代理向原始服务器转交请求并将获得的内容返回给客户端。")])]),s._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"title"},[s._v("TIP")]),n("p",[n("code",[s._v("正向代理")]),s._v(" 是为我们服务的，即为客户端服务的，客户端可以根据正向代理访问到它本身无法访问到的服务器资源。")]),s._v(" "),n("p",[n("code",[s._v("正向代理")]),s._v(" 对我们是透明的，对服务端是非透明的，即服务端并不知道自己收到的是来自代理的访问还是来自真实客户端的访问。")])]),n("p",[n("strong",[s._v("反向代理")])]),s._v(" "),n("blockquote",[n("p",[s._v("是指以代理服务器来接受 "),n("code",[s._v("internet")]),s._v(" 上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给 "),n("code",[s._v("internet")]),s._v(" 上请求连接的客户端，此时代理服务器对外就表现为一个反向代理服务器。")])]),s._v(" "),n("h3",{attrs:{id:"配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[s._v("#")]),s._v(" 配置")]),s._v(" "),n("ul",[n("li",[n("strong",[s._v("实现效果访问"),n("code",[s._v("http://192.168.80.102:80")]),s._v("(Nginx首页),最终代理到"),n("code",[s._v("http://192.168.80.102:8080")]),s._v("(其他服务首页)")])])]),s._v(" "),n("blockquote",[n("p",[s._v("通过node启动一个本地服务，进行代理模拟")])]),s._v(" "),n("blockquote",[n("p",[s._v("在Nginx的配置文件中进行配置")])]),s._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[s._v("1. 新建一个server块，在server全局块中配置监听80端口\n\n2. 在location块中配置 / 路径请求代理到tomcat的地址\n下面三个配置的含义就是 ，当访问Linux的http://192.168.80.102:80这个地址时，由于配置Nginx监听的是80端口，所以会进入这个server块进行处理，然后看你的访问路径，根据location块配置的不同路径进入对应的处理，由于配置了/请求，所以进入/的location处理，然后配置了proxy_pass，所以进行代理到指定的路径。\n\n ```text\nserver {\n#\t监听端口80 即当访问服务器的端口是80时，进入这个server块处理\n        listen       80;\n# server_name当配置了listen时不起作用        \n        server_name  localhost;\n\n# location后面代表访问路径 当是/ 请求时 代理到tomcat的地址\n        location / {\n# 使用 proxy_pass（固定写法）后面跟要代理服务器地址            \n            proxy_pass http://192.168.80.102:8080;\n        }\n}                \n```\n经过测试，当输入http://192.168.80.102:80时，Nginx给我们代理到了我们启动的本地服务，所以显示了本地服务的页面，即配置成功\n")])])]),n("ul",[n("li",[n("strong",[s._v("应用一访问的是/路径，给我们代理到指定的服务器")]),s._v(" "),n("ul",[n("li",[s._v("让 "),n("code",[s._v("Nginx")]),s._v(" 监听9001端口")]),s._v(" "),n("li",[s._v("我们实现当访问"),n("code",[s._v("http://192.168.80.102:9001/edu")]),s._v("("),n("code",[s._v("Nginx")]),s._v(" 地址)时，"),n("code",[s._v("Nginx")]),s._v(" 给我们代理到"),n("code",[s._v("http://192.168.80.102:8081")]),s._v("，")]),s._v(" "),n("li",[s._v("当访问"),n("code",[s._v("http://192.168.80.102:9001/vod")]),s._v("时，"),n("code",[s._v("Nginx")]),s._v(" 给我们代理到"),n("code",[s._v("http://192.168.80.102:8082")])])])])]),s._v(" "),n("blockquote",[n("p",[s._v("通过node启动两个本地服务，进行代理模拟")])]),s._v(" "),n("blockquote",[n("p",[s._v("在Nginx的配置文件中进行配置")])]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("server {\n        # 监听9001端口\n        listen       9001;\n        # 进行路径匹配，匹配到edu代理到8081\n        location ~/edu/ {\n            proxy_pass http://192.168.80.102:8081;\n        }\n        # 进行路径匹配，匹配到vod代理到8082\n        location ~/vod/ {\n            proxy_pass http://192.168.80.102:8082;\n        }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("p",[s._v("经过测试，访问成功！！!")]),s._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"title"},[s._v("TIP")]),n("p",[n("code",[s._v("反向代理")]),s._v(" 是为服务端服务的，反向代理可以帮助服务器接收来自客户端的请求，帮助服务器做请求转发，负载均衡等。")]),s._v(" "),n("p",[n("code",[s._v("反向代理")]),s._v(" 对服务端是透明的，对我们是非透明的，即我们并不知道自己访问的是代理服务器，而服务器知道反向代理在为他服务。")])]),n("h3",{attrs:{id:"nginx基本结构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx基本结构"}},[s._v("#")]),s._v(" nginx基本结构")]),s._v(" "),n("p",[n("img",{attrs:{src:"/images/base-js84.png",alt:"nginx基本结构"}})]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 全局快")]),s._v("\n------------------------------------------------------------------------------\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#user  nobody;")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("worker_processes")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#error_log  logs/error.log;")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#error_log  logs/error.log  notice;")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#error_log  logs/error.log  info;")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#pid        logs/nginx.pid;")]),s._v("\n\n------------------------------------------------------------------------------\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# events块")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("events")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("worker_connections")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# http块 ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n------------------------------------------------------------------------------# "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http全局块")]),s._v("\n    include       mime.types")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default_type")]),s._v("  application/octet-stream")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#                  '$status $body_bytes_sent \"$http_referer\" '")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#                  \'"$http_user_agent" "$http_x_forwarded_for"\';')]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#access_log  logs/access.log  main;")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sendfile")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("on")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#tcp_nopush     on;")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#keepalive_timeout  0;")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("keepalive_timeout")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#gzip  on;        ")]),s._v("\n------------------------------------------------------------------------------    \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# server块")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# server全局块")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  localhost")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#charset koi8-r;")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#access_log  logs/host.access.log  main;")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# location块")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("   html")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v("  index.html index.htm")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#error_page  404              /404.html;")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# redirect server error pages to the static page /50x.html")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("error_page")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("502")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("504")]),s._v("  /50x.html")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" = /50x.html")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("   html")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# proxy the PHP scripts to Apache listening on 127.0.0.1:80")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#location ~ \\.php$ {")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    proxy_pass   http://127.0.0.1;")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#}")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#location ~ \\.php$ {")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    root           html;")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    fastcgi_pass   127.0.0.1:9000;")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    fastcgi_index  index.php;")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    include        fastcgi_params;")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#}")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# deny access to .htaccess files, if Apache's document root")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# concurs with nginx's one")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#location ~ /\\.ht {")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    deny  all;")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以配置多个server块\t")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br")])]),n("ul",[n("li",[n("p",[n("code",[s._v("全局块")]),s._v(":就是配置文件从头开始到 "),n("code",[s._v("events")]),s._v(" 块之间的内容，主要设置的是影响 "),n("code",[s._v("nginx")]),s._v(" 服务器整体运行的配置指令比如 "),n("code",[s._v("worker_process")]),s._v(", 值越大，可以支持的并发处理量也越多，但是还是和服务器的硬件相关。")])]),s._v(" "),n("li",[n("p",[n("code",[s._v("events块")]),s._v(": "),n("code",[s._v("events")]),s._v(" 块涉及的指令主要影响 "),n("code",[s._v("Nginx")]),s._v(" 服务器与用户的网络连接，常用的设置包括是否开启对多 "),n("code",[s._v("work_process")]),s._v(" 下的网络连接进行序列化，是否允许同时接收多个网络连接，选取哪种事件驱动模型来处理连接请求，每个 "),n("code",[s._v("word_process")]),s._v(" 可以同时支持的最大连接数等。\n上述例子就表示每个 "),n("code",[s._v("work_process")]),s._v(" 支持的最大连接数为 1024.这部分的配置对 "),n("code",[s._v("Nginx")]),s._v(" 的性能影响较大，在实际中应该灵活配置")])]),s._v(" "),n("li",[n("p",[n("code",[s._v("http")]),s._v("：包括 "),n("code",[s._v("http")]),s._v(" 全局块，以及多个 "),n("code",[s._v("server")]),s._v(" 块。")]),s._v(" "),n("ul",[n("li",[n("strong",[s._v("http全局块")]),s._v(" "),n("code",[s._v("http")]),s._v(" 全局块配置的指令包括文件引入、 "),n("code",[s._v("MIME-TYPE")]),s._v(" 定义、日志自定义、连接超时时间、单链接请求数上限等。")]),s._v(" "),n("li",[n("strong",[s._v("server模块")]),s._v(" "),n("ul",[n("li",[s._v("这块和虚拟主机有密切关系，虚拟主机从用户角度看，和一台独立的硬件主机是完全一样的，该技术的产生是为了节省互联网服务器硬件成本。")]),s._v(" "),n("li",[s._v("每个 "),n("code",[s._v("http")]),s._v(" 块可以包括多个 "),n("code",[s._v("server")]),s._v(" 块，而每个 "),n("code",[s._v("server")]),s._v(" 块就相当于一个虚拟主机")]),s._v(" "),n("li",[s._v("而每个 "),n("code",[s._v("server")]),s._v(" 块也分为全局 "),n("code",[s._v("server")]),s._v(" 块，以及可以同时包含多个 "),n("code",[s._v("location")]),s._v(" 块。")])])]),s._v(" "),n("li",[n("strong",[s._v("location块")]),s._v(" "),n("ul",[n("li",[s._v("一个 "),n("code",[s._v("server")]),s._v(" 块可以配置多个 "),n("code",[s._v("location")]),s._v(" 块。")]),s._v(" "),n("li",[s._v("主要作用是根据请求地址路径的匹配，匹配成功进行特定的处理")]),s._v(" "),n("li",[s._v("这块的主要作用是基于 "),n("code",[s._v("Nginx")]),s._v(" 服务器接收到的请求字符串（例如 "),n("code",[s._v("server_name/uri-string")]),s._v("），对虚拟主机名称（也可以是 "),n("code",[s._v("IP")]),s._v(" 别名）之外的字符串（例如 前面的 "),n("code",[s._v("/uri-string")]),s._v("）进行匹配，对特定的请求进行处理。地址定向、数据缓存和应答控制等功能，还有许多第三方模块的配置也在这里进行。")])])])]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# 表示如果请求路径是/就是用这个location块进行处理\nlocation / {\n            root   html;\n            index  index.html index.htm;\n        }\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])])]),s._v(" "),n("li",[n("p",[n("code",[s._v("upstream")]),s._v("：配置后端服务器具体地址，负载均衡配置不可或缺的部分。")])])]),s._v(" "),n("p",[n("code",[s._v("访问http://192.168.80.102:80/edu/test.html，Nginx将请求分配到8081和8082两台tomcat服务器上。")])]),s._v(" "),n("blockquote",[n("p",[s._v("启用两个服务，通过Nginx分配到两个服务器上面")])]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# 在http块中的全局块中配置\n# upstream固定写法 后面的myserver可以自定义\nupstream myserver{\n    server 192.168.80.102:8081;\n    server 192.168.80.102:8082;\n}\n\n# server配置\n    server {\n      # 监听80端口\n        listen 80;   \n    \t#location块\n        location / {\n# 反向代理到上面的两台服务器 写上自定义的名称\n        proxy_pass http://myserver;\n        }\n    }\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("start nginx\nnginx -t                         # 查看nginx状态\nnginx -s reload            # 重新载入配置文件\nnginx -s reopen           # 重启 Nginx\nnginx -s stop               # 停止 Nginx\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h2",{attrs:{id:"location-匹配规则"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#location-匹配规则"}},[s._v("#")]),s._v(" location 匹配规则")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://www.cnblogs.com/duhuo/p/8323812.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("location 匹配规则"),n("OutboundLink")],1)]),s._v(" "),n("h2",{attrs:{id:"nginx内置变量"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx内置变量"}},[s._v("#")]),s._v(" nginx内置变量")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("变量名")]),s._v(" "),n("th",[s._v("功能")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[n("code",[s._v("$host")])]),s._v(" "),n("td",[s._v("请求信息中的 "),n("code",[s._v("Host")]),s._v("，如果请求中没有 "),n("code",[s._v("Host")]),s._v(" 行，则等于设置的服务器名。")])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("$request_method")])]),s._v(" "),n("td",[s._v("客户端请求类型如 "),n("code",[s._v("GET")]),s._v("、"),n("code",[s._v("POST")]),s._v(" 等。")])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("$args")])]),s._v(" "),n("td",[s._v("请求中的参数。")])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("$content_length")])]),s._v(" "),n("td",[s._v("请求头中的"),n("code",[s._v("Content-length")]),s._v("字段。")])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("$http_user_agent")])]),s._v(" "),n("td",[s._v("客户端的"),n("code",[s._v("agent")]),s._v("信息。")])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("$http_cookie")])]),s._v(" "),n("td",[s._v("客户端的"),n("code",[s._v("cookie")]),s._v("信息。")])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("$remote_addr")])]),s._v(" "),n("td",[s._v("客户端的"),n("code",[s._v("IP地址")]),s._v("。")])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("$remote_port")])]),s._v(" "),n("td",[s._v("客户端的端口。")])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("$server_protocol")])]),s._v(" "),n("td",[s._v("请求使用的协议如"),n("code",[s._v("HTTP/1.1")]),s._v("。")])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("$server_addr")])]),s._v(" "),n("td",[s._v("服务器地址。")])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("$server_name")])]),s._v(" "),n("td",[s._v("服务器名称。")])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("$server_port")])]),s._v(" "),n("td",[s._v("服务器端口。")])])])]),s._v(" "),n("h2",{attrs:{id:"解决跨域"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#解决跨域"}},[s._v("#")]),s._v(" "),n("strong",[s._v("解决跨域")])]),s._v(" "),n("p",[n("strong",[s._v("跨域的定义")])]),s._v(" "),n("blockquote",[n("p",[s._v("同源策略限制了从同一个源加载的文档或脚本如何与来自另一个源的资源进行交互。这是一个用于隔离潜在恶意文件的重要安全机制。通常不允许不同源间的读操作。")])]),s._v(" "),n("p",[n("strong",[s._v("同源的定义")])]),s._v(" "),n("blockquote",[n("p",[s._v("如果两个页面的协议，端口（如果有指定）和域名都相同，则两个页面具有相同的源。")])]),s._v(" "),n("p",[n("strong",[s._v("nginx 解决跨域的原理")])]),s._v(" "),n("blockquote",[n("p",[s._v("nginx对服务端转发的请求不会触发浏览器的同源策略。")])]),s._v(" "),n("ul",[n("li",[s._v("前端 "),n("code",[s._v("server")]),s._v(" 的域名为："),n("code",[s._v("fe.server.com")])]),s._v(" "),n("li",[s._v("后端服务的域名为："),n("code",[s._v("dev.server.com")])])]),s._v(" "),n("p",[s._v("前端"),n("code",[s._v("fe.server.com")]),s._v("发出对"),n("code",[s._v("dev.server.com")]),s._v("的请求一定会出现跨域。")]),s._v(" "),n("p",[s._v("我们只需要启动一个 "),n("code",[s._v("nginx")]),s._v(" 服务器，将"),n("code",[s._v("server_name")]),s._v("设置为"),n("code",[s._v("fe.server.com")]),s._v(", 然后设置相应的 "),n("code",[s._v("location")]),s._v(" 以拦截前端需要跨域的请求，最后将请求代理回"),n("code",[s._v("dev.server.com")]),s._v("。如下面的配置：")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  fe.server.com")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" dev.server.com")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[n("strong",[s._v("nginx请求过滤")])]),s._v(" "),n("ul",[n("li",[s._v("根据状态码过滤:")])]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("error_page")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("501")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("502")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("504")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("506")]),s._v(" /50x.html")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" = /50x.html")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将根路径改编为存放 html 的路径。")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" /root/static/html")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("ul",[n("li",[s._v("根据 "),n("code",[s._v("URL")]),s._v(" 名称过滤，精准匹配 "),n("code",[s._v("URL")]),s._v("，不匹配的 "),n("code",[s._v("URL")]),s._v(" 全部重定向到主页:")])]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rewrite")]),s._v("  ^.*$ /index.html  redirect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ul",[n("li",[s._v("根据请求类型过滤:")])]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" ( "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_method")]),s._v(" !~ ^(GET|POST|HEAD)$ )")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("403")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" ( !-f "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_filename")]),s._v(" )")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rewrite")]),s._v(" (.*) /index.js")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h2",{attrs:{id:"配置gzip压缩"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置gzip压缩"}},[s._v("#")]),s._v(" 配置Gzip压缩")]),s._v(" "),n("p",[n("code",[s._v("GZIP")]),s._v("是规定的三种标准 "),n("code",[s._v("HTTP 压缩格式")]),s._v("之一。目前绝大多数的网站都在使用"),n("code",[s._v("GZIP")]),s._v("传输 "),n("code",[s._v("HTML")]),s._v("、"),n("code",[s._v("CSS")]),s._v("、"),n("code",[s._v("JavaScript")]),s._v(" 等资源文件。")]),s._v(" "),n("p",[s._v("对于文本文件，"),n("code",[s._v("GZip")]),s._v(" 的效果非常明显，开启后传输所需流量大约会降至 "),n("code",[s._v("1/4 ~ 1/3")]),s._v("。")]),s._v(" "),n("p",[s._v("并不是每个浏览器都支持"),n("code",[s._v("gzip")]),s._v("的，如何知道客户端是否支持"),n("code",[s._v("gzip")]),s._v("呢，请求头中的"),n("code",[s._v("Accept-Encoding")]),s._v("来标识对压缩的支持。")]),s._v(" "),n("p",[n("img",{attrs:{src:"/images/base-js85.png",alt:"请求头配置"}})]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip")]),s._v("                    "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("on")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" // 开启或者关闭gzip模块 默认为off\n"),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_http_version")]),s._v("       1.1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("// 启用 `GZip` 所需的`HTTP`最低版本 默认值为HTTP/1.1\n"),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_comp_level")]),s._v("         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" // 压缩级别，级别越高压缩率越大，当然压缩时间也就越长（传输快但比较消耗 "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("cpu）")]),s._v(" 默认值为 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 压缩级别取值为1-9\ngzip_min_length         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("// 设置允许压缩的页面最小字节数，Content-Length小于该值的请求将不会被压缩 默认值:0  当设置的值较小时，压缩后的长度可能比原文件大，建议设置1000以上\n"),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_types")]),s._v("              text/csv text/xml text/css text/plain text/javascript application/javascript application/x-javascript application/json application/xml")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" // 要采用 gzip 压缩的文件类型 (MIME类型)  默认值:text/html(默认不压缩js/css)\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h2",{attrs:{id:"负载均衡"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡"}},[s._v("#")]),s._v(" 负载均衡")]),s._v(" "),n("blockquote",[n("p",[s._v("负载均衡就是用来帮助我们将众多的客户端请求合理的分配到各个服务器，以达到服务端资源的充分利用和更少的请求时间。")])]),s._v(" "),n("p",[n("strong",[s._v("Upstream 指定后端服务器地址列表")])]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" balanceServer")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 10.1.22.33:12345")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 10.1.22.34:12345")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 10.1.22.35:12345")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[n("strong",[s._v("在 "),n("code",[s._v("server")]),s._v(" 中拦截响应请求，并将请求转发到 "),n("code",[s._v("Upstream")]),s._v(" 中配置的服务器列表。")])]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在http块中的全局块中配置")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# upstream固定写法 后面的myserver可以自定义")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" myserver")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 192.168.80.102:8081")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 192.168.80.102:8082")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# server配置")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 监听80端口")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   \n    \t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#location块")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 反向代理到上面的两台服务器 写上自定义的名称")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://myserver")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("p",[s._v("上面的配置只是指定了 "),n("code",[s._v("nginx")]),s._v(" 需要转发的服务端列表，并没有指定分配策略。")]),s._v(" "),n("p",[n("strong",[s._v("轮询策略")]),s._v("\n默认情况下采用的策略，将所有客户端请求轮询分配给服务端。")]),s._v(" "),n("p",[s._v("这种策略是可以正常工作的，但是如果其中某一台服务器压力太大，出现延迟，会影响所有分配在这台服务器下的用户\n每个请求按时间顺序逐一分配到不同的后端服务器，如果后端服务器 down 掉，能自动剔除")]),s._v(" "),n("p",[n("strong",[s._v("最小连接数策略")])]),s._v(" "),n("p",[s._v("将请求优先分配给压力较小的服务器，它可以平衡每个队列的长度，并避免向压力大的服务器添加更多的请求。")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" myserver")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("least_conn")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 10.1.22.33:12345")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 10.1.22.34:12345")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 10.1.22.35:12345")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[n("strong",[s._v("- 最快响应时间策略")])]),s._v(" "),n("p",[s._v("依赖于 "),n("code",[s._v("NGINX Plus")]),s._v("，优先分配给响应时间最短的服务器。")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" myserver")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fair")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 10.1.22.33:12345")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 10.1.22.34:12345")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 10.1.22.35:12345")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[n("strong",[n("code",[s._v("weight")]),s._v(" 权重")]),s._v(" "),n("code",[s._v("weight")]),s._v(" 代表权重默认为 1,权重越高被分配的客户端越多")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" myserver")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n\t"),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 192.168.80.102:8081 weight=1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 192.168.80.102:8082 weight=2")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  \n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://myserver")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[n("strong",[s._v("客户端 "),n("code",[s._v("ip_hash")]),s._v(" 绑定")])]),s._v(" "),n("p",[s._v("来自同一个 "),n("code",[s._v("ip")]),s._v("的请求永远只分配一台服务器，有效解决了动态网页存在的 "),n("code",[s._v("session")]),s._v(" 共享问题。")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" myserver")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ip_hash")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 10.1.22.33:12345")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 10.1.22.34:12345")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 10.1.22.35:12345")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[n("strong",[s._v("fair")]),s._v("\n按后端服务器的响应时间来分配请求，响应时间短的优先分配。")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置负载均衡的服务器和端口")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" myserver")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("   \n\t"),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 192.168.80.102:8081")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 192.168.80.102:8082")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fair")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  \n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   \n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://myserver")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("    \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("hr"),s._v(" "),n("h2",{attrs:{id:"动静分离"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#动静分离"}},[s._v("#")]),s._v(" 动静分离")]),s._v(" "),n("h3",{attrs:{id:"概述"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[s._v("#")]),s._v(" 概述")]),s._v(" "),n("ul",[n("li",[s._v("将静态资源 "),n("code",[s._v("css")]),s._v(" "),n("code",[s._v("html")]),s._v(" "),n("code",[s._v("js")]),s._v(" 等和动态资源("),n("code",[s._v("jsp servlet")]),s._v(")进行分开部署，"),n("strong",[s._v("我们可以将静态资源直接部署在专门的服务器上，也可以直接放在反向代理服务器上("),n("code",[s._v("Nginx")]),s._v(")所在在的服务器上")]),s._v(" 然后动态资源还是部署在服务器上，"),n("code",[s._v("如tomcat")]),s._v("。")]),s._v(" "),n("li",[s._v("然后请求来的时候，静态资源从专门的静态资源服务器获取，动态资源还是转发到后端服务器上。")])]),s._v(" "),n("p",[n("img",{attrs:{src:"/images/nginx3.png",alt:"静态资源代理"}})]),s._v(" "),n("h3",{attrs:{id:"配置-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置-2"}},[s._v("#")]),s._v(" 配置")]),s._v(" "),n("p",[s._v("准备工作：在node服务中设置静态文件目录，并在目录下创建两个文件夹，分别是www和image，在www目录下创建一个okc.html,在image目录下放一张ttt.jpg")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当访问路径带了www时，进入这个location处理，去/staticResource目录下对应的www目录     去找okc.html")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  即最终实现访问到这个路径")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  http://192.168.80.102:80/staticResource/www/okc.html")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /www/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("   /staticResource/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v("  index.html index.htm")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 跟上面一样")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /image/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("  /staticResource/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("   \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("p",[s._v("直接用 "),n("code",[s._v("Nginx")]),s._v(" 当服务器使用访问")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" ~* \\.(png|gif|jpg|jpeg)$")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("    /root/static/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("autoindex")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("on")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("access_log")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("off")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("expires")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10h")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置过期时间为 10 小时          ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("匹配以"),n("code",[s._v("png|gif|jpg|jpeg")]),s._v("为结尾的请求，并将请求转发到本地路径，"),n("code",[s._v("root")]),s._v("中指定的路径即 "),n("code",[s._v("nginx")]),s._v(" 本地路径。同时也可以进行一些缓存的设置。")])])}),[],!1,null,null,null);t.default=e.exports}}]);
<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack | yh-orange 学习笔记</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/images/icon.png">
    <meta name="description" content="Personal Website">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.31114bff.css" as="style"><link rel="preload" href="/assets/js/app.ab7ccc71.js" as="script"><link rel="preload" href="/assets/js/3.4edb9727.js" as="script"><link rel="preload" href="/assets/js/1.8fa44146.js" as="script"><link rel="preload" href="/assets/js/25.1dd59c95.js" as="script"><link rel="prefetch" href="/assets/js/10.117c3e7a.js"><link rel="prefetch" href="/assets/js/11.92bc9c31.js"><link rel="prefetch" href="/assets/js/12.f9afe2d3.js"><link rel="prefetch" href="/assets/js/13.814b4335.js"><link rel="prefetch" href="/assets/js/14.07ec2310.js"><link rel="prefetch" href="/assets/js/15.75624940.js"><link rel="prefetch" href="/assets/js/16.1b7695b0.js"><link rel="prefetch" href="/assets/js/17.3ebd7f2b.js"><link rel="prefetch" href="/assets/js/18.74427907.js"><link rel="prefetch" href="/assets/js/19.6afca700.js"><link rel="prefetch" href="/assets/js/20.62ea23cc.js"><link rel="prefetch" href="/assets/js/21.2a1e282a.js"><link rel="prefetch" href="/assets/js/22.3e86ef0c.js"><link rel="prefetch" href="/assets/js/23.86990ac5.js"><link rel="prefetch" href="/assets/js/24.901bce47.js"><link rel="prefetch" href="/assets/js/26.d382260a.js"><link rel="prefetch" href="/assets/js/27.4f928d65.js"><link rel="prefetch" href="/assets/js/28.3b826946.js"><link rel="prefetch" href="/assets/js/29.6c5a6671.js"><link rel="prefetch" href="/assets/js/30.236895e5.js"><link rel="prefetch" href="/assets/js/31.b8047fdd.js"><link rel="prefetch" href="/assets/js/32.1d2b663c.js"><link rel="prefetch" href="/assets/js/33.a3528f35.js"><link rel="prefetch" href="/assets/js/34.03511400.js"><link rel="prefetch" href="/assets/js/35.de42440a.js"><link rel="prefetch" href="/assets/js/36.0fc211d4.js"><link rel="prefetch" href="/assets/js/37.26759b23.js"><link rel="prefetch" href="/assets/js/38.588a7518.js"><link rel="prefetch" href="/assets/js/39.15e5c940.js"><link rel="prefetch" href="/assets/js/4.e9ad93dd.js"><link rel="prefetch" href="/assets/js/40.c97b3712.js"><link rel="prefetch" href="/assets/js/41.303f2a45.js"><link rel="prefetch" href="/assets/js/42.73ca30bd.js"><link rel="prefetch" href="/assets/js/43.953b4c7c.js"><link rel="prefetch" href="/assets/js/44.6792b66b.js"><link rel="prefetch" href="/assets/js/45.0c7776f3.js"><link rel="prefetch" href="/assets/js/46.c0458285.js"><link rel="prefetch" href="/assets/js/47.926765f5.js"><link rel="prefetch" href="/assets/js/48.8fa5c2c8.js"><link rel="prefetch" href="/assets/js/49.7495e132.js"><link rel="prefetch" href="/assets/js/5.4c32532b.js"><link rel="prefetch" href="/assets/js/50.d63aadc0.js"><link rel="prefetch" href="/assets/js/51.9a363be7.js"><link rel="prefetch" href="/assets/js/52.28410924.js"><link rel="prefetch" href="/assets/js/53.acc6026d.js"><link rel="prefetch" href="/assets/js/54.e030fc14.js"><link rel="prefetch" href="/assets/js/55.0b081e5c.js"><link rel="prefetch" href="/assets/js/56.833ab305.js"><link rel="prefetch" href="/assets/js/57.b1608b93.js"><link rel="prefetch" href="/assets/js/58.be51ba8c.js"><link rel="prefetch" href="/assets/js/59.aec83a30.js"><link rel="prefetch" href="/assets/js/6.132c57c0.js"><link rel="prefetch" href="/assets/js/60.08ff5ee8.js"><link rel="prefetch" href="/assets/js/61.94a50c42.js"><link rel="prefetch" href="/assets/js/62.b2db71be.js"><link rel="prefetch" href="/assets/js/63.2a0181c3.js"><link rel="prefetch" href="/assets/js/64.7f023a4a.js"><link rel="prefetch" href="/assets/js/65.17b400ef.js"><link rel="prefetch" href="/assets/js/66.794f64c3.js"><link rel="prefetch" href="/assets/js/67.ce97d267.js"><link rel="prefetch" href="/assets/js/68.12100ad3.js"><link rel="prefetch" href="/assets/js/69.31abf334.js"><link rel="prefetch" href="/assets/js/7.49a9a74a.js"><link rel="prefetch" href="/assets/js/70.dcd9c229.js"><link rel="prefetch" href="/assets/js/71.6eb3c080.js"><link rel="prefetch" href="/assets/js/72.741c9df7.js"><link rel="prefetch" href="/assets/js/73.30fe6803.js"><link rel="prefetch" href="/assets/js/74.b146fd8c.js"><link rel="prefetch" href="/assets/js/75.b3e38e76.js"><link rel="prefetch" href="/assets/js/76.73926b71.js"><link rel="prefetch" href="/assets/js/77.65ea9d49.js"><link rel="prefetch" href="/assets/js/78.1d532daa.js"><link rel="prefetch" href="/assets/js/79.07ccc890.js"><link rel="prefetch" href="/assets/js/8.17f9c4ab.js"><link rel="prefetch" href="/assets/js/9.71be61be.js">
    <link rel="stylesheet" href="/assets/css/0.styles.31114bff.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-1aefc0b4><div data-v-1aefc0b4><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-1aefc0b4 data-v-1aefc0b4><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-25ba6db2 data-v-1aefc0b4 data-v-1aefc0b4><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>yh-orange 学习笔记</h3> <p class="description" data-v-25ba6db2 data-v-25ba6db2>Personal Website</p> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><span data-v-25ba6db2>yh-orange</span>
            
          <!---->
          2024
        </a></span></div></div> <div class="hide" data-v-1aefc0b4><header class="navbar" data-v-1aefc0b4><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/images/hero.jpg" alt="yh-orange 学习笔记" class="logo"> <span class="site-name">yh-orange 学习笔记</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/base-js/" class="nav-link router-link-active"><i class="undefined"></i>
  前端基础资料
</a></div><div class="nav-item"><a href="/informal-essay/" class="nav-link"><i class="undefined"></i>
  随笔
</a></div><div class="nav-item"><a href="/front-end-engineering/" class="nav-link"><i class="undefined"></i>
  前端工程化
</a></div><div class="nav-item"><a href="/ps/" class="nav-link"><i class="undefined"></i>
  拍照修图
</a></div><div class="nav-item"><a href="/other/" class="nav-link"><i class="undefined"></i>
  其他资料
</a></div><div class="nav-item"><a href="/mini-program/" class="nav-link"><i class="undefined"></i>
  小程序资料
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-1aefc0b4></div> <aside class="sidebar" data-v-1aefc0b4><div class="personal-info-wrapper" data-v-39576ba9 data-v-1aefc0b4><!----> <h3 class="name" data-v-39576ba9>
    yh-orange
  </h3> <div class="num" data-v-39576ba9><div data-v-39576ba9><h3 data-v-39576ba9>60</h3> <h6 data-v-39576ba9>Articles</h6></div> <div data-v-39576ba9><h3 data-v-39576ba9>0</h3> <h6 data-v-39576ba9>Tags</h6></div></div> <ul class="social-links" data-v-39576ba9></ul> <hr data-v-39576ba9></div> <nav class="nav-links"><div class="nav-item"><a href="/base-js/" class="nav-link router-link-active"><i class="undefined"></i>
  前端基础资料
</a></div><div class="nav-item"><a href="/informal-essay/" class="nav-link"><i class="undefined"></i>
  随笔
</a></div><div class="nav-item"><a href="/front-end-engineering/" class="nav-link"><i class="undefined"></i>
  前端工程化
</a></div><div class="nav-item"><a href="/ps/" class="nav-link"><i class="undefined"></i>
  拍照修图
</a></div><div class="nav-item"><a href="/other/" class="nav-link"><i class="undefined"></i>
  其他资料
</a></div><div class="nav-item"><a href="/mini-program/" class="nav-link"><i class="undefined"></i>
  小程序资料
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>前端基础资料</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/base-js/html-css-js.html" class="sidebar-link">html+css+js</a></li><li><a href="/base-js/wen-dang-dui-xiang-mo-xing.html" class="sidebar-link">文档对象模型</a></li><li><a href="/base-js/liu-lan-qi-dui-xiang.html" class="sidebar-link">浏览器对象</a></li><li><a href="/base-js/javascriptji-chu-zhi-shi.html" class="sidebar-link">javaScript基础知识</a></li><li><a href="/base-js/es6-es12te-xing-zong-jie.html" class="sidebar-link">ES6-ES12特性总结</a></li><li><a href="/base-js/httpxiang-guan-zhi-shi.html" class="sidebar-link">HTTP 相关知识</a></li><li><a href="/base-js/git.html" class="sidebar-link">git基本操作</a></li><li><a href="/base-js/es.html" class="sidebar-link">es</a></li><li><a href="/base-js/node.html" class="sidebar-link">Node</a></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>webpack相关知识</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/base-js/webpack/basic.html" aria-current="page" class="active sidebar-link">webpack的基础介绍</a></li><li><a href="/base-js/webpack/custom.html" class="sidebar-link">自定义脚手架</a></li></ul></section></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-25ba6db2 data-v-1aefc0b4><h3 class="title" data-v-25ba6db2 data-v-25ba6db2></h3> <!----> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><span data-v-25ba6db2>yh-orange</span>
            
          <!---->
          2024
        </a></span></div></div> <div data-v-1aefc0b4><main class="page"><section><div class="page-title"><h1 class="title">webpack</h1> <div data-v-f875f3fc><i class="iconfont reco-account" data-v-f875f3fc><span data-v-f875f3fc>yh-orange</span></i> <!----> <i class="iconfont reco-eye" data-v-f875f3fc><span id="/base-js/webpack/basic.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-f875f3fc><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <!----></div></div> <div class="theme-reco-content content__default"><h1 id="webpack"><a href="#webpack" class="header-anchor">#</a> webpack</h1> <p><strong>本文所阐述的相关知识都是基于 webpack4.x 版本</strong></p> <h2 id="定义"><a href="#定义" class="header-anchor">#</a> 定义</h2> <blockquote><p><code>webpack</code>是一个现代<code>JavasScript</code>应用程序的模块打包器(<code>module bunder</code>)</p></blockquote> <h2 id="四个核心概念"><a href="#四个核心概念" class="header-anchor">#</a> 四个核心概念</h2> <ul><li><code>入口(entry)</code></li> <li><code>输出(output)</code></li> <li><code>loader</code></li> <li><code>插件(plugins)</code></li></ul> <h3 id="入口"><a href="#入口" class="header-anchor">#</a> 入口</h3> <blockquote><p>指示 <code>webpack</code> 应该使用哪个模块，来作为构建其内部依赖图的开始。Webpack 执行构建的第一步将从 入口开始，搜寻及递归解析出所有入口依赖的模块。</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 最简单的单入口文件</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&quot;./path/to/my/entry/file.js&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// entry 属性的单个入口语法，是下面的简写：</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">main</span><span class="token operator">:</span> <span class="token string">&quot;./path/to/my/entry/file.js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> config<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="出口"><a href="#出口" class="header-anchor">#</a> 出口</h3> <blockquote><p><code>output</code> 属性告诉 <code>webpack</code> 在哪里输出它所创建的 <code>bundles</code>，以及如何命名这些文件，默认值为 <code>./dist</code>。基本上，整个应用程序结构，都会被编译到你指定的输出路径的文件夹中。你可以通过在配置中指定一个 <code>output</code> 字段，来配置这些处理过程：</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 简单的单入口 单出口配置</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&quot;./path/to/my/entry/file.js&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;dist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;my-first-webpack.bundle.js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="loader"><a href="#loader" class="header-anchor">#</a> loader</h3> <blockquote><p><code>loader</code> 让 <code>webpack</code> 能够去处理那些非 <code>JavaScript</code> 文件（<code>webpack</code> 自身只理解 <code>JavaScript</code>）。<code>loader</code> 可以将所有类型的文件转换为 <code>webpack</code> 能够处理的有效模块，然后你就可以利用 <code>webpack</code> 的打包能力，对它们进行处理。</p></blockquote> <p>本质上，<code>webpack loader</code> 将所有类型的文件，转换为应用程序的依赖图（和最终的 <code>bundle</code>）可以直接引用的模块。</p> <div class="custom-block tip"><p class="title"></p><p>在 <code>webpack</code> 的配置中 <code>loader</code> 有两个目标：</p> <ul><li><code>test</code> 属性，用于标识出应该被对应的 <code>loader</code> 进行转换的某个或某些文件。</li> <li><code>use</code> 属性，表示进行转换时，应该使用哪个 <code>loader</code>。</li></ul> <p><code>thread-loader</code>:可以配置 webpack 进行多进程的打包 js 和 css。</p></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 简单的loader配置</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;my-first-webpack.bundle.js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.txt$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token string">&quot;raw-loader&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">//匹配所有的js文件</span>
        <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">//除了node_modules以外</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// 配置css loaders 假如在index.js中引入css 会被转化成commonjs对象</span>
      <span class="token punctuation">{</span> <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// styles-loader 将css转化成style 插入到head中</span>
      <span class="token punctuation">{</span> <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.less$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;less-loader&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.scss$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;sass-loader&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// url-loader可以处理一些图片大小转base64的功能   limit的单位是B(字节)</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.png|jpg|jpeg|gif$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>loader<span class="token operator">:</span> <span class="token string">&quot;url-loader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>options<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">limit</span><span class="token operator">:</span> <span class="token number">10240</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> config<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h3 id="loader-特性"><a href="#loader-特性" class="header-anchor">#</a> loader 特性</h3> <ol><li><p>loader 支持链式传递。能够对资源使用流水线(pipeline)。一组链式的 loader 将按照相反的顺序执行。loader 链中的第一个 loader 返回值给下一个 loader。在最后一个 loader，返回 webpack 所预期的 JavaScript。</p></li> <li><p>loader 可以是同步的，也可以是异步的。</p></li> <li><p>loader 运行在 Node.js 中，并且能够执行任何可能的操作。</p></li> <li><p>loader 接收查询参数。用于对 loader 传递配置。</p></li> <li><p>loader 也能够使用 options 对象进行配置。</p></li> <li><p>除了使用 package.json 常见的 main 属性，还可以将普通的 npm 模块导出为 loader，做法是在 package.json 里定义一个 loader 字段。</p></li> <li><p>插件(plugin)可以为 loader 带来更多特性。</p></li> <li><p>loader 能够产生额外的任意文件。</p></li></ol> <h3 id="插件-plugins"><a href="#插件-plugins" class="header-anchor">#</a> 插件(plugins)</h3> <blockquote><p><code>loader</code> 被用于转换某些类型的模块，而插件则可以用于执行范围更广的任务。插件的范围包括，从打包优化和压缩，一直到重新定义环境中的变量。插件接口功能极其强大，可以用来处理各种各样的任务。</p></blockquote> <p>想要使用一个插件，你只需要 <code>require()</code> 它，然后把它添加到 <code>plugins</code> 数组中。多数插件可以通过选项(<code>option</code>)自定义。你也可以在一个配置文件中因为不同目的而多次使用同一个插件，这时需要通过使用 <code>new</code> 操作符来创建它的一个实例。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;html-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 通过 npm 安装</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 用于访问内置插件</span>

<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.txt$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token string">&quot;raw-loader&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.html&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> config<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="custom-block tip"><p class="title"></p><p><code>webpack</code> 提供许多开箱可用的插件！查阅<a href="https://www.webpackjs.com/plugins/" target="_blank" rel="noopener noreferrer">插件列表<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>获取更多信息。</p></div><h3 id="模式-mode"><a href="#模式-mode" class="header-anchor">#</a> 模式(mode)</h3> <blockquote><p><code>webpack</code>内置了两个不同的模式(<code>development</code>、<code>production</code> ),通过选择 <code>development</code> 或 <code>production</code> 之中的一个，来设置 <code>mode</code> 参数，你可以启用相应模式下的 <code>webpack</code> 内置的优化。</p></blockquote> <p><strong>- <code>development</code>模式下，将侧重于功能调试和优化开发体验，包含如下内容：</strong></p> <ol><li>浏览器调试工具</li> <li>开发阶段的详细错误日志和提示</li> <li>快速和优化的增量构建机制</li></ol> <p><strong>- <code>production模式下</code>，将侧重于模块体积优化和线上部署，包含如下内容：</strong></p> <ol><li>开启所有的优化代码</li> <li>更小的<code>bundle</code>大小</li> <li>去除掉只在开发阶段运行的代码</li> <li><code>Scope hoisting</code>和<code>Tree-shaking</code></li> <li>自动启用<code>uglifyjs</code>对代码进行压缩</li></ol> <h3 id="manifest"><a href="#manifest" class="header-anchor">#</a> manifest</h3> <p><strong>在使用 webpack 构建的典型应用程序或站点中，有三种主要的代码类型：</strong></p> <ol><li>你或你的团队编写的源码。</li> <li>你的源码会依赖的任何第三方的 library 或 &quot;vendor&quot; 代码。</li> <li>webpack 的 <code>runtime</code> 和 <code>manifest</code>，管理所有模块的交互。</li></ol> <p><strong>Runtime</strong></p> <p>如上所述，我们这里只简略地介绍一下。runtime，以及伴随的 manifest 数据，主要是指：在浏览器运行时，webpack 用来连接模块化的应用程序的所有代码。runtime 包含：在模块交互时，连接模块所需的加载和解析逻辑。包括浏览器中的已加载模块的连接，以及懒加载模块的执行逻辑。</p> <p><strong>Manifest</strong>
那么，一旦你的应用程序中，形如 index.html 文件、一些 bundle 和各种资源加载到浏览器中，会发生什么？你精心安排的 /src 目录的文件结构现在已经不存在，所以 webpack 如何管理所有模块之间的交互呢？这就是 manifest 数据用途的由来……</p> <p>当编译器(compiler)开始执行、解析和映射应用程序时，它会保留所有模块的详细要点。这个数据集合称为 &quot;Manifest&quot;，当完成打包并发送到浏览器时，会在运行时通过 Manifest 来解析和加载模块。无论你选择哪种模块语法，那些 import 或 require 语句现在都已经转换为 <strong>webpack_require</strong> 方法，此方法指向模块标识符(module identifier)。通过使用 manifest 中的数据，runtime 将能够查询模块标识符，检索出背后对应的模块。</p> <h2 id="模块热替换"><a href="#模块热替换" class="header-anchor">#</a> 模块热替换</h2> <p>模块热替换(HMR - Hot Module Replacement)功能会在应用程序运行过程中替换、添加或删除模块，而无需重新加载整个页面。主要是通过以下几种方式，来显著加快开发速度：</p> <ul><li><p>保留在完全重新加载页面时丢失的应用程序状态。</p></li> <li><p>只更新变更内容，以节省宝贵的开发时间。</p></li> <li><p>调整样式更加快速 - 几乎相当于在浏览器调试器中更改样式。</p></li></ul> <p>你可以设置 HMR，以使此进程自动触发更新，或者你可以选择要求在用户交互时进行更新。通常我们可以使用<code>webpack-dev-server</code>来进行处理。</p> <div class="custom-block tip"><p class="title"></p><ul><li><p><code>webpack-dev-server</code> 不会刷新浏览器</p></li> <li><p><code>webpack-dev-server</code> 不输出文件,二是放在内存中</p></li> <li><p>使用 <code>HotModuleReplacementPlugin</code> 插件(webpack 自带)</p></li> <li><p>使用 <code>webpack-dev-middleware</code>也可以实现相同的功能，不过这种方式会将<code>webpack</code>输出的文件传输给服务器,适用于灵活的定制场景。</p></li></ul></div><h3 id="热更新原理"><a href="#热更新原理" class="header-anchor">#</a> 热更新原理</h3> <p><img src="https://img-blog.csdnimg.cn/20200515205923186.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hqbDI3MTMxNA==,size_16,color_FFFFFF,t_70" alt="极客时间热更原理"></p> <h2 id="文件监听"><a href="#文件监听" class="header-anchor">#</a> 文件监听</h2> <blockquote><p>文件监听是在发现源码发生变化的时候,自动的构建出新的输出文件。</p></blockquote> <p>webpack 中开启监听模式有两种方式实现:</p> <ul><li><p>启动 <code>webpack</code> 的时候带上 <code>--watch</code> 参数</p></li> <li><p>在配置 <code>webpack.config.js</code> 的时候设置 <code>watch:true</code></p></li></ul> <div class="custom-block warning"><p class="title"></p><p>这种方式虽然 webpack 构建是成功了 但是需要开发者手动刷新浏览器才会显示效果</p></div><h3 id="文件监听的原理"><a href="#文件监听的原理" class="header-anchor">#</a> 文件监听的原理</h3> <blockquote><p>轮询的判断文件的最后编辑时间是否发生了变化。当某个文件发生了变化，并不会立即告诉监听者，而是先缓存起来,等待 <code>aggregateTimeout</code></p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code>modules<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 默认是false 不开启</span>
  <span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token comment">// 只有watch开启之后才会有效</span>
  <span class="token literal-property property">watchOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 默认为空 不监听的文件或文件夹 支持正则匹配</span>
    <span class="token literal-property property">ignored</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    <span class="token comment">// 监听到变化后等待多少ms之后执行 默认是300ms</span>
    <span class="token literal-property property">aggregateTimeout</span><span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">,</span>
    <span class="token comment">// 判断文件是否发生变化通过不停询问系统指定文件有没有变化实现的， 默认为每秒询问1000次</span>
    <span class="token literal-property property">poll</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="文件指纹"><a href="#文件指纹" class="header-anchor">#</a> 文件指纹</h2> <blockquote><p>文件指纹其实指的就是每次文件打包之后后面跟着的<code>HashCode</code>,用来做版本管理等功能</p></blockquote> <h3 id="分类"><a href="#分类" class="header-anchor">#</a> 分类</h3> <ul><li><p><code>Hash</code>: 和整个项目的构建有关,只要项目文件有修改,整个项目构建的 hash 值就会更改。</p></li> <li><p><code>Chunkhash</code>: 和<code>webpack</code>打包的<code>chunk</code>有关，不同的<code>entry</code>会生成不同的<code>chunkhash</code>。</p></li> <li><p><code>Contenthash</code>: 根据文件的内容来定义<code>hash</code>,文件内容不变,则<code>contenthash</code>不变。</p></li></ul> <h2 id="自动清理构建目录"><a href="#自动清理构建目录" class="header-anchor">#</a> 自动清理构建目录</h2> <ul><li>2020.05.18</li></ul> <p>默认情况下每次 webpack 的构建的需要手动去清除之前构建产生的目录文件，这样在实际工程中就变得很麻烦。下面将会讲解几种自动化清理构建目录的方法。</p> <ol><li>通过 script 命令</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code>rm <span class="token operator">-</span>rf <span class="token punctuation">.</span><span class="token operator">/</span>dist <span class="token operator">&amp;&amp;</span> webpack
<span class="token comment">// rimraf 是个插件库</span>
rimraf <span class="token punctuation">.</span><span class="token operator">/</span>dist <span class="token operator">&amp;&amp;</span> webpack
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="2"><li>使用 <code>clean-webpack-plugin</code> 插件</li></ol> <blockquote><p>这个插件默认会删除 <code>output</code> 指定的输出目录</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="css-增强"><a href="#css-增强" class="header-anchor">#</a> CSS 增强</h2> <h3 id="_1-自动补全属性兼容"><a href="#_1-自动补全属性兼容" class="header-anchor">#</a> 1. 自动补全属性兼容</h3> <p>CSS3 某些属性其实在不同浏览器的支持情况不一样，以前的 css 代码中经常会出现以下这种 qingx</p> <div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token property">-moz-border-redius</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>
<span class="token property">-webkit-border-redius</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>
<span class="token property">-o-border-redius</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>
<span class="token property">-ms-border-redius</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>
<span class="token property">border-redius</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>如何只编写 W3C 规范的属性，其余的让大宝工具自动帮助我们完成?</p> <p>其实我们可以通过使用<code>post-css</code>和<code>autoprefixer</code>插件来辅助我们完成这个功能。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rule</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.scss$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
                <span class="token literal-property property">loader</span><span class="token operator">:</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'style-loader'</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token literal-property property">loader</span><span class="token operator">:</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'css-loader'</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token literal-property property">loader</span><span class="token operator">:</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'postcss-loader'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                        <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'autoprefixer'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                            <span class="token literal-property property">overrideBrowserslist</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'last 4 versions'</span><span class="token punctuation">,</span> <span class="token string">'ie 9'</span><span class="token punctuation">,</span> <span class="token string">'android 4.4.4'</span><span class="token punctuation">,</span> <span class="token string">'ios 8'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token literal-property property">loader</span><span class="token operator">:</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'sass-loader'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token literal-property property">modifyVars</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">javascriptEnabled</span><span class="token operator">:</span> <span class="token boolean">true</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>机制是在 CanIUse 上查找兼容性。</p> <h3 id="_2-自动-px-转-rem-适配移动端"><a href="#_2-自动-px-转-rem-适配移动端" class="header-anchor">#</a> 2. 自动 px 转 rem 适配移动端</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>
  addPostcssPlugins<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;customize-cra&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">addPostcssPlugins</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'postcss-px2rem'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">remUnit</span><span class="token operator">:</span> <span class="token number">75</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// px转换成rem</span>

<span class="token comment">// 早期版本</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span><span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'px2rem-loader'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">remUnit</span><span class="token operator">:</span> <span class="token number">75</span><span class="token punctuation">,</span><span class="token comment">// 1rem = 75px  750设计稿</span>
        <span class="token literal-property property">remPrecision</span><span class="token operator">:</span> <span class="token number">8</span> <span class="token punctuation">,</span><span class="token comment">// px转rem小数点位数</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><div class="custom-block tip"><p class="title"></p><p>推荐使用手机淘宝的<a href="https://github.com/amfe/lib-flexible" target="_blank" rel="noopener noreferrer"><code>lib-flexible</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>库配套使用 或者使用本博客对应的 js 技巧篇中的方法。</p></div><h2 id="静态资源内联"><a href="#静态资源内联" class="header-anchor">#</a> 静态资源内联</h2> <h3 id="意义"><a href="#意义" class="header-anchor">#</a> 意义</h3> <ul><li><p>页面框架的初始化脚本</p></li> <li><p>上报相关打点</p></li> <li><p>CSS 内联避免页面闪动</p></li> <li><p>小图片或者字体内联 减少<code>HTTP</code>请求数</p></li></ul> <h3 id="实现"><a href="#实现" class="header-anchor">#</a> 实现</h3> <p>主要是用 <code>raw-loader</code>来实现静态资源内联。</p> <h3 id="功能"><a href="#功能" class="header-anchor">#</a> 功能</h3> <ul><li><code>raw-loader</code> 内联 html</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>$<span class="token punctuation">{</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;raw-loader!babel-loader!./meta.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><code>raw-loader</code> 内联 js</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
  $<span class="token punctuation">{</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;raw-loader!babel-loader!../node_modules/lib_flexible&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="实现-css-内联"><a href="#实现-css-内联" class="header-anchor">#</a> 实现 css 内联</h3> <ol><li>借助<code>style-loader</code></li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">options</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">insertAt</span><span class="token operator">:</span> <span class="token string">'top'</span><span class="token punctuation">,</span><span class="token comment">// 样式插入head</span>
        <span class="token literal-property property">singleton</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 将所有的style标签合并成一个</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ol start="2"><li>使用<code>html-inline-css-webpack-plugin</code></li></ol> <h2 id="使用-source-map"><a href="#使用-source-map" class="header-anchor">#</a> 使用 source map</h2> <blockquote><p>soure map 可以将打包后的文件与原文件建立映射 方便查找打包之前的文件、定位错误</p></blockquote> <div class="custom-block warning"><p class="title"></p><p>注意: 一般仅在开发环境开启</p></div><h3 id="关键字"><a href="#关键字" class="header-anchor">#</a> 关键字</h3> <ul><li><p><code>eval</code>: 使用<code>eval</code>包裹模块代码</p></li> <li><p><code>source map</code>: 产生<code>.map</code>文件</p></li> <li><p><code>cheap</code>: 不包含列信息</p></li> <li><p><code>inline</code>: 将<code>.map</code>作为<code>DataURI</code>嵌入,不单独生成<code>.map</code>文件</p></li> <li><p><code>module</code>: 包含<code>loader</code>的<code>sourcemap</code></p></li></ul> <h2 id="提取页面的公共资源"><a href="#提取页面的公共资源" class="header-anchor">#</a> 提取页面的公共资源</h2> <h3 id="基础库的分离"><a href="#基础库的分离" class="header-anchor">#</a> 基础库的分离</h3> <blockquote><p>将 react、react-dom 等基础包通过 cdn 引入,不打入 bundle 中。</p></blockquote> <p>实际操作起来就是将这些库使用<code>externals</code>进行引入或者使用<code>splitChunks</code>进行分割.</p> <p><strong>使用 <code>html-webpack-externals-plugin</code></strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 安装</span>
npm i html<span class="token operator">-</span>webpack<span class="token operator">-</span>externals<span class="token operator">-</span>plugin <span class="token operator">-</span><span class="token constant">D</span>


<span class="token comment">// 使用</span>
<span class="token keyword">const</span> HtmlWebpackExternalsPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-externals-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token operator">...</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackExternalsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">externals</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token string">'react'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">'cdn文件地址'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">global</span><span class="token operator">:</span> <span class="token string">'React'</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token string">'react-dom'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">'cdn文件地址'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">global</span><span class="token operator">:</span> <span class="token string">'ReactDOM'</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token comment">// index.html</span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;依赖地址&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h2 id="splitchunks"><a href="#splitchunks" class="header-anchor">#</a> splitChunks</h2> <ul><li>2020.05.18</li></ul> <p><code>splitChunks</code>算是<code>webpack</code>中比较高级的一个用法，主要是跟<code>模块拆分</code>与<code>代码拆分</code>功能相关。</p> <p>在研究<code>splitChunks</code>之前，我们先再回顾下<code>webpack</code>中的<code>module</code>、<code>chunk</code>和<code>bundle</code>。</p> <ul><li><p><code>module</code>：就是 js 的模块化<code>webpack</code>支持<code>commonJS</code>、<code>ES6</code>等模块化规范，简单来说就是你通过<code>import</code>语句引入的代码。</p></li> <li><p><code>chunk</code>: <code>chunk</code>是<code>webpack</code>根据功能拆分出来的，包含三种情况：</p> <ol><li>你的项目入口<code>（entry）</code></li> <li>通过<code>import()</code>动态引入的代码</li> <li>通过<code>splitChunks</code>拆分出来的代码</li></ol></li></ul> <p><code>chunk</code>包含着<code>module</code>，可能是一对多也可能是一对一。</p> <ul><li><code>bundle</code>：<code>bundle</code>是<code>webpack</code>打包之后的各个文件，一般就是和<code>chunk</code>是一对一的关系，<code>bundle</code>就是对<code>chunk</code>进行编译压缩打包等处理之后的产出。</li></ul> <p>在<code>webpack4</code>之后有一个默认的<code>splitChunks</code>配置：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">splitChunks</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">&quot;async&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">minSize</span><span class="token operator">:</span> <span class="token number">30000</span><span class="token punctuation">,</span>
      <span class="token literal-property property">minChunks</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token literal-property property">maxAsyncRequests</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
      <span class="token literal-property property">maxInitialRequests</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
      <span class="token literal-property property">automaticNameDelimiter</span><span class="token operator">:</span> <span class="token string">&quot;~&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">cacheGroups</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">vendors</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">minChunks</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
          <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
          <span class="token literal-property property">reuseExistingChunk</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="chunks"><a href="#chunks" class="header-anchor">#</a> chunks</h3> <p><code>chunks</code>的含义是拆分模块的范围，它有三个值<code>async</code>、<code>initial</code>和<code>all</code>。</p> <ul><li><code>async</code>表示只从异步加载得模块（<code>动态加载import()</code>）里面进行拆分</li> <li><code>initial</code>表示只从入口模块进行拆分</li> <li><code>all</code>表示以上两者都包括</li></ul> <p><code>chunks</code>的默认配置是<code>async</code>，也就是只从<code>动态加载得模块</code>里面进行拆分</p> <h3 id="cachegroups"><a href="#cachegroups" class="header-anchor">#</a> cacheGroups</h3> <p><code>cacheGroups</code>其实是<code>splitChunks</code>里面最核心的配置,<code>splitChunks</code>就是根据<code>cacheGroups</code>去拆分模块的.</p> <p><code>splitChunks</code>默认有两个缓存组：<code>vender</code>和<code>default</code>。</p> <p>如果有一个模块满足了多个缓存组的条件就会去按照权重划分，谁的权重高就优先按照谁的规则处理。</p> <h3 id="maxinitialrequests"><a href="#maxinitialrequests" class="header-anchor">#</a> maxInitialRequests</h3> <blockquote><p>表示允许入口并行加载的最大请求数。</p></blockquote> <p>之所以有这个配置也是为了对拆分数量进行限制，不至于拆分出太多模块导致请求数量过多而得不偿失。</p> <p><strong>这里需要注意几点：</strong></p> <ol><li>入口文件本身算一个请求</li> <li>如果入口里面有动态加载得模块这个不算在内</li> <li>通过<code>runtimeChunk</code>拆分出的<code>runtime</code>不算在内</li> <li>只算<code>js</code>文件的请求，<code>css</code>不算在内</li> <li>如果同时又两个模块满足<code>cacheGroup</code>的规则要进行拆分，但是<code>maxInitialRequests</code>的值只能允许再拆分一个模块，那尺寸更大的模块会被拆分出来</li></ol> <h3 id="maxasyncrequests"><a href="#maxasyncrequests" class="header-anchor">#</a> maxAsyncRequests</h3> <p><code>maxAsyncRequests</code>和<code>maxInitialRequests</code>有相似之处，它俩都是用来限制拆分数量的，<code>maxInitialRequests</code>是用来限制入口的拆分数量而<code>maxAsyncRequests</code>是用来限制异步模块内部的并行最大请求数的，说白了你可以理解为是<code>每个import()</code>它里面的最大并行请求数量。</p> <p><strong>这其中要注意以下几点：</strong></p> <ol><li><p><code>import()</code>文件本身算一个请求</p></li> <li><p>并不算 js 以外的公共资源请求比如 css</p></li> <li><p>如果同时有两个模块满足<code>cacheGroup</code>的规则要进行拆分，但是<code>maxInitialRequests</code>的值只能允许再拆分一个模块，那<code>尺寸更大</code>的模块会被拆分出来</p></li></ol> <h3 id="其余要点"><a href="#其余要点" class="header-anchor">#</a> 其余要点</h3> <ol><li><p><code>splitChunks.cacheGroup</code>必须同时满足各个条件才能生效，比如<code>minSize</code>或是<code>minChunks</code>等条件必须同时满足才行</p></li> <li><p><code>splitChunks</code>的配置项都是作用于<code>cacheGroup</code>上的，如果将<code>cacheGroup</code>的默认两个分组<code>vendor</code>和<code>default</code>设置为<code>false</code>，则<code>splitChunks</code>就不会起作用</p></li> <li><p><code>minChunks</code>、<code>maxAsyncRequests</code>、<code>maxInitialRequests</code>的值必须设置为大于等于 1 的数</p></li> <li><p>当<code>chunk</code>没有名字时，通过<code>splitChunks</code>分出的模块的名字用<code>id</code>替代，当然你也可以通过<code>name</code>属性自定义</p></li> <li><p>当<code>父chunk</code>和<code>子chunk</code>同时引入相同的<code>module</code>时，并不会将其分割出来而是删除掉<code>子chunk</code>里面共同的<code>module</code>，保留<code>父chunk</code>的<code>module</code>，这个是因为 <code>optimization.removeAvaliableModules</code> 默认是<code>true</code></p></li> <li><p>当两个<code>cacheGroup.priority</code>相同时，先定义的会先命中</p></li> <li><p>除了<code>js</code>，<code>splitChunks</code>也适用于<code>css</code></p></li></ol> <h2 id="tree-shaking"><a href="#tree-shaking" class="header-anchor">#</a> Tree Shaking</h2> <ul><li>2020.05.19</li></ul> <blockquote><p>一个模块里可能有很多个方法,只要其中的某个方法使用到了,则整个文件都会被打包到 <code>bundle</code>中去，<code>tree shaking</code>就是只把用到的方法打入到 <code>bundle</code> , 没用到的方法会在 <code>ugify阶段</code>被擦除掉,从而减小了包的体积。</p></blockquote> <h3 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h3> <p><code>webpack</code>默认支持, 在 <code>.barbelrc</code> 里面设置 <code>modules: false</code> 即可。</p> <div class="custom-block tip"><p class="title"></p><p>webpack4 之后在<code>mode:production</code> 的情况下默认开启。</p> <p>必须是 ES6 的语法, CJS 的方式不支持,且其中编写的方法不能有副作用，否则就会失效。</p></div><p><strong>副作用解释</strong></p> <blockquote><p>对于相同的输入就有相同的输出，不依赖外部环境，也不改变外部环境。</p></blockquote> <p>符合上述的描述就可以称为纯函数，反之就是带有副作用。</p> <h3 id="原理"><a href="#原理" class="header-anchor">#</a> 原理</h3> <p>利用 ES6 模块的特点:</p> <ul><li>只能作为模块顶层的语句出现,只在文件的顶层,不能在代码中动态导入</li> <li><code>import</code>的模块名只能是字符串常量</li> <li><code>import binding</code> 是 <code>immutable</code> 的</li></ul> <p>代码擦除:</p> <ul><li><code>uglify</code>阶段删除无用代码。</li></ul> <h3 id="扩展"><a href="#扩展" class="header-anchor">#</a> 扩展</h3> <ul><li>2020.05.19</li></ul> <p>上述描述到如果模块是不纯,那么<code>tree shaking</code>检测就会失效，如何优化这部分的功能呢?</p> <p>这里可以配合使用另外一个插件<code>webpack-deep-scope-plugin</code>。</p> <blockquote><p><code>webpack-deep-scope-plugin</code>是一位中国同胞(学生)在<code>Google夏令营</code>，在导师 Tobias 带领下写的一个<code>webpack</code>插件。主要用于填充<code>webpack</code>自身<code>Tree-shaking</code>的不足，通过<code>作用域分析</code>来消除无用的代码。</p></blockquote> <h2 id="scope-hoisting"><a href="#scope-hoisting" class="header-anchor">#</a> Scope Hoisting</h2> <ul><li>2020.05.19</li></ul> <blockquote><p><code>scope hoisting</code> 是 <code>webpack3</code> 的新功能，直译过来就是<code>「作用域提升」</code>。熟悉 <code>JavaScript</code> 都应该知道<code>「函数提升」</code>和<code>「变量提升」</code>，<code>JavaScript</code> 会把函数和变量声明提升到当前作用域的顶部。<code>「作用域提升」</code>也类似于此，<code>webpack</code> 会把引入的 <code>js</code> 文件“提升到”它的引入者顶部。</p></blockquote> <h3 id="现象"><a href="#现象" class="header-anchor">#</a> 现象</h3> <p>在未使用<code>Scope Hoisting</code>的情况下,编译后的代码中存在着大量的闭包代码。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 编译前</span>
<span class="token comment">// a.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token string">&quot;xxxx&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// b.js</span>
<span class="token keyword">import</span> index <span class="token keyword">from</span> <span class="token string">&quot;./a&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 编译后</span>

<span class="token comment">/****/</span> <span class="token string">&quot;./app/index/app.js&quot;</span><span class="token punctuation">;</span>
<span class="token comment">/******************!*\
  !*** ./app/index/app.js ***!
  \**************************/</span>
<span class="token comment">/*! no exports provided */</span>
<span class="token comment">/***/</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>
  __webpack_require__<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>__webpack_exports<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">/* harmony import */</span> <span class="token keyword">var</span> __js_index__WEBPACK_IMPORTED_MODULES_0__ <span class="token operator">=</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span>
    <span class="token comment">/*! ./js/index */</span> <span class="token string">&quot;./app/index/app.js&quot;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>__js_index__WEBPACK_IMPORTED_MODULES_0__<span class="token punctuation">[</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">/***/</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">/****/</span> <span class="token string">&quot;./app/index/js/index.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/******************!*\
  !*** ./app/index/js/index.js ***!
  \**************************/</span>
<span class="token comment">/*! export provided:default */</span>
<span class="token comment">/***/</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>
  __webpack_require__<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>__webpack_exports<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* harmony default export */</span> __webpack_exoirts__<span class="token punctuation">[</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;xxxx&quot;</span><span class="token punctuation">;</span>

  <span class="token comment">/***/</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p><strong>这样会导致:</strong></p> <ol><li><p>大量闭包函数包裹代码，导致体积增大(模块越多的情况下越明显)</p></li> <li><p>运行代码时创建的函数作用域变多,内存开销变大</p></li></ol> <h3 id="原理之模块转化分析"><a href="#原理之模块转化分析" class="header-anchor">#</a> 原理之模块转化分析</h3> <p>我们来探究下为什么经过<code>webpack</code>打包之后会产生这么多的闭包函数，先来了解下<code>webpack</code>的<code>模块转化</code>。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 打包之前的代码</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> helloword <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./helloworld&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&quot;../../common&quot;</span><span class="token punctuation">;</span>

document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token function">helloworld</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 打包之后的模块初始化函数</span>
<span class="token comment">/* 0 */</span>
<span class="token comment">/***/</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>
__webpack_require__<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>__webpack_exports__<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* harmony import (指es6的import语法)*/</span> <span class="token keyword">var</span> _common_WEBPACK_IMPORTED_MODULE_0__ <span class="token operator">=</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* harmony import */</span> <span class="token keyword">var</span> _helloworld_WEBPACK_IMPORTED_MODULE_1__ <span class="token operator">=</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token function">Object</span><span class="token punctuation">(</span>_helloworld_WEBPACK_IMPORTED_MODULE_1__<span class="token punctuation">[</span><span class="token string">&quot;helloworld&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/***/</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="结论"><a href="#结论" class="header-anchor">#</a> 结论</h4> <ul><li><p>被 <code>webpack</code> 转化后的模块会带上一层包裹</p></li> <li><p><code>import</code> 会被转化成 <code>__webpack_require</code></p></li></ul> <h3 id="进一步分析-webpack-的模块机制"><a href="#进一步分析-webpack-的模块机制" class="header-anchor">#</a> 进一步分析 <code>webpack</code> 的模块机制</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">modules</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> installedModules <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token parameter">moduleId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> module <span class="token operator">=</span> installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">i</span><span class="token operator">:</span> moduleId<span class="token punctuation">,</span>
      <span class="token literal-property property">l</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token literal-property property">exports</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    modules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> module<span class="token punctuation">,</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> __webpack_require__<span class="token punctuation">)</span><span class="token punctuation">;</span>
    module<span class="token punctuation">.</span>l <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token comment">/* 0 module*/</span>
  <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">.</span> __webpack_require__</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">/* 1 module*/</span>
  <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">.</span> __webpack_require__</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">/* n module*/</span>
  <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">.</span> __webpack_require__</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h4 id="结论-2"><a href="#结论-2" class="header-anchor">#</a> 结论</h4> <ul><li><p><code>webpack</code>打包出来的是一个 <code>IIFE(匿名闭包)</code></p></li> <li><p><code>modules</code> 是一个数组,每一项是一个模块初始化函数</p></li> <li><p><code>__webpack_require</code> 用来加载模块, 返回的是 <code>module.exports</code></p></li> <li><p>通过<code>WEBPACK_REQUIRE_METHOD(0)</code>来启动程序</p></li></ul> <h3 id="scope-hoisting-原理"><a href="#scope-hoisting-原理" class="header-anchor">#</a> Scope Hoisting 原理</h3> <blockquote><p>将所有模块的代码按照引用顺序放在一个函数作用域里, 然后适当的重命名一些变量以防止变量名冲突。</p></blockquote> <p><img src="https://img-blog.csdnimg.cn/20200519145232537.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hqbDI3MTMxNA==,size_16,color_FFFFFF,t_70" alt="Scope Hoisting 原理"></p> <h3 id="scope-hoisting-使用"><a href="#scope-hoisting-使用" class="header-anchor">#</a> Scope Hoisting 使用</h3> <p><strong>在<code>webpack4</code>下 <code>mode</code> 为 <code>production</code> 时默认开启了此功能。</strong></p> <h2 id="code-splitting-和-动态-import"><a href="#code-splitting-和-动态-import" class="header-anchor">#</a> Code Splitting 和 动态 import</h2> <ul><li>2020.05.19</li></ul> <h3 id="code-splitting"><a href="#code-splitting" class="header-anchor">#</a> Code Splitting</h3> <p><code>Code Splitting</code> 一般需要做这些事情：</p> <ul><li>为 <code>Vendor</code> 单独打包（<code>Vendor</code> 指<code>第三方的库或者公共的基础组件</code>，因为 <code>Vendor</code> 的变化比较少，单独打包利于缓存）。</li> <li>为 <code>Manifest</code> （<code>Webpack</code> 的 <code>Runtime</code> 代码）单独打包。</li> <li>为不同入口的公共业务代码打包（同理，也是为了缓存和加载速度）。</li> <li>为异步加载的代码打一个公共的包。</li></ul> <p><code>Code Splitting</code> 一般是通过配置 <code>CommonsChunkPlugin</code> 来完成的。一个典型的配置如下，分别为 <code>vendor</code>、<code>manifest</code> 和 <code>vendor-async</code> 配置了 <code>CommonsChunkPlugin</code>。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>CommonsChunkPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'vendor'</span><span class="token punctuation">,</span>
    <span class="token function">minChunks</span> <span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
          module<span class="token punctuation">.</span>resource <span class="token operator">&amp;&amp;</span>
          <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>resource<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
          module<span class="token punctuation">.</span>resource<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>
            path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../node_modules'</span><span class="token punctuation">)</span>
          <span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

<span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>CommonsChunkPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'manifest'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">minChunks</span><span class="token operator">:</span> <span class="token number">Infinity</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

<span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>CommonsChunkPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'app'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">async</span><span class="token operator">:</span> <span class="token string">'vendor-async'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">minChunks</span><span class="token operator">:</span> <span class="token number">3</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p><code>CommonsChunkPlugin</code> 的特点就是配置比较难懂，大家的配置往往是复制过来的，这些代码基本上成了模板代码（<code>boilerplate</code>）。</p> <p>如果 <code>Code Splitting</code> 的要求简单倒好，如果有比较特殊的要求，比如把不同入口的 <code>vendor</code> 打不同的包，那就很难配置了。总的来说配置 <code>Code Splitting</code> 是一个比较痛苦的事情。</p> <p>而 <code>Long-term caching</code> 策略是这样的：给静态文件一个很长的缓存过期时间，比如一年。然后在给文件名里加上一个 <code>hash</code>，每次构建时，当文件内容改变时，文件名中的 <code>hash</code> 也会改变。浏览器在根据文件名作为文件的标识，所以当 <code>hash</code> 改变时，浏览器就会重新加载这个文件。</p> <p><code>Webpack</code> 的 <code>Output</code> 选项中可以配置文件名的 <code>hash</code>，比如这样：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">path</span><span class="token operator">:</span> config<span class="token punctuation">.</span>build<span class="token punctuation">.</span>assetsRoot<span class="token punctuation">,</span>
  <span class="token literal-property property">filename</span><span class="token operator">:</span> utils<span class="token punctuation">.</span><span class="token function">assetsPath</span><span class="token punctuation">(</span><span class="token string">'js/[name].[chunkhash].js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">chunkFilename</span><span class="token operator">:</span> utils<span class="token punctuation">.</span><span class="token function">assetsPath</span><span class="token punctuation">(</span><span class="token string">'js/[id].[chunkhash].js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="如何动态的-import"><a href="#如何动态的-import" class="header-anchor">#</a> 如何动态的 import</h3> <ol><li>安装 babel 插件</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install @babel/plugin-syntax-dynamic-import --save-dev
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="2"><li>配置<code>.babelrc</code>文件的<code>plugins</code></li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">'@babel/plugin-syntax-dynamic-import'</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="如何使用"><a href="#如何使用" class="header-anchor">#</a> 如何使用</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// do something</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="内部原理"><a href="#内部原理" class="header-anchor">#</a> 内部原理</h3> <p>通过 <code>webpackJsonp</code> 请求异步加载。动态创建<code>script标签</code>,然后引入。</p> <h2 id="webpack-与-ci-cd-集成"><a href="#webpack-与-ci-cd-集成" class="header-anchor">#</a> webpack 与 CI/CD 集成</h2> <ul><li>2020.05.19</li></ul> <h3 id="本地开发增加precommit钩子"><a href="#本地开发增加precommit钩子" class="header-anchor">#</a> 本地开发增加<code>precommit</code>钩子</h3> <ol><li>安装 <code>husky</code></li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install husky --save-dev
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="2"><li>增加 <code>npm script</code>，通过 <code>lint-staged</code> 增量检查修改的文件</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">...</span><span class="token punctuation">,</span>
<span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string-property property">&quot;precommit&quot;</span><span class="token operator">:</span> <span class="token string">&quot;lint-staged&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token string-property property">&quot;husky&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;hooks&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;pre-commit&quot;</span><span class="token operator">:</span> <span class="token string">&quot;git rev-parse --abbrev-ref HEAD | if ! [[ $(xargs) =~ 'gray|master|t\\d*' ]]; then lint-staged; fi&quot;</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;commit-msg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;commitlint -E HUSKY_GIT_PARAMS&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token string-property property">&quot;lint-staged&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string-property property">&quot;linters&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;*.{js,scss}&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;eslint --fix&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;git add&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="webpack-打包组件和基础库"><a href="#webpack-打包组件和基础库" class="header-anchor">#</a> webpack 打包组件和基础库</h2> <ul><li>2020.05.19</li></ul> <blockquote><p><code>webpack</code>除了打包应用，也可以用来打包 js 库和一些自定义组件库。</p></blockquote> <div class="custom-block tip"><p class="title"></p><p>单纯只是打包 js 库和组件库的话 使用<a href="https://www.rollupjs.com/" target="_blank" rel="noopener noreferrer"><code>rollup</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>打包也是一个不错的选择</p></div><p><strong>我们来实现一个简单的打包例子，这个例子需要满足以下几点功能:</strong></p> <ol><li><p>需要支持打包<code>压缩版(x.min.js)</code>和<code>非压缩版本(x.js)</code>。</p></li> <li><p>支持 <code>AMD/CJS/ESM</code> 模块引入。</p></li> <li><p>支持通过<code>script</code>脚本直接引入链接。</p></li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// ESM</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> Tool <span class="token keyword">from</span> <span class="token string">'tools'</span><span class="token punctuation">;</span>

<span class="token comment">//cjs</span>
<span class="token keyword">const</span> Tool <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'tools'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// AMD</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'tools'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// script 脚本</span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;https://xxx.com/tools&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>如何将库暴露出去？</strong></p> <ul><li><p><code>library</code>：指定库的全局变量</p></li> <li><p><code>libraryTarget</code>：支持库引入的方式</p></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
   <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
   <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token literal-property property">tools</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
     tools<span class="token punctuation">.</span>min<span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token literal-property property">output</span><span class="token operator">:</span><span class="token punctuation">{</span>
     <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;[name].js&quot;</span><span class="token punctuation">,</span>
     <span class="token literal-property property">library</span><span class="token operator">:</span> <span class="token string">&quot;tools&quot;</span><span class="token punctuation">,</span>
     <span class="token literal-property property">libraryExport</span><span class="token operator">:</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span>
     <span class="token literal-property property">libraryTarget</span><span class="token operator">:</span> <span class="token string">&quot;umd&quot;</span><span class="token punctuation">,</span><span class="token comment">// var this window ...</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>接下来让我们开始表演:</strong></p> <h3 id="_1-新建项目-webpack-build-tools-安装webpack和webpack-cli"><a href="#_1-新建项目-webpack-build-tools-安装webpack和webpack-cli" class="header-anchor">#</a> 1.新建项目 <code>webpack-build-tools</code> 安装<code>webpack</code>和<code>webpack-cli</code></h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>mkdir webpack-build-tools

cd webpack-build-tools

npm init -y

npm i webpack webpack-cli
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_2-新建目录-src-index-js-编写我们的工具代码"><a href="#_2-新建目录-src-index-js-编写我们的工具代码" class="header-anchor">#</a> 2. 新建目录 <code>src/index.js</code>,编写我们的工具代码</h3> <p>此处的代码来自我的博客下 <code>js-tips</code> 仅作为示例使用</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/**
 * 将参数中的null undefined转化为空
 * @param {String} el
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">transferDefectParams</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">&quot;null&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;&quot;</span> <span class="token operator">:</span> el<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 正则表示法
 * 思路:通过正则表达式获取url上的参数 然后通过数组reduce追加到对象中
 *
 * @param {string} url 需要获取的url地址默认为当前地址
 */</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">getUrlParameters</span><span class="token punctuation">(</span><span class="token parameter">url <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/**
   * match返回字符串中匹配结果的数组,匹配不到返回null
   * [^?=&amp;]+ 匹配除了?=&amp;之外的字符 仅匹配一次
   * Array.reduce(callBack(prev,cur,index,array), initialValue)
   * Array.slice(start,[end]) 返回start-end的元素
   */</span>
  <span class="token keyword">const</span> params <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">([^?=&amp;]+)=([^&amp;]*)</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> params<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>
      <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
        <span class="token punctuation">(</span>a<span class="token punctuation">[</span>v<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;=&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">transferDefectParams</span><span class="token punctuation">(</span>
          v<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;=&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        a
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h3 id="_3-安装-terser-webpack-plugin-压缩插件"><a href="#_3-安装-terser-webpack-plugin-压缩插件" class="header-anchor">#</a> 3. 安装 <code>terser-webpack-plugin</code> 压缩插件</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm i terser-webpack-plugin -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_4-新建-webpack-config-js"><a href="#_4-新建-webpack-config-js" class="header-anchor">#</a> 4. 新建 <code>webpack.config.js</code></h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> TerserPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;terser-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 引入压缩插件</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&quot;none&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 因为默认是production 默认会进行压缩</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">tools</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;tools.min&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;[name].js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">library</span><span class="token operator">:</span> <span class="token string">&quot;tools&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">libraryExport</span><span class="token operator">:</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 不添加的话引用的时候需要 tools.default</span>
    <span class="token literal-property property">libraryTarget</span><span class="token operator">:</span> <span class="token string">&quot;umd&quot;</span><span class="token punctuation">,</span> <span class="token comment">// var this window ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">minimize</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">minimizer</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token comment">// 使用压缩插件</span>
        <span class="token literal-property property">include</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.min\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="_5-修改-package-json-添加打包命令"><a href="#_5-修改-package-json-添加打包命令" class="header-anchor">#</a> 5. 修改 <code>package.json</code> 添加打包命令</h3> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack-build-tools&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;js常用工具函数&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;prepublish&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;keywords&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;webpack-build-tools&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;xjl271314&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;webpack&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.43.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;webpack-cli&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.3.11&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;terser-webpack-plugin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.0.1&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="_6-打包并查看打包效果"><a href="#_6-打包并查看打包效果" class="header-anchor">#</a> 6. 打包并查看打包效果</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm run build
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://img-blog.csdnimg.cn/20200519174826824.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hqbDI3MTMxNA==,size_16,color_FFFFFF,t_70" alt="打包结果"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// tools.js</span>
<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">webpackUniversalModuleDefinition</span><span class="token punctuation">(</span><span class="token parameter">root<span class="token punctuation">,</span> factory</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> exports <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> module <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span><span class="token punctuation">)</span>
    module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> define <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span> <span class="token operator">&amp;&amp;</span> define<span class="token punctuation">.</span>amd<span class="token punctuation">)</span> <span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> factory<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> exports <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span><span class="token punctuation">)</span> exports<span class="token punctuation">[</span><span class="token string">&quot;tools&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span> root<span class="token punctuation">[</span><span class="token string">&quot;tools&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token comment">/******/</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">modules</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// webpackBootstrap</span>
    <span class="token comment">/******/</span> <span class="token comment">// The module cache</span>
    <span class="token comment">/******/</span> <span class="token keyword">var</span> installedModules <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// The require function</span>
    <span class="token comment">/******/</span>
    <span class="token comment">/******/</span> <span class="token comment">/******/</span> <span class="token keyword">function</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token parameter">moduleId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">/******/</span>
      <span class="token comment">/******/</span> <span class="token comment">// Check if module is in cache</span>
      <span class="token comment">/******/</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">/******/</span> <span class="token keyword">return</span> installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
        <span class="token comment">/******/</span>
      <span class="token punctuation">}</span> <span class="token comment">// Create a new module (and put it into the cache)</span>
      <span class="token comment">/******/</span> <span class="token comment">/******/</span> <span class="token keyword">var</span> module <span class="token operator">=</span> <span class="token punctuation">(</span>installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token comment">/******/</span> <span class="token literal-property property">i</span><span class="token operator">:</span> moduleId<span class="token punctuation">,</span>
        <span class="token comment">/******/</span> <span class="token literal-property property">l</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token comment">/******/</span> <span class="token literal-property property">exports</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">/******/</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Execute the module function</span>
      <span class="token comment">/******/</span>
      <span class="token comment">/******/</span> <span class="token comment">/******/</span> modules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>
        module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span>
        module<span class="token punctuation">,</span>
        module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span>
        __webpack_require__
      <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Flag the module as loaded</span>
      <span class="token comment">/******/</span>
      <span class="token comment">/******/</span> <span class="token comment">/******/</span> module<span class="token punctuation">.</span>l <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// Return the exports of the module</span>
      <span class="token comment">/******/</span>
      <span class="token comment">/******/</span> <span class="token comment">/******/</span> <span class="token keyword">return</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
      <span class="token comment">/******/</span>
    <span class="token punctuation">}</span> <span class="token comment">// expose the modules object (__webpack_modules__)</span>
    <span class="token comment">/******/</span>
    <span class="token comment">/******/</span>
    <span class="token comment">/******/</span> <span class="token comment">/******/</span> __webpack_require__<span class="token punctuation">.</span>m <span class="token operator">=</span> modules<span class="token punctuation">;</span> <span class="token comment">// expose the module cache</span>
    <span class="token comment">/******/</span>
    <span class="token comment">/******/</span> <span class="token comment">/******/</span> __webpack_require__<span class="token punctuation">.</span>c <span class="token operator">=</span> installedModules<span class="token punctuation">;</span> <span class="token comment">// define getter function for harmony exports</span>
    <span class="token comment">/******/</span>
    <span class="token comment">/******/</span> <span class="token comment">/******/</span> __webpack_require__<span class="token punctuation">.</span><span class="token function-variable function">d</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">exports<span class="token punctuation">,</span> name<span class="token punctuation">,</span> getter</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">/******/</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>__webpack_require__<span class="token punctuation">.</span><span class="token function">o</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">/******/</span> Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token literal-property property">get</span><span class="token operator">:</span> getter<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/******/</span>
      <span class="token punctuation">}</span>
      <span class="token comment">/******/</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// define __esModule on exports</span>
    <span class="token comment">/******/</span>
    <span class="token comment">/******/</span> <span class="token comment">/******/</span> __webpack_require__<span class="token punctuation">.</span><span class="token function-variable function">r</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">exports</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">/******/</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> Symbol <span class="token operator">!==</span> <span class="token string">&quot;undefined&quot;</span> <span class="token operator">&amp;&amp;</span> Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">/******/</span> Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">,</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;Module&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/******/</span>
      <span class="token punctuation">}</span>
      <span class="token comment">/******/</span> Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">&quot;__esModule&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">/******/</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// create a fake namespace object // mode &amp; 1: value is a module id, require it // mode &amp; 2: merge all properties of value into the ns // mode &amp; 4: return value when already ns object // mode &amp; 8|1: behave like require</span>
    <span class="token comment">/******/</span>
    <span class="token comment">/******/</span> <span class="token comment">/******/</span> <span class="token comment">/******/</span> <span class="token comment">/******/</span> <span class="token comment">/******/</span> <span class="token comment">/******/</span> __webpack_require__<span class="token punctuation">.</span><span class="token function-variable function">t</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>
      <span class="token parameter">value<span class="token punctuation">,</span>
      mode</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">/******/</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>mode <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> value <span class="token operator">=</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">/******/</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>mode <span class="token operator">&amp;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token keyword">return</span> value<span class="token punctuation">;</span>
      <span class="token comment">/******/</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>
        mode <span class="token operator">&amp;</span> <span class="token number">4</span> <span class="token operator">&amp;&amp;</span>
        <span class="token keyword">typeof</span> value <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span> <span class="token operator">&amp;&amp;</span>
        value <span class="token operator">&amp;&amp;</span>
        value<span class="token punctuation">.</span>__esModule
      <span class="token punctuation">)</span>
        <span class="token keyword">return</span> value<span class="token punctuation">;</span>
      <span class="token comment">/******/</span> <span class="token keyword">var</span> ns <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">/******/</span> __webpack_require__<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>ns<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">/******/</span> Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>ns<span class="token punctuation">,</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> value<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">/******/</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>mode <span class="token operator">&amp;</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> value <span class="token operator">!=</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> value<span class="token punctuation">)</span>
          __webpack_require__<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>
            ns<span class="token punctuation">,</span>
            key<span class="token punctuation">,</span>
            <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">return</span> value<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">/******/</span> <span class="token keyword">return</span> ns<span class="token punctuation">;</span>
      <span class="token comment">/******/</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// getDefaultExport function for compatibility with non-harmony modules</span>
    <span class="token comment">/******/</span>
    <span class="token comment">/******/</span> <span class="token comment">/******/</span> __webpack_require__<span class="token punctuation">.</span><span class="token function-variable function">n</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">/******/</span> <span class="token keyword">var</span> getter <span class="token operator">=</span>
        module <span class="token operator">&amp;&amp;</span> module<span class="token punctuation">.</span>__esModule
          <span class="token operator">?</span> <span class="token comment">/******/</span> <span class="token keyword">function</span> <span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">return</span> module<span class="token punctuation">[</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token operator">:</span> <span class="token comment">/******/</span> <span class="token keyword">function</span> <span class="token function">getModuleExports</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">return</span> module<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token comment">/******/</span> __webpack_require__<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>getter<span class="token punctuation">,</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> getter<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">/******/</span> <span class="token keyword">return</span> getter<span class="token punctuation">;</span>
      <span class="token comment">/******/</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// Object.prototype.hasOwnProperty.call</span>
    <span class="token comment">/******/</span>
    <span class="token comment">/******/</span> <span class="token comment">/******/</span> __webpack_require__<span class="token punctuation">.</span><span class="token function-variable function">o</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">object<span class="token punctuation">,</span> property</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>object<span class="token punctuation">,</span> property<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// __webpack_public_path__</span>
    <span class="token comment">/******/</span>
    <span class="token comment">/******/</span> <span class="token comment">/******/</span> __webpack_require__<span class="token punctuation">.</span>p <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span> <span class="token comment">// Load entry module and return exports</span>
    <span class="token comment">/******/</span>
    <span class="token comment">/******/</span>
    <span class="token comment">/******/</span> <span class="token comment">/******/</span> <span class="token keyword">return</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token punctuation">(</span>__webpack_require__<span class="token punctuation">.</span>s <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/******/</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>
    <span class="token comment">/************************************************************************/</span>
    <span class="token comment">/******/</span> <span class="token punctuation">[</span>
      <span class="token comment">/* 0 */</span>
      <span class="token comment">/***/</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>
        __webpack_require__<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>__webpack_exports__<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/* harmony export (binding) */</span> __webpack_require__<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>
          __webpack_exports__<span class="token punctuation">,</span>
          <span class="token string">&quot;transferDefectParams&quot;</span><span class="token punctuation">,</span>
          <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> transferDefectParams<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/* harmony export (binding) */</span> __webpack_require__<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>
          __webpack_exports__<span class="token punctuation">,</span>
          <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span>
          <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> getUrlParameters<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/**
         * 将参数中的null undefined转化为空
         * @param {String} el
         */</span>
        <span class="token keyword">function</span> <span class="token function">transferDefectParams</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">&quot;null&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;&quot;</span> <span class="token operator">:</span> el<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">/**
         * 正则表示法
         * 思路:通过正则表达式获取url上的参数 然后通过数组reduce追加到对象中
         *
         * @param {string} url 需要获取的url地址默认为当前地址
         */</span>
        <span class="token keyword">function</span> <span class="token function">getUrlParameters</span><span class="token punctuation">(</span><span class="token parameter">url <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">/**
           * match返回字符串中匹配结果的数组,匹配不到返回null
           * [^?=&amp;]+ 匹配除了?=&amp;之外的字符 仅匹配一次
           * Array.reduce(callBack(prev,cur,index,array), initialValue)
           * Array.slice(start,[end]) 返回start-end的元素
           */</span>
          <span class="token keyword">const</span> params <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">([^?=&amp;]+)=([^&amp;]*)</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> params<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>
              <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
                <span class="token punctuation">(</span>a<span class="token punctuation">[</span>v<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;=&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">transferDefectParams</span><span class="token punctuation">(</span>
                  v<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;=&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                a
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">/***/</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">/******/</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// tools.min.js</span>
<span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span> t</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;object&quot;</span> <span class="token operator">==</span> <span class="token keyword">typeof</span> exports <span class="token operator">&amp;&amp;</span> <span class="token string">&quot;object&quot;</span> <span class="token operator">==</span> <span class="token keyword">typeof</span> module
    <span class="token operator">?</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token operator">:</span> <span class="token string">&quot;function&quot;</span> <span class="token operator">==</span> <span class="token keyword">typeof</span> define <span class="token operator">&amp;&amp;</span> define<span class="token punctuation">.</span>amd
    <span class="token operator">?</span> <span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span>
    <span class="token operator">:</span> <span class="token string">&quot;object&quot;</span> <span class="token operator">==</span> <span class="token keyword">typeof</span> exports
    <span class="token operator">?</span> <span class="token punctuation">(</span>exports<span class="token punctuation">.</span>tools <span class="token operator">=</span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token operator">:</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>tools <span class="token operator">=</span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">n</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">return</span> t<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
      <span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token punctuation">(</span>t<span class="token punctuation">[</span>r<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">i</span><span class="token operator">:</span> r<span class="token punctuation">,</span> <span class="token literal-property property">l</span><span class="token operator">:</span> <span class="token operator">!</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">exports</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> e<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> o<span class="token punctuation">,</span> o<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>o<span class="token punctuation">.</span>l <span class="token operator">=</span> <span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> o<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token punctuation">(</span>n<span class="token punctuation">.</span>m <span class="token operator">=</span> e<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span>n<span class="token punctuation">.</span>c <span class="token operator">=</span> t<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span>n<span class="token punctuation">.</span><span class="token function-variable function">d</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span> t<span class="token punctuation">,</span> r</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        n<span class="token punctuation">.</span><span class="token function">o</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> t<span class="token punctuation">)</span> <span class="token operator">||</span> Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> t<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">get</span><span class="token operator">:</span> r <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span>n<span class="token punctuation">.</span><span class="token function-variable function">r</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;undefined&quot;</span> <span class="token operator">!=</span> <span class="token keyword">typeof</span> Symbol <span class="token operator">&amp;&amp;</span>
          Symbol<span class="token punctuation">.</span>toStringTag <span class="token operator">&amp;&amp;</span>
          Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;Module&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token string">&quot;__esModule&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token operator">!</span><span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span>n<span class="token punctuation">.</span><span class="token function-variable function">t</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span> t</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&amp;</span> t <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>e <span class="token operator">=</span> <span class="token function">n</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">8</span> <span class="token operator">&amp;</span> t<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> e<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">&amp;</span> t <span class="token operator">&amp;&amp;</span> <span class="token string">&quot;object&quot;</span> <span class="token operator">==</span> <span class="token keyword">typeof</span> e <span class="token operator">&amp;&amp;</span> e <span class="token operator">&amp;&amp;</span> e<span class="token punctuation">.</span>__esModule<span class="token punctuation">)</span> <span class="token keyword">return</span> e<span class="token punctuation">;</span>
        <span class="token keyword">var</span> r <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>
          <span class="token punctuation">(</span>n<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">,</span>
          Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> e <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token number">2</span> <span class="token operator">&amp;</span> t <span class="token operator">&amp;&amp;</span> <span class="token string">&quot;string&quot;</span> <span class="token operator">!=</span> <span class="token keyword">typeof</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> o <span class="token keyword">in</span> e<span class="token punctuation">)</span>
            n<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>
              r<span class="token punctuation">,</span>
              o<span class="token punctuation">,</span>
              <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">t</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> e<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> o<span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> r<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span>n<span class="token punctuation">.</span><span class="token function-variable function">n</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> t <span class="token operator">=</span>
          e <span class="token operator">&amp;&amp;</span> e<span class="token punctuation">.</span>__esModule
            <span class="token operator">?</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> e<span class="token punctuation">.</span>default<span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
            <span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> e<span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> n<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">,</span> t<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span>n<span class="token punctuation">.</span><span class="token function-variable function">o</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span> t</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span>n<span class="token punctuation">.</span>p <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">n</span><span class="token punctuation">(</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span>s <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span> t<span class="token punctuation">,</span> n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>
      <span class="token keyword">function</span> <span class="token function">r</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">&quot;null&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;&quot;</span> <span class="token operator">:</span> e<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">function</span> <span class="token function">o</span><span class="token punctuation">(</span><span class="token parameter">e <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> t <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">([^?=&amp;]+)=([^&amp;]*)</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> t
          <span class="token operator">?</span> t<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>
              <span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span> t</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
                <span class="token punctuation">(</span>e<span class="token punctuation">[</span>t<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;=&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">r</span><span class="token punctuation">(</span>
                  t<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;=&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                e
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token punctuation">)</span>
          <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      n<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">,</span>
        n<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token string">&quot;transferDefectParams&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> r<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        n<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> o<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br></div></div><h3 id="_7-设置入口文件-不同环境下使用不同的入口文件"><a href="#_7-设置入口文件-不同环境下使用不同的入口文件" class="header-anchor">#</a> 7.设置入口文件 不同环境下使用不同的入口文件</h3> <p><code>package.json</code>中的<code>main</code>字段为<code>index.js</code>，所以在项目根目录下新建 <code>index.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// index.js</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&quot;production&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 通过环境变量来决定入口文件</span>
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./dist/tools.min.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./dist/tools.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_8-进行-npm-包发布-需要注册-npm-账号-且进行登录"><a href="#_8-进行-npm-包发布-需要注册-npm-账号-且进行登录" class="header-anchor">#</a> 8.进行 npm 包发布(需要注册 npm 账号,且进行登录)</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm publish
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_9-同步代码到-git-并编写对应的说明文档等"><a href="#_9-同步代码到-git-并编写对应的说明文档等" class="header-anchor">#</a> 9. 同步代码到 git,并编写对应的说明文档等</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 其他项目引用</span>
npm i tools <span class="token operator">-</span>s

<span class="token keyword">import</span> getUrlParameters <span class="token keyword">from</span> <span class="token string">'tools'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="custom-block tip"><p class="title"></p><p>完整代码参见<a href="https://github.com/xjl271314/webpack-build-tools" target="_blank" rel="noopener noreferrer">github 地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div><h2 id="webpack-实现-ssr-打包"><a href="#webpack-实现-ssr-打包" class="header-anchor">#</a> webpack 实现 SSR 打包</h2> <ul><li>2020.05.19</li></ul> <ol><li><p>客户端渲染: HTML + CSS + JS + Data ————&gt; 渲染后的 HTML</p></li> <li><p>服务端渲染:</p></li></ol> <ul><li><p>所有的模板等资源都存储在服务器</p></li> <li><p>内网机器拉取更快</p></li> <li><p>一个 HTML 返回所有的数据</p></li></ul> <p><img src="https://img-blog.csdnimg.cn/20200519202722384.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hqbDI3MTMxNA==,size_16,color_FFFFFF,t_70" alt="渲染差别"></p> <h3 id="ssr-代码实现思路"><a href="#ssr-代码实现思路" class="header-anchor">#</a> SSR 代码实现思路</h3> <ul><li>服务端：</li></ul> <ol><li><p>使用 <code>react-dom/server</code> 的 <code>renderToString</code> 方法将 <code>React组件</code> 渲染成字符串。</p></li> <li><p>服务端路由返回对应的模板。</p></li></ol> <ul><li>客户端</li></ul> <p>打包出针对服务端的组件。</p> <h3 id="简单示例"><a href="#简单示例" class="header-anchor">#</a> 简单示例</h3> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token comment">// package.json</span>
<span class="token property">&quot;script&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
  ...<span class="token punctuation">,</span>
  <span class="token property">&quot;build:ssr&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --config webpack.ssr.js&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>目录下新建 <code>server/index.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/* server/index.js */</span>

<span class="token comment">// 兼容window报错</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> window <span class="token operator">===</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  global<span class="token punctuation">.</span>window <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> renderToString <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;react-dom/server&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">SSR</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../dist/xx-server&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">server</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">port</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">&quot;dist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/search&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> html <span class="token operator">=</span> <span class="token function">renderMarkup</span><span class="token punctuation">(</span><span class="token function">renderToString</span><span class="token punctuation">(</span><span class="token constant">SSR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Server is running on port:&quot;</span><span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">server</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">renderMarkup</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;!DOCTYPE html&gt;
    &lt;html lang=&quot;en&quot;&gt;
    &lt;head&gt;
        &lt;meta charset=&quot;UTF-8&quot;&gt;
        &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
        &lt;title&gt;Document&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div id=&quot;root&quot;&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>str<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/div&gt;
    &lt;/body&gt;
    &lt;/html&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><p>组件目录下创建<code>index-server.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// index-server.js server端不能识别import 需要使用commonjs规范</span>
<span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> React <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;react&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">Example</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Hello World<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token operator">&lt;</span>Example <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>创建 <code>webpack.ssr.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// webpack.ssr.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'[name-server].js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">libraryTarget</span><span class="token operator">:</span> <span class="token string">'umd'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="打包过程中遇到的问题"><a href="#打包过程中遇到的问题" class="header-anchor">#</a> 打包过程中遇到的问题</h3> <h4 id="浏览器的全局变量-node-js-中没有document-window"><a href="#浏览器的全局变量-node-js-中没有document-window" class="header-anchor">#</a> 浏览器的全局变量(<code>Node.js</code> 中没有<code>document</code>, <code>window</code>)</h4> <ul><li><p>组件适配: 将不兼容的组件根据打包环境进行适配</p></li> <li><p>请求适配: 将<code>fetch</code> 或者 <code>ajax</code> 发送请求的写法改成 <code>isomorphic-fetch</code> 或者 <code>axios</code></p></li></ul> <h4 id="样式问题-node-js-无法解析css"><a href="#样式问题-node-js-无法解析css" class="header-anchor">#</a> 样式问题(<code>Node.js</code> 无法解析<code>CSS</code>)</h4> <ul><li><p>服务端打包通过 <code>ignore-loader</code> 忽略掉 <code>CSS的解析</code></p></li> <li><p>将<code>style-loader</code> 替换成 <code>isomorphic-style-loader</code></p></li> <li><p>或者使用内联样式<code>style</code></p></li></ul> <h3 id="解决打包样式问题"><a href="#解决打包样式问题" class="header-anchor">#</a> 解决打包样式问题</h3> <p>使用打包出来的浏览器端 html 文件作为模板, 设置占位符, 动态插入组件。</p> <p>修改 <code>/server/index.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> template <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">&quot;xxx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>修改对应的 <code>template.html</code></p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- HTML_PLCAEHOLDER ---&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="优化构建时命令行的显示"><a href="#优化构建时命令行的显示" class="header-anchor">#</a> 优化构建时命令行的显示</h2> <ul><li>2020.05.26</li></ul> <p>实际开发过程中当我们进行打包<code>npm run build</code>或者在开发过程中<code>npm run dev</code>的时候会在控制台输出大量的信息。</p> <h3 id="使用-friendly-errors-webpack-plugin-优化日志显示"><a href="#使用-friendly-errors-webpack-plugin-优化日志显示" class="header-anchor">#</a> 使用 <code>friendly-errors-webpack-plugin</code> 优化日志显示</h3> <ul><li><p><code>success</code>: 构建成功的日志提示</p></li> <li><p><code>warning</code>: 构建警告的日志提示</p></li> <li><p><code>error</code>: 构建报错的日志提示</p></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token literal-property property">stats</span><span class="token operator">:</span> <span class="token string">'errors-only'</span>
<span class="token operator">...</span>
<span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token punctuation">[</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">FriendlyErrorsWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="commonschunkplugin"><a href="#commonschunkplugin" class="header-anchor">#</a> CommonsChunkPlugin</h2> <ul><li>2020.05.18</li></ul> <blockquote><p>主要是用来提取第三方库和公共模块，避免<code>首屏加载的bundle文件</code>或者<code>按需加载的bundle文件</code>体积过大，从而导致加载时间过长，是一把优化项目的利器。</p></blockquote> <div class="custom-block tip"><p class="title"></p><p><code>webpack4</code>之后推荐使用<code>splitChunks</code>替代该方法。</p></div><h3 id="chunk-有哪几种-主要有以下三种"><a href="#chunk-有哪几种-主要有以下三种" class="header-anchor">#</a> chunk 有哪几种，主要有以下三种：</h3> <ol><li><p><code>webpack</code>当中配置的<code>入口文件（entry）</code>是<code>chunk</code>，可以理解为<code>entry chunk</code></p></li> <li><p>入口文件以及它的依赖文件通过<code>code split（代码分割</code>）出来的也是<code>chunk</code>，可以理解为<code>children chunk</code></p></li> <li><p>通过<code>commonsChunkPlugin</code>创建出来的文件也是<code>chunk</code>，可以理解为<code>commons chunk</code></p></li></ol> <h3 id="可配置的属性"><a href="#可配置的属性" class="header-anchor">#</a> 可配置的属性：</h3> <table><thead><tr><th style="text-align:left;">属性名</th> <th style="text-align:left;">属性说明</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>name</code></td> <td style="text-align:left;">可以是已经存在的<code>chunk（一般指入口文件</code>）对应的<code>name</code>，那么就会把公共模块代码合并到这个<code>chunk</code>上；否则，就会创建名字为<code>name</code>的<code>commons chunk</code>进行合并</td></tr> <tr><td style="text-align:left;"><code>filename</code></td> <td style="text-align:left;">指定<code>commons chunk</code>的文件名</td></tr> <tr><td style="text-align:left;"><code>chunks</code></td> <td style="text-align:left;">指定该<code>source chunk</code>，即指定从哪些<code>chunk</code>当中去找公共模块，省略该选项的时候，默认就是<code>entry chunks</code></td></tr> <tr><td style="text-align:left;"><code>minChunks</code></td> <td style="text-align:left;">既可以数字，也可以是函数，还可以是<code>Infinity</code></td></tr></tbody></table> <h4 id="插件的作用"><a href="#插件的作用" class="header-anchor">#</a> 插件的作用:</h4> <p>单独分离出第三方库、自定义公共模块、webpack 运行文件</p> <ul><li>抽离 webpack 运行文件，修改 webpack 配置文件：</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>CommonsChunkPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;vendor&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;runtime&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;[name].js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">minChunks</span><span class="token operator">:</span> <span class="token number">Infinity</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>上面这段抽离<code>webpack</code>运行文件代码的意思是创建一个名为<code>runtime</code>的<code>commons chunk</code>进行<code>webpack</code>运行文件的抽离，其中<code>source chunks</code>是<code>vendor.js</code>。</p> <h2 id="cleanwebpackplugin"><a href="#cleanwebpackplugin" class="header-anchor">#</a> CleanWebpackPlugin</h2> <blockquote><p>清理构建目录</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="extracttextwebpackplugin"><a href="#extracttextwebpackplugin" class="header-anchor">#</a> ExtractTextWebpackPlugin</h2> <blockquote><p>将 CSS 从 bundle 中提取成一个独立的 css 文件</p></blockquote> <h2 id="copywebpackplugin"><a href="#copywebpackplugin" class="header-anchor">#</a> CopyWebpackPlugin</h2> <blockquote><p>将文件或者文件夹拷贝到构建的输出目录</p></blockquote> <h2 id="uglifyjswebpackplugin"><a href="#uglifyjswebpackplugin" class="header-anchor">#</a> UglifyjsWebpackPlugin</h2> <blockquote><p>压缩 JS</p></blockquote> <h2 id="zipwebpackplugin"><a href="#zipwebpackplugin" class="header-anchor">#</a> ZipWebpackPlugin</h2> <blockquote><p>将打包出的资源生成一个 zip 包</p></blockquote> <h2 id="minicssextractplugin"><a href="#minicssextractplugin" class="header-anchor">#</a> MiniCssExtractPlugin</h2> <ul><li>2020.05.29</li></ul> <blockquote><p>将 css 打包成单独的 css 文件</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// npm i  mini-css-extract-plugin</span>

<span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;mini-css-extract-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&quot;development&quot;</span><span class="token punctuation">,</span> <span class="token comment">//打包为开发模式</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&quot;./src/main&quot;</span><span class="token punctuation">,</span> <span class="token comment">//入口文件,从项目根目录指定</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">//输出路径和文件名，使用path模块resolve方法将输出路径解析为绝对路径</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../dist/js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//将js文件打包到dist/js的目录</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;main.js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">minimize</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;../css/styles.css&quot;</span><span class="token punctuation">,</span> <span class="token comment">//如果需要将css文件单独放入css文件夹中需要../</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h2 id="htmlwebpackplugin"><a href="#htmlwebpackplugin" class="header-anchor">#</a> HtmlWebpackPlugin</h2> <ol><li><p><a href="https://github.com/jantimon/html-webpack-plugin" target="_blank" rel="noopener noreferrer"><code>HtmlWebpackPlugin</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> star: 8.5K</p> <p>主要有两个作用:</p> <ol><li><p>为<code>html</code>文件中引入的外部资源如<code>script</code>、<code>link</code>动态添加每次<code>compile</code>后的<code>hash</code>，防止引用缓存的外部文件问题</p></li> <li><p>可以生成创建<code>html</code>入口文件，比如单页面可以生成一个<code>html</code>文件入口，配置 N 个<code>html-webpack-plugin</code>可以生成 N 个页面入口</p></li></ol> <p>常用的字段：</p> <ul><li><p><code>title</code>:设置生成<code>html</code>文件的标题 默认值为:<code>Webpack App</code></p></li> <li><p><code>filename</code>: 输出的<code>html</code>的文件名称 默认值为:<code>index.html</code></p></li> <li><p><code>template</code>: html 模板所在的文件路径</p></li></ul> <p>根据自己的指定的模板文件来生成特定的 <code>html</code> 文件。这里的模板类型可以是任意你喜欢的模板，可以是 <code>html</code>, <code>jade</code>, <code>ejs</code>, <code>hbs</code>, 等等，但是要注意的是，使用自定义的模板文件时，需要提前安装对应的 <code>loader</code>， 否则<code>webpack</code>不能正确解析。</p> <ul><li><p><code>inject</code>:注入选项。</p> <ol><li><code>true</code>：默认值，script 标签位于 html 文件的 body 底部</li> <li><code>body</code>：script 标签位于 html 文件的 body 底部（同 true）</li> <li><code>head</code>：script 标签位于 head 标签内</li> <li><code>false</code>：不插入生成的 js 文件，只是单纯的生成一个 html 文件</li></ol></li> <li><p><code>favicon</code>:给生成的 <code>html</code> 文件生成一个 <code>favicon</code>。属性值为 <code>favicon</code> 文件所在的路径名</p></li> <li><p><code>minify</code>:对 <code>html</code> 文件进行压缩，<code>minify</code> 的属性值是一个压缩选项或者 <code>false</code> 。默认值为<code>false</code>, 不对生成的 <code>html</code> 文件进行压缩。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// 部分省略，具体看minify的配置</span>
    <span class="token literal-property property">minify</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">//是否对大小写敏感，默认false</span>
      <span class="token literal-property property">caseSensitive</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

      <span class="token comment">//是否简写boolean格式的属性如：disabled=&quot;disabled&quot; 简写为disabled  默认false</span>
      <span class="token literal-property property">collapseBooleanAttributes</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

      <span class="token comment">//是否去除空格，默认false</span>
      <span class="token literal-property property">collapseWhitespace</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

      <span class="token comment">//是否压缩html里的css（使用clean-css进行的压缩） 默认值false；</span>
      <span class="token literal-property property">minifyCSS</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

      <span class="token comment">//是否压缩html里的js（使用uglify-js进行的压缩）</span>
      <span class="token literal-property property">minifyJS</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

      <span class="token comment">//Prevents the escaping of the values of attributes</span>
      <span class="token literal-property property">preventAttributesEscaping</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

      <span class="token comment">//是否移除属性的引号 默认false</span>
      <span class="token literal-property property">removeAttributeQuotes</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

      <span class="token comment">//是否移除注释 默认false</span>
      <span class="token literal-property property">removeComments</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

      <span class="token comment">//从脚本和样式删除的注释 默认false</span>
      <span class="token literal-property property">removeCommentsFromCDATA</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

      <span class="token comment">//是否删除空属性，默认false</span>
      <span class="token literal-property property">removeEmptyAttributes</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

      <span class="token comment">//若开启此项，生成的html中没有 body 和 head，html也未闭合</span>
      <span class="token literal-property property">removeOptionalTags</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>

      <span class="token comment">//删除多余的属性</span>
      <span class="token literal-property property">removeRedundantAttributes</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

      <span class="token comment">//删除script的类型属性，在h5下面script的type默认值：text/javascript 默认值false</span>
      <span class="token literal-property property">removeScriptTypeAttributes</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

      <span class="token comment">//删除style的类型属性， type=&quot;text/css&quot; 同上</span>
      <span class="token literal-property property">removeStyleLinkTypeAttributes</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

      <span class="token comment">//使用短的文档类型，默认false</span>
      <span class="token literal-property property">useShortDoctype</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div></li> <li><p><code>hash</code>:给生成的 <code>js</code> 文件一个独特的 <code>hash</code> 值，该 <code>hash</code> 值是该次 <code>webpack</code> 编译的 <code>hash</code> 值。默认值为 <code>false</code> 。</p></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">hash</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
<span class="token comment">// 编译后</span>
<span class="token operator">&lt;</span>script type<span class="token operator">=</span>text<span class="token operator">/</span>javascript src<span class="token operator">=</span>bundle<span class="token punctuation">.</span>js<span class="token operator">?</span>22b9692e22e7be37b57e<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li><p><code>cache</code>:默认是<code>true</code>的，表示内容变化的时候生成一个新的文件。</p></li> <li><p><code>showErrors</code>:如果 webpack 编译出现错误，webpack 会将错误信息包裹在一个 pre 标签内，属性的默认值为 true ，也就是显示错误信息。开启这个，方便定位错误.</p></li> <li><p><code>chunks</code>:chunks 主要用于多入口文件，当你有多个入口文件，那就会编译后生成多个打包后的文件，那么<code>chunks</code> 就能选择你要使用那些 js 文件。</p></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">index</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">devor</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./src/devor.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">main</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./src/main.js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">httpWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'index'</span><span class="token punctuation">,</span><span class="token string">'main'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
<span class="token comment">// 打包后</span>
<span class="token operator">&lt;</span>script type<span class="token operator">=</span>text<span class="token operator">/</span>javascript src<span class="token operator">=</span><span class="token string">&quot;index.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script type<span class="token operator">=</span>text<span class="token operator">/</span>javascript src<span class="token operator">=</span><span class="token string">&quot;main.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token comment">// 而如果没有指定 chunks 选项，默认会全部引用。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ul><li><code>excludeChunks</code>:排除掉一些 js 不进行打包</li></ul></li></ol> <h2 id="path-与-publicpath"><a href="#path-与-publicpath" class="header-anchor">#</a> path 与 publicPath</h2> <p>在复杂的项目里可能会有一些构建出的资源需要异步加载，加载这些异步资源需要对应的 URL 地址。</p> <p><code>output.publicPath</code>配置发布到线上资源的 URL 前缀，为<code>string</code>类型，默认值是字符串’’，即使用相对路径。</p> <p>例如：需要将构建出的资源文件上传到 CDN 服务上，以利于加快页面的打开速度，配置代码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;[name]_[chunkhash:8].js&quot;</span><span class="token punctuation">;</span>
<span class="token literal-property property">publicPath</span><span class="token operator">:</span> <span class="token string">&quot;https://cdn.example.com/assets/&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><p><code>path</code>是<code>webpack</code>构建后输出构建结果的目录，必须是<code>绝对路径</code>.</p></li> <li><p><code>publicPath</code>并不会对生成文件的路径造成影响，主要是对你的页面里面引入的资源的路径做对应的补全，常见的就是 css 文件里面引入的图片 url 值.</p></li></ul> <h2 id="构建配置抽离成-npm-包"><a href="#构建配置抽离成-npm-包" class="header-anchor">#</a> 构建配置抽离成 npm 包</h2> <ul><li>2020.05.26</li></ul> <h3 id="意义-2"><a href="#意义-2" class="header-anchor">#</a> 意义</h3> <ul><li><p>通用性</p> <ul><li>业务的开发者无需关注构建配置</li> <li>统一团队构建脚本</li></ul></li> <li><p>可维护性</p> <ul><li>构建配置合理的拆分</li> <li>README 文档、ChangeLog 文档等</li></ul></li> <li><p>质量</p> <ul><li>冒烟测试</li> <li>持续集成</li></ul></li></ul> <h3 id="可选方案"><a href="#可选方案" class="header-anchor">#</a> 可选方案</h3> <p><strong>1. 通过配置多个文件区分不同环境的构建 <code>webpack --config</code> 进行参数的控制</strong></p> <ul><li>基础环境: webpack.base.js</li> <li>开发环境: webpack.dev.js</li> <li>生成环境: webpack.prod.js</li> <li>SSR 环境: webpack.ssr.js</li> <li>PWA 环境: webpack.pwa.js</li></ul> <p><strong>2. 将构建配置设计成一个库， 比如 <code>hjs-webpack</code></strong></p> <ul><li>规范: Git Commit 日志、README 文档、ESlint 规范、Semver 规范等</li> <li>质量: 冒烟测试、单元测试、测试覆盖率和 CI 等</li></ul> <p><strong>3. 抽离成一个工具进行管理， 比如 <code>create-react-app</code></strong></p> <p><strong>4. 将所有配置放在一个文件，通过一个 <code>--env</code> 参数控制分支选择</strong></p> <h3 id="组合"><a href="#组合" class="header-anchor">#</a> 组合</h3> <blockquote><p>推荐使用<code>webpack-merge</code>组合我们的配置</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> merge <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack-merge&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>baseConfig<span class="token punctuation">,</span> devConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="构建包功能模块设计"><a href="#构建包功能模块设计" class="header-anchor">#</a> 构建包功能模块设计</h2> <ul><li>2020.05.27</li></ul> <p><img src="https://img-blog.csdnimg.cn/2020052712400568.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hqbDI3MTMxNA==,size_16,color_FFFFFF,t_70" alt="构建功能模块设计"></p> <h2 id="目录结构设计"><a href="#目录结构设计" class="header-anchor">#</a> 目录结构设计</h2> <p><img src="https://img-blog.csdnimg.cn/20200527203103923.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hqbDI3MTMxNA==,size_16,color_FFFFFF,t_70" alt="目录结构设计"></p> <h2 id="冒烟测试"><a href="#冒烟测试" class="header-anchor">#</a> 冒烟测试</h2> <ul><li>2020.6.01</li></ul> <ol><li><p>判断构建是否成功</p></li> <li><p>判断基本功能是否正常</p></li></ol> <p>借助第三方工具 jest 等。</p> <h2 id="单元测试和测试覆盖率"><a href="#单元测试和测试覆盖率" class="header-anchor">#</a> 单元测试和测试覆盖率</h2> <ul><li>2020.06.01</li></ul> <h3 id="单纯的测试框架-需要断言库"><a href="#单纯的测试框架-需要断言库" class="header-anchor">#</a> 单纯的测试框架,需要断言库</h3> <ul><li>chai</li> <li>mocha</li> <li>ava</li> <li>should.js</li> <li>expect</li> <li>better-assert</li></ul> <h3 id="集成框架-开箱即用"><a href="#集成框架-开箱即用" class="header-anchor">#</a> 集成框架，开箱即用</h3> <ul><li>jest</li> <li>jasmine</li></ul> <h3 id="编写单元测试用例"><a href="#编写单元测试用例" class="header-anchor">#</a> 编写单元测试用例</h3> <p><img src="https://img-blog.csdnimg.cn/20200601203435647.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hqbDI3MTMxNA==,size_16,color_FFFFFF,t_70" alt="编写单元测试用例"></p> <h3 id="单元测试的接入"><a href="#单元测试的接入" class="header-anchor">#</a> 单元测试的接入</h3> <ol><li>安装相关的插件</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm i mocha chai -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="2"><li><p>新建<code>test</code>目录, 并增加 <code>xxx.test.js</code> 测试文件</p></li> <li><p>在 <code>package.json</code> 中的 <code>scripts</code> 字段增加 <code>test</code> 命令</p></li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node_modules/mocha/bin/_mocha&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="4"><li>执行测试命令</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm run test
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="验证测试覆盖率"><a href="#验证测试覆盖率" class="header-anchor">#</a> 验证测试覆盖率</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm i -g istanbul
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>修改 script</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;istanbul cover node_modules/mocha/bin/_mocha&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="构建包的持续集成和-travis-ci"><a href="#构建包的持续集成和-travis-ci" class="header-anchor">#</a> 构建包的持续集成和 Travis CI</h2> <ul><li>2020.07.27</li></ul> <h3 id="接入-travis-ci"><a href="#接入-travis-ci" class="header-anchor">#</a> 接入 Travis CI</h3> <ol><li><p>https://travis-ci.org 使用 Github 账号登录</p></li> <li><p>在https://travis-ci.org/account/repositories为项目开启</p></li> <li><p>项目根目录下新增 .travis.yml</p></li></ol> <p>具体流程可以参考<a href="https://docs.travis-ci.com/user/deployment/" target="_blank" rel="noopener noreferrer">官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="发布构建包到-npm"><a href="#发布构建包到-npm" class="header-anchor">#</a> 发布构建包到 npm</h2> <ul><li>2020.07.27</li></ul> <h3 id="添加用户"><a href="#添加用户" class="header-anchor">#</a> 添加用户</h3> <blockquote><p>npm adduser</p></blockquote> <h3 id="升级版本"><a href="#升级版本" class="header-anchor">#</a> 升级版本</h3> <ul><li><p>升级补丁版本号: npm version patch</p></li> <li><p>升级小版本号: npm version minor</p></li> <li><p>升级大版本号: npm version major</p></li></ul> <h3 id="发布版本"><a href="#发布版本" class="header-anchor">#</a> 发布版本</h3> <blockquote><p>npm publish</p></blockquote> <div class="custom-block tip"><p class="title"></p><p>发布的时候需要去搜索下 当前包名是否已经被使用。包里不要带上一些不相干的文件。</p></div><h2 id="使用-webpack-内部的-stats-进行构建包的初步分析"><a href="#使用-webpack-内部的-stats-进行构建包的初步分析" class="header-anchor">#</a> 使用 webpack 内部的 stats 进行构建包的初步分析</h2> <ul><li>2020.07.28</li></ul> <blockquote><p>webpack 内部给我们提供了一个 stats 的功能,我们可以在 script 中配置。</p></blockquote> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token comment">// package.json</span>
<span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
  <span class="token property">&quot;build:stats&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --env production --json &gt; stats.json&quot;</span>
<span class="token punctuation">}</span>
...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>在 Node.js 中使用</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./webpack.config.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">&quot;production&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">webpack</span><span class="token punctuation">(</span>config<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stats</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">hasErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">&quot;errors-only&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stats<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>这种方式可以达到简单的分析效果 但是颗粒度太细,看不太出问题的所在。</p> <h2 id="使用-speed-measure-webpack-plugin-进行速度分析"><a href="#使用-speed-measure-webpack-plugin-进行速度分析" class="header-anchor">#</a> 使用 speed-measure-webpack-plugin 进行速度分析</h2> <ul><li>2020.07.28</li></ul> <blockquote><p>使用该插件可以直观的看到每个 loader 和插件执行耗时以及打包的总耗时。</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> SpeedMeasureWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'speed-measure-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> smp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpeedMeasureWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> webpackVonfig <span class="token operator">=</span> smp<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token comment">// 需要分析的插件</span>
    <span class="token keyword">new</span> <span class="token class-name">MyPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">new</span> <span class="token class-name">MyOtherPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="custom-block tip"><p class="title"></p><p>构建比较耗时的会显示为红色，构建较耗时的会显示为黄色,构建速度正常的会显示为绿色。</p></div><h2 id="使用-webpack-bundle-analyzer-进行体积分析"><a href="#使用-webpack-bundle-analyzer-进行体积分析" class="header-anchor">#</a> 使用 webpack-bundle-analyzer 进行体积分析</h2> <ul><li>2020.07.29</li></ul> <blockquote><p>使用该插件可以分析项目内依赖的第三方模块文件的大小以及业务内组件代码的大小。</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> BundleAnalyzerPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-bundle-analyzer'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>BundleAnalyzerPlugin<span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">BundleAnalyzerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>构建完成后会在 8888 端口进行构建包大小的展示。</p> <h2 id="多进程-多实例并行压缩"><a href="#多进程-多实例并行压缩" class="header-anchor">#</a> 多进程/多实例并行压缩</h2> <ul><li>2020.08.07</li></ul> <h3 id="使用-parallel-uglify-plugin"><a href="#使用-parallel-uglify-plugin" class="header-anchor">#</a> 使用 parallel-uglify-plugin</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> parallelUglifyPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;parallel-uglify-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">parallelUglifyPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">uglifyJS</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">beautify</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
          <span class="token literal-property property">comments</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">compress</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">warning</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
          <span class="token literal-property property">drop_console</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token literal-property property">collapse_vars</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token literal-property property">reduce_vars</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="使用-uglifyjs-webpack-plugin-并开启-parallel-参数"><a href="#使用-uglifyjs-webpack-plugin-并开启-parallel-参数" class="header-anchor">#</a> 使用 uglifyjs-webpack-plugin 并开启 parallel 参数</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> UglifyJsPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;uglifyjs-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugin</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">UglifyJsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">uglifyOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">warnings</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token literal-property property">parse</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">compress</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">mangle</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        <span class="token literal-property property">toplevel</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token literal-property property">nameCache</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        <span class="token literal-property property">ie8</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token literal-property property">keep_names</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">parallel</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="使用-terser-webpack-plugin-开启-parallel-参数"><a href="#使用-terser-webpack-plugin-开启-parallel-参数" class="header-anchor">#</a> 使用 terser-webpack-plugin 开启 parallel 参数</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> TerserPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;terser-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">minimizer</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">parallel</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="通过设置-externals-进行分包"><a href="#通过设置-externals-进行分包" class="header-anchor">#</a> 通过设置 Externals 进行分包</h2> <ul><li>2020.08.07</li></ul> <h3 id="使用-html-webpack-externals-plugin"><a href="#使用-html-webpack-externals-plugin" class="header-anchor">#</a> 使用 html-webpack-externals-plugin</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> HtmlWebpackExternalsPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;html-webpack-externals-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugin</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackExternalsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">externals</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&quot;react_cdn_url&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">global</span><span class="token operator">:</span> <span class="token string">&quot;React&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token string">&quot;react-dom&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&quot;react_dom_url&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">global</span><span class="token operator">:</span> <span class="token string">&quot;ReactDom&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="进一步分包-采用预编译资源模块"><a href="#进一步分包-采用预编译资源模块" class="header-anchor">#</a> 进一步分包:采用预编译资源模块</h3> <blockquote><p>思路: 将 react、react-dom、redux、react-redux 基础包和业务基础包打包成一个文件。</p></blockquote> <p>方法: 使用 <code>DLLPlugin</code>进行分包,<code>DllReferencePlugin</code> 对 <code>manifest.json</code> 引用。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">context</span><span class="token operator">:</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">extensions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;.js&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.jsx&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.json&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.less&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.css&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.scss&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token punctuation">[</span>__driname<span class="token punctuation">,</span> <span class="token string">&quot;node_modules&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">library</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;react&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;react-dom&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;redux&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;react-redux&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;[name].dll.js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./build/library&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">library</span><span class="token operator">:</span> <span class="token string">&quot;[name]&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DLLPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;[name]&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&quot;./build/library/[name].json&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>包构建完成后,在<code>webpack.config.js</code>中引入</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">manifest</span><span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./build/library/manifest.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>引用效果,会在 html 文件中加入一个脚本。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/build/library/library.dll.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>完整的配置示例:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// webpack.dll.js</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">library</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;react&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;react-dom&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;redux&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;react-redux&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;[name]_[chunkhash].dll.js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./build/library&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">library</span><span class="token operator">:</span> <span class="token string">&quot;[name]&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 暴露库的名字</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DLLPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;[name]_[hash]&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;build/library/[name].json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// webpack.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">manifest</span><span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./build/library/manifest.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h3 id="充分利用缓存提升二次构建速度"><a href="#充分利用缓存提升二次构建速度" class="header-anchor">#</a> 充分利用缓存提升二次构建速度</h3> <p>缓存思路:</p> <ul><li><code>babel-loder</code> 开启缓存</li> <li><code>terser-webpack-plugin</code> 开启缓存</li> <li>使用 <code>cache-loader</code> 或者 <code>hard-source-webpack-plugin</code></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// babel-loder 开启缓存</span>

<span class="token literal-property property">loaders</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'babel-loader?cacheDirectory=true'</span><span class="token punctuation">]</span>

<span class="token comment">// terser-webpack-plugin 开启缓存</span>
<span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">minizer</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">parallel</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token literal-property property">cache</span><span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token comment">// hard-source-webpack-plugin(https://github.com/mzgoddard/hard-source-webpack-plugin)</span>
<span class="token keyword">var</span> HardSourceWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'hard-source-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">context</span><span class="token operator">:</span> <span class="token comment">// ...</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token comment">// ...</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token comment">// ...</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HardSourceWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h2 id="缩小构建目标"><a href="#缩小构建目标" class="header-anchor">#</a> 缩小构建目标</h2> <ul><li>2020.08.13</li></ul> <blockquote><p>尽可能的少构建模块。</p></blockquote> <h3 id="比如-babel-loader-不解析-node-modules"><a href="#比如-babel-loader-不解析-node-modules" class="header-anchor">#</a> 比如 <code>babel-loader</code> 不解析 <code>node_modules</code></h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token string">&quot;/.js$&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;happypack/loader&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token string">&quot;node_modules&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="减少文件搜索范围"><a href="#减少文件搜索范围" class="header-anchor">#</a> 减少文件搜索范围</h3> <ul><li>优化 <code>resolve.modules</code> 配置(减少模块搜索层级)</li> <li>优化 <code>resolve.mainFields</code> 配置</li> <li>优化 <code>resolve.extensions</code> 配置</li> <li>合理使用 <code>alias</code></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">react</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./node_modules/react/dist/react.min.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;node_modules&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 先找项目内 找不到直接去node_modules找 以减少模块搜索的层级</span>
    <span class="token literal-property property">extensions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;.js&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// import一个文件没有后缀 优先查找.js文件 如果数组内配置较多 查找也比较耗时</span>
    <span class="token literal-property property">mainFields</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;main&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="tree-shaking-在-css-中的优化"><a href="#tree-shaking-在-css-中的优化" class="header-anchor">#</a> Tree Shaking 在 CSS 中的优化</h2> <ul><li>2020.08.13</li></ul> <p>之前的章节中已经介绍过<code>Tree Shaking</code> 的相关原理和在 js 中的使用,那么如何在<code>CSS</code>中也进行相应的优化呢?</p> <ul><li><p><code>PurifyCSS</code>: 遍历代码,识别已经用到的 CSS Class。</p></li> <li><p><code>uncss</code>: <code>HTML</code>需要通过<code>jsdom</code>加载,所有的样式通过<code>PostCss</code>解析,通过<code>document.querySelector</code>来识别在<code>html</code>文件里面不存在的选择器。</p></li></ul> <p>这里将使用 <a href="https://github.com/FullHuman/purgecss-webpack-plugin" target="_blank" rel="noopener noreferrer">purgecss-webpack-plugin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 配合 <a href="https://github.com/webpack-contrib/mini-css-extract-plugin" target="_blank" rel="noopener noreferrer">mini-css-extract-plugin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 来使用。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;mini-css-extract-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token comment">// Options similar to the same options in webpackOptions.output</span>
      <span class="token comment">// both options are optional</span>
      <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;[name].css&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">chunkFilename</span><span class="token operator">:</span> <span class="token string">&quot;[id].css&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>
            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">publicPath</span><span class="token operator">:</span> <span class="token string">&quot;/public/path/to/&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// PurgecssPlugin</span>
<span class="token keyword">const</span> PurgecssPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;purgecss-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">PATHS</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">src</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">PurgecssPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">paths</span><span class="token operator">:</span> glob<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">PATHS</span><span class="token punctuation">.</span>src<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/**/*</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">nodir</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><h2 id="使用-webpack-进行图片压缩"><a href="#使用-webpack-进行图片压缩" class="header-anchor">#</a> 使用 webpack 进行图片压缩</h2> <ul><li>2020.08.13</li></ul> <p>要求: 基于 <code>Node</code>库的 <code>imagemin</code> 或者 <code>tinypng API</code></p> <p>使用: 配置 <code>image-webpack-plugin</code></p> <h3 id="使用-imagemin-的优点分析"><a href="#使用-imagemin-的优点分析" class="header-anchor">#</a> 使用 Imagemin 的优点分析</h3> <ul><li><p>有很多定制选项</p></li> <li><p>可以引入更多第三方优化插件，例如 pngquant</p></li> <li><p>可以处理多种图片格式</p></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">return</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token string">&quot;/.(png|svg|jpg|gif|blob)&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;file-loader&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>filename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">img/[name]</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>hash<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.[ext]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;image-webpack-loader&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">mozjpeg</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">progressive</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token literal-property property">quality</span><span class="token operator">:</span> <span class="token number">65</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">optipng</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">enabled</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">pngquant</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">quality</span><span class="token operator">:</span> <span class="token string">&quot;65-90&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">speed</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">gifsicle</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">interlaced</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">webp</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">quality</span><span class="token operator">:</span> <span class="token number">75</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h3 id="imagemin-的压缩原理"><a href="#imagemin-的压缩原理" class="header-anchor">#</a> Imagemin 的压缩原理</h3> <ul><li><p><code>pngquant</code>: 一款 PNG 压缩器,通过将图像转化为具有<code>alpha通道</code>(通常比 24/32 位 PNG 文件小 60-80%)的更高效的 8 位 PNG 格式,可显著减小文件大小。</p></li> <li><p><code>pngcrush</code>: 其主要目的是通过尝试不同的压缩级别和 PNG 过滤方法来降低 PNG IDAT 数据流的大小。</p></li> <li><p><code>optipng</code>: 其设计灵感来自于<code>pngcrush</code>。<code>optipng</code>可将图像文件重新压缩为更小尺寸,而不会失去任何信息。</p></li> <li><p><code>tinypng</code>: 将 24 位 png 文件转化为更小有索引的 8 位图片,同时所有非必要的<code>metadata</code>也会被剥离掉。</p></li></ul> <h2 id="使用动态的-ployfill-优化构建体积"><a href="#使用动态的-ployfill-优化构建体积" class="header-anchor">#</a> 使用动态的 Ployfill 优化构建体积</h2> <ul><li>2020.08.14</li></ul> <table><thead><tr><th style="text-align:left;">方案</th> <th style="text-align:left;">优点</th> <th style="text-align:left;">缺点</th> <th style="text-align:left;">建议</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>babel-polyfill</code></td> <td style="text-align:left;">React16 官方推荐方案</td> <td style="text-align:left;">1. 包体积约 200K+,难以单独抽离 Map、Set。 2. 项目里 react 是单独引用的 cdn,如果用使用的话,需要单独构建一份放在 react 前加载。</td> <td style="text-align:left;">不建议采用</td></tr> <tr><td style="text-align:left;"><code>babel-plugin-transform-runtime</code></td> <td style="text-align:left;">能只 polyfill 用到的类或方法,相对体积较小</td> <td style="text-align:left;">不能 polyfill 原型上的方法,不适用于业务项目的复杂开发环境</td> <td style="text-align:left;">不建议采用</td></tr> <tr><td style="text-align:left;"><code>自己写Map、Set的polyfill</code></td> <td style="text-align:left;">定制化高,体积小</td> <td style="text-align:left;">1. 重复造轮子,容易在日后年久失修或者成为坑 2. 即使体积小,依然所以用户都要加载。</td> <td style="text-align:left;">不建议采用</td></tr> <tr><td style="text-align:left;"><code>polyfill-service</code></td> <td style="text-align:left;">只给用户返回需要的 polyfill,社区维护</td> <td style="text-align:left;">部分国内奇葩浏览器 UA 可能无法识别(但是可以降级返回所需全部 polyfill)</td> <td style="text-align:left;">推荐使用</td></tr></tbody></table> <h3 id="polyfill-service-原理"><a href="#polyfill-service-原理" class="header-anchor">#</a> Polyfill Service 原理</h3> <blockquote><p>识别访问的<code>User Agent</code>,下发不同的 <code>Polyfill</code></p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;https://cdn.polyfill.io/v2/polyfill.min.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="webpack-启动过程分析"><a href="#webpack-启动过程分析" class="header-anchor">#</a> webpack 启动过程分析</h2> <ul><li>2020.08.14</li></ul> <p><strong>思考:</strong></p> <ul><li><p>通过 <code>npm scripts</code> 运行 <code>webpack</code> -开发环境: <code>npm run dev</code> -生产环境: <code>npm run build</code></p></li> <li><p>通过 webpack 直接运行</p> <ul><li><code>webpack entry.js bundle.js</code></li></ul></li></ul> <p><strong>这个过程到底发生了什么???</strong></p> <h3 id="_1-查找-webpack-入口文件"><a href="#_1-查找-webpack-入口文件" class="header-anchor">#</a> 1. 查找 webpack 入口文件</h3> <blockquote><p>在命令行运行以上命令后,<code>npm</code>会让命令行工具进入<code>node_modules/.bin</code> 目录查找是否存在 <code>webpack.sh(mac)</code> 或者 <code>webpack.cmd(windows)</code>文件,如果存在就执行,不存在就抛出错误。</p></blockquote> <p>实际的入口文件是: <code>node_modules/webpack/bin/webpack.js</code> 找到之后执行其中的代码。</p> <h3 id="_2-分析-webpack-的入口文件-webpack-js-到底做了什么事情"><a href="#_2-分析-webpack-的入口文件-webpack-js-到底做了什么事情" class="header-anchor">#</a> 2. 分析 webpack 的入口文件 webpack.js 到底做了什么事情</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token hashbang comment">#!/usr/bin/env node</span>

<span class="token comment">// @ts-ignore 正常执行的返回值</span>
process<span class="token punctuation">.</span>exitCode <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 运行某个命令之后返回一个promise
 * @param {string} command process to run
 * @param {string[]} args commandline arguments
 * @returns {Promise&lt;void&gt;} promise
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">runCommand</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">command<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> cp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;child_process&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> executedCommand <span class="token operator">=</span> cp<span class="token punctuation">.</span><span class="token function">spawn</span><span class="token punctuation">(</span>command<span class="token punctuation">,</span> args<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">stdio</span><span class="token operator">:</span> <span class="token string">&quot;inherit&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">shell</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    executedCommand<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    executedCommand<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;exit&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>code <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 判断某个包是否安装
 * @param {string} packageName name of the package
 * @returns {boolean} is the package installed?
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">isInstalled</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">packageName</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>packageName<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * webpack可用的CLI:webpack-cli 和 webpack-command
 * @typedef {Object} CliOption
 * @property {string} name display name
 * @property {string} package npm package name
 * @property {string} binName name of the executable file
 * @property {string} alias shortcut for choice
 * @property {boolean} installed currently installed?
 * @property {boolean} recommended is recommended
 * @property {string} url homepage
 * @property {string} description description
 */</span>

<span class="token comment">/** @type {CliOption[]} */</span>
<span class="token keyword">const</span> CLIs <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;webpack-cli&quot;</span><span class="token punctuation">,</span>
    <span class="token keyword">package</span><span class="token operator">:</span> <span class="token string">&quot;webpack-cli&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">binName</span><span class="token operator">:</span> <span class="token string">&quot;webpack-cli&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token string">&quot;cli&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">installed</span><span class="token operator">:</span> <span class="token function">isInstalled</span><span class="token punctuation">(</span><span class="token string">&quot;webpack-cli&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">recommended</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&quot;https://github.com/webpack/webpack-cli&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">&quot;The original webpack full-featured CLI.&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;webpack-command&quot;</span><span class="token punctuation">,</span>
    <span class="token keyword">package</span><span class="token operator">:</span> <span class="token string">&quot;webpack-command&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">binName</span><span class="token operator">:</span> <span class="token string">&quot;webpack-command&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token string">&quot;command&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">installed</span><span class="token operator">:</span> <span class="token function">isInstalled</span><span class="token punctuation">(</span><span class="token string">&quot;webpack-command&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">recommended</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&quot;https://github.com/webpack-contrib/webpack-command&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">&quot;A lightweight, opinionated webpack CLI.&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 判断两个CLI是否安装了</span>
<span class="token keyword">const</span> installedClis <span class="token operator">=</span> CLIs<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cli</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> cli<span class="token punctuation">.</span>installed<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 根据安装的CLI数量进行处理</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>installedClis<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> readLine <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;readline&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> notify <span class="token operator">=</span>
    <span class="token string">&quot;One CLI for webpack must be installed. These are recommended choices, delivered as separate packages:&quot;</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> item <span class="token keyword">of</span> CLIs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>recommended<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      notify <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\n - </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> (</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)\n   </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>description<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>notify<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> isYarn <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;yarn.lock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> packageManager <span class="token operator">=</span> isYarn <span class="token operator">?</span> <span class="token string">&quot;yarn&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;npm&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> installOptions <span class="token operator">=</span> <span class="token punctuation">[</span>isYarn <span class="token operator">?</span> <span class="token string">&quot;add&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;install&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-D&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">We will use &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>packageManager<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; to install the CLI via &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>packageManager<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>installOptions<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>
      <span class="token string">&quot; &quot;</span>
    <span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;.</span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> question <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Do you want to install 'webpack-cli' (yes/no): </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> questionInterface <span class="token operator">=</span> readLine<span class="token punctuation">.</span><span class="token function">createInterface</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">input</span><span class="token operator">:</span> process<span class="token punctuation">.</span>stdin<span class="token punctuation">,</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span> process<span class="token punctuation">.</span>stderr<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  questionInterface<span class="token punctuation">.</span><span class="token function">question</span><span class="token punctuation">(</span>question<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">answer</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    questionInterface<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> normalizedAnswer <span class="token operator">=</span> answer<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;y&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>normalizedAnswer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>
        <span class="token string">&quot;You need to install 'webpack-cli' to use webpack via CLI.\n&quot;</span> <span class="token operator">+</span>
          <span class="token string">&quot;You can also install the CLI manually.&quot;</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      process<span class="token punctuation">.</span>exitCode <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> packageName <span class="token operator">=</span> <span class="token string">&quot;webpack-cli&quot;</span><span class="token punctuation">;</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Installing '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>packageName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">' (running '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>packageManager<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>installOptions<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>
        <span class="token string">&quot; &quot;</span>
      <span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>packageName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">')...</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">runCommand</span><span class="token punctuation">(</span>packageManager<span class="token punctuation">,</span> installOptions<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>packageName<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">require</span><span class="token punctuation">(</span>packageName<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//eslint-disable-line</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        process<span class="token punctuation">.</span>exitCode <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>installedClis<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> pkgPath <span class="token operator">=</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>installedClis<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>package<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/package.json</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// eslint-disable-next-line node/no-missing-require</span>
  <span class="token keyword">const</span> pkg <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>pkgPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// eslint-disable-next-line node/no-missing-require</span>
  <span class="token function">require</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>
    path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>pkgPath<span class="token punctuation">)</span><span class="token punctuation">,</span>
    pkg<span class="token punctuation">.</span>bin<span class="token punctuation">[</span>installedClis<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>binName<span class="token punctuation">]</span>
  <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">You have installed </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>installedClis
      <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>
        <span class="token string">&quot; and &quot;</span>
      <span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> together. To work with the &quot;webpack&quot; command you need only one CLI package, please remove one of them or use them directly via their binary.</span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// @ts-ignore</span>
  process<span class="token punctuation">.</span>exitCode <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br></div></div><div class="custom-block tip"><p class="title"></p><p><strong>webpack 启动后的结果:</strong></p> <p><code>webpack</code>最终找到 <code>webpack-cli(webpack-command)</code>这个<code>npm</code>包,并且执行<code>CLI</code>命令。</p></div><h2 id="webpack-cli-源码阅读"><a href="#webpack-cli-源码阅读" class="header-anchor">#</a> webpack-cli 源码阅读</h2> <ul><li>2020.08.14</li></ul> <h3 id="webpack-cli-做的事情"><a href="#webpack-cli-做的事情" class="header-anchor">#</a> webpack-cli 做的事情</h3> <ol><li><p>引入了<code>yargs</code>,对命令进行定制</p></li> <li><p>分析命令行参数,对各个参数进行转换,组成编译配置项</p></li> <li><p>引用<code>webpack</code>,根据配置项进行编译和构建</p></li></ol> <h3 id="_1-从-non-compilation-cdm-分析出不需要编译的命令"><a href="#_1-从-non-compilation-cdm-分析出不需要编译的命令" class="header-anchor">#</a> 1.从 NON_COMPILATION_CDM 分析出不需要编译的命令</h3> <blockquote><p><code>webpack-cli</code>处理不需要经过编译的命令</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token hashbang comment">#!/usr/bin/env node</span>

<span class="token comment">/*
	MIT License http://www.opensource.org/licenses/mit-license.php
	Author Tobias Koppers @sokra
*/</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">NON_COMPILATION_ARGS</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./utils/constants&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// wrap in IIFE to be able to use return</span>

  <span class="token keyword">const</span> importLocal <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;import-local&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Prefer the local installation of webpack-cli</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">importLocal</span><span class="token punctuation">(</span>__filename<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;v8-compile-cache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> ErrorHelpers <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./utils/errorHelpers&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token constant">NON_COMPILATION_CMD</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>arg <span class="token operator">===</span> <span class="token string">&quot;serve&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      global<span class="token punctuation">.</span>process<span class="token punctuation">.</span>argv <span class="token operator">=</span> global<span class="token punctuation">.</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">!==</span> <span class="token string">&quot;serve&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      process<span class="token punctuation">.</span>argv <span class="token operator">=</span> global<span class="token punctuation">.</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token constant">NON_COMPILATION_ARGS</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">===</span> arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NON_COMPILATION_CMD</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./utils/prompt-command&quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>
      <span class="token constant">NON_COMPILATION_CMD</span><span class="token punctuation">,</span>
      <span class="token operator">...</span>process<span class="token punctuation">.</span>argv
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> yargs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;yargs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">usage</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">webpack-cli </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>
    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../package.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>version
  <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">

Usage: webpack-cli [options]
       webpack-cli [options] --entry &lt;entry&gt; --output &lt;output&gt;
       webpack-cli [options] &lt;entries...&gt; --output &lt;output&gt;
       webpack-cli &lt;command&gt; [options]

For more information, see https://webpack.js.org/api/cli/.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./config/config-yargs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>yargs<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// yargs will terminate the process early when the user uses help or version.</span>
  <span class="token comment">// This causes large help outputs to be cut short (https://github.com/nodejs/node/wiki/API-changes-between-v0.10-and-v4#process).</span>
  <span class="token comment">// To prevent this we use the yargs.parse API and exit the process normally</span>
  yargs<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> argv<span class="token punctuation">,</span> output</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    Error<span class="token punctuation">.</span>stackTraceLimit <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>

    <span class="token comment">// arguments validation failed</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err <span class="token operator">&amp;&amp;</span> output<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">;</span>
      process<span class="token punctuation">.</span>exitCode <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// help or version info</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>output<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>argv<span class="token punctuation">.</span>verbose<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      argv<span class="token punctuation">[</span><span class="token string">&quot;display&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;verbose&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> options<span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      options <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./utils/convert-argv&quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token string">&quot;MODULE_NOT_FOUND&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> moduleName <span class="token operator">=</span> err<span class="token punctuation">.</span>message<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> instructions <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> errorMessage <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>moduleName <span class="token operator">===</span> <span class="token string">&quot;webpack&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          errorMessage <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>moduleName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> not installed</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
          instructions <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Install webpack to start bundling: \u001b[32m\n  $ npm install --save-dev </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>moduleName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

          <span class="token keyword">if</span> <span class="token punctuation">(</span>
            process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>npm_execpath <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span>
            process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>npm_execpath<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;yarn&quot;</span><span class="token punctuation">)</span>
          <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            instructions <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Install webpack to start bundling: \u001b[32m\n $ yarn add </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>moduleName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> --dev\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          Error<span class="token punctuation">.</span>stackTraceLimit <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
          console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>errorMessage<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>instructions<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          process<span class="token punctuation">.</span>exitCode <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">.</span>name <span class="token operator">!==</span> <span class="token string">&quot;ValidationError&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">const</span> stack <span class="token operator">=</span> ErrorHelpers<span class="token punctuation">.</span><span class="token function">cleanUpWebpackOptions</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>stack<span class="token punctuation">,</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> message <span class="token operator">=</span> err<span class="token punctuation">.</span>message <span class="token operator">+</span> <span class="token string">&quot;\n&quot;</span> <span class="token operator">+</span> stack<span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>argv<span class="token punctuation">.</span>color<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\u001b[1m\u001b[31m</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\u001b[39m\u001b[22m</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      process<span class="token punctuation">.</span>exitCode <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * When --silent flag is present, an object with a no-op write method is
     * used in place of process.stout
     */</span>
    <span class="token keyword">const</span> stdout <span class="token operator">=</span> argv<span class="token punctuation">.</span>silent <span class="token operator">?</span> <span class="token punctuation">{</span> <span class="token function-variable function">write</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token operator">:</span> process<span class="token punctuation">.</span>stdout<span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> fn<span class="token punctuation">,</span> init</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>init<span class="token punctuation">)</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        argv<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> argv<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>init<span class="token punctuation">)</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">fn</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">processOptions</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// process Promise</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options<span class="token punctuation">.</span>then <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        options<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>processOptions<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>stack <span class="token operator">||</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// eslint-disable-next-line no-process-exit</span>
          process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">const</span> firstOptions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> statsPresetToOptions <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Stats<span class="token punctuation">.</span>presetToOptions<span class="token punctuation">;</span>

      <span class="token keyword">let</span> outputOptions <span class="token operator">=</span> options<span class="token punctuation">.</span>stats<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>
        <span class="token keyword">typeof</span> outputOptions <span class="token operator">===</span> <span class="token string">&quot;boolean&quot;</span> <span class="token operator">||</span>
        <span class="token keyword">typeof</span> outputOptions <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span>
      <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        outputOptions <span class="token operator">=</span> <span class="token function">statsPresetToOptions</span><span class="token punctuation">(</span>outputOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>outputOptions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        outputOptions <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;display&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">preset</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        outputOptions <span class="token operator">=</span> <span class="token function">statsPresetToOptions</span><span class="token punctuation">(</span>preset<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      outputOptions <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>outputOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>outputOptions<span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        outputOptions<span class="token punctuation">.</span>children <span class="token operator">=</span> options<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> o<span class="token punctuation">.</span>stats<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> outputOptions<span class="token punctuation">.</span>context <span class="token operator">===</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">)</span>
        outputOptions<span class="token punctuation">.</span>context <span class="token operator">=</span> firstOptions<span class="token punctuation">.</span>context<span class="token punctuation">;</span>

      <span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;env&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>outputOptions<span class="token punctuation">.</span>env<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          outputOptions<span class="token punctuation">.</span>_env <span class="token operator">=</span> value<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>bool<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          outputOptions<span class="token punctuation">.</span>json <span class="token operator">=</span> bool<span class="token punctuation">;</span>
          outputOptions<span class="token punctuation">.</span>modules <span class="token operator">=</span> bool<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> outputOptions<span class="token punctuation">.</span>colors <span class="token operator">===</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">)</span>
        outputOptions<span class="token punctuation">.</span>colors <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;supports-color&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>stdout<span class="token punctuation">;</span>

      <span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;sort-modules-by&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        outputOptions<span class="token punctuation">.</span>modulesSort <span class="token operator">=</span> value<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;sort-chunks-by&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        outputOptions<span class="token punctuation">.</span>chunksSort <span class="token operator">=</span> value<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;sort-assets-by&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        outputOptions<span class="token punctuation">.</span>assetsSort <span class="token operator">=</span> value<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;display-exclude&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        outputOptions<span class="token punctuation">.</span>exclude <span class="token operator">=</span> value<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>outputOptions<span class="token punctuation">.</span>json<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> outputOptions<span class="token punctuation">.</span>cached <span class="token operator">===</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">)</span>
          outputOptions<span class="token punctuation">.</span>cached <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> outputOptions<span class="token punctuation">.</span>cachedAssets <span class="token operator">===</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">)</span>
          outputOptions<span class="token punctuation">.</span>cachedAssets <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

        <span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;display-chunks&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>bool<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            outputOptions<span class="token punctuation">.</span>modules <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            outputOptions<span class="token punctuation">.</span>chunks <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            outputOptions<span class="token punctuation">.</span>chunkModules <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;display-entrypoints&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          outputOptions<span class="token punctuation">.</span>entrypoints <span class="token operator">=</span> bool<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;display-reasons&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>bool<span class="token punctuation">)</span> outputOptions<span class="token punctuation">.</span>reasons <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;display-depth&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>bool<span class="token punctuation">)</span> outputOptions<span class="token punctuation">.</span>depth <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;display-used-exports&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>bool<span class="token punctuation">)</span> outputOptions<span class="token punctuation">.</span>usedExports <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;display-provided-exports&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>bool<span class="token punctuation">)</span> outputOptions<span class="token punctuation">.</span>providedExports <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;display-optimization-bailout&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>bool<span class="token punctuation">)</span> outputOptions<span class="token punctuation">.</span>optimizationBailout <span class="token operator">=</span> bool<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;display-error-details&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>bool<span class="token punctuation">)</span> outputOptions<span class="token punctuation">.</span>errorDetails <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;display-origins&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>bool<span class="token punctuation">)</span> outputOptions<span class="token punctuation">.</span>chunkOrigins <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;display-max-modules&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          outputOptions<span class="token punctuation">.</span>maxModules <span class="token operator">=</span> <span class="token operator">+</span>value<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;display-cached&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>bool<span class="token punctuation">)</span> outputOptions<span class="token punctuation">.</span>cached <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;display-cached-assets&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>bool<span class="token punctuation">)</span> outputOptions<span class="token punctuation">.</span>cachedAssets <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>outputOptions<span class="token punctuation">.</span>exclude<span class="token punctuation">)</span>
          outputOptions<span class="token punctuation">.</span>exclude <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token string">&quot;node_modules&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;bower_components&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;components&quot;</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token string">&quot;display-modules&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          outputOptions<span class="token punctuation">.</span>maxModules <span class="token operator">=</span> <span class="token number">Infinity</span><span class="token punctuation">;</span>
          outputOptions<span class="token punctuation">.</span>exclude <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
          outputOptions<span class="token punctuation">.</span>modules <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;hide-modules&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>bool<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          outputOptions<span class="token punctuation">.</span>modules <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
          outputOptions<span class="token punctuation">.</span>chunkModules <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;info-verbosity&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        outputOptions<span class="token punctuation">.</span>infoVerbosity <span class="token operator">=</span> value<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token function">ifArg</span><span class="token punctuation">(</span><span class="token string">&quot;build-delimiter&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        outputOptions<span class="token punctuation">.</span>buildDelimiter <span class="token operator">=</span> value<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">let</span> lastHash <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> compiler<span class="token punctuation">;</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        compiler <span class="token operator">=</span> <span class="token function">webpack</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&quot;WebpackOptionsValidationError&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>argv<span class="token punctuation">.</span>color<span class="token punctuation">)</span>
            console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>
              <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\u001b[1m\u001b[31m</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>err<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\u001b[39m\u001b[22m</span><span class="token template-punctuation string">`</span></span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">else</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// eslint-disable-next-line no-process-exit</span>
          process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>argv<span class="token punctuation">.</span>progress<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> ProgressPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>ProgressPlugin<span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">ProgressPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">profile</span><span class="token operator">:</span> argv<span class="token punctuation">.</span>profile<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>outputOptions<span class="token punctuation">.</span>infoVerbosity <span class="token operator">===</span> <span class="token string">&quot;verbose&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>argv<span class="token punctuation">.</span>w<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>watchRun<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&quot;WebpackInfo&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compilation</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> compilationName <span class="token operator">=</span> compilation<span class="token punctuation">.</span>name <span class="token operator">?</span> compilation<span class="token punctuation">.</span>name <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;\nCompilation &quot;</span> <span class="token operator">+</span> compilationName <span class="token operator">+</span> <span class="token string">&quot; starting…\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>beforeRun<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&quot;WebpackInfo&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compilation</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> compilationName <span class="token operator">=</span> compilation<span class="token punctuation">.</span>name <span class="token operator">?</span> compilation<span class="token punctuation">.</span>name <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;\nCompilation &quot;</span> <span class="token operator">+</span> compilationName <span class="token operator">+</span> <span class="token string">&quot; starting…\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>done<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&quot;WebpackInfo&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compilation</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> compilationName <span class="token operator">=</span> compilation<span class="token punctuation">.</span>name <span class="token operator">?</span> compilation<span class="token punctuation">.</span>name <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
          console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;\nCompilation &quot;</span> <span class="token operator">+</span> compilationName <span class="token operator">+</span> <span class="token string">&quot; finished\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">function</span> <span class="token function">compilerCallback</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stats</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>options<span class="token punctuation">.</span>watch <span class="token operator">||</span> err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// Do not keep cache anymore</span>
          compiler<span class="token punctuation">.</span><span class="token function">purgeInputFileSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          lastHash <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
          console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>stack <span class="token operator">||</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">.</span>details<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>details<span class="token punctuation">)</span><span class="token punctuation">;</span>
          process<span class="token punctuation">.</span>exitCode <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>outputOptions<span class="token punctuation">.</span>json<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          stdout<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>
            <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>outputOptions<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\n&quot;</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>stats<span class="token punctuation">.</span>hash <span class="token operator">!==</span> lastHash<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          lastHash <span class="token operator">=</span> stats<span class="token punctuation">.</span>hash<span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>stats<span class="token punctuation">.</span>compilation <span class="token operator">&amp;&amp;</span> stats<span class="token punctuation">.</span>compilation<span class="token punctuation">.</span>errors<span class="token punctuation">.</span>length <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> errors <span class="token operator">=</span> stats<span class="token punctuation">.</span>compilation<span class="token punctuation">.</span>errors<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>errors<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&quot;EntryModuleNotFoundError&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>
                <span class="token string">&quot;\n\u001b[1m\u001b[31mInsufficient number of arguments or no entry found.&quot;</span>
              <span class="token punctuation">)</span><span class="token punctuation">;</span>
              console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>
                <span class="token string">&quot;\u001b[1m\u001b[31mAlternatively, run 'webpack(-cli) --help' for usage info.\u001b[39m\u001b[22m\n&quot;</span>
              <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">const</span> statsString <span class="token operator">=</span> stats<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>outputOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">const</span> delimiter <span class="token operator">=</span> outputOptions<span class="token punctuation">.</span>buildDelimiter
            <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>outputOptions<span class="token punctuation">.</span>buildDelimiter<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token template-punctuation string">`</span></span>
            <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>statsString<span class="token punctuation">)</span> stdout<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>statsString<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>delimiter<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>options<span class="token punctuation">.</span>watch <span class="token operator">&amp;&amp;</span> stats<span class="token punctuation">.</span><span class="token function">hasErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          process<span class="token punctuation">.</span>exitCode <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>firstOptions<span class="token punctuation">.</span>watch <span class="token operator">||</span> options<span class="token punctuation">.</span>watch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> watchOptions <span class="token operator">=</span>
          firstOptions<span class="token punctuation">.</span>watchOptions <span class="token operator">||</span>
          options<span class="token punctuation">.</span>watchOptions <span class="token operator">||</span>
          firstOptions<span class="token punctuation">.</span>watch <span class="token operator">||</span>
          options<span class="token punctuation">.</span>watch <span class="token operator">||</span>
          <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>watchOptions<span class="token punctuation">.</span>stdin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          process<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;end&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">_</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// eslint-disable-line</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          process<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        compiler<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span>watchOptions<span class="token punctuation">,</span> compilerCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>outputOptions<span class="token punctuation">.</span>infoVerbosity <span class="token operator">!==</span> <span class="token string">&quot;none&quot;</span><span class="token punctuation">)</span>
          console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;\nwebpack is watching the files…\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        compiler<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stats</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>compiler<span class="token punctuation">.</span>close<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            compiler<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err2</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token function">compilerCallback</span><span class="token punctuation">(</span>err <span class="token operator">||</span> err2<span class="token punctuation">,</span> stats<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">compilerCallback</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> stats<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">processOptions</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br><span class="line-number">323</span><br><span class="line-number">324</span><br><span class="line-number">325</span><br><span class="line-number">326</span><br><span class="line-number">327</span><br><span class="line-number">328</span><br><span class="line-number">329</span><br><span class="line-number">330</span><br><span class="line-number">331</span><br><span class="line-number">332</span><br><span class="line-number">333</span><br><span class="line-number">334</span><br><span class="line-number">335</span><br><span class="line-number">336</span><br><span class="line-number">337</span><br><span class="line-number">338</span><br><span class="line-number">339</span><br><span class="line-number">340</span><br><span class="line-number">341</span><br><span class="line-number">342</span><br><span class="line-number">343</span><br><span class="line-number">344</span><br><span class="line-number">345</span><br><span class="line-number">346</span><br><span class="line-number">347</span><br><span class="line-number">348</span><br><span class="line-number">349</span><br><span class="line-number">350</span><br><span class="line-number">351</span><br><span class="line-number">352</span><br><span class="line-number">353</span><br><span class="line-number">354</span><br><span class="line-number">355</span><br><span class="line-number">356</span><br><span class="line-number">357</span><br><span class="line-number">358</span><br><span class="line-number">359</span><br><span class="line-number">360</span><br><span class="line-number">361</span><br><span class="line-number">362</span><br><span class="line-number">363</span><br><span class="line-number">364</span><br><span class="line-number">365</span><br><span class="line-number">366</span><br><span class="line-number">367</span><br><span class="line-number">368</span><br><span class="line-number">369</span><br><span class="line-number">370</span><br><span class="line-number">371</span><br><span class="line-number">372</span><br><span class="line-number">373</span><br><span class="line-number">374</span><br><span class="line-number">375</span><br><span class="line-number">376</span><br><span class="line-number">377</span><br><span class="line-number">378</span><br><span class="line-number">379</span><br><span class="line-number">380</span><br><span class="line-number">381</span><br><span class="line-number">382</span><br><span class="line-number">383</span><br><span class="line-number">384</span><br><span class="line-number">385</span><br><span class="line-number">386</span><br><span class="line-number">387</span><br><span class="line-number">388</span><br><span class="line-number">389</span><br><span class="line-number">390</span><br><span class="line-number">391</span><br><span class="line-number">392</span><br><span class="line-number">393</span><br><span class="line-number">394</span><br><span class="line-number">395</span><br><span class="line-number">396</span><br><span class="line-number">397</span><br><span class="line-number">398</span><br><span class="line-number">399</span><br><span class="line-number">400</span><br></div></div><p><strong>NON_COMPILATION_ARGS</strong>:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/**
 * init 创建一份webpack配置文件
 * migrate 进行webpack版本迁移
 * add 往webpack配置文件中增加属性
 * remove 往webpack配置文件中删除属性
 * serve 运行webpack-server
 * generate-loader 生成webpack loader代码
 * generate-plugin 生成webpack plugin代码
 * info 返回与本地环境相关的一些信息
 */</span>
<span class="token keyword">const</span> <span class="token constant">NON_COMPILATION_ARGS</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">&quot;init&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;migrate&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;add&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;remove&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;serve&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;generate-loader&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;generate-plugin&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">CONFIG_GROUP</span> <span class="token operator">=</span> <span class="token string">&quot;Config options:&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">BASIC_GROUP</span> <span class="token operator">=</span> <span class="token string">&quot;Basic options:&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">MODULE_GROUP</span> <span class="token operator">=</span> <span class="token string">&quot;Module options:&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">OUTPUT_GROUP</span> <span class="token operator">=</span> <span class="token string">&quot;Output options:&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">ADVANCED_GROUP</span> <span class="token operator">=</span> <span class="token string">&quot;Advanced options:&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">RESOLVE_GROUP</span> <span class="token operator">=</span> <span class="token string">&quot;Resolving options:&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">OPTIMIZE_GROUP</span> <span class="token operator">=</span> <span class="token string">&quot;Optimizing options:&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">DISPLAY_GROUP</span> <span class="token operator">=</span> <span class="token string">&quot;Stats options:&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">GROUPS</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token constant">CONFIG_GROUP</span><span class="token punctuation">,</span>
  <span class="token constant">BASIC_GROUP</span><span class="token punctuation">,</span>
  <span class="token constant">MODULE_GROUP</span><span class="token punctuation">,</span>
  <span class="token constant">OUTPUT_GROUP</span><span class="token punctuation">,</span>
  <span class="token constant">ADVANCED_GROUP</span><span class="token punctuation">,</span>
  <span class="token constant">RESOLVE_GROUP</span><span class="token punctuation">,</span>
  <span class="token constant">OPTIMIZE_GROUP</span><span class="token punctuation">,</span>
  <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">WEBPACK_OPTIONS_FLAG</span> <span class="token operator">=</span> <span class="token string">&quot;WEBPACK_OPTIONS&quot;</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token constant">NON_COMPILATION_ARGS</span><span class="token punctuation">,</span>
  <span class="token constant">GROUPS</span><span class="token punctuation">,</span>
  <span class="token constant">WEBPACK_OPTIONS_FLAG</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><p><strong>prompt-command.js</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// based on https://github.com/webpack/webpack/blob/master/bin/webpack.js</span>

<span class="token comment">/**
 * @param {string} command process to run
 * @param {string[]} args commandline arguments
 * @returns {Promise&lt;void&gt;} promise
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">runCommand</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">command<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> cp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;child_process&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> executedCommand <span class="token operator">=</span> cp<span class="token punctuation">.</span><span class="token function">spawn</span><span class="token punctuation">(</span>command<span class="token punctuation">,</span> args<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">stdio</span><span class="token operator">:</span> <span class="token string">&quot;inherit&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">shell</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    executedCommand<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    executedCommand<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;exit&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>code <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">npmGlobalRoot</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> cp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;child_process&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> command <span class="token operator">=</span> cp<span class="token punctuation">.</span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token string">&quot;npm&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-g&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    command<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    command<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    command<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">reject</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">runWhenInstalled</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">packages<span class="token punctuation">,</span> pathForCmd<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> currentPackage <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>pathForCmd<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> func <span class="token operator">=</span> currentPackage<span class="token punctuation">.</span>default<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> func <span class="token operator">!==</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">@webpack-cli/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>packages<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> failed to export a default function</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">promptForInstallation</span><span class="token punctuation">(</span><span class="token parameter">packages<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> nameOfPackage <span class="token operator">=</span> <span class="token string">&quot;@webpack-cli/&quot;</span> <span class="token operator">+</span> packages<span class="token punctuation">;</span>
  <span class="token keyword">let</span> packageIsInstalled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> pathForCmd<span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    pathForCmd <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>
      process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token string">&quot;node_modules&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;@webpack-cli&quot;</span><span class="token punctuation">,</span>
      packages
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>pathForCmd<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> globalModules <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;global-modules&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      pathForCmd <span class="token operator">=</span> globalModules <span class="token operator">+</span> <span class="token string">&quot;/@webpack-cli/&quot;</span> <span class="token operator">+</span> packages<span class="token punctuation">;</span>
      require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>pathForCmd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>pathForCmd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    packageIsInstalled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    packageIsInstalled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>packageIsInstalled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> readLine <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;readline&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> isYarn <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;yarn.lock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> packageManager <span class="token operator">=</span> isYarn <span class="token operator">?</span> <span class="token string">&quot;yarn&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;npm&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;install&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-D&quot;</span><span class="token punctuation">,</span> nameOfPackage<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>isYarn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      options<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;add&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>packages <span class="token operator">===</span> <span class="token string">&quot;init&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>isYarn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        options<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// remove '-D'</span>
        options<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;global&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        options<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;-g&quot;</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> commandToBeRun <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>packageManager<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>options<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> question <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Would you like to install </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>packages<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">? (That will run </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>commandToBeRun<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">) (yes/NO) : </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">The command moved into a separate package: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>nameOfPackage<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> questionInterface <span class="token operator">=</span> readLine<span class="token punctuation">.</span><span class="token function">createInterface</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">input</span><span class="token operator">:</span> process<span class="token punctuation">.</span>stdin<span class="token punctuation">,</span>
      <span class="token literal-property property">output</span><span class="token operator">:</span> process<span class="token punctuation">.</span>stdout<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    questionInterface<span class="token punctuation">.</span><span class="token function">question</span><span class="token punctuation">(</span>question<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">answer</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      questionInterface<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">switch</span> <span class="token punctuation">(</span>answer<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">&quot;y&quot;</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token string">&quot;yes&quot;</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token string">&quot;1&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token function">runCommand</span><span class="token punctuation">(</span>packageManager<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">_</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>packages <span class="token operator">===</span> <span class="token string">&quot;init&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">npmGlobalRoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">root</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">const</span> pathtoInit <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>
                      root<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token string">&quot;@webpack-cli&quot;</span><span class="token punctuation">,</span>
                      <span class="token string">&quot;init&quot;</span>
                    <span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> pathtoInit<span class="token punctuation">;</span>
                  <span class="token punctuation">}</span><span class="token punctuation">)</span>
                  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">pathForInit</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token function">require</span><span class="token punctuation">(</span>pathForInit<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token punctuation">}</span><span class="token punctuation">)</span>
                  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    process<span class="token punctuation">.</span>exitCode <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>

              pathForCmd <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>
                process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">&quot;node_modules&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;@webpack-cli&quot;</span><span class="token punctuation">,</span>
                packages
              <span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">return</span> <span class="token function">runWhenInstalled</span><span class="token punctuation">(</span>packages<span class="token punctuation">,</span> pathForCmd<span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
              process<span class="token punctuation">.</span>exitCode <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>
            <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>nameOfPackage<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> needs to be installed in order to run the command.</span><span class="token template-punctuation string">`</span></span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
          process<span class="token punctuation">.</span>exitCode <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">runWhenInstalled</span><span class="token punctuation">(</span>packages<span class="token punctuation">,</span> pathForCmd<span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br></div></div><h3 id="_2-命令行工具-yargs-介绍"><a href="#_2-命令行工具-yargs-介绍" class="header-anchor">#</a> 2.命令行工具 yargs 介绍</h3> <blockquote><p>提供命令和分组参数,动态生成 help 帮助信息</p></blockquote> <p><img src="https://img-blog.csdnimg.cn/20200814163033594.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hqbDI3MTMxNA==,size_16,color_FFFFFF,t_70#pic_center" alt="help帮助信息"></p> <p><strong>config-yargs</strong>:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> optionsSchema <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../config/optionsSchema.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">GROUPS</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../utils/constants&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span>
  <span class="token constant">CONFIG_GROUP</span><span class="token punctuation">,</span>
  <span class="token constant">BASIC_GROUP</span><span class="token punctuation">,</span>
  <span class="token constant">MODULE_GROUP</span><span class="token punctuation">,</span>
  <span class="token constant">OUTPUT_GROUP</span><span class="token punctuation">,</span>
  <span class="token constant">ADVANCED_GROUP</span><span class="token punctuation">,</span>
  <span class="token constant">RESOLVE_GROUP</span><span class="token punctuation">,</span>
  <span class="token constant">OPTIMIZE_GROUP</span><span class="token punctuation">,</span>
  <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token constant">GROUPS</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> nestedProperties <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;anyOf&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;oneOf&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;allOf&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">resolveSchema</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">schema</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> current <span class="token operator">=</span> schema<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>schema <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> schema <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token string">&quot;$ref&quot;</span> <span class="token keyword">in</span> schema<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> path <span class="token operator">=</span> schema<span class="token punctuation">.</span>$ref<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> element <span class="token keyword">of</span> path<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>element <span class="token operator">===</span> <span class="token string">&quot;#&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        current <span class="token operator">=</span> optionsSchema<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        current <span class="token operator">=</span> current<span class="token punctuation">[</span>element<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> current<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">findPropertyInSchema</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">schema<span class="token punctuation">,</span> property<span class="token punctuation">,</span> subProperty</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>schema<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>subProperty<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>
      schema<span class="token punctuation">[</span>property<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span>
      <span class="token keyword">typeof</span> schema<span class="token punctuation">[</span>property<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span> <span class="token operator">&amp;&amp;</span>
      subProperty <span class="token keyword">in</span> schema<span class="token punctuation">[</span>property<span class="token punctuation">]</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">resolveSchema</span><span class="token punctuation">(</span>schema<span class="token punctuation">[</span>property<span class="token punctuation">]</span><span class="token punctuation">[</span>subProperty<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>property <span class="token keyword">in</span> schema<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">resolveSchema</span><span class="token punctuation">(</span>schema<span class="token punctuation">[</span>property<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> name <span class="token keyword">of</span> nestedProperties<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>schema<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> item <span class="token keyword">of</span> schema<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> resolvedItem <span class="token operator">=</span> <span class="token function">resolveSchema</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">findPropertyInSchema</span><span class="token punctuation">(</span>
          resolvedItem<span class="token punctuation">,</span>
          property<span class="token punctuation">,</span>
          subProperty
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token keyword">return</span> result<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">getSchemaInfo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">path<span class="token punctuation">,</span> property<span class="token punctuation">,</span> subProperty</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> pathSegments <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> current <span class="token operator">=</span> optionsSchema<span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> segment <span class="token keyword">of</span> pathSegments<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>segment <span class="token operator">===</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      current <span class="token operator">=</span>
        <span class="token function">findPropertyInSchema</span><span class="token punctuation">(</span>current<span class="token punctuation">,</span> <span class="token string">&quot;additionalProperties&quot;</span><span class="token punctuation">)</span> <span class="token operator">||</span>
        <span class="token function">findPropertyInSchema</span><span class="token punctuation">(</span>current<span class="token punctuation">,</span> <span class="token string">&quot;items&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      current <span class="token operator">=</span> <span class="token function">findPropertyInSchema</span><span class="token punctuation">(</span>current<span class="token punctuation">,</span> <span class="token string">&quot;properties&quot;</span><span class="token punctuation">,</span> segment<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>current<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token function">findPropertyInSchema</span><span class="token punctuation">(</span>current<span class="token punctuation">,</span> property<span class="token punctuation">,</span> subProperty<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">yargs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  yargs
    <span class="token punctuation">.</span><span class="token function">help</span><span class="token punctuation">(</span><span class="token string">&quot;help&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">alias</span><span class="token punctuation">(</span><span class="token string">&quot;help&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;h&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">alias</span><span class="token punctuation">(</span><span class="token string">&quot;version&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;v&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">options</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">config</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;Path to the config file&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">CONFIG_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">defaultDescription</span><span class="token operator">:</span> <span class="token string">&quot;webpack.config.js or webpackfile.js&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">requiresArg</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;config-register&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;array&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token string">&quot;r&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span>
          <span class="token string">&quot;Preload one or more modules before loading the webpack configuration&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">CONFIG_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">defaultDescription</span><span class="token operator">:</span> <span class="token string">&quot;module id or path&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">requiresArg</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;config-name&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;Name of the config to use&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">CONFIG_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">requiresArg</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">env</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;Environment passed to the config, when it is a function&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">CONFIG_GROUP</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;mode&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">choices</span><span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;mode&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;enum&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;mode&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">CONFIG_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">requiresArg</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">context</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;context&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;context&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">BASIC_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">defaultDescription</span><span class="token operator">:</span> <span class="token string">&quot;The current directory&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">requiresArg</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;entry&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">BASIC_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">requiresArg</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;no-cache&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;Disables cached builds&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">BASIC_GROUP</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;module-bind&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;Bind an extension to a loader&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">MODULE_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">requiresArg</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;module-bind-post&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;Bind an extension to a post loader&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">MODULE_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">requiresArg</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;module-bind-pre&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;Bind an extension to a pre loader&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">MODULE_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">requiresArg</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token string">&quot;o&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;The output path and file for compilation assets&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">OUTPUT_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">requiresArg</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;output-path&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;output.path&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">OUTPUT_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">defaultDescription</span><span class="token operator">:</span> <span class="token string">&quot;The current directory&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">requiresArg</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;output-filename&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;output.filename&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">OUTPUT_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">defaultDescription</span><span class="token operator">:</span> <span class="token string">&quot;[name].js&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">requiresArg</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;output-chunk-filename&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;output.chunkFilename&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">OUTPUT_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">defaultDescription</span><span class="token operator">:</span>
          <span class="token string">&quot;filename with [id] instead of [name] or [id] prefixed&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">requiresArg</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;output-source-map-filename&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;output.sourceMapFilename&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">OUTPUT_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">requiresArg</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;output-public-path&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;output.publicPath&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">OUTPUT_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">requiresArg</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;output-jsonp-function&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;output.jsonpFunction&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">OUTPUT_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">requiresArg</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;output-pathinfo&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;output.pathinfo&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">OUTPUT_GROUP</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;output-library&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;array&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;Expose the exports of the entry point as library&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">OUTPUT_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">requiresArg</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;output-library-target&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;output.libraryTarget&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">choices</span><span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;output.libraryTarget&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;enum&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">OUTPUT_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">requiresArg</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;records-input-path&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;recordsInputPath&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">ADVANCED_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">requiresArg</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;records-output-path&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;recordsOutputPath&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">ADVANCED_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">requiresArg</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;records-path&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;recordsPath&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">ADVANCED_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">requiresArg</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">define</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;Define any free var in the bundle&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">ADVANCED_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">requiresArg</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;target&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">ADVANCED_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">requiresArg</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">cache</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;cache&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">ADVANCED_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">defaultDescription</span><span class="token operator">:</span> <span class="token string">&quot;It's enabled by default when watching&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token string">&quot;w&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;watch&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">BASIC_GROUP</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;watch-stdin&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token string">&quot;stdin&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;watchOptions.stdin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">ADVANCED_GROUP</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;watch-aggregate-timeout&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;watchOptions.aggregateTimeout&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;watchOptions.aggregateTimeout&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">ADVANCED_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">requiresArg</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;watch-poll&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;watchOptions.poll&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">ADVANCED_GROUP</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">hot</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;Enables Hot Module Replacement&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">ADVANCED_GROUP</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">debug</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;Switch loaders to debug mode&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">BASIC_GROUP</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">devtool</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;devtool&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">BASIC_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">requiresArg</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;resolve-alias&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;resolve.alias&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">RESOLVE_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">requiresArg</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;resolve-extensions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;array&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;resolve.alias&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">RESOLVE_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">requiresArg</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;resolve-loader-alias&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;Setup a loader alias for resolving&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">RESOLVE_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">requiresArg</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;optimize-max-chunks&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;Try to keep the chunk count below a limit&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">OPTIMIZE_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">requiresArg</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;optimize-min-chunk-size&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span>
          <span class="token string">&quot;optimization.splitChunks.minSize&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;description&quot;</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">OPTIMIZE_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">requiresArg</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;optimize-minimize&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;optimization.minimize&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">OPTIMIZE_GROUP</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">prefetch</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;Prefetch this request (Example: --prefetch ./file.js)&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">ADVANCED_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">requiresArg</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">provide</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span>
          <span class="token string">&quot;Provide these modules as free vars in all modules (Example: --provide jQuery=jquery)&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">ADVANCED_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">requiresArg</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;labeled-modules&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;Enables labeled modules&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">ADVANCED_GROUP</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">plugin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;Load this plugin&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">ADVANCED_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">requiresArg</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">bail</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;bail&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;bail&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">ADVANCED_GROUP</span><span class="token punctuation">,</span>
        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">profile</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token function">getSchemaInfo</span><span class="token punctuation">(</span><span class="token string">&quot;profile&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">ADVANCED_GROUP</span><span class="token punctuation">,</span>
        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">d</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span>
          <span class="token string">&quot;shortcut for --debug --devtool eval-cheap-module-source-map --output-pathinfo&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">BASIC_GROUP</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">p</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
        <span class="token comment">// eslint-disable-next-line quotes</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span>
          <span class="token string">'shortcut for --optimize-minimize --define process.env.NODE_ENV=&quot;production&quot;'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">BASIC_GROUP</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">silent</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;Prevent output from being displayed in stdout&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">json</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token string">&quot;j&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;Prints the result as JSON.&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">progress</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;Print compilation progress in percentage&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">BASIC_GROUP</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token string">&quot;colors&quot;</span><span class="token punctuation">,</span>
        <span class="token function-variable function">default</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">supportsColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;supports-color&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>stdout<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;Force colors on the console&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;no-color&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token string">&quot;no-colors&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;Force no colors on the console&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;sort-modules-by&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;Sorts the modules list by property in module&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;sort-chunks-by&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;Sorts the chunks list by property in chunk&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;sort-assets-by&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;Sorts the assets list by property in asset&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;hide-modules&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;Hides info about modules&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;display-exclude&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;Exclude modules in the output&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;display-modules&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;Display even excluded modules in the output&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;display-max-modules&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;number&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;Sets the maximum number of visible modules in output&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;display-chunks&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;Display chunks in the output&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;display-entrypoints&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;Display entry points in the output&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;display-origins&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;Display origins of chunks in the output&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;display-cached&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;Display also cached modules in the output&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;display-cached-assets&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;Display also cached assets in the output&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;display-reasons&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;Display reasons about module inclusion in the output&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;display-depth&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;Display distance from entry point for each module&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;display-used-exports&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span>
          <span class="token string">&quot;Display information about used exports in modules (Tree Shaking)&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;display-provided-exports&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;Display information about exports provided from modules&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;display-optimization-bailout&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span>
          <span class="token string">&quot;Display information about why optimization bailed out for modules&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;display-error-details&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;Display details about errors&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">display</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">choices</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;verbose&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;detailed&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;normal&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;minimal&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;errors-only&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;none&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;Select display preset&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">verbose</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;Show more details&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;info-verbosity&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">choices</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;none&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;verbose&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span>
          <span class="token string">&quot;Controls the output of lifecycle messaging e.g. Started watching files...&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;build-delimiter&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token constant">DISPLAY_GROUP</span><span class="token punctuation">,</span>
        <span class="token literal-property property">describe</span><span class="token operator">:</span> <span class="token string">&quot;Display custom text after build output&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br><span class="line-number">323</span><br><span class="line-number">324</span><br><span class="line-number">325</span><br><span class="line-number">326</span><br><span class="line-number">327</span><br><span class="line-number">328</span><br><span class="line-number">329</span><br><span class="line-number">330</span><br><span class="line-number">331</span><br><span class="line-number">332</span><br><span class="line-number">333</span><br><span class="line-number">334</span><br><span class="line-number">335</span><br><span class="line-number">336</span><br><span class="line-number">337</span><br><span class="line-number">338</span><br><span class="line-number">339</span><br><span class="line-number">340</span><br><span class="line-number">341</span><br><span class="line-number">342</span><br><span class="line-number">343</span><br><span class="line-number">344</span><br><span class="line-number">345</span><br><span class="line-number">346</span><br><span class="line-number">347</span><br><span class="line-number">348</span><br><span class="line-number">349</span><br><span class="line-number">350</span><br><span class="line-number">351</span><br><span class="line-number">352</span><br><span class="line-number">353</span><br><span class="line-number">354</span><br><span class="line-number">355</span><br><span class="line-number">356</span><br><span class="line-number">357</span><br><span class="line-number">358</span><br><span class="line-number">359</span><br><span class="line-number">360</span><br><span class="line-number">361</span><br><span class="line-number">362</span><br><span class="line-number">363</span><br><span class="line-number">364</span><br><span class="line-number">365</span><br><span class="line-number">366</span><br><span class="line-number">367</span><br><span class="line-number">368</span><br><span class="line-number">369</span><br><span class="line-number">370</span><br><span class="line-number">371</span><br><span class="line-number">372</span><br><span class="line-number">373</span><br><span class="line-number">374</span><br><span class="line-number">375</span><br><span class="line-number">376</span><br><span class="line-number">377</span><br><span class="line-number">378</span><br><span class="line-number">379</span><br><span class="line-number">380</span><br><span class="line-number">381</span><br><span class="line-number">382</span><br><span class="line-number">383</span><br><span class="line-number">384</span><br><span class="line-number">385</span><br><span class="line-number">386</span><br><span class="line-number">387</span><br><span class="line-number">388</span><br><span class="line-number">389</span><br><span class="line-number">390</span><br><span class="line-number">391</span><br><span class="line-number">392</span><br><span class="line-number">393</span><br><span class="line-number">394</span><br><span class="line-number">395</span><br><span class="line-number">396</span><br><span class="line-number">397</span><br><span class="line-number">398</span><br><span class="line-number">399</span><br><span class="line-number">400</span><br><span class="line-number">401</span><br><span class="line-number">402</span><br><span class="line-number">403</span><br><span class="line-number">404</span><br><span class="line-number">405</span><br><span class="line-number">406</span><br><span class="line-number">407</span><br><span class="line-number">408</span><br><span class="line-number">409</span><br><span class="line-number">410</span><br><span class="line-number">411</span><br><span class="line-number">412</span><br><span class="line-number">413</span><br><span class="line-number">414</span><br><span class="line-number">415</span><br><span class="line-number">416</span><br><span class="line-number">417</span><br><span class="line-number">418</span><br><span class="line-number">419</span><br><span class="line-number">420</span><br><span class="line-number">421</span><br><span class="line-number">422</span><br><span class="line-number">423</span><br><span class="line-number">424</span><br><span class="line-number">425</span><br><span class="line-number">426</span><br><span class="line-number">427</span><br><span class="line-number">428</span><br><span class="line-number">429</span><br><span class="line-number">430</span><br><span class="line-number">431</span><br><span class="line-number">432</span><br><span class="line-number">433</span><br><span class="line-number">434</span><br><span class="line-number">435</span><br><span class="line-number">436</span><br><span class="line-number">437</span><br><span class="line-number">438</span><br><span class="line-number">439</span><br><span class="line-number">440</span><br><span class="line-number">441</span><br><span class="line-number">442</span><br><span class="line-number">443</span><br><span class="line-number">444</span><br><span class="line-number">445</span><br><span class="line-number">446</span><br><span class="line-number">447</span><br><span class="line-number">448</span><br><span class="line-number">449</span><br><span class="line-number">450</span><br><span class="line-number">451</span><br><span class="line-number">452</span><br><span class="line-number">453</span><br><span class="line-number">454</span><br><span class="line-number">455</span><br><span class="line-number">456</span><br><span class="line-number">457</span><br><span class="line-number">458</span><br><span class="line-number">459</span><br><span class="line-number">460</span><br><span class="line-number">461</span><br><span class="line-number">462</span><br><span class="line-number">463</span><br><span class="line-number">464</span><br><span class="line-number">465</span><br><span class="line-number">466</span><br><span class="line-number">467</span><br><span class="line-number">468</span><br><span class="line-number">469</span><br><span class="line-number">470</span><br><span class="line-number">471</span><br><span class="line-number">472</span><br><span class="line-number">473</span><br><span class="line-number">474</span><br><span class="line-number">475</span><br><span class="line-number">476</span><br><span class="line-number">477</span><br><span class="line-number">478</span><br><span class="line-number">479</span><br><span class="line-number">480</span><br><span class="line-number">481</span><br><span class="line-number">482</span><br><span class="line-number">483</span><br><span class="line-number">484</span><br><span class="line-number">485</span><br><span class="line-number">486</span><br><span class="line-number">487</span><br><span class="line-number">488</span><br><span class="line-number">489</span><br><span class="line-number">490</span><br><span class="line-number">491</span><br><span class="line-number">492</span><br><span class="line-number">493</span><br><span class="line-number">494</span><br><span class="line-number">495</span><br><span class="line-number">496</span><br><span class="line-number">497</span><br><span class="line-number">498</span><br><span class="line-number">499</span><br><span class="line-number">500</span><br><span class="line-number">501</span><br><span class="line-number">502</span><br><span class="line-number">503</span><br><span class="line-number">504</span><br><span class="line-number">505</span><br><span class="line-number">506</span><br><span class="line-number">507</span><br><span class="line-number">508</span><br><span class="line-number">509</span><br><span class="line-number">510</span><br><span class="line-number">511</span><br><span class="line-number">512</span><br><span class="line-number">513</span><br><span class="line-number">514</span><br><span class="line-number">515</span><br><span class="line-number">516</span><br><span class="line-number">517</span><br><span class="line-number">518</span><br><span class="line-number">519</span><br><span class="line-number">520</span><br><span class="line-number">521</span><br><span class="line-number">522</span><br><span class="line-number">523</span><br><span class="line-number">524</span><br><span class="line-number">525</span><br><span class="line-number">526</span><br><span class="line-number">527</span><br><span class="line-number">528</span><br><span class="line-number">529</span><br><span class="line-number">530</span><br><span class="line-number">531</span><br><span class="line-number">532</span><br><span class="line-number">533</span><br></div></div><h3 id="_3-webpack-cli-使用-args-分析"><a href="#_3-webpack-cli-使用-args-分析" class="header-anchor">#</a> 3.webpack-cli 使用 args 分析</h3> <blockquote><p>参数分组(config/config-args.js)将命令划分为了 9 类：</p></blockquote> <ul><li><code>Config options</code>: 配置相关参数(文件名称、运行参数等)</li> <li><code>Basic options</code>: 基础参数(entry 设置、debug 模式设置、watch 监听设置、devtool 设置)</li> <li><code>Module options</code>: 模块参数,给 loader 设置扩展</li> <li><code>Output options</code>: 输出参数(输出路径、输出文件名称)</li> <li><code>Advanced options</code>: 高级用法(记录设置、缓存设置、监听频率、bail 等)</li> <li><code>Resolving options</code>: 解析参数(alias 和 解析的文件后缀设置)</li> <li><code>Optimizing options</code>: 优化参数</li> <li><code>Stats options</code>: 统计参数</li> <li><code>options</code>: 通用参数(帮助命令、版本信息等)</li></ul> <div class="custom-block tip"><p class="title"></p><p><strong>webpack-cli 执行的结果</strong></p> <p>webpack-cli 配置文件和命令行参数进行转换最终胜出配置选项参数 options</p> <p>最终会根据配置参数实例化 webpack 对象,然后执行构建流程</p></div><h2 id="tapable-插件架构与-hooks-设计"><a href="#tapable-插件架构与-hooks-设计" class="header-anchor">#</a> Tapable 插件架构与 Hooks 设计</h2> <ul><li>2020.08.16</li></ul> <h3 id="webpack-的本质是什么"><a href="#webpack-的本质是什么" class="header-anchor">#</a> webpack 的本质是什么?</h3> <blockquote><p>可以理解为 webpack 是一种基于事件流的编程范例,一系列的插件运行。</p></blockquote> <p>其中核心对象 Complier 继承 Tapable,Complation 也是继承 Tapable。</p> <h3 id="tapable-是什么"><a href="#tapable-是什么" class="header-anchor">#</a> Tapable 是什么?</h3> <blockquote><p><code>Tapable</code>是一个类似于<code>Node.js</code>的<code>EventEmitter插件库</code>,主要是控制钩子函数的发布与订阅,控制着<code>webpack</code>的插件系统。</p></blockquote> <p>Tapable 库暴露了很多的 Hook(钩子)类,为插件的挂载提供了钩子</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>
  Tapable<span class="token punctuation">,</span>
  SyncHook<span class="token punctuation">,</span> <span class="token comment">// 同步钩子</span>
  SyncBailHook<span class="token punctuation">,</span> <span class="token comment">// 同步熔断钩子</span>
  SyncWaterfallHook<span class="token punctuation">,</span> <span class="token comment">// 同步流水钩子</span>
  SyncLoopHook<span class="token punctuation">,</span> <span class="token comment">// 同步循环钩子</span>
  AsyncParallelHook<span class="token punctuation">,</span> <span class="token comment">// 异步并发钩子</span>
  AsyncParallelBailHook<span class="token punctuation">,</span> <span class="token comment">// 异步并发熔断钩子</span>
  AsyncSeriesHook<span class="token punctuation">,</span> <span class="token comment">// 异步串行钩子</span>
  AsyncSeriesBailHook<span class="token punctuation">,</span> <span class="token comment">// 异步串行熔断钩子</span>
  AsyncSeriesWaterfallHook<span class="token punctuation">,</span> <span class="token comment">// 异步串行流水钩子</span>
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;tapable&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>hooks 类型:</p> <table><thead><tr><th style="text-align:left;">type</th> <th style="text-align:left;">function</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>Hook</code></td> <td style="text-align:left;">所有钩子的后缀</td></tr> <tr><td style="text-align:left;"><code>Waterfall</code></td> <td style="text-align:left;">同步方法,但是他会传值给下一个函数</td></tr> <tr><td style="text-align:left;"><code>Bail</code></td> <td style="text-align:left;">熔断,当函数有任何返回值,则在当前执行函数停止</td></tr> <tr><td style="text-align:left;"><code>Loop</code></td> <td style="text-align:left;">监听函数返回 true 表示循环,返回 undefined 表示结束循环</td></tr> <tr><td style="text-align:left;"><code>Sync</code></td> <td style="text-align:left;">同步方法</td></tr> <tr><td style="text-align:left;"><code>AsyncSeries</code></td> <td style="text-align:left;">异步串行钩子</td></tr> <tr><td style="text-align:left;"><code>AsyncParallel</code></td> <td style="text-align:left;">异步并行执行钩子</td></tr></tbody></table> <h3 id="tapable-的使用-new-hook-新建钩子"><a href="#tapable-的使用-new-hook-新建钩子" class="header-anchor">#</a> Tapable 的使用————new Hook(新建钩子)</h3> <blockquote><p>Tapable 暴露出来的都是类方法,我们需要 new 一个类方法获得我们需要的钩子。class 接收数组参数 options,非必传。类方法会根据传参,接收同样数量的参数。</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> hook1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span>arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">,</span> arg3<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="tapable-的使用-钩子的绑定与执行"><a href="#tapable-的使用-钩子的绑定与执行" class="header-anchor">#</a> Tapable 的使用————钩子的绑定与执行</h3> <blockquote><p>Tapable 提供了同步和异步的绑定钩子的方法,并且他们都有绑定事件和执行事件对应的方法。</p></blockquote> <table><thead><tr><th style="text-align:left;">Async*</th> <th style="text-align:left;">Sync*</th></tr></thead> <tbody><tr><td style="text-align:left;">绑定: tapAsync、tapPromise、tap</td> <td style="text-align:left;">绑定: tap</td></tr> <tr><td style="text-align:left;">执行: callAsync、promise</td> <td style="text-align:left;">执行: call</td></tr></tbody></table> <h3 id="tapable-的使用-hook-基本用法示例"><a href="#tapable-的使用-hook-基本用法示例" class="header-anchor">#</a> Tapable 的使用————hook 基本用法示例</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> hook1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;arg1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;arg2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;arg3&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 绑定事件到webpack事件流</span>
hook1<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&quot;hook1&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">,</span> arg3</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">,</span> arg3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 执行绑定的事件</span>
<span class="token function">hook1</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="tapable-的使用-实际例子演示"><a href="#tapable-的使用-实际例子演示" class="header-anchor">#</a> Tapable 的使用————实际例子演示</h3> <p>定义一个 Car 方法,在内部 hook 上新建钩子。分别是同步钩子 <code>accelerate</code>、<code>brake</code>(accelerate 接收一个参数)和异步钩子<code>calculateRoutes</code>。</p> <p>使用钩子对应的绑定和执行方法。</p> <p><code>calculateRoutes</code>使用<code>tapPromise</code>可以返回一个<code>promise对象</code>。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// Car.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> SyncHook<span class="token punctuation">,</span> AsyncSeriesHook <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;tapable&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Car</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">accelerate</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;newspeed&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">brake</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">calculateRoutes</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;source&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;trget&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;routesList&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> myCar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Car</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 绑定同步钩子</span>
myCar<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>brake<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&quot;WarningLampPlugin&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;WarningLampPlugin&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 绑定同步钩子 并传参</span>
myCar<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>accelerate<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&quot;LoggerPlugin&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newSpeed</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Accelerating to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>newSpeed<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//</span>
myCar<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>calculateRoutes<span class="token punctuation">.</span><span class="token function">tapPromise</span><span class="token punctuation">(</span>
  <span class="token string">&quot;calculateRoutes tapPromise&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">source<span class="token punctuation">,</span> trget<span class="token punctuation">,</span> routesList<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;source&quot;</span><span class="token punctuation">,</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> rej</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">tapPromise to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>source<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>trget<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>routesList<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

myCar<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">brake</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
myCar<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">accelerate</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">&quot;cost&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 执行异步钩子</span>
myCar<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>calculateRoutes<span class="token punctuation">.</span><span class="token function">promise</span><span class="token punctuation">(</span><span class="token string">&quot;Async&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hook&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;demo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">timeEmd</span><span class="token punctuation">(</span><span class="token string">&quot;cost&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">timeEmd</span><span class="token punctuation">(</span><span class="token string">&quot;cost&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><h2 id="tapable-是如何和-webpack-关联起来的"><a href="#tapable-是如何和-webpack-关联起来的" class="header-anchor">#</a> Tapable 是如何和 webpack 关联起来的</h2> <ul><li>2020.08.17</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// webpack.js</span>
<span class="token comment">/**
 * @param {WebpackOptions} options options object
 * @param {function(Error=, Stats=): void=} callback callback
 * @returns {Compiler | MultiCompiler} the compiler object
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">webpack</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">options<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> webpackOptionsValidationErrors <span class="token operator">=</span> <span class="token function">validateSchema</span><span class="token punctuation">(</span>
    webpackOptionsSchema<span class="token punctuation">,</span>
    options
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>webpackOptionsValidationErrors<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">WebpackOptionsValidationError</span><span class="token punctuation">(</span>webpackOptionsValidationErrors<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> compiler<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    compiler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MultiCompiler</span><span class="token punctuation">(</span>
      Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">webpack</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebpackOptionsDefaulter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>

    compiler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Compiler</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    compiler<span class="token punctuation">.</span>options <span class="token operator">=</span> options<span class="token punctuation">;</span>
    <span class="token keyword">new</span> <span class="token class-name">NodeEnvironmentPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">infrastructureLogging</span><span class="token operator">:</span> options<span class="token punctuation">.</span>infrastructureLogging<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 这里对应的就是webpack.config.js中对应的plugins数组执行</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>plugins <span class="token operator">&amp;&amp;</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>plugins<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> plugin <span class="token keyword">of</span> options<span class="token punctuation">.</span>plugins<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> plugin <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">plugin</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>compiler<span class="token punctuation">,</span> compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token function">plugin</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">environment</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">afterEnvironment</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    compiler<span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebpackOptionsApply</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Invalid argument: options&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> callback <span class="token operator">!==</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Invalid argument: callback&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>
      options<span class="token punctuation">.</span>watch <span class="token operator">===</span> <span class="token boolean">true</span> <span class="token operator">||</span>
      <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> o<span class="token punctuation">.</span>watch<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> watchOptions <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
        <span class="token operator">?</span> options<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> o<span class="token punctuation">.</span>watchOptions <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token operator">:</span> options<span class="token punctuation">.</span>watchOptions <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> compiler<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span>watchOptions<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    compiler<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> compiler<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div></div><h3 id="模拟一个自定义的-complier"><a href="#模拟一个自定义的-complier" class="header-anchor">#</a> 模拟一个自定义的 complier</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Complier</span> <span class="token punctuation">{</span>
	<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>hooks <span class="token operator">=</span> <span class="token punctuation">{</span>
			<span class="token literal-property property">accelerate</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'newspeed'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token literal-property property">brake</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token literal-property property">calculateRoutes</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'source'</span><span class="token punctuation">,</span> <span class="token string">'trget'</span><span class="token punctuation">,</span> <span class="token string">'routesList'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">accelerate</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>break<span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">calculateRoutes</span><span class="token punctuation">(</span><span class="token string">'Async'</span><span class="token punctuation">,</span> <span class="token string">'Hook'</span><span class="token punctuation">,</span> <span class="token string">'Demo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">accelerate</span><span class="token punctuation">(</span><span class="token parameter">speed</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">accelerate</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>speed<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">break</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">brake</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">calculateRoutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>calculateRoutes<span class="token punctuation">.</span><span class="token function">promise</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span>arguments<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>

		<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Complier<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h3 id="根据-complier-编写一个简易的自定义插件"><a href="#根据-complier-编写一个简易的自定义插件" class="header-anchor">#</a> 根据 Complier 编写一个简易的自定义插件</h3> <blockquote><p>通过上面的分析我们知道自定义插件需要接收一个 complier 对象参数,内部需要有一个 apply 方法。</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> complier <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./complier'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">MyFirstPlugin</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

	<span class="token punctuation">}</span>

	<span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">complier</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		complier<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>break<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&quot;WarningLampPlugin&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'WarningLampPlugin'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		complier<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>accelerate<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&quot;LoggerPlugin&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newSpeed</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Accelerate to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>newSpeed<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		complier<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>calculateRoutes<span class="token punctuation">.</span><span class="token function">tapPromise</span><span class="token punctuation">(</span><span class="token string">&quot;calculateRoutes tapAsync&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">source<span class="token punctuation">,</span> target<span class="token punctuation">,</span> routesList</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
					console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">tapPromise to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>source<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>target<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>routesList<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="模拟插件的执行"><a href="#模拟插件的执行" class="header-anchor">#</a> 模拟插件的执行</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> myPlugin <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyFirstPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>myPlugin<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> complier <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Complier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> plugin <span class="token keyword">of</span> options<span class="token punctuation">.</span>plugins<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> plugin <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">plugin</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>compiler<span class="token punctuation">,</span> compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">plugin</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

complier<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h2 id="webpack-流程细剖-准备篇"><a href="#webpack-流程细剖-准备篇" class="header-anchor">#</a> webpack 流程细剖————准备篇</h2> <ul><li>2020.08.17</li></ul> <p><img src="https://img-blog.csdnimg.cn/20200817204240119.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hqbDI3MTMxNA==,size_16,color_FFFFFF,t_70#pic_center" alt="流程分析"></p> <h2 id="模块构建和-chunk-生成阶段"><a href="#模块构建和-chunk-生成阶段" class="header-anchor">#</a> 模块构建和 chunk 生成阶段</h2> <ul><li>2020.08.17</li></ul> <h3 id="modulefactory"><a href="#modulefactory" class="header-anchor">#</a> ModuleFactory</h3> <ul><li>NormalModuleFactory</li></ul> <blockquote><p>指那些通过普通的<code>module.exports</code>导出的模块。</p></blockquote> <ul><li>ContextModuleFactory</li></ul> <blockquote><p>路径模块之类的。</p></blockquote> <h3 id="module-的类型"><a href="#module-的类型" class="header-anchor">#</a> Module 的类型</h3> <ul><li><code>NormalModule</code> 普通模块</li></ul> <p>Build 通过:</p> <ol><li><p>使用 <code>loader-runner</code> 运行 loaders</p></li> <li><p>通过 <code>Parser</code> 解析(内部是 acron)</p></li> <li><p><code>ParserPlugins</code> 添加依赖</p></li></ol> <ul><li><code>ContextModule</code> 路径模块</li></ul> <blockquote><p>'./src/a'</p></blockquote> <ul><li><code>ExternalModule</code> 外部模块</li></ul> <blockquote><p>module.exports = Jquery</p></blockquote> <ul><li><code>DelegatedModule</code></li></ul> <blockquote><p>manifest</p></blockquote> <ul><li><code>MultiModule</code></li></ul> <blockquote><p>entry: ['a', 'b']</p></blockquote> <h3 id="chunk-生成算法"><a href="#chunk-生成算法" class="header-anchor">#</a> chunk 生成算法</h3> <ol><li><code>webpack</code>先将<code>entry</code>中对应的<code>module</code>都生成一个新的<code>chunk</code></li> <li>遍历<code>module</code>的依赖列表，将依赖的<code>module</code>也加入到<code>chunk</code>中</li> <li>如果一个依赖<code>module</code>是动态引入的模块，那么就会根据这个<code>module</code>创建一个新的<code>chunk</code>，继续遍历依赖</li> <li>重复上面的过程，知道得到所有的<code>chunks</code></li></ol> <h2 id="webpack-流程篇-文件生成"><a href="#webpack-流程篇-文件生成" class="header-anchor">#</a> webpack 流程篇————文件生成</h2> <ul><li>2020.08.18</li></ul> <div class="custom-block tip"><p class="title"></p><p>这里有一个点,文件生成的<code>Hash值</code>是在<code>seal阶段</code>生成的。</p> <p>调用的是<code>Complation.js</code>中的<code>this.createHash</code>方法。</p></div><h2 id="实战篇-动手编写一个简易的-webpack"><a href="#实战篇-动手编写一个简易的-webpack" class="header-anchor">#</a> 实战篇————动手编写一个简易的 webpack</h2> <ul><li>2020.08.18</li></ul> <p><strong>知识点回顾:</strong></p> <ol><li><code>webpack</code>打包出来的是一个<code>IIFE(匿名闭包)</code>。</li> <li><code>modules</code> 是一个数组,每一项是一个模块初始化函数。</li> <li><code>__webpack__require</code> 用来加载模块,返回<code>module.exports</code>。</li> <li><code>通过WEBPACK_REQUIRE_METHOD(0)</code> 来启动程序。</li></ol> <p><strong>功能需求:</strong></p> <ol><li><p>可以将 ES6 预发转化成 ES5 的语法。</p> <ul><li>通过<code>babylon</code>生成 AST 树</li> <li>通过<code>babel-core</code>将 AST 重新生成源码</li></ul></li> <li><p>可以分析模块之间的依赖关系</p> <ul><li>通过<code>babel-traverse</code> 的<code>ImportDeclaration</code> 方法获取依赖属性</li></ul></li> <li><p>生成的 JS 文件可以在浏览器中运行。</p></li></ol> <p><strong>完整示例</strong></p> <p><a href="https://github.com/xjl271314/simple-webpack" target="_blank" rel="noopener noreferrer">完整代码参见<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="loader-的链式调用和执行顺序"><a href="#loader-的链式调用和执行顺序" class="header-anchor">#</a> Loader 的链式调用和执行顺序</h2> <ul><li>2020.08.19</li></ul> <blockquote><p>loader 只是一个导出为函数的 Javascript 函数,我们知道定义的 loader 是从右往左依次执行的。</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> source<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>loader 是串行执行的, loader 的执行顺序为: <code>postcss-loader</code> -&gt; <code>scss-loader</code> -&gt; <code>css-loader</code> -&gt; <code>style-loader</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token operator">...</span><span class="token punctuation">,</span>
	<span class="token literal-property property">module</span><span class="token operator">:</span><span class="token punctuation">{</span>
		<span class="token literal-property property">rule</span><span class="token operator">:</span> <span class="token punctuation">[</span>
			<span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.scss$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
			<span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token string">'scss-loader'</span><span class="token punctuation">,</span><span class="token string">'postcss-loader'</span><span class="token punctuation">]</span>
		<span class="token punctuation">]</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>loader 的实现方式和我们之前接触的 compose 函数的思想是一致的。</p> <h3 id="compose-函数"><a href="#compose-函数" class="header-anchor">#</a> compose 函数</h3> <blockquote><p>compose 函数接收一个参数返回一个组合后的复合函数,下一个函数会以上个函数的返回值作为参数</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>arguments<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">initArg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> result <span class="token operator">=</span> initArg<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> args<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      result <span class="token operator">=</span> args<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 调用ReduceRight()</span>
<span class="token keyword">function</span> <span class="token function">compose1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">initArg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> args<span class="token punctuation">.</span><span class="token function">reduceRight</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">init<span class="token punctuation">,</span> current</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">current</span><span class="token punctuation">(</span>init<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> initArg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p><strong>使用 webpack-cli 创建 loader</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>webpack <span class="token operator">-</span> cli <span class="token operator">-</span> loader<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="使用-loader-runner-高效进行-loader-的调式"><a href="#使用-loader-runner-高效进行-loader-的调式" class="header-anchor">#</a> 使用 loader-runner 高效进行 loader 的调式</h2> <ul><li>2020.08.20</li></ul> <blockquote><p><code>loader-runner</code>允许你在不安装<code>webpack</code>的情况下运行<code>loaders</code></p></blockquote> <p><strong>作用:</strong></p> <ol><li>作为 webpack 的依赖,webpack 中使用它执行 loader</li> <li>进行 loader 的开发和测试。</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> runLoaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;loader-runner&quot;</span><span class="token punctuation">;</span>

<span class="token function">runLoaders</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">resource</span><span class="token operator">:</span> <span class="token string">&quot;/abs/path/to/file.txt?query&quot;</span><span class="token punctuation">,</span>
    <span class="token comment">// String: Absolute path to the resource (optionally including query string)</span>

    <span class="token literal-property property">loaders</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;/abs/path/to/loader.js?query&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// String[]: Absolute paths to the loaders (optionally including query string)</span>
    <span class="token comment">// {loader, options}[]: Absolute paths to the loaders with options object</span>

    <span class="token literal-property property">context</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">minimize</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// Additional loader context which is used as base context</span>

    <span class="token literal-property property">readResource</span><span class="token operator">:</span> fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>fs<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// A function to read the resource</span>
    <span class="token comment">// Must have signature function(path, function(err, buffer))</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// err: Error?</span>
    <span class="token comment">// result.result: Buffer | String</span>
    <span class="token comment">// The result</span>
    <span class="token comment">// result.resourceBuffer: Buffer</span>
    <span class="token comment">// The raw resource as Buffer (useful for SourceMaps)</span>
    <span class="token comment">// result.cacheable: Bool</span>
    <span class="token comment">// Is the result cacheable or do it require reexecution?</span>
    <span class="token comment">// result.fileDependencies: String[]</span>
    <span class="token comment">// An array of paths (files) on which the result depends on</span>
    <span class="token comment">// result.contextDependencies: String[]</span>
    <span class="token comment">// An array of paths (directories) on which the result depends on</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h3 id="开发一个-raw-loader"><a href="#开发一个-raw-loader" class="header-anchor">#</a> 开发一个 raw-loader</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// raw-loader \u2028: 行分隔符 \u2029: 段落分隔符</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">const</span> json <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\u2028</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'\\u2028'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\u2029</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'\\u2029'</span><span class="token punctuation">)</span>

	<span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">export default </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>json<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// run-loader.js</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> runLoaders <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'loader-runner'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">runLoaders</span><span class="token punctuation">(</span>
	<span class="token punctuation">{</span>
		<span class="token literal-property property">resource</span><span class="token operator">:</span> <span class="token string">'./demo.txt'</span><span class="token punctuation">,</span>
		<span class="token literal-property property">loaders</span><span class="token operator">:</span> <span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./loaders/raw-loader'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token literal-property property">readResource</span><span class="token operator">:</span> fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>fs<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> err <span class="token operator">?</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">:</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 运行</span>
node run<span class="token operator">-</span>loader<span class="token punctuation">.</span>js

<span class="token comment">// 结果</span>
<span class="token punctuation">{</span>
	<span class="token literal-property property">result</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'export defualt footbar'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token literal-property property">resourceBuffer</span><span class="token operator">:</span> <span class="token operator">&lt;</span>Buffer <span class="token number">66</span> 6f 6f <span class="token number">62</span> <span class="token number">61</span> <span class="token number">72</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
	<span class="token literal-property property">cacheable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
	<span class="token literal-property property">fileDependencies</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./src/demo.txt'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token literal-property property">contextDependencies</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h2 id="更复杂的-loader-开发场景"><a href="#更复杂的-loader-开发场景" class="header-anchor">#</a> 更复杂的 loader 开发场景</h2> <blockquote><p>实际的 loader 开发过程中往往涉及到很多,比如 loader 的参数获取、loader 内部的异常处理</p></blockquote> <h3 id="通过-loader-utils-的-getoptions-方法获取参数"><a href="#通过-loader-utils-的-getoptions-方法获取参数" class="header-anchor">#</a> 通过 loader-utils 的 getOptions 方法获取参数</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> loaderUtils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;loader-utils&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> loaderUtils<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="loader-内部的异常处理"><a href="#loader-内部的异常处理" class="header-anchor">#</a> loader 内部的异常处理</h3> <blockquote><p>loader 内直接通过<code>throw</code>抛出,通过<code>this.callback</code>传递错误。</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span>
	<span class="token literal-property property">err</span><span class="token operator">:</span> Error <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
	<span class="token literal-property property">content</span><span class="token operator">:</span> string <span class="token operator">|</span> Buffer<span class="token punctuation">,</span>
	sourceMap<span class="token operator">?</span><span class="token operator">:</span> sourceMap<span class="token punctuation">,</span>
	meta<span class="token operator">?</span><span class="token operator">:</span> any
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="loader-的异步处理"><a href="#loader-的异步处理" class="header-anchor">#</a> loader 的异步处理</h3> <blockquote><p>通过 <code>this.async</code>来返回一个异步函数(第一个参数是<code>Error</code>,第二个参数是<code>处理的结果</code>)</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">input</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// No callback -&gt; return synchronous results</span>
  <span class="token comment">// if callback ....</span>

  <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> input <span class="token operator">+</span> input<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="在-loader-中使用缓存"><a href="#在-loader-中使用缓存" class="header-anchor">#</a> 在 loader 中使用缓存</h3> <blockquote><p>webpack 中默认是开启 loader 缓存的(可以使用<code>this.cacheable</code>关掉缓存)。</p></blockquote> <p>缓存的条件:</p> <p><code>loader</code>的结果在相同的输入下有明确的输出,有依赖的<code>loader</code>无法使用缓存。</p> <h3 id="在-loader-中如何进行文件输出"><a href="#在-loader-中如何进行文件输出" class="header-anchor">#</a> 在 loader 中如何进行文件输出</h3> <blockquote><p>loader 中通过 <code>this.emitFile</code> 进行文件写入</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> loaderUtils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;loader-utils&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> url <span class="token operator">=</span> loaderUtils<span class="token punctuation">.</span><span class="token function">interpolateName</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">&quot;[name].[ext]&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    source<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emitFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">,</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">__webpack_public_path__+</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">export default </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="开发一个自动合成雪碧图的-loader"><a href="#开发一个自动合成雪碧图的-loader" class="header-anchor">#</a> 开发一个自动合成雪碧图的 loader</h2> <ul><li>2020.08.20</li></ul> <p><strong>准备知识：如何将两张图片合成一张图片?</strong></p> <blockquote><p>使用 spritesmith(https://www.npmjs.com/package/spritesmith)</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> Spritesmith <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'spritesmith '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">const</span> imgs <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">url\((\s*)\?__sprite</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> matchedImgs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span> imgs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">const</span> img <span class="token operator">=</span> imgs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">url\((\s*)\?__sprite</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

		matchedImgs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> img<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	Spritesmith<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		<span class="token literal-property property">src</span><span class="token operator">:</span> matchedImgs<span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>	<span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'dist/sprite.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>image<span class="token punctuation">)</span><span class="token punctuation">;</span>
			source <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">url\((\s*)\?__sprite</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">match</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				<span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">url(&quot;dist/sprite.jpg&quot;)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>

			fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'dist/index.css'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h2 id="插件基本结构介绍"><a href="#插件基本结构介绍" class="header-anchor">#</a> 插件基本结构介绍</h2> <ul><li>2020.08.20</li></ul> <blockquote><p>用于处理除了 loader 以外的功能,没有像 loader 一样的独立运行环境,只能在 webpack 中运行。</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">MyPlugin</span> <span class="token punctuation">{</span>
  <span class="token comment">// 插件的名称</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 必须的apply方法</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>done<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&quot;My Plugin&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">stats</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 触发的hooks</span>
      <span class="token comment">// do something ...</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> MyPlugin<span class="token punctuation">;</span>

<span class="token comment">// 插件的使用</span>
<span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">MyPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="动手实现一个-loader-之简易的-jsx-px2rem"><a href="#动手实现一个-loader-之简易的-jsx-px2rem" class="header-anchor">#</a> 动手实现一个 loader 之简易的 jsx-px2rem</h2> <ul><li>2020.09.08</li></ul> <blockquote><p>此 loader 用于将 jsx 中的 style 中的 px 转换为 rem。</p></blockquote> <p><strong><code>jsx-px2rem-loader.js</code></strong>:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> regRules <span class="token keyword">from</span> <span class="token string">&quot;./reg&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">&quot;lodash&quot;</span><span class="token punctuation">;</span> <span class="token comment">// lodash是一个js工具库，特别方便建议各位去了解一下</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// webpack中默认是开启loader缓存的(可以使用this.cacheable关掉缓存)。</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cacheable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cacheable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> backUp <span class="token operator">=</span> source<span class="token punctuation">;</span>

  <span class="token comment">// style={{marginRight: '1px'}} =&gt; style={{marginRight: '0.01rem'}}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>regRules<span class="token punctuation">.</span>pxReg<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>backUp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    backUp <span class="token operator">=</span> backUp<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>regRules<span class="token punctuation">.</span>pxReg<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">px</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> val <span class="token operator">=</span> px<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>regRules<span class="token punctuation">.</span>numReg<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> num <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      val <span class="token operator">=</span> val<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">px$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">&quot;rem&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> val<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// marginRight: 1 =&gt; marginRight: '0.01rem'</span>
  _<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span>regRules<span class="token punctuation">.</span>styleReg<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">reg<span class="token punctuation">,</span> styleName</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>reg<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>backUp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      backUp <span class="token operator">=</span> backUp<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>reg<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> val<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>regRules<span class="token punctuation">.</span>numReg<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>num <span class="token operator">/</span> <span class="token number">100</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">rem&quot;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// img标签 width: 1 =&gt; style={{width: '0.01rem'}}</span>
  _<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span>regRules<span class="token punctuation">.</span>imgReg<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">reg<span class="token punctuation">,</span> styleName</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>reg<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>backUp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      backUp <span class="token operator">=</span> backUp<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>reg<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> style <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        val<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>regRules<span class="token punctuation">.</span>numReg<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          style <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>num <span class="token operator">/</span> <span class="token number">100</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">rem</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">style={{</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>styleName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>style<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;}}</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> backUp<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><p><strong><code>reg.js</code></strong>:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 匹配jsx中的px 如 1px</span>
<span class="token keyword">const</span> pxReg <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\b(\d+(\.\d+)?)px\b</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">;</span>

<span class="token comment">// 匹配jsx中 缩写形式的style 如：marginRight: 1</span>
<span class="token keyword">const</span> styleReg <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">marginTop</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\bmarginTop(?:\s+):(?:\s+)?(\d+)</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span>
  <span class="token literal-property property">marginRight</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\bmarginRight(?:\s+)?:(?:\s+)?(\d+)</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span>
  <span class="token literal-property property">marginBottom</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\bmarginBottom(?:\s+)?:(?:\s+)?(\d+)</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span>
  <span class="token literal-property property">marginLeft</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\bmarginLeft(?:\s+)?:(?:\s+)?(\d+)</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span>
  <span class="token literal-property property">fontSize</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\bfontSize(?:\s+)?:(?:\s+)?(\d+)</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span>
  <span class="token literal-property property">paddingTop</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\bpaddingTop(?:\s+)?:(?:\s+)?(\d+)</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span>
  <span class="token literal-property property">paddingRight</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\bpaddingRight(?:\s+)?:(?:\s+)?(\d+)</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span>
  <span class="token literal-property property">paddingBottom</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\bpaddingBottom(?:\s+)?:(?:\s+)?(\d+)</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span>
  <span class="token literal-property property">paddingLeft</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\bpaddingLeft(?:\s+)?:(?:\s+)?(\d+)</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 匹配img 中的行内样式 width: '20'</span>
<span class="token keyword">const</span> imgReg <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\bheight(?:\s+)?=(?:\s+)?(\'||\&quot;)?(\d+)?=(\'||\&quot;)?</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span>
  <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\bwidth(?:\s+)?=(?:\s+)?(\'||\&quot;)?(\d+)?=(\'||\&quot;)?</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 匹配数字</span>
<span class="token keyword">const</span> numReg <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(\d+)</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  pxReg<span class="token punctuation">,</span>
  styleReg<span class="token punctuation">,</span>
  imgReg<span class="token punctuation">,</span>
  numReg<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p><strong><code>config.js</code></strong>:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">'path'</span>

<span class="token operator">...</span>

<span class="token function">chainWebpack</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    config<span class="token punctuation">.</span>module
      <span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span><span class="token string">'jsx-px2rem-loader'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>exclude
      <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'../src/pages/.umi'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'node_modules'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'../loader/jsx-px2rem-loader'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">loader</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../loader/jsx-px2rem-loader'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">6/12/2024, 9:57:18 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/base-js/node.html" class="prev">
            Node
          </a></span> <span class="next"><a href="/base-js/webpack/custom.html">
            自定义脚手架
          </a></span></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-cb1513f6><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#定义" class="sidebar-link reco-side-定义" data-v-cb1513f6>定义</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#四个核心概念" class="sidebar-link reco-side-四个核心概念" data-v-cb1513f6>四个核心概念</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#入口" class="sidebar-link reco-side-入口" data-v-cb1513f6>入口</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#出口" class="sidebar-link reco-side-出口" data-v-cb1513f6>出口</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#loader" class="sidebar-link reco-side-loader" data-v-cb1513f6>loader</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#loader-特性" class="sidebar-link reco-side-loader-特性" data-v-cb1513f6>loader 特性</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#插件-plugins" class="sidebar-link reco-side-插件-plugins" data-v-cb1513f6>插件(plugins)</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#模式-mode" class="sidebar-link reco-side-模式-mode" data-v-cb1513f6>模式(mode)</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#manifest" class="sidebar-link reco-side-manifest" data-v-cb1513f6>manifest</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#模块热替换" class="sidebar-link reco-side-模块热替换" data-v-cb1513f6>模块热替换</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#热更新原理" class="sidebar-link reco-side-热更新原理" data-v-cb1513f6>热更新原理</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#文件监听" class="sidebar-link reco-side-文件监听" data-v-cb1513f6>文件监听</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#文件监听的原理" class="sidebar-link reco-side-文件监听的原理" data-v-cb1513f6>文件监听的原理</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#文件指纹" class="sidebar-link reco-side-文件指纹" data-v-cb1513f6>文件指纹</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#分类" class="sidebar-link reco-side-分类" data-v-cb1513f6>分类</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#自动清理构建目录" class="sidebar-link reco-side-自动清理构建目录" data-v-cb1513f6>自动清理构建目录</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#css-增强" class="sidebar-link reco-side-css-增强" data-v-cb1513f6>CSS 增强</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#_1-自动补全属性兼容" class="sidebar-link reco-side-_1-自动补全属性兼容" data-v-cb1513f6>1. 自动补全属性兼容</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#_2-自动-px-转-rem-适配移动端" class="sidebar-link reco-side-_2-自动-px-转-rem-适配移动端" data-v-cb1513f6>2. 自动 px 转 rem 适配移动端</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#静态资源内联" class="sidebar-link reco-side-静态资源内联" data-v-cb1513f6>静态资源内联</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#意义" class="sidebar-link reco-side-意义" data-v-cb1513f6>意义</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#实现" class="sidebar-link reco-side-实现" data-v-cb1513f6>实现</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#功能" class="sidebar-link reco-side-功能" data-v-cb1513f6>功能</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#实现-css-内联" class="sidebar-link reco-side-实现-css-内联" data-v-cb1513f6>实现 css 内联</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#使用-source-map" class="sidebar-link reco-side-使用-source-map" data-v-cb1513f6>使用 source map</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#关键字" class="sidebar-link reco-side-关键字" data-v-cb1513f6>关键字</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#提取页面的公共资源" class="sidebar-link reco-side-提取页面的公共资源" data-v-cb1513f6>提取页面的公共资源</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#基础库的分离" class="sidebar-link reco-side-基础库的分离" data-v-cb1513f6>基础库的分离</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#splitchunks" class="sidebar-link reco-side-splitchunks" data-v-cb1513f6>splitChunks</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#chunks" class="sidebar-link reco-side-chunks" data-v-cb1513f6>chunks</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#cachegroups" class="sidebar-link reco-side-cachegroups" data-v-cb1513f6>cacheGroups</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#maxinitialrequests" class="sidebar-link reco-side-maxinitialrequests" data-v-cb1513f6>maxInitialRequests</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#maxasyncrequests" class="sidebar-link reco-side-maxasyncrequests" data-v-cb1513f6>maxAsyncRequests</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#其余要点" class="sidebar-link reco-side-其余要点" data-v-cb1513f6>其余要点</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#tree-shaking" class="sidebar-link reco-side-tree-shaking" data-v-cb1513f6>Tree Shaking</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#使用" class="sidebar-link reco-side-使用" data-v-cb1513f6>使用</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#原理" class="sidebar-link reco-side-原理" data-v-cb1513f6>原理</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#扩展" class="sidebar-link reco-side-扩展" data-v-cb1513f6>扩展</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#scope-hoisting" class="sidebar-link reco-side-scope-hoisting" data-v-cb1513f6>Scope Hoisting</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#现象" class="sidebar-link reco-side-现象" data-v-cb1513f6>现象</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#原理之模块转化分析" class="sidebar-link reco-side-原理之模块转化分析" data-v-cb1513f6>原理之模块转化分析</a></li><li class="level-4" data-v-cb1513f6><a href="/base-js/webpack/basic.html#结论" class="sidebar-link reco-side-结论" data-v-cb1513f6>结论</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#进一步分析-webpack-的模块机制" class="sidebar-link reco-side-进一步分析-webpack-的模块机制" data-v-cb1513f6>进一步分析 webpack 的模块机制</a></li><li class="level-4" data-v-cb1513f6><a href="/base-js/webpack/basic.html#结论-2" class="sidebar-link reco-side-结论-2" data-v-cb1513f6>结论</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#scope-hoisting-原理" class="sidebar-link reco-side-scope-hoisting-原理" data-v-cb1513f6>Scope Hoisting 原理</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#scope-hoisting-使用" class="sidebar-link reco-side-scope-hoisting-使用" data-v-cb1513f6>Scope Hoisting 使用</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#code-splitting-和-动态-import" class="sidebar-link reco-side-code-splitting-和-动态-import" data-v-cb1513f6>Code Splitting 和 动态 import</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#code-splitting" class="sidebar-link reco-side-code-splitting" data-v-cb1513f6>Code Splitting</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#如何动态的-import" class="sidebar-link reco-side-如何动态的-import" data-v-cb1513f6>如何动态的 import</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#如何使用" class="sidebar-link reco-side-如何使用" data-v-cb1513f6>如何使用</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#内部原理" class="sidebar-link reco-side-内部原理" data-v-cb1513f6>内部原理</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#webpack-与-ci-cd-集成" class="sidebar-link reco-side-webpack-与-ci-cd-集成" data-v-cb1513f6>webpack 与 CI/CD 集成</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#本地开发增加precommit钩子" class="sidebar-link reco-side-本地开发增加precommit钩子" data-v-cb1513f6>本地开发增加precommit钩子</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#webpack-打包组件和基础库" class="sidebar-link reco-side-webpack-打包组件和基础库" data-v-cb1513f6>webpack 打包组件和基础库</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#_1-新建项目-webpack-build-tools-安装webpack和webpack-cli" class="sidebar-link reco-side-_1-新建项目-webpack-build-tools-安装webpack和webpack-cli" data-v-cb1513f6>1.新建项目 webpack-build-tools 安装webpack和webpack-cli</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#_2-新建目录-src-index-js-编写我们的工具代码" class="sidebar-link reco-side-_2-新建目录-src-index-js-编写我们的工具代码" data-v-cb1513f6>2. 新建目录 src/index.js,编写我们的工具代码</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#_3-安装-terser-webpack-plugin-压缩插件" class="sidebar-link reco-side-_3-安装-terser-webpack-plugin-压缩插件" data-v-cb1513f6>3. 安装 terser-webpack-plugin 压缩插件</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#_4-新建-webpack-config-js" class="sidebar-link reco-side-_4-新建-webpack-config-js" data-v-cb1513f6>4. 新建 webpack.config.js</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#_5-修改-package-json-添加打包命令" class="sidebar-link reco-side-_5-修改-package-json-添加打包命令" data-v-cb1513f6>5. 修改 package.json 添加打包命令</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#_6-打包并查看打包效果" class="sidebar-link reco-side-_6-打包并查看打包效果" data-v-cb1513f6>6. 打包并查看打包效果</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#_7-设置入口文件-不同环境下使用不同的入口文件" class="sidebar-link reco-side-_7-设置入口文件-不同环境下使用不同的入口文件" data-v-cb1513f6>7.设置入口文件 不同环境下使用不同的入口文件</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#_8-进行-npm-包发布-需要注册-npm-账号-且进行登录" class="sidebar-link reco-side-_8-进行-npm-包发布-需要注册-npm-账号-且进行登录" data-v-cb1513f6>8.进行 npm 包发布(需要注册 npm 账号,且进行登录)</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#_9-同步代码到-git-并编写对应的说明文档等" class="sidebar-link reco-side-_9-同步代码到-git-并编写对应的说明文档等" data-v-cb1513f6>9. 同步代码到 git,并编写对应的说明文档等</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#webpack-实现-ssr-打包" class="sidebar-link reco-side-webpack-实现-ssr-打包" data-v-cb1513f6>webpack 实现 SSR 打包</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#ssr-代码实现思路" class="sidebar-link reco-side-ssr-代码实现思路" data-v-cb1513f6>SSR 代码实现思路</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#简单示例" class="sidebar-link reco-side-简单示例" data-v-cb1513f6>简单示例</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#打包过程中遇到的问题" class="sidebar-link reco-side-打包过程中遇到的问题" data-v-cb1513f6>打包过程中遇到的问题</a></li><li class="level-4" data-v-cb1513f6><a href="/base-js/webpack/basic.html#浏览器的全局变量-node-js-中没有document-window" class="sidebar-link reco-side-浏览器的全局变量-node-js-中没有document-window" data-v-cb1513f6>浏览器的全局变量(Node.js 中没有document, window)</a></li><li class="level-4" data-v-cb1513f6><a href="/base-js/webpack/basic.html#样式问题-node-js-无法解析css" class="sidebar-link reco-side-样式问题-node-js-无法解析css" data-v-cb1513f6>样式问题(Node.js 无法解析CSS)</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#解决打包样式问题" class="sidebar-link reco-side-解决打包样式问题" data-v-cb1513f6>解决打包样式问题</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#优化构建时命令行的显示" class="sidebar-link reco-side-优化构建时命令行的显示" data-v-cb1513f6>优化构建时命令行的显示</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#使用-friendly-errors-webpack-plugin-优化日志显示" class="sidebar-link reco-side-使用-friendly-errors-webpack-plugin-优化日志显示" data-v-cb1513f6>使用 friendly-errors-webpack-plugin 优化日志显示</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#commonschunkplugin" class="sidebar-link reco-side-commonschunkplugin" data-v-cb1513f6>CommonsChunkPlugin</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#chunk-有哪几种-主要有以下三种" class="sidebar-link reco-side-chunk-有哪几种-主要有以下三种" data-v-cb1513f6>chunk 有哪几种，主要有以下三种：</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#可配置的属性" class="sidebar-link reco-side-可配置的属性" data-v-cb1513f6>可配置的属性：</a></li><li class="level-4" data-v-cb1513f6><a href="/base-js/webpack/basic.html#插件的作用" class="sidebar-link reco-side-插件的作用" data-v-cb1513f6>插件的作用:</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#cleanwebpackplugin" class="sidebar-link reco-side-cleanwebpackplugin" data-v-cb1513f6>CleanWebpackPlugin</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#extracttextwebpackplugin" class="sidebar-link reco-side-extracttextwebpackplugin" data-v-cb1513f6>ExtractTextWebpackPlugin</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#copywebpackplugin" class="sidebar-link reco-side-copywebpackplugin" data-v-cb1513f6>CopyWebpackPlugin</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#uglifyjswebpackplugin" class="sidebar-link reco-side-uglifyjswebpackplugin" data-v-cb1513f6>UglifyjsWebpackPlugin</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#zipwebpackplugin" class="sidebar-link reco-side-zipwebpackplugin" data-v-cb1513f6>ZipWebpackPlugin</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#minicssextractplugin" class="sidebar-link reco-side-minicssextractplugin" data-v-cb1513f6>MiniCssExtractPlugin</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#htmlwebpackplugin" class="sidebar-link reco-side-htmlwebpackplugin" data-v-cb1513f6>HtmlWebpackPlugin</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#path-与-publicpath" class="sidebar-link reco-side-path-与-publicpath" data-v-cb1513f6>path 与 publicPath</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#构建配置抽离成-npm-包" class="sidebar-link reco-side-构建配置抽离成-npm-包" data-v-cb1513f6>构建配置抽离成 npm 包</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#意义-2" class="sidebar-link reco-side-意义-2" data-v-cb1513f6>意义</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#可选方案" class="sidebar-link reco-side-可选方案" data-v-cb1513f6>可选方案</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#组合" class="sidebar-link reco-side-组合" data-v-cb1513f6>组合</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#构建包功能模块设计" class="sidebar-link reco-side-构建包功能模块设计" data-v-cb1513f6>构建包功能模块设计</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#目录结构设计" class="sidebar-link reco-side-目录结构设计" data-v-cb1513f6>目录结构设计</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#冒烟测试" class="sidebar-link reco-side-冒烟测试" data-v-cb1513f6>冒烟测试</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#单元测试和测试覆盖率" class="sidebar-link reco-side-单元测试和测试覆盖率" data-v-cb1513f6>单元测试和测试覆盖率</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#单纯的测试框架-需要断言库" class="sidebar-link reco-side-单纯的测试框架-需要断言库" data-v-cb1513f6>单纯的测试框架,需要断言库</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#集成框架-开箱即用" class="sidebar-link reco-side-集成框架-开箱即用" data-v-cb1513f6>集成框架，开箱即用</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#编写单元测试用例" class="sidebar-link reco-side-编写单元测试用例" data-v-cb1513f6>编写单元测试用例</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#单元测试的接入" class="sidebar-link reco-side-单元测试的接入" data-v-cb1513f6>单元测试的接入</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#验证测试覆盖率" class="sidebar-link reco-side-验证测试覆盖率" data-v-cb1513f6>验证测试覆盖率</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#构建包的持续集成和-travis-ci" class="sidebar-link reco-side-构建包的持续集成和-travis-ci" data-v-cb1513f6>构建包的持续集成和 Travis CI</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#接入-travis-ci" class="sidebar-link reco-side-接入-travis-ci" data-v-cb1513f6>接入 Travis CI</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#发布构建包到-npm" class="sidebar-link reco-side-发布构建包到-npm" data-v-cb1513f6>发布构建包到 npm</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#添加用户" class="sidebar-link reco-side-添加用户" data-v-cb1513f6>添加用户</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#升级版本" class="sidebar-link reco-side-升级版本" data-v-cb1513f6>升级版本</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#发布版本" class="sidebar-link reco-side-发布版本" data-v-cb1513f6>发布版本</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#使用-webpack-内部的-stats-进行构建包的初步分析" class="sidebar-link reco-side-使用-webpack-内部的-stats-进行构建包的初步分析" data-v-cb1513f6>使用 webpack 内部的 stats 进行构建包的初步分析</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#使用-speed-measure-webpack-plugin-进行速度分析" class="sidebar-link reco-side-使用-speed-measure-webpack-plugin-进行速度分析" data-v-cb1513f6>使用 speed-measure-webpack-plugin 进行速度分析</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#使用-webpack-bundle-analyzer-进行体积分析" class="sidebar-link reco-side-使用-webpack-bundle-analyzer-进行体积分析" data-v-cb1513f6>使用 webpack-bundle-analyzer 进行体积分析</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#多进程-多实例并行压缩" class="sidebar-link reco-side-多进程-多实例并行压缩" data-v-cb1513f6>多进程/多实例并行压缩</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#使用-parallel-uglify-plugin" class="sidebar-link reco-side-使用-parallel-uglify-plugin" data-v-cb1513f6>使用 parallel-uglify-plugin</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#使用-uglifyjs-webpack-plugin-并开启-parallel-参数" class="sidebar-link reco-side-使用-uglifyjs-webpack-plugin-并开启-parallel-参数" data-v-cb1513f6>使用 uglifyjs-webpack-plugin 并开启 parallel 参数</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#使用-terser-webpack-plugin-开启-parallel-参数" class="sidebar-link reco-side-使用-terser-webpack-plugin-开启-parallel-参数" data-v-cb1513f6>使用 terser-webpack-plugin 开启 parallel 参数</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#通过设置-externals-进行分包" class="sidebar-link reco-side-通过设置-externals-进行分包" data-v-cb1513f6>通过设置 Externals 进行分包</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#使用-html-webpack-externals-plugin" class="sidebar-link reco-side-使用-html-webpack-externals-plugin" data-v-cb1513f6>使用 html-webpack-externals-plugin</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#进一步分包-采用预编译资源模块" class="sidebar-link reco-side-进一步分包-采用预编译资源模块" data-v-cb1513f6>进一步分包:采用预编译资源模块</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#充分利用缓存提升二次构建速度" class="sidebar-link reco-side-充分利用缓存提升二次构建速度" data-v-cb1513f6>充分利用缓存提升二次构建速度</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#缩小构建目标" class="sidebar-link reco-side-缩小构建目标" data-v-cb1513f6>缩小构建目标</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#比如-babel-loader-不解析-node-modules" class="sidebar-link reco-side-比如-babel-loader-不解析-node-modules" data-v-cb1513f6>比如 babel-loader 不解析 node_modules</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#减少文件搜索范围" class="sidebar-link reco-side-减少文件搜索范围" data-v-cb1513f6>减少文件搜索范围</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#tree-shaking-在-css-中的优化" class="sidebar-link reco-side-tree-shaking-在-css-中的优化" data-v-cb1513f6>Tree Shaking 在 CSS 中的优化</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#使用-webpack-进行图片压缩" class="sidebar-link reco-side-使用-webpack-进行图片压缩" data-v-cb1513f6>使用 webpack 进行图片压缩</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#使用-imagemin-的优点分析" class="sidebar-link reco-side-使用-imagemin-的优点分析" data-v-cb1513f6>使用 Imagemin 的优点分析</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#imagemin-的压缩原理" class="sidebar-link reco-side-imagemin-的压缩原理" data-v-cb1513f6>Imagemin 的压缩原理</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#使用动态的-ployfill-优化构建体积" class="sidebar-link reco-side-使用动态的-ployfill-优化构建体积" data-v-cb1513f6>使用动态的 Ployfill 优化构建体积</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#polyfill-service-原理" class="sidebar-link reco-side-polyfill-service-原理" data-v-cb1513f6>Polyfill Service 原理</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#webpack-启动过程分析" class="sidebar-link reco-side-webpack-启动过程分析" data-v-cb1513f6>webpack 启动过程分析</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#_1-查找-webpack-入口文件" class="sidebar-link reco-side-_1-查找-webpack-入口文件" data-v-cb1513f6>1. 查找 webpack 入口文件</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#_2-分析-webpack-的入口文件-webpack-js-到底做了什么事情" class="sidebar-link reco-side-_2-分析-webpack-的入口文件-webpack-js-到底做了什么事情" data-v-cb1513f6>2. 分析 webpack 的入口文件 webpack.js 到底做了什么事情</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#webpack-cli-源码阅读" class="sidebar-link reco-side-webpack-cli-源码阅读" data-v-cb1513f6>webpack-cli 源码阅读</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#webpack-cli-做的事情" class="sidebar-link reco-side-webpack-cli-做的事情" data-v-cb1513f6>webpack-cli 做的事情</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#_1-从-non-compilation-cdm-分析出不需要编译的命令" class="sidebar-link reco-side-_1-从-non-compilation-cdm-分析出不需要编译的命令" data-v-cb1513f6>1.从 NONCOMPILATIONCDM 分析出不需要编译的命令</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#_2-命令行工具-yargs-介绍" class="sidebar-link reco-side-_2-命令行工具-yargs-介绍" data-v-cb1513f6>2.命令行工具 yargs 介绍</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#_3-webpack-cli-使用-args-分析" class="sidebar-link reco-side-_3-webpack-cli-使用-args-分析" data-v-cb1513f6>3.webpack-cli 使用 args 分析</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#tapable-插件架构与-hooks-设计" class="sidebar-link reco-side-tapable-插件架构与-hooks-设计" data-v-cb1513f6>Tapable 插件架构与 Hooks 设计</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#webpack-的本质是什么" class="sidebar-link reco-side-webpack-的本质是什么" data-v-cb1513f6>webpack 的本质是什么?</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#tapable-是什么" class="sidebar-link reco-side-tapable-是什么" data-v-cb1513f6>Tapable 是什么?</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#tapable-的使用-new-hook-新建钩子" class="sidebar-link reco-side-tapable-的使用-new-hook-新建钩子" data-v-cb1513f6>Tapable 的使用————new Hook(新建钩子)</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#tapable-的使用-钩子的绑定与执行" class="sidebar-link reco-side-tapable-的使用-钩子的绑定与执行" data-v-cb1513f6>Tapable 的使用————钩子的绑定与执行</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#tapable-的使用-hook-基本用法示例" class="sidebar-link reco-side-tapable-的使用-hook-基本用法示例" data-v-cb1513f6>Tapable 的使用————hook 基本用法示例</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#tapable-的使用-实际例子演示" class="sidebar-link reco-side-tapable-的使用-实际例子演示" data-v-cb1513f6>Tapable 的使用————实际例子演示</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#tapable-是如何和-webpack-关联起来的" class="sidebar-link reco-side-tapable-是如何和-webpack-关联起来的" data-v-cb1513f6>Tapable 是如何和 webpack 关联起来的</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#模拟一个自定义的-complier" class="sidebar-link reco-side-模拟一个自定义的-complier" data-v-cb1513f6>模拟一个自定义的 complier</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#根据-complier-编写一个简易的自定义插件" class="sidebar-link reco-side-根据-complier-编写一个简易的自定义插件" data-v-cb1513f6>根据 Complier 编写一个简易的自定义插件</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#模拟插件的执行" class="sidebar-link reco-side-模拟插件的执行" data-v-cb1513f6>模拟插件的执行</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#webpack-流程细剖-准备篇" class="sidebar-link reco-side-webpack-流程细剖-准备篇" data-v-cb1513f6>webpack 流程细剖————准备篇</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#模块构建和-chunk-生成阶段" class="sidebar-link reco-side-模块构建和-chunk-生成阶段" data-v-cb1513f6>模块构建和 chunk 生成阶段</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#modulefactory" class="sidebar-link reco-side-modulefactory" data-v-cb1513f6>ModuleFactory</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#module-的类型" class="sidebar-link reco-side-module-的类型" data-v-cb1513f6>Module 的类型</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#chunk-生成算法" class="sidebar-link reco-side-chunk-生成算法" data-v-cb1513f6>chunk 生成算法</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#webpack-流程篇-文件生成" class="sidebar-link reco-side-webpack-流程篇-文件生成" data-v-cb1513f6>webpack 流程篇————文件生成</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#实战篇-动手编写一个简易的-webpack" class="sidebar-link reco-side-实战篇-动手编写一个简易的-webpack" data-v-cb1513f6>实战篇————动手编写一个简易的 webpack</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#loader-的链式调用和执行顺序" class="sidebar-link reco-side-loader-的链式调用和执行顺序" data-v-cb1513f6>Loader 的链式调用和执行顺序</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#compose-函数" class="sidebar-link reco-side-compose-函数" data-v-cb1513f6>compose 函数</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#使用-loader-runner-高效进行-loader-的调式" class="sidebar-link reco-side-使用-loader-runner-高效进行-loader-的调式" data-v-cb1513f6>使用 loader-runner 高效进行 loader 的调式</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#开发一个-raw-loader" class="sidebar-link reco-side-开发一个-raw-loader" data-v-cb1513f6>开发一个 raw-loader</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#更复杂的-loader-开发场景" class="sidebar-link reco-side-更复杂的-loader-开发场景" data-v-cb1513f6>更复杂的 loader 开发场景</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#通过-loader-utils-的-getoptions-方法获取参数" class="sidebar-link reco-side-通过-loader-utils-的-getoptions-方法获取参数" data-v-cb1513f6>通过 loader-utils 的 getOptions 方法获取参数</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#loader-内部的异常处理" class="sidebar-link reco-side-loader-内部的异常处理" data-v-cb1513f6>loader 内部的异常处理</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#loader-的异步处理" class="sidebar-link reco-side-loader-的异步处理" data-v-cb1513f6>loader 的异步处理</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#在-loader-中使用缓存" class="sidebar-link reco-side-在-loader-中使用缓存" data-v-cb1513f6>在 loader 中使用缓存</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/webpack/basic.html#在-loader-中如何进行文件输出" class="sidebar-link reco-side-在-loader-中如何进行文件输出" data-v-cb1513f6>在 loader 中如何进行文件输出</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#开发一个自动合成雪碧图的-loader" class="sidebar-link reco-side-开发一个自动合成雪碧图的-loader" data-v-cb1513f6>开发一个自动合成雪碧图的 loader</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#插件基本结构介绍" class="sidebar-link reco-side-插件基本结构介绍" data-v-cb1513f6>插件基本结构介绍</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/webpack/basic.html#动手实现一个-loader-之简易的-jsx-px2rem" class="sidebar-link reco-side-动手实现一个-loader-之简易的-jsx-px2rem" data-v-cb1513f6>动手实现一个 loader 之简易的 jsx-px2rem</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><canvas id="vuepress-canvas-cursor"></canvas></div></div>
    <script src="/assets/js/app.ab7ccc71.js" defer></script><script src="/assets/js/3.4edb9727.js" defer></script><script src="/assets/js/1.8fa44146.js" defer></script><script src="/assets/js/25.1dd59c95.js" defer></script>
  </body>
</html>

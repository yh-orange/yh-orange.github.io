<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>yh-orange 学习笔记</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/images/icon.png">
    <meta name="description" content="Personal Website">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.31114bff.css" as="style"><link rel="preload" href="/assets/js/app.ab7ccc71.js" as="script"><link rel="preload" href="/assets/js/3.4edb9727.js" as="script"><link rel="preload" href="/assets/js/1.8fa44146.js" as="script"><link rel="preload" href="/assets/js/23.86990ac5.js" as="script"><link rel="prefetch" href="/assets/js/10.117c3e7a.js"><link rel="prefetch" href="/assets/js/11.92bc9c31.js"><link rel="prefetch" href="/assets/js/12.f9afe2d3.js"><link rel="prefetch" href="/assets/js/13.814b4335.js"><link rel="prefetch" href="/assets/js/14.07ec2310.js"><link rel="prefetch" href="/assets/js/15.75624940.js"><link rel="prefetch" href="/assets/js/16.1b7695b0.js"><link rel="prefetch" href="/assets/js/17.3ebd7f2b.js"><link rel="prefetch" href="/assets/js/18.74427907.js"><link rel="prefetch" href="/assets/js/19.6afca700.js"><link rel="prefetch" href="/assets/js/20.62ea23cc.js"><link rel="prefetch" href="/assets/js/21.2a1e282a.js"><link rel="prefetch" href="/assets/js/22.3e86ef0c.js"><link rel="prefetch" href="/assets/js/24.901bce47.js"><link rel="prefetch" href="/assets/js/25.1dd59c95.js"><link rel="prefetch" href="/assets/js/26.d382260a.js"><link rel="prefetch" href="/assets/js/27.4f928d65.js"><link rel="prefetch" href="/assets/js/28.3b826946.js"><link rel="prefetch" href="/assets/js/29.6c5a6671.js"><link rel="prefetch" href="/assets/js/30.236895e5.js"><link rel="prefetch" href="/assets/js/31.b8047fdd.js"><link rel="prefetch" href="/assets/js/32.1d2b663c.js"><link rel="prefetch" href="/assets/js/33.a3528f35.js"><link rel="prefetch" href="/assets/js/34.03511400.js"><link rel="prefetch" href="/assets/js/35.de42440a.js"><link rel="prefetch" href="/assets/js/36.0fc211d4.js"><link rel="prefetch" href="/assets/js/37.26759b23.js"><link rel="prefetch" href="/assets/js/38.588a7518.js"><link rel="prefetch" href="/assets/js/39.15e5c940.js"><link rel="prefetch" href="/assets/js/4.e9ad93dd.js"><link rel="prefetch" href="/assets/js/40.c97b3712.js"><link rel="prefetch" href="/assets/js/41.303f2a45.js"><link rel="prefetch" href="/assets/js/42.73ca30bd.js"><link rel="prefetch" href="/assets/js/43.953b4c7c.js"><link rel="prefetch" href="/assets/js/44.6792b66b.js"><link rel="prefetch" href="/assets/js/45.0c7776f3.js"><link rel="prefetch" href="/assets/js/46.c0458285.js"><link rel="prefetch" href="/assets/js/47.926765f5.js"><link rel="prefetch" href="/assets/js/48.8fa5c2c8.js"><link rel="prefetch" href="/assets/js/49.7495e132.js"><link rel="prefetch" href="/assets/js/5.4c32532b.js"><link rel="prefetch" href="/assets/js/50.d63aadc0.js"><link rel="prefetch" href="/assets/js/51.9a363be7.js"><link rel="prefetch" href="/assets/js/52.28410924.js"><link rel="prefetch" href="/assets/js/53.acc6026d.js"><link rel="prefetch" href="/assets/js/54.e030fc14.js"><link rel="prefetch" href="/assets/js/55.0b081e5c.js"><link rel="prefetch" href="/assets/js/56.833ab305.js"><link rel="prefetch" href="/assets/js/57.b1608b93.js"><link rel="prefetch" href="/assets/js/58.be51ba8c.js"><link rel="prefetch" href="/assets/js/59.aec83a30.js"><link rel="prefetch" href="/assets/js/6.132c57c0.js"><link rel="prefetch" href="/assets/js/60.08ff5ee8.js"><link rel="prefetch" href="/assets/js/61.94a50c42.js"><link rel="prefetch" href="/assets/js/62.b2db71be.js"><link rel="prefetch" href="/assets/js/63.2a0181c3.js"><link rel="prefetch" href="/assets/js/64.7f023a4a.js"><link rel="prefetch" href="/assets/js/65.17b400ef.js"><link rel="prefetch" href="/assets/js/66.794f64c3.js"><link rel="prefetch" href="/assets/js/67.ce97d267.js"><link rel="prefetch" href="/assets/js/68.12100ad3.js"><link rel="prefetch" href="/assets/js/69.31abf334.js"><link rel="prefetch" href="/assets/js/7.49a9a74a.js"><link rel="prefetch" href="/assets/js/70.dcd9c229.js"><link rel="prefetch" href="/assets/js/71.6eb3c080.js"><link rel="prefetch" href="/assets/js/72.741c9df7.js"><link rel="prefetch" href="/assets/js/73.30fe6803.js"><link rel="prefetch" href="/assets/js/74.b146fd8c.js"><link rel="prefetch" href="/assets/js/75.b3e38e76.js"><link rel="prefetch" href="/assets/js/76.73926b71.js"><link rel="prefetch" href="/assets/js/77.65ea9d49.js"><link rel="prefetch" href="/assets/js/78.1d532daa.js"><link rel="prefetch" href="/assets/js/79.07ccc890.js"><link rel="prefetch" href="/assets/js/8.17f9c4ab.js"><link rel="prefetch" href="/assets/js/9.71be61be.js">
    <link rel="stylesheet" href="/assets/css/0.styles.31114bff.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-1aefc0b4><div data-v-1aefc0b4><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-1aefc0b4 data-v-1aefc0b4><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-25ba6db2 data-v-1aefc0b4 data-v-1aefc0b4><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>yh-orange 学习笔记</h3> <p class="description" data-v-25ba6db2 data-v-25ba6db2>Personal Website</p> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><span data-v-25ba6db2>yh-orange</span>
            
          <!---->
          2024
        </a></span></div></div> <div class="hide" data-v-1aefc0b4><header class="navbar" data-v-1aefc0b4><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/images/hero.jpg" alt="yh-orange 学习笔记" class="logo"> <span class="site-name">yh-orange 学习笔记</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/base-js/" class="nav-link router-link-active"><i class="undefined"></i>
  前端基础资料
</a></div><div class="nav-item"><a href="/informal-essay/" class="nav-link"><i class="undefined"></i>
  随笔
</a></div><div class="nav-item"><a href="/front-end-engineering/" class="nav-link"><i class="undefined"></i>
  前端工程化
</a></div><div class="nav-item"><a href="/ps/" class="nav-link"><i class="undefined"></i>
  拍照修图
</a></div><div class="nav-item"><a href="/other/" class="nav-link"><i class="undefined"></i>
  其他资料
</a></div><div class="nav-item"><a href="/mini-program/" class="nav-link"><i class="undefined"></i>
  小程序资料
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-1aefc0b4></div> <aside class="sidebar" data-v-1aefc0b4><div class="personal-info-wrapper" data-v-39576ba9 data-v-1aefc0b4><!----> <h3 class="name" data-v-39576ba9>
    yh-orange
  </h3> <div class="num" data-v-39576ba9><div data-v-39576ba9><h3 data-v-39576ba9>60</h3> <h6 data-v-39576ba9>Articles</h6></div> <div data-v-39576ba9><h3 data-v-39576ba9>0</h3> <h6 data-v-39576ba9>Tags</h6></div></div> <ul class="social-links" data-v-39576ba9></ul> <hr data-v-39576ba9></div> <nav class="nav-links"><div class="nav-item"><a href="/base-js/" class="nav-link router-link-active"><i class="undefined"></i>
  前端基础资料
</a></div><div class="nav-item"><a href="/informal-essay/" class="nav-link"><i class="undefined"></i>
  随笔
</a></div><div class="nav-item"><a href="/front-end-engineering/" class="nav-link"><i class="undefined"></i>
  前端工程化
</a></div><div class="nav-item"><a href="/ps/" class="nav-link"><i class="undefined"></i>
  拍照修图
</a></div><div class="nav-item"><a href="/other/" class="nav-link"><i class="undefined"></i>
  其他资料
</a></div><div class="nav-item"><a href="/mini-program/" class="nav-link"><i class="undefined"></i>
  小程序资料
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>前端基础资料</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/base-js/html-css-js.html" class="sidebar-link">html+css+js</a></li><li><a href="/base-js/wen-dang-dui-xiang-mo-xing.html" class="sidebar-link">文档对象模型</a></li><li><a href="/base-js/liu-lan-qi-dui-xiang.html" class="sidebar-link">浏览器对象</a></li><li><a href="/base-js/javascriptji-chu-zhi-shi.html" aria-current="page" class="active sidebar-link">javaScript基础知识</a></li><li><a href="/base-js/es6-es12te-xing-zong-jie.html" class="sidebar-link">ES6-ES12特性总结</a></li><li><a href="/base-js/httpxiang-guan-zhi-shi.html" class="sidebar-link">HTTP 相关知识</a></li><li><a href="/base-js/git.html" class="sidebar-link">git基本操作</a></li><li><a href="/base-js/es.html" class="sidebar-link">es</a></li><li><a href="/base-js/node.html" class="sidebar-link">Node</a></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>webpack相关知识</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/base-js/webpack/basic.html" class="sidebar-link">webpack的基础介绍</a></li><li><a href="/base-js/webpack/custom.html" class="sidebar-link">自定义脚手架</a></li></ul></section></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-25ba6db2 data-v-1aefc0b4><h3 class="title" data-v-25ba6db2 data-v-25ba6db2></h3> <!----> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><span data-v-25ba6db2>yh-orange</span>
            
          <!---->
          2024
        </a></span></div></div> <div data-v-1aefc0b4><main class="page"><section><div class="page-title"><h1 class="title"></h1> <div data-v-f875f3fc><i class="iconfont reco-account" data-v-f875f3fc><span data-v-f875f3fc>yh-orange</span></i> <!----> <i class="iconfont reco-eye" data-v-f875f3fc><span id="/base-js/javascriptji-chu-zhi-shi.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-f875f3fc><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <!----></div></div> <div class="theme-reco-content content__default"><p><code>#</code>javaScript` 基础知识</p> <h2 id="script标签"><a href="#script标签" class="header-anchor">#</a> <code>script</code>标签</h2> <blockquote><p>目的：让 <code>JavaScript</code> 既能与 <code>HTML</code> 页面共存，又不影响那些页面在其他浏览器中的呈现效果。</p></blockquote> <p>常用属性</p> <ol><li><code>async</code>(可选): 关键词：异步脚本，外部文件，立即下载；</li></ol> <p>当标签中包含这个属性时会立即下载脚本（外部文件），只对外部脚本文件有效，下载的同时可以进行页面的其他操作，下载完成后停止解析并执行，执行后继续进行解析，但不能保证执行顺序。</p> <ol start="2"><li><code>defer</code>（可选）: 关键词：延迟脚本，外部文件，延迟加载；</li></ol> <p>当标签中包含这个属性时，脚本可以再等到页面完全被解析或显示之后执行，只对外部文件有效，如果同时存在两个带有<code>defer</code>的脚本，由于延迟的原因，前者将会优先于后者执行。</p> <ol start="3"><li><code>charset</code>（可选）: 关键词：字符集</li></ol> <p>大多数浏览器已经忽略它的值了，所以很少有人使用。</p> <ol start="4"><li><code>src</code>（可选）: 关键词：外部引用</li></ol> <p>指明要引用的外部脚本文件的地址。</p> <ol start="5"><li><code>type</code>（可选）: 关键词：<code>MIME</code>（脚本语言的内容类型）</li></ol> <p>为保证最大限度的浏览器兼容，type的属性值主要时候用的依旧是<code>text/javascript</code>，如果没有写这个属性，其默认值仍然为<code>text/javascript</code>。</p> <div class="custom-block warning"><p class="title">WARNING</p><p>外部script脚本内不应该包含其他自定义的脚本，其他自定义的脚本内部的代码并不会被执行。</p></div><h2 id="noscript标签"><a href="#noscript标签" class="header-anchor">#</a> <code>noscript</code>标签</h2> <blockquote><p><code>noscript</code>元素用来定义在脚本未被执行时的替代内容（文本）。</p></blockquote> <p>主要有以下两种情况:</p> <ul><li>浏览器不支持脚本；</li> <li>浏览器支持脚本，但是JavaScript被禁用；</li></ul> <h2 id="script脚本解析顺序问题"><a href="#script脚本解析顺序问题" class="header-anchor">#</a> <code>script</code>脚本解析顺序问题</h2> <p>按照传统的做法，所有<code>&lt;script&gt;</code>元素都应该放在页面的<code>&lt;head&gt;</code>元素中，例如:</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span> 
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span> 
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Example HTML Page<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span> 
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>example1.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span> 
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>example2.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span> 
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span> 
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span> 
 <span class="token comment">&lt;!-- 这里放网站的内容 --&gt;</span> 
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>这种做法目的是把外部文件(<code>CSS</code>和<code>JS</code>)放置在相同位置。可是这种做法会等到<code>&lt;head&gt;</code>元素中的<code>javascript</code>脚本全部下载、解析、执行完毕后，再开始解析页面的内容。</p> <p>对于那些需要很多<code>javaScript</code>代码的页面来说，这无疑会导致浏览器在呈现页面时出现明显的延迟，而延迟期间的浏览器窗口中将是一片空白。</p> <p>为了避免这个问题，现代<code>Web</code>应用程序一般都把<code>javaScript</code>引用放在<code>&lt;body&gt;</code>元素中页面内容的后面，如下例所示：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span> 
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span> 
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Example HTML Page<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span> 
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span> 
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span> 
 <span class="token comment">&lt;!-- 这里放内容 --&gt;</span> 
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>example1.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span> 
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>example2.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span> 
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>这样，在解析包含的<code>javaScript</code>代码之前，页面的内容将完全呈现在浏览器中。而用户也会因为浏览器窗口显示空白页面的时间缩短而感到打开页面的速度加快了。</p> <h2 id="严格模式与非严格模式"><a href="#严格模式与非严格模式" class="header-anchor">#</a> 严格模式与非严格模式</h2> <div class="custom-block tip"><p class="title">TIP</p><p><a href="https://www.jb51.net/article/174040.htm" target="_blank" rel="noopener noreferrer">完整例子<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div><p><code>ECMAScript 5</code>引入了<code>严格模式(strict mode)</code>的概念。</p> <p>严格模式是为<code>javaScript</code>定义了一种不同的解析与执行模型。</p> <p>在严格模式下，<code>ECMAScript3</code>中的一些不确定的行为将得到处理，而且对某些不安全 的操作也会抛出错误。</p> <p><em>要在整个脚本中启用严格模式，可以在js文件顶部添加如下代码：</em></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// js</span>
<span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><em>也可以指定函数在严格模式下执行</em></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
 <span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span> 
 <span class="token comment">//函数体</span>
<span class="token punctuation">}</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><em>严格模式对正常的 JavaScript语义做了一些更改：</em></p> <blockquote><ol><li>严格模式通过抛出错误来消除了一些原有静默错误。</li> <li>严格模式修复了一些导致 JavaScript引擎难以执行优化的缺陷：有时候，相同的代码，严格模式可以比非严格模式下运行得更快。</li> <li>严格模式禁用了在ECMAScript的未来版本中可能会定义的一些语法。</li></ol></blockquote> <p><em>详细的区别</em></p> <ol><li><p>禁用<code>with</code>语法，使用将报错。因为解析<code>with</code>语法时作用域的情况会非常复杂，严重影响代码的解析与运行速度</p></li> <li><p>禁止删除变量与函数。<code>delete</code> 变量 <code>或delete</code> 函数都将报错。</p></li> <li><p>属性描述符（<code>propertyDescriptor</code>）相关:</p></li> <li><p>能改变属性描述符的方法有： <code>Object.defineProperty</code>、 <code>Object.defineProperties</code>、 <code>Reflect.defineProperty</code>、 <code>Reflect.defineProperties</code>、 <code>Object.freeze</code> 冻结对象的一切属性、 <code>Object.seal</code> 冻结对象的新增属性，即可以更改已存在的属性的值，和<code>writeable</code>有关，但是无法新增属性。</p></li></ol> <p><em>能改变属性描述符的方法有：</em> <code>Object.defineProperty</code>、 <code>Object.defineProperties</code>、 <code>Reflect.defineProperty</code>、 <code>Reflect.defineProperties</code>、 <code>Object.freeze</code> 冻结对象的一切属性、 <code>Object.seal</code> 冻结对象的新增属性，即可以更改已存在的属性的值，和<code>writeable</code>有关，但是无法新增属性。</p> <p><em>获取一个属性描述符的方法有:</em> <code>Object.getOwnPropertyDescriptor</code>、 <code>Object.getOwnPropertyDecriptors</code>、 <code>Reflect.getOwnPropertyDescriptor</code>、 <code>Reflect.getOwnPropertyDescriptors</code></p> <p><s>-删除configurable = false的属性会报错</s></p> <p><s>-给writable = false的属性赋值会报错</s></p> <p><s>-给不允许扩展的object增加属性会报错</s></p> <p>将<code>object</code>设置为不可扩展的方法有: <code>Object.freeze</code>、<code>Object.seal</code>、<code>Object.preventExtensions</code>、 <code>Reflect.freeze</code>、<code>Reflect.seal</code>、<code>Reflect.preventExtensions</code></p> <p>判断一个<code>object</code>是否允许扩展可以用 <code>Object.isExtensible</code>、<code>Reflect.isExtensible</code></p> <p><s>- 定义object时属性重名会报错</s></p> <p><s>- 形参重复时会报错</s></p> <p><s>- eval有独立作用域,eval不能作为变量名或函数名,类似关键字</s></p> <p><s>- arguments是形参的副本（类似浅拷贝）,arguments不能作为变量名或函数名,类似关键字</s></p> <p><s>- 禁用caller与callee</s></p> <h2 id="var关键字与变量生命周期"><a href="#var关键字与变量生命周期" class="header-anchor">#</a> var关键字与变量生命周期</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> message<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>未赋值的变量初始值为 <code>undefined</code>。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> message <span class="token operator">=</span> <span class="token string">&quot;hi&quot;</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>有一点必须注意，即用<code>var</code>操作符定义的变量将成为定义该变量的作用域中的局部变量。</p> <p>也就是说，如果在函数中使用<code>var</code>定义一个变量，那么这个变量在函数退出后就会被销毁。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
 <span class="token keyword">var</span> message <span class="token operator">=</span> <span class="token string">&quot;hi&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 局部变量</span>
<span class="token punctuation">}</span> 
<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">alert</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 错误！</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>这里，变量<code>message</code>是在函数中使用<code>var</code>定义的。当函数被调用时，就会创建该变量并为其赋值。而在此之后，这个变量又会立即被销毁，因此例子中的下一行代码就会导致错误。
var声明的变量在函数内部，函数会产生局部作用域，无法在外部字节访问。</p> <p>不过，可以像下面这样省略<code>var</code>操作符，从而创建一个全局变量：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
 message <span class="token operator">=</span> <span class="token string">&quot;hi&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 全局变量</span>
<span class="token punctuation">}</span> 
<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">alert</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;hi&quot; </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><em>虽然省略<code>var</code>关键字声明变量会将变量声明为全局变量,但是并不推荐。因为在局部作用域中定义的全局变量很难维护。给未声明的变量赋值在严格模式下会抛出<code>ReferenceError</code>错误。</em></p> <h2 id="变量提升"><a href="#变量提升" class="header-anchor">#</a> 变量提升</h2> <blockquote><p>在 <code>ECMAScript</code> 中有一个奇怪的语法规则： 变量提升。如果你使用了一个从未声明的变量，程序运行就会抛出错误。但是代码中如果使用 <code>var</code> 对其进行过声明,无论在声明前使用，还是在声明后使用，都不会报异常</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 变量提升</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>

<span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">&quot;Jack&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Jack</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>如果你直接对一个未声明的变量进行赋值，就相当于在全局作用域声明了这样的一个变量，会造成无意的变量泄露。</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 变量泄露</span>
<span class="token keyword">function</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  age <span class="token operator">=</span> <span class="token number">24</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 24</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>造成这种现象的原因是: JavaScript解释器在对代码进行扫描的时候，会将全局作用域中声明的变量和函数先定义为全局符号，运行到具体声明处才进行赋值。</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 变量提升</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token keyword">typeof</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '' string 是因为取的window里面的name属性 这个地方比较特殊 在node段打印出来是undefined</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">&quot;Jack&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> sum <span class="token operator">=</span> i<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>上述的示例代码中，首先 <code>if</code> 条件判断语句为 <code>false</code>，<code>if</code> 内部的代码永远不会执行,但是从结果中我们可以看到第一句打印的语句并不会报错，<code>name</code> 变量还是被声明了。</p> <p>而在后面的循环结构中，我们在 <code>for</code> 循环条件语句中声明了一个 <code>i</code> 变量，在循环体内部声明了 <code>sum</code> 变量，可是当 <code>sum</code> 循环结束后，<code>i</code> 变量依然存在，变成了全局的变量。</p> <p><code>sum</code> 同样也变成了全局的变量，这种所谓的变量提升会消耗一部分无用内存，并对之后的代码编写产生额外的风险。</p> <h2 id="数据类型"><a href="#数据类型" class="header-anchor">#</a> 数据类型</h2> <p><strong><code>javascript</code> 有如下几种数据类型：</strong></p> <h3 id="基本数据类型"><a href="#基本数据类型" class="header-anchor">#</a> 基本数据类型</h3> <div class="language-md line-numbers-mode"><pre class="language-md"><code><span class="token list punctuation">1.</span> <span class="token code-snippet code keyword">`undefined`</span>
<span class="token list punctuation">2.</span> <span class="token code-snippet code keyword">`null`</span>
<span class="token list punctuation">3.</span> <span class="token code-snippet code keyword">`number`</span>
<span class="token list punctuation">4.</span> <span class="token code-snippet code keyword">`string`</span>
<span class="token list punctuation">5.</span> <span class="token code-snippet code keyword">`boolean`</span>
<span class="token list punctuation">6.</span> <span class="token code-snippet code keyword">`symbol`</span>(ES6中加入的变量类型)
<span class="token list punctuation">7.</span> <span class="token code-snippet code keyword">`bigInt`</span>(ES10中加入的变量类型)

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="复杂数据类型"><a href="#复杂数据类型" class="header-anchor">#</a> 复杂数据类型</h3> <p>对象 <code>object</code></p> <p>在将一个值赋给变量时，解析器必须确定这个值是基本类型值还是引用类型值。</p> <p>基本数据类型：<code>Undefined</code>、<code>Null</code>、<code>Boolean</code>、<code>Number</code> 、<code>String</code>、<code>Symbol</code>、<code>BigInt</code> 是按值访问的，因为可以操作保存在变量中的实际的值。</p> <div class="custom-block tip"><p class="title">TIP</p><p><code>原始值</code>和<code>引用值</code>的区别在于存储的位置与访问的方式不同。</p> <ul><li><code>原始类型</code>的值是存储在栈中的简单数据。</li> <li><code>引用类型</code>的值是保存在<code>内存(堆内存</code>)中的对象。
与其他语言不同，<code>JavaScript</code> 不允许直接访问内存中的位置，也就是说不能直接操作对象的内存空间。</li></ul> <p>当复制保存着对象的某个变量时，操作的是<code>对象的引用</code>。</p> <p>但在为对象添加属性时，操作的是实际的对象。</p></div><div class="custom-block warning"><p class="title">WARNING</p><p>只能给<code>引用类型值</code>动态地添加属性，以便将来使用。</p> <p>变量在内存中存储的方式</p></div><h3 id="变量在内存中存储的方式"><a href="#变量在内存中存储的方式" class="header-anchor">#</a> 变量在内存中存储的方式</h3> <p>在 <code>JavaScript</code> 中，每一个变量在内存中都需要一个空间来存储，内存空间又被分为两种:</p> <p>栈内存。</p> <ul><li><p>堆内存。</p></li> <li><p>栈内存</p></li></ul> <p><strong>栈内存</strong></p> <ul><li>先进后出，后进先出(栈的概念是弹压,就像子弹壳装弹,一粒一粒压进去,但是打出来的时候是从上面打出来的,最先压进去的最后弹出来,如果进去顺序是123,打出来顺序是321,这就是后进先出。)</li> <li>存储的值大小固定</li> <li>空间较小</li> <li>可以直接操作其保存的变量，运行效率高</li> <li>由系统自动分配存储空间</li> <li><code>JavaScript</code> <strong>中的原始类型的值被直接存储在<code>栈</code>中，在变量定义时，<code>栈</code>就为其分配好了内存空间。</strong></li></ul> <p><strong>堆内存</strong></p> <ul><li>先进先出</li> <li>存储的值大小不定，可动态调整</li> <li>空间较大，运行效率低</li> <li>无法直接操作其内部存储，使用引用地址读取</li> <li>通过代码进行分配空间</li></ul> <p>相对于原始数据类型，我们习惯把对象称为引用类型，引用类型的值实际存储在<code>堆内存</code>中，它在<code>栈</code>中只存储了一个固定长度的地址，这个地址指向<code>堆内存</code>中的值。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;Hello World&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">obj2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;obj2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> obj3 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><img src="/images/base-js13.png" alt="堆栈关系"></p> <h3 id="复制基本类型"><a href="#复制基本类型" class="header-anchor">#</a> 复制基本类型</h3> <p>如果从一个变量向另一个变量复制基本类型的值，会在变量对象上创建一个新值，然后把该值复制到为新变量分配的位置上。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> num1 <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> num2 <span class="token operator">=</span> num1<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>在此，<code>num1</code> 中保存的值是 5。当使用 <code>num1</code> 的值来初始化 <code>num2</code> 时，<code>num2</code> 中也保存了值 5。</p> <p>但 <code>num2</code> 中的 5 与 <code>num1</code> 中的 5 是完全独立的，该值只是 <code>num1</code> 中 5 的一个副本</p> <p><strong>此后，这两个变量可以参与任何操作而不会相互影响。</strong></p> <p><em>复制前</em></p> <table><thead><tr><th>属性名</th> <th>属性值</th></tr></thead> <tbody><tr><td>num1</td> <td>5(Number 类型)</td></tr></tbody></table> <p><em>复制后</em></p> <table><thead><tr><th>属性名</th> <th>属性值</th></tr></thead> <tbody><tr><td>num2</td> <td>5(Number 类型)</td></tr> <tr><td>num1</td> <td>5(Number 类型)</td></tr></tbody></table> <h3 id="复制引用类型"><a href="#复制引用类型" class="header-anchor">#</a> 复制引用类型</h3> <p>当从一个变量向另一个变量复制引用类型的值时，同样也会将存储在变量对象中的值复制一份放到为新变量分配的空间中。</p> <p>不同的是，这个值的副本实际上是一个指针，而这个指针指向存储在堆中的一个对象。复制操作结束后，两个变量实际上将引用同一个对象。</p> <p>因此，改变其中一个变量，就会影响另一个变量，如下面的例子所示：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> obj1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> obj2 <span class="token operator">=</span> obj1<span class="token punctuation">;</span>
obj1<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;Nicholas&quot;</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>obj2<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&quot;Nicholas&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>首先，变量 <code>obj1</code> 保存了一个对象的新实例。然后，这个值被复制到了 <code>obj2</code> 中；</p> <p>换句话说，<code>obj1</code> 和 <code>obj2</code> 都指向同一个对象。这样，当为 <code>obj1</code> 添加 <code>name</code> 属性后，可以通过 <code>obj2</code> 来访问这个属性， 因为这两个变量引用的都是同一个对象。</p> <p><img src="/images/base-js14.png" alt="复制引用类型"></p> <h3 id="变量类型检测"><a href="#变量类型检测" class="header-anchor">#</a> 变量类型检测</h3> <ul><li>如果想检验变量是否是基础类型的话，推荐的方式是typeof操作符。</li> <li>如果我们想要知道一个对象是什么类型的对象，推荐使用instanceof来判断。</li> <li>通用的方式，我们可以使用Object.prototype.toString.call()来检测变量具体是什么类型。</li></ul> <h3 id="变量之间比较"><a href="#变量之间比较" class="header-anchor">#</a> 变量之间比较</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 当我们在对两个变量进行比较时，不同类型的变量的表现是不同的：</span>
<span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">&quot;ConardLi&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> name2 <span class="token operator">=</span> <span class="token string">&quot;ConardLi&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name <span class="token operator">===</span> name2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;ConardLi&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;ConardLi&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj <span class="token operator">===</span> obj2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="custom-block tip"><p class="title">TIP</p><p>通过上述变量类型在内存中的存储方式,我们知道基础变量类型之间存储在栈中,两者的比较只会去比较两者的类型和值是否一致，如果一致就返回了 <code>true</code>。</p> <p>对应引用类型 <code>obj</code>、<code>obj2</code> 我们知道他们在栈中存储了一个指向堆中数据的指针,两个数据的值虽然是一样的,但是在栈中存储的指针的地址是不一致的,所以两者并不相等。</p></div><h3 id="值传递和引用传递"><a href="#值传递和引用传递" class="header-anchor">#</a> 值传递和引用传递</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token string">&quot;Lucy&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">changeName</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  name <span class="token operator">=</span> <span class="token string">&quot;Jack&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">changeName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Lucy</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>上述代码的执行结果,<code>name</code> 仍然是 <code>Lucy</code>,说明函数参数传递的是变量的值，即值传递,改变这个局部变量不会对外部变量产生影响。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;Lucy&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">changeValue</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  obj<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;Jack&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">changeValue</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Jack</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>上述代码的执行结果 <code>name</code> 变成了 <code>Jack</code>。但是，是不是参数是引用类型就是引用传递呢？</p> <div class="custom-block warning"><p class="title">WARNING</p><p><code>ECMAScript</code> 中所有的函数的参数都是按值传递的。</p></div><p>当函数参数是<code>引用类型</code>时，我们同样将参数复制了一个副本到局部变量，只不过复制的这个副本是指向堆内存中的地址而已，我们在函数内部对对象的属性进行操作，实际上和外部变量指向堆内存中的值相同，但是这并不代表着引用传递，下面我们再看一个例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">changeValue</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  obj<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;Lucy&quot;</span><span class="token punctuation">;</span>
  obj <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;Jack&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">changeValue</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Lucy</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>因此可见，函数参数传递的并不是变量的引用，而是变量拷贝的副本，当变量是原始类型时，这个副本就是值本身，当变量是引用类型时，这个副本是指向堆内存的地址。</p> <h3 id="引用类型与基本类型生命周期"><a href="#引用类型与基本类型生命周期" class="header-anchor">#</a> 引用类型与基本类型生命周期</h3> <ul><li>使用 <code>new</code> 操作符创建的引用类型的实例，在执行流离开当前作用域之前都一直保存在内存中。</li> <li>自动创建的基本包装类型的对象，则只存在于一行代码的执行瞬间，然后立即被销毁。</li></ul> <p><strong>这意味着我们不能在运行时为基本类型值添加属性和方法。</strong> 来看下面的例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token string">&quot;some text&quot;</span><span class="token punctuation">;</span>
s1<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>s1<span class="token punctuation">.</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//undefined</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>在此，第二行代码试图为字符串 <code>s1</code> 添加一个 <code>color</code> 属性。但是，当第三行代码再次访问 <code>s1</code> 时，其 <code>color</code> 属性不见了。</p> <p>问题的原因就是第二行创建的 <code>String</code> 对象在执行第三行代码时已经被销毁了。第三行代码又创建自己的 <code>String</code> 对象，而该对象没有 <code>color</code> 属性。</p> <h2 id="null、underfined、void-0"><a href="#null、underfined、void-0" class="header-anchor">#</a> null、underfined、void 0</h2> <blockquote><p>我们首先要明白的是,<code>javascript</code> 中变量只声明不赋值的话默认就是 <code>undefined</code>。</p></blockquote> <p><code>undefined</code> 表示未定义,它的类型只有一个就是 <code>undefined</code>。</p> <p><code>undefined</code> 值是派生自 <code>null</code> 值的，因此<code>ECMA-262</code> 规定对它们的相等性测试要返回 <code>true</code>。</p> <p><strong>对于尚未声明过的变量，只能使用 <code>typeof</code> 操作符检测其数据类型(对未经声明的变量调用 <code>delete</code> 不会导致错误，但这样做没什么实际意义，在严格模式下确实会导致错误)。</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">null</span> <span class="token operator">==</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token keyword">null</span> <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span> <span class="token comment">// false</span>

<span class="token keyword">let</span> a<span class="token punctuation">;</span>
<span class="token keyword">typeof</span> a<span class="token punctuation">;</span> <span class="token comment">// undefined</span>

<span class="token keyword">function</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1111</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> fn <span class="token operator">=</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 没有返回值的函数 返回的值也是undefined</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>如前所述，无论在什么情况下都没有必要把一个变量的值显式地设置为 <code>undefined</code>，可是同样的规则对 <code>null</code> 却不适用。</p> <div class="custom-block tip"><p class="title">TIP</p><p>换句话说，只要意在保存对象的变量还没有真正保存对象，就应该明确地让该变量保存null值。</p> <p>这样做不仅可以体现null作为空对象指针的惯例，而且也有助于进一步区分null和undefined。</p></div><h3 id="void-0-与-undefined"><a href="#void-0-与-undefined" class="header-anchor">#</a> void 0 与 undefined</h3> <p>在 <code>js</code> 中 <code>undefined</code> 是一个变量而并非是一个关键字所以可能存在无意中被篡改的问题,在这种情况下我们可以使用 <code>void 0</code> 来代替 <code>undefined</code> 的值。</p> <p>或者我们想要返回一个 <code>undefined</code> 的计算值的时候。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token number">2020</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Output: 2020</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token function">getYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Output: undefined</span>

<span class="token comment">// Useful use case</span>
button<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span> <span class="token function">getYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="数值转换"><a href="#数值转换" class="header-anchor">#</a> 数值转换</h2> <p><strong>由于保存浮点数值需要的内存空间是保存整数值的两倍，因此 <code>ECMAScript</code> 会不失时机地将浮点数值转换为整数值。</strong></p> <p>有 3 个函数可以把非数值转换为数值：<code>Number()</code>、<code>parseInt()</code>和 <code>parseFloat()</code>。</p> <p>第一个函数，即转型函数<code>Number()</code>可以用于任何数据类型，而另两个函数则专门用于把字符串转换成数值。</p> <h3 id="number-函数的转换规则如下"><a href="#number-函数的转换规则如下" class="header-anchor">#</a> <code>Number()</code>函数的转换规则如下</h3> <ul><li>如果是 <code>Boolean</code> 值 <code>true</code> 和 <code>false</code> 将分别被转换为 1 和 0。</li> <li>如果是数字值，只是简单的传入和返回。</li> <li>如果是 <code>null</code> 值，返回 <code>0</code>。</li> <li>如果是 <code>undefined</code>，返回 <code>NaN</code>。</li> <li>如果是字符串，遵循下列规则：</li> <li>如果字符串中只包含数字，则将其转换为十进制数值，即&quot;1&quot;会变成 1，&quot;123&quot;会变成 123，而&quot;011&quot;会变成 11（注意：前导的零被忽略了）；</li> <li>如果字符串中包含有效的浮点格式，如&quot;1.1&quot;，则将其转换为对应的浮点数值（同样，也会忽略前导零）；</li> <li>如果字符串中包含有效的十六进制格式，例如&quot;0xf&quot;，则将其转换为相同大小的十进制整数值；</li> <li>如果字符串是空的（不包含任何字符），则将其转换为 0；</li> <li>如果字符串中包含除上述格式之外的字符，则将其转换为 <code>NaN</code>。</li> <li>如果是对象，则调用对象的<code>valueOf()</code>方法，然后依照前面的规则转换返回的值。如果转换的结果是 <code>NaN</code>，则调用对象的<code>toString()</code>方法，然后再次依照前面的规则转换返回的字符串值。</li></ul> <h3 id="parseint-转换规则"><a href="#parseint-转换规则" class="header-anchor">#</a> <code>parseInt()</code>转换规则</h3> <p><code>parseInt()</code>函数在转换字符串时，更多的是看其是否符合数值模式。</p> <p>它会忽略字符串前面的空格，直至找到第一个非空格字符。如果第一个字符不是数字字符或者负号，<code>parseInt()</code>就会返回<code>NaN</code>；</p> <p>也就是说，用<code>parseInt()</code>转换空字符串会返回<code>NaN</code>。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//NaN</span>
<span class="token function">Number</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>如果第一个字符是数字字符，<code>parseInt()</code>会继续解析第二个字符，直到解析完所有后续字符或者遇到了一个非数字字符。</p> <p>例如，&quot;1234blue&quot;会被转换为 1234，因为&quot;blue&quot;会被完全忽略。类似地，&quot;22.5&quot;会被转换为 22，因为小数点并不是有效的数字字符。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> num1 <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">&quot;1234blue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1234</span>
<span class="token keyword">let</span> num2 <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// NaN</span>
<span class="token keyword">let</span> num3 <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">&quot;0xA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 10（十六进制数）</span>
<span class="token keyword">let</span> num4 <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token number">22.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 22</span>
<span class="token keyword">let</span> num5 <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">&quot;070&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 56（八进制数）</span>
<span class="token keyword">let</span> num6 <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">&quot;70&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 70（十进制数）</span>
<span class="token keyword">let</span> num7 <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">&quot;0xf&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 15（十六进制数）</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>为了消除在使用<code>parseInt()</code>函数时可能导致的上述困惑，可以为这个函数提供第二个参数：转换时使用的基数（即多少进制）。</p> <p>如果知道要解析的值是十六进制格式的字符串，那么指定基数 <code>16</code> 作为第二个参数，可以保证得到正确的结果，例如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> num <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">&quot;0xAF&quot;</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//175</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="parsefloat-转换规则"><a href="#parsefloat-转换规则" class="header-anchor">#</a> <code>parseFloat()</code>转换规则</h3> <p>与 <code>parseInt()</code>函数类似，<code>parseFloat()</code>也是从第一个字符开始解析每个字符。而且也是一直解析到字符串末尾，或者解析到遇见一个无效的浮点数字字符为止。</p> <p>也就是说，字符串中的第一个小数点是有效的，而第二个小数点就是无效的了，因此它后面的字符串将被忽略。</p> <p>举例来说，&quot;22.34.5&quot;将会被转换为 22.34。</p> <p>由于<code>parseFloat()</code>只解析十进制值，因此它没有用第二个参数指定基数的用法。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> num1 <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span><span class="token string">&quot;1234blue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//1234 （整数）</span>
<span class="token keyword">let</span> num2 <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span><span class="token string">&quot;0xA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//0</span>
<span class="token keyword">let</span> num3 <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span><span class="token string">&quot;22.5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//22.5</span>
<span class="token keyword">let</span> num4 <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span><span class="token string">&quot;22.34.5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//22.34</span>
<span class="token keyword">let</span> num5 <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span><span class="token string">&quot;0908.5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//908.5</span>
<span class="token keyword">let</span> num6 <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span><span class="token string">&quot;3.125e7&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//31250000</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="运算符转换规则的区别"><a href="#运算符转换规则的区别" class="header-anchor">#</a> + - 运算符转换规则的区别</h3> <p><strong>+操作符在 js 中比较特殊，执行+操作符时：</strong></p> <ol><li>当一侧为<code>String</code>类型，被识别为字符串拼接，并会优先将另一侧转换为字符串类型。</li> <li>当一侧为<code>Number</code>类型，另一侧为原始类型，则将原始类型转换为 <code>Number</code> 类型。</li> <li>当一侧为<code>Number</code>类型，另一侧为引用类型，将引用类型和 <code>Number</code> 类型转换成字符串后拼接。</li></ol> <p><strong>-操作符在 js 中比较特殊，执行-操作符时：</strong></p> <ol><li>如果执行减法运算的两个操作数中有字符串类型，且其中的字符串可以转化为数字，则会将其转化为数字之后再进行运算。</li> <li>如果其中有字符串且不能转化为数字，则计算结果为 <code>NaN</code>。</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// +</span>
<span class="token string">&quot;10&quot;</span> <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// 5</span>
<span class="token string">&quot;10&quot;</span> <span class="token operator">-</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 7</span>
<span class="token string">&quot;s&quot;</span> <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// NaN</span>
<span class="token string">&quot;10&quot;</span> <span class="token operator">-</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">;</span> <span class="token comment">// NaN</span>
<span class="token comment">// -</span>
<span class="token number">1</span> <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token number">1</span> <span class="token operator">&gt;</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
<span class="token number">1</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="、-比较运算符的规则"><a href="#、-比较运算符的规则" class="header-anchor">#</a> &gt;、&lt; 比较运算符的规则</h3> <p>比较运算符常用于数值类型的变量进行比较的时候使用，例如:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token number">1</span> <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token number">1</span> <span class="token operator">&gt;</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
<span class="token number">1</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>除了用于数值型变量比较外，还可以用于字符串类型进行比较，比较的时候遵循如下的规则:</p> <blockquote><p>逐字比较字符码的大小，如果字符码相同就比较下一个字符，直到比较出结果或者比较完所有的字符。如果是非数字的字符串和数字进行比较，返回值永远是 false。</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token string">&quot;a&quot;</span> <span class="token operator">&gt;</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
<span class="token string">&quot;a&quot;</span> <span class="token operator">&lt;</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token string">&quot;s&quot;</span> <span class="token operator">==</span> <span class="token string">&quot;s&quot;</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token string">&quot;abc&quot;</span> <span class="token operator">&lt;</span> <span class="token string">&quot;abd&quot;</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token string">&quot;13&quot;</span> <span class="token operator">&gt;</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
<span class="token string">&quot;13&quot;</span> <span class="token operator">&gt;</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token string">&quot;a&quot;</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>数字的字符型比较也遵循上述的原则，如果其中一个是数值(Number)类型则会隐式转化后比较。</p> <h3 id="运算法比较规则"><a href="#运算法比较规则" class="header-anchor">#</a> == === 运算法比较规则</h3> <p>在进行相等比较运算的时候，不同的数据类型比较遵循以下几条原则:</p> <ol><li>布尔值比较运算前会被转换成数值，<code>true</code> 转化为 1，<code>false</code> 转化为 0；</li> <li>描述数字的字符串与数字进行比较前会被转化成数字。</li> <li>对象和字符串进行比较前，会将对象转换成字符串&quot;[object object]&quot;。</li> <li><code>null</code> 值和 <code>undefined</code> 值进行相等比较，结果返回为 <code>true</code>。</li> <li><code>NaN</code> 与 <code>NaN</code> 比较返回都是 <code>false</code>。</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token boolean">true</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token number">2</span> <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
<span class="token boolean">false</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token string">&quot;11&quot;</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
obj <span class="token operator">==</span> <span class="token string">&quot;[object object]&quot;</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token number">1</span> <span class="token operator">!=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token keyword">null</span> <span class="token operator">==</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token operator">!</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
<span class="token number">NaN</span> <span class="token operator">==</span> <span class="token number">NaN</span><span class="token punctuation">;</span> <span class="token comment">//false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>=== 与 == 的区别不仅仅会比较值，还会比较数据类型,全部一直才返回<code>true</code>。</p> <h3 id="、-、-逻辑运算符"><a href="#、-、-逻辑运算符" class="header-anchor">#</a> &amp;&amp; 、 || 、!逻辑运算符</h3> <ul><li>&amp;&amp;</li></ul> <blockquote><p>逻辑与运算符进行运算时只有两个操作数都为 true 的时候返回结果才是 true，否则返回 false。不过运算后的最终结果不一定是布尔值，转化规则如下:</p></blockquote> <ol><li>在两个对象间进行运算时，结果将返回第二个对象。</li> <li>在进行运算的两个数中，如果一个操作数为 <code>null</code>，则结果为 <code>null</code>。</li> <li>在进行运算的两个数中，如果一个操作数为 <code>NaN</code>，则结果为 <code>NaN</code>。</li> <li>在进行运算的两个数中，如果一个操作数为 <code>undefined</code>，则结果为 <code>undefined</code>。</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;jack&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token operator">&amp;&amp;</span> obj<span class="token punctuation">;</span> <span class="token comment">// { name: &quot;jack&quot; };</span>
<span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// null</span>
<span class="token number">NaN</span> <span class="token operator">&amp;&amp;</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// NaN</span>
<span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>
<span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>||</li></ul> <blockquote><p>逻辑或运算符只要满足运算中的数值某一个为 true 即可返回 true，否则返回 false。</p></blockquote> <ol><li>如果有一个操作数为对象:</li></ol> <ul><li>当对象为第 1 个操作数时，结果为对象本身。</li> <li>当对象为第 2 个操作数时，如果第 1 个操作数为 false，则结果为对象本身，如果第 1 个操作数为 ture，则结果为 true。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
obj <span class="token operator">||</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// {}</span>
<span class="token boolean">true</span> <span class="token operator">||</span> obj<span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token operator">||</span> obj<span class="token punctuation">;</span> <span class="token comment">// {}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>!</li></ul> <blockquote><p>逻辑非运算符会将输入的值进行 Boolean 的转化。</p></blockquote> <ol><li>如果操作数是对象，则返回 <code>false</code>。</li> <li>如果操作数为 0，则返回 <code>true</code>。</li> <li>如果操作数为非 0 数字，则返回 <code>false</code>。</li> <li>如果操作数是 <code>null</code>，则返回 <code>true</code>。</li> <li>如果操作数是 <code>NaN</code>，则返回 <code>true</code>。</li> <li>如果操作数是 <code>undefined</code>，则返回 <code>true</code>。</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">!</span>obj<span class="token punctuation">;</span> <span class="token comment">// false</span>
<span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token operator">!</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
<span class="token operator">!</span><span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token operator">!</span><span class="token number">NaN</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token operator">!</span><span class="token keyword">undefined</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="补充部分"><a href="#补充部分" class="header-anchor">#</a> 补充部分</h3> <ol><li><strong>NaN</strong></li></ol> <p><code>NaN</code>和其他任何类型比较永远返回<code>false</code>(包括和他自己)。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token number">NaN</span> <span class="token operator">==</span> <span class="token number">NaN</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="2"><li>Boolean</li></ol> <p><code>Boolean</code>和其他任何类型比较，<code>Boolean</code>首先被转换为<code>Number</code>类型。</p> <p>true == 1; // true
true == &quot;2&quot;; // false
true == [&quot;1&quot;]; // true
true == [&quot;2&quot;]; // false</p> <div class="custom-block tip"><p class="title">TIP</p><p>这也是为什么 <code>undefined</code>、<code>null</code> 和布尔值比较返回 <code>false</code> 的原因。</p> <p><code>false</code> 首先被转换成 0。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">undefined</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
<span class="token keyword">null</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div><ol start="3"><li><code>String</code> 和 <code>Number</code></li></ol> <p><code>String</code> 和 <code>Number</code> 比较，先将 <code>String</code> 转换为 <code>Number</code> 类型。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token number">123</span> <span class="token operator">==</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token string">&quot;&quot;</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="4"><li><code>null</code> 和 <code>undefined</code> <code>null</code> == <code>undefined</code> 比较结果是 <code>true</code>，除此之外，<code>null</code>、<code>undefined</code> 和其他任何结果的比较值都为 <code>false</code>。</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">null</span> <span class="token operator">==</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token keyword">null</span> <span class="token operator">==</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
<span class="token keyword">null</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
<span class="token keyword">null</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
<span class="token keyword">undefined</span> <span class="token operator">==</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
<span class="token keyword">undefined</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
<span class="token keyword">undefined</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="5"><li>原始类型和引用类型
当原始类型和引用类型做比较时，对象类型会依照 <code>ToPrimitive</code> 规则转换为原始类型:</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token string">&quot;[object Object]&quot;</span> <span class="token operator">==</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token string">&quot;1,2,3&quot;</span> <span class="token operator">==</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="custom-block tip"><p class="title">TIP</p><p>这里有一个常见的面试题:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// true</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>!的优先级高于==，![]首先会被转换为 false，然后根据上面第三点，false 转换成 Number 类型 0，左侧[]转换为 0，两侧比较相等。</p></div><p>同理:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token keyword">null</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">[</span><span class="token keyword">undefined</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token comment">// true</span>
  <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="custom-block tip"><p class="title">TIP</p><div class="language- extra-class"><pre><code>   一道有意思的面试题：
   
   如何让：a == 1 &amp;&amp; a == 2 &amp;&amp; a == 3?
</code></pre></div><div class="language-js line-numbers-mode"><pre class="language-js"><code> <span class="token comment">// 解法1</span>
    <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token function-variable function">valueOf</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// 解法2</span>
    <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">i</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token function-variable function">toString</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> a<span class="token punctuation">.</span>i<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// 解法3</span>
    <span class="token keyword">let</span> val <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    
    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">++</span>val<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div></div><h2 id="数值类型转换"><a href="#数值类型转换" class="header-anchor">#</a> 数值类型转换</h2> <h3 id="装箱和拆箱"><a href="#装箱和拆箱" class="header-anchor">#</a> 装箱和拆箱</h3> <ul><li>装箱转换：把基本类型转换为对应的包装类型。</li> <li>拆箱操作：把引用类型转换为基本类型。</li></ul> <p><strong>原始类型不能扩展属性和方法，那么我们是如何使用原始类型调用方法的呢？</strong></p> <p>每当我们操作一个基础类型时，后台就会自动创建一个包装类型的对象，从而让我们能够调用一些方法和属性，例如下面的代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">&quot;Linda&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> name2 <span class="token operator">=</span> name<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>上述代码的执行过程:</p> <ol><li>创建一个String的包装类型实例.</li> <li>在实例上调用substring方法.</li> <li>销毁实例.</li></ol> <p>也就是说，我们使用基本类型调用方法，就会自动进行 <code>装箱</code> 和 <code>拆箱</code> 操作，相同的，我们使用 <code>Number</code> 和 <code>Boolean</code> 类型时，也会发生这个过程。</p> <div class="custom-block tip"><p class="title">TIP</p><p>从引用类型到基本类型转换(拆箱)的过程中，会遵循 <code>ECMAScript</code> 规范规定的 <code>toPrimitive</code> 原则，一般会调用引用类型的 <code>valueOf</code> 和 <code>toString</code> 方法，我们也可以直接重写 <code>toPeimitive</code> 方法。</p></div><p>一般转换成不同类型的值遵循的原则不同，例如：</p> <ul><li>引用类型转换为 <code>Number</code> 类型，先调用 <code>valueOf</code>，再调用 <code>toString</code>。</li> <li>引用类型转换为 <code>String</code> 类型，先调用 <code>toString</code>，再调用 <code>valueOf</code>。</li></ul> <div class="custom-block warning"><p class="title">WARNING</p><p>若 <code>valueOf</code> 和 <code>toString</code> 都不存在，或者没有返回基本类型，则抛出 <code>TypeError</code> 异常。</p></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">valueOf</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'valueOf'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token number">123</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">toString</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'toString'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token string">'Linda'</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// valueOf 122</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>obj<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// toString  Hello Linda</span>

<span class="token keyword">const</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>toPrimitive<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'toPrimitive'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token number">123</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj2 <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// valueOf   122</span>

<span class="token keyword">const</span> obj3 <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">valueOf</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'valueOf'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">toString</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'toString'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj3 <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token comment">// valueOf  </span>
<span class="token comment">// toString</span>
<span class="token comment">// TypeError</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>除了程序中的自动拆箱和自动装箱，我们还可以手动进行拆箱和装箱操作。我们可以直接调用包装类型的 <code>valueOf</code> 或 <code>toString</code>，实现拆箱操作。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> num <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token keyword">typeof</span> num<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// number</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token keyword">typeof</span> num<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// string</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="连续赋值的问题"><a href="#连续赋值的问题" class="header-anchor">#</a> 连续赋值的问题</h2> <p>关于 <code>javascript</code> 连续赋值问题,我们先来看一段代码:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">n</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> a<span class="token punctuation">;</span>
a<span class="token punctuation">.</span>x <span class="token operator">=</span> a <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">n</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">;</span>       
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>x<span class="token punctuation">)</span>  <span class="token comment">// undefined</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>x<span class="token punctuation">)</span>  <span class="token comment">// {n:2}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">===</span> b<span class="token punctuation">.</span>x<span class="token punctuation">)</span>  <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>首先<code>let a = {n : 1};</code>定义了一个引用类型变量<code>a</code>,在栈中存储了一个变量<code>a</code>的内存地址,在堆(内存)中开辟了一个空间存放对应的值<code>{n:1}</code>。</p> <p>其次<code>let b = a;</code>在栈中写入了<code>b</code>,并将<code>a</code>指向堆中的地址索引赋值给了<code>b</code>。但是并没有开辟新的存储空间。</p> <p>接下来执行<code>a.x = a = {n:2};</code>这段代码的执行顺序遵循如下原则:</p> <p><code>“.”的优先级高于“=”</code>  , 所以先计算a.x<code>，也就是在</code>a<code>中添加属性</code>x<code>(此时这个</code>x<code>是</code>undefined<code>).</code>a--&gt;{n:1,x:undefined}`)</p> <p>这也是为什么直接引用一个未定义的变量会报错，但是直接引用一个对象的不存在的成员时，会返回 <code>undefined</code>。</p> <p>然后依循<code>从右往左</code>的复制运算顺序执行 <code>a = {n:2}</code>这时候，<code>a</code>指向的对象发生了改变，变成了新对象<code>{n:2}</code>。(可能你在这会有疑惑（重点），之前<code>a</code>不是指向了<code>{n:1,x:undefined}</code>吗，赋值不会影响他吗？原因是因为在执行（<code>a.x=</code>）的时候已经被挂起来等待赋值了，即使<code>a</code>发生了指向的变化，但也不再影响此刻的（<code>a.x</code>）了，因为已经对（<code>a.x</code>）进行了指向的确定，只不过他现在正在等待被赋值。<code>a</code>被重新赋值，此时<code>a</code>的指向也就变化了）
此时变成了 <code>a--&gt;{n:2}，b--&gt;{n:1,x:undefined}</code></p> <p>继续执行<code>a</code>.<code>x=a</code>相当于<code>a.x = {n: 2}</code>，由于在第三步时<code>a.x</code>已经被创建，并且等待赋值，所以<code>x = {n: 2}</code> 。
（<code>a.x</code>由于一直等待赋值一直被挂起，也就是一直保持着<code>{n:1,x:undefined}</code>对象<code>x</code>属性的访问，对象<code>{n:1,x:undefined}</code>由于一直有一个<code>b</code>的指向，所以不会被<code>JS</code>的垃圾回收机制给回收，赋值后对象变为了<code>{n:1,x:{n:2}}</code> ）</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">n</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>  
a<span class="token punctuation">.</span>x <span class="token operator">=</span> a <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">n</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">;</span>       
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>x<span class="token punctuation">)</span>  <span class="token comment">// undefined</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="custom-block tip"><p class="title">TIP</p><p>总结:</p> <p>基础类型的存储是存在栈中的,引用类型的存储是在栈中存储堆的索引,在堆中开辟空间存储变量的值。</p> <p>当访问一个对象的属性的时候,如果属性不存在会被赋值为 <code>undefined</code>。</p> <p>当进行连续赋值的时候,.属性访问优先级会大于=赋值,且当成员等待赋值的时候,锁定的赋值目标是成员，而非对象。</p> <p>对象重新赋值时，并非是修改原堆内存的值，而是重新分配堆内存，栈内存中的指针会做相应修改。</p> <p>如果原堆内存有多个栈内存指向它，由于引用还存在，原堆内存的数据不会消失。如果堆内存再无其它引用，则会被<code>JS</code>的垃圾回收机制回收。对象的成员对象也一样。</p></div><h2 id="tostring-方法介绍"><a href="#tostring-方法介绍" class="header-anchor">#</a> toString 方法介绍</h2> <p><strong>要把一个值转换为一个字符串有两种方式。</strong></p> <ol><li>第一种是使用几乎每个值都有的 <code>toString()</code>方法</li> <li>还可以使用转型函数 <code>String()</code>，这个函数能够将任何类型的值转换为字符串。</li></ol> <p><code>数值</code>、<code>布尔值</code>、<code>对象</code> 和 <code>字符串值</code> 都有<code>toString()</code>方法。但<code>null</code>和 <code>undefined</code> 值没有这个方法。</p> <p>多数情况下，调用<code>toString()</code>方法不必传递参数。但是，在调用数值的<code>toString()</code>方法时，可以传递一个参数：输出数值的基数。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> num <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>num<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;10&quot;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>num<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;1010&quot;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>num<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;12&quot;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>num<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;10&quot;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>num<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;a&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong><code>String()</code>函数遵循下列转换规则：</strong>
如果值有<code>toString()</code>方法，则调用该方法（没有参数）并返回相应的结果；
如果值是<code>null</code>，则返回<code>null</code>；
如果值是<code>undefined</code>，则返回<code>undefined</code>。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> value1 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> value2 <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> value3 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> value4<span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>value1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;10&quot;</span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>value2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;true&quot;</span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>value3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;null&quot;</span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>value4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;undefined&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="custom-block tip"><p class="title">TIP</p><p><code>toString()</code>方法与<code>String()</code>方法的一个区别就是转换<code>null</code>与<code>undefiend</code>类型时的区别。</p> <p><code>String()</code>方法可以执行,<code>toString()</code>方法则会报错。</p></div><p><strong>引申: 字符串是否有最大长度?</strong></p> <p><code>String</code> 用于表示文本数据。<code>String</code> 有个最大长度是 <code>2^53 - 1</code>,有趣的是这个所谓的最大长度,并不是我们理解中的字符数。</p> <p>因为 <code>String</code> 的意义并非字符串,二是字符串的 <code>UTF16</code> 编码,我们字符串的操作 <code>charAt</code>、<code>charCodeAt</code>、<code>length</code> 等方法针对的都是 <code>UTF16</code> 编码。所以,字符串的最大长度,实际上是受字符串的编码长度影响的。</p> <p>然而,现在字符集国际标准,字符是以 <code>Unicode</code> 的方式表示的,每一个 Unicode 的码表示一个字符,理论上 <code>Unicode</code> 的范围是无限的。</p> <p>试题: <code>12.toString()</code>输出结果是什么?为什么?</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// Uncaught SyntaxError: Invalid or unexpected token</span>
<span class="token number">12.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 12</span>
<span class="token number">12</span> <span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 12</span>
<span class="token number">12.</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Uncaught SyntaxError: Invalid or unexpected token</span>
<span class="token number">12.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><code>12.</code> 会被当作省略了小数点后面部分的数字，而单独看成一个整体,所以我们要想让点单独成为一个 <code>token</code>，就要加入空格。</p> <p><strong>使用小技巧</strong></p> <div class="custom-block tip"><p class="title">TIP</p><p>在 <code>Javascript</code> 中,可以使用反斜杠进行字符串的折行编写，有些时候这样做可以使你的代码看起来更加漂亮，示例如下:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 使用反斜杠进行字符串的折行</span>
<span class="token keyword">var</span> text <span class="token operator">=</span>
  <span class="token string">&quot;啊哈哈哈哈\
  你猜我是谁?\
  猜对了我就给你一颗糖\
&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></div><h2 id="object-类型"><a href="#object-类型" class="header-anchor">#</a> <code>Object</code> 类型</h2> <p>对象可以通过执行<code>new</code>操作符后跟要创建的对象类型的名称来创建。</p> <p>而创建<code>Object</code>类型的实例并为其添加属性和（或）方法，就可以创建自定义对象，如下所示：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>Object</code> 的每个实例都具有下列属性和方法:</p> <ul><li><p><code>constructor</code>：保存着用于创建当前对象的函数。对于前面的例子而言，就是<code>Object()</code>。</p></li> <li><p><code>hasOwnProperty(propertyName)</code>：用于检查给定的属性在当前对象实例中（而不是在实例的原型中)是否存在。 其中，作为参数的属性<code>propertyName</code>必须以字符串形式指定（例如：<code>o.hasOwnProperty(&quot;name&quot;)</code>)。</p></li> <li><p><code>isPrototypeOf(object)</code>：用于检查传入的对象是否是传入对象的原型。</p></li> <li><p><code>propertyIsEnumerable(propertyName)</code>：用于检查给定的属性是否能够使用<code>for-in</code>语句来枚举。与 <code>hasOwnProperty()</code>方法一样，作为参数的属性名必须以字符串形式指定。</p></li> <li><p><code>toLocaleString()</code>：返回对象的字符串表示，该字符串与执行环境的地区对应。</p></li> <li><p><code>toString()</code>：返回对象的字符串表示。</p></li> <li><p><code>valueOf()</code>：返回对象的字符串、数值或布尔值表示。通常与<code>toString()</code>方法的返回值相同。</p></li></ul> <p>由于在<code>ECMAScript</code>中<code>Object</code>是所有对象的基础，因此所有对象都具有这些基本的属性和方法。</p> <h3 id="创建object类型的方式"><a href="#创建object类型的方式" class="header-anchor">#</a> 创建<code>object</code>类型的方式</h3> <ol><li>new + Object构造函数。</li> <li>对象字面量方法。</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// new + constructor</span>
<span class="token keyword">let</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// //与 var person = {} 相同</span>
person<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;Nicholas&quot;</span><span class="token punctuation">;</span> 
person<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">29</span><span class="token punctuation">;</span>

<span class="token comment">// 对象字面量</span>
<span class="token keyword">let</span> person <span class="token operator">=</span> <span class="token punctuation">{</span> 
 <span class="token literal-property property">name</span> <span class="token operator">:</span> <span class="token string">&quot;Nicholas&quot;</span><span class="token punctuation">,</span> 
 <span class="token literal-property property">age</span> <span class="token operator">:</span> <span class="token number">29</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>Object.create(null)</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 当我们使用Object.create(null)创建的对象不是Object的子类</span>

<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> b <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

a <span class="token operator">==</span> b <span class="token comment">// false</span>

<span class="token keyword">typeof</span> a<span class="token punctuation">;</span><span class="token comment">// object</span>
<span class="token keyword">typeof</span> b<span class="token punctuation">;</span><span class="token comment">// object</span>

a <span class="token keyword">instanceof</span> <span class="token class-name">Object</span><span class="token punctuation">;</span><span class="token comment">// true</span>
b <span class="token keyword">instanceof</span> <span class="token class-name">Object</span><span class="token punctuation">;</span><span class="token comment">// false</span>

a<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// [object Object]</span>
b<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// VM274:1 Uncaught TypeError: b.toString is not a function</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="javascript-对象的特征"><a href="#javascript-对象的特征" class="header-anchor">#</a> <code>javascript</code> 对象的特征</h3> <p><code>JavaScript</code> 对象的本质有如下几个特点:</p> <p>对象具有唯一标识性: 即使完全相同的两个对象,也并非同一个对象。</p> <p>对象有状态: 对象具有状态,同一对象可能处于不同的状态之下。</p> <p>对象具有行为: 即对象的状态,可能因为它的行为产生变迁。</p> <h3 id="对象具有唯一标识性"><a href="#对象具有唯一标识性" class="header-anchor">#</a> 对象具有唯一标识性</h3> <p>一般而言,各种语言的对象唯一标识性都是用内存地址来实现的，对象具有唯一的内存地址，所以具有唯一的标识。</p> <p>在<code>javascript</code>中对象其实是互不相等的,如下这个示例, O1 和 O2乍看起来是两个一模一样的对象,但是结果是不相等的。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> o1 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> o2 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

o1 <span class="token operator">==</span> o2 <span class="token comment">// false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="对象有状态和行为"><a href="#对象有状态和行为" class="header-anchor">#</a> 对象有状态和行为</h3> <p>在<code>javascript</code>中，将状态和行为统一抽象为属性。将函数设计成一种特殊对象，所以<code>Javascript</code>中的行为和状态都能用属性来抽象。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> obg <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="array类型"><a href="#array类型" class="header-anchor">#</a> <code>Array</code>类型</h2> <p>除了 <code>Object</code> 之外，<code>Array</code> 类型恐怕是 <code>ECMAScript</code> 中最常用的类型了。</p> <p><strong>创建Array类型的方式</strong></p> <ol><li><code>new</code> + <code>Array</code> 构造函数。</li> <li>用数组字面量表示法。</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> colors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;red&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;blue&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;green&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>数组的项数保存在其 <code>length</code> 属性中，这个属性始终会返回 0 或更大的值.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;red&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;blue&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;green&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个包含 3 个字符串的数组</span>
<span class="token keyword">let</span> names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个空数组</span>
<span class="token function">alert</span><span class="token punctuation">(</span>colors<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//3 </span>
<span class="token function">alert</span><span class="token punctuation">(</span>names<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>数组的 <code>length</code> 属性很有特点——它不是只读的。因此，通过设置这个属性，可以从数组的末尾移 除项或向数组中添加新项。请看下面的例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;red&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;blue&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;green&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个包含 3 个字符串的数组</span>
colors<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> 
<span class="token function">alert</span><span class="token punctuation">(</span>colors<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这个例子中的数组 <code>colors</code> 一开始有 3 个值。将其 <code>length</code> 属性设置为 2 会移除最后一项），结果再访问 <code>colors[2]</code>就会显示 <code>undefined</code> 了。</p> <p>如果将其 <code>length</code> 属性设置为大于数组项数的值，则新增的每一项都会取得 <code>undefined</code> 值，如下所示：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;red&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;blue&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;green&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个包含 3 个字符串的数组</span>
colors<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span> 
<span class="token function">alert</span><span class="token punctuation">(</span>colors<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// undefined</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="数组常用方法"><a href="#数组常用方法" class="header-anchor">#</a> 数组常用方法</h3> <ol><li><code>push()</code>向数组的末尾添加一个或多个元素，返回新的数组长度。原数组改变。</li> <li><code>pop()</code> 删除并返回数组的最后一个元素，若该数组为空，则返回 <code>undefined</code>。原数组改变。</li> <li><code>unshift()</code>向数组的开头添加一个或多个元素，返回新的数组长度。原数组改变。</li> <li><code>shift()</code>删除数组的第一项，并返回第一个元素的值。若该数组为空，则返回 <code>undefined</code>。原数组改变。</li> <li><code>concat(arr1,arr2...)</code>，合并两个或多个数组，生成一个新的数组。原数组不变。</li> <li><code>join(type)</code> 将数组的每一项用指定字符连接返回一个字符串。默认连接字符为逗号。原数组不变。</li> <li><code>reverse()</code>将数组倒序，返回倒序后的数组，原数组改变。</li> <li><code>sort()</code>，对数组元素进行排序,返回排序后的数组。按照字符串UniCode码排序，原数组改变。从小到大 a-b，从到到小 b-a。</li> <li><code>map(currentItem,index,array)</code>，原数组的每一项执行函数后，返回一个新的数组。原数组不变。</li> <li><code>slice(start,end)</code>从<code>start</code>开始，<code>end</code>之前结束，不到<code>end</code>；如果不给<code>end</code>值，从<code>start</code>开始到数组结束。<code>start</code>可以给负值，-1表示数组最后位置，-2表示倒数第二个，以此类推，顾前不顾后。原数组不变。</li> <li><code>splice(index,howmany,arr1,arr2...)</code> 删除元素并添加元素，从  <code>index</code> 位置开始删除  <code>howmany</code> 个元素，并将<code>arr1、arr2...</code>数据从<code>index</code>位置依次插入。<code>howmany</code> 为0时，则不删除元素。原数组改变。</li> <li><code>forEach(item,callback)</code>，用于调用数组的每个元素，并将元素传递给回调函数。原数组不变。</li> <li><code>filter(function)</code>，过滤数组中，符合条件的元素并返回一个新的数组。原数组不变。</li> <li><code>every(function)</code>，对数组中的每一项进行判断，若都符合则返回true，否则返回false。原数组不变。</li> <li><code>some(function)</code>，对数组中的每一项进行判断，若都不符合则返回false，否则返回true。原数组不变。</li> <li><code>reduce(prev,cur,index,array)</code>，<code>reduce()</code> 方法接收一个函数作为累加器，数组中的每个值（从左到右）开始缩减，最终计算为一个值。原数组不变。</li></ol> <h2 id="或与非"><a href="#或与非" class="header-anchor">#</a> 或与非 || &amp;&amp; ！</h2> <p>逻辑非操作符也可以用于将一个值转换为与其对应的布尔值。而同时使用两个逻辑非操作符，实际上就会模拟<code>Boolean()</code>转型函数的行为。</p> <p>其中，第一个逻辑非操作会基于无论什么操作数返回一个布尔值，而第二个逻辑非操作则对该布尔值求反，于是就得到了这个值真正对应的布尔值。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">alert</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token string">&quot;blue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true </span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false </span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token number">NaN</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false </span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false </span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token number">12345</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true </span>
<span class="token keyword">null</span> <span class="token operator">==</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token keyword">null</span> <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="try-catch-简单介绍"><a href="#try-catch-简单介绍" class="header-anchor">#</a> <code>try.catch</code> 简单介绍</h2> <p><code>dome</code>如下</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">finally</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'finally'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// finally return 0;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">finally</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">'finally'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// finally </span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>上述代码的执行结果是: <code>finally</code> 中的 <code>return</code> 覆盖了 <code>try</code> 中的 <code>return</code>。在一个函数中执行了两次 <code>return</code>,这已经超出了很多人的常识,也是其他语言中不会出现的一种行为。</p> <p>产生上述执行结果的实质原因是背后运行的<code>Completion Record</code>机制。</p> <p><strong>Completion Record机制</strong></p> <p>表示一个语句执行完成之后的结果,它有3个字段:</p> <ol><li><p><code>type</code>: 表示完成的类型,有 <code>break</code>、<code>continue</code>、<code>return</code>、<code>throw</code> 和 <code>normal</code> 几种类型。</p></li> <li><p><code>value</code>: 表示语句的返回值,如果语句没有返回值,则是 <code>empty</code>。</p></li> <li><p><code>target</code>: 表示语句的目标,通常是一个 <code>javascript</code> 标签。</p></li></ol> <p><code>Javascript</code> 正是依靠语句的<code>CompletionRecord</code>类型才可以在语句的复杂嵌套结构中 ,实现各种控制。</p> <p><img src="/images/base-js15.png" alt="base-js15"></p> <p><strong>普通语句</strong></p> <p>这些语句在执行时,从前到后顺次执行,没有任何分支或者重复执行逻辑。</p> <p>普通语句执行完成后,会得到<code>type</code>为<code>normal</code>的<code>Completion Record</code>, <code>javascript</code> 引擎遇到这样的记录就会执行下一条语句。</p> <p>这些语句中只有表达式语句会产生 <code>value</code> ,从引擎的角度,这个 <code>value</code> 并没有什么用处,这就像我们在 <code>Chrome</code> 的控制台调式工具中输入一个表达式是可以得到结果的,但是在表达式前面加上 <code>var</code>,就变成了 <code>undefined</code>。这也说明了 <code>Chrome</code> 控制台输出的是语句的 <code>Completion Record</code> 的<code>value</code>值。</p> <p><strong>语句块</strong></p> <p>语句块就是拿大括号括起来的一组语句,它是一种语句的复合结构,可以嵌套。</p> <p>在使用语句块的时候,我们需要注意的是语句块内部的<code>Completion Recordtype</code>如果不是<code>normal</code>的话,就会打断语句块后续的执行。</p> <p><strong>控制型语句</strong>
控制型语句带有 <code>if</code>、<code>switch</code> 关键字,它们会对不同类型的<code>Completion Record</code>产生反应。</p> <p><img src="/images/base-js16.png" alt="base-js16.png">
通过这个表我们发现,因为 <code>finally</code> 中的内容必须保证执行,所以<code>try/catch</code>执行完毕,即使得到的结果是非<code>normal</code>类型的完成记录,也必须要执行 <code>finally</code>。</p> <p>而当 <code>finally</code> 执行也得到了了非 <code>normal</code> 的记录,则会是 <code>finally</code> 中的记录作为整个 <code>try</code> 结构的结果。</p> <p><strong>带标签的语句</strong></p> <p>前文阐述了一些 <code>type</code> 在语句中的作用,接下来涉及到 <code>target</code>。</p> <p>实际上,任何 <code>javascript</code> 语句是可以加标签的,在语句前面加冒号即可:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token literal-property property">firstStatement</span><span class="token operator">:</span> <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>大部分的时候,这个东西类似于注释,没有任何作用。唯一有作用的时候是: 与完成记录类型中的<code>target</code>相配合,用于跳出多层循环。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token literal-property property">outer</span><span class="token operator">:</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token literal-property property">inner</span><span class="token operator">:</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">break</span> outer<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'finished'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><code>break/continue</code> 语句如果后跟了关键字,会产生带<code>target</code>的完成记录。一旦完成记录带了<code>target</code>,那么只有拥有对应<code>label</code>的循环语句会消费它。</p> <div class="custom-block tip"><p class="title">TIP</p><p>总结:</p> <p>因为 <code>Javascript</code> 语句存在嵌套关系,所以只需过程实际上主要在一个树形结构上进行,树形结构的每一个节点执行后产生<code>Completion Record</code>,根据语句的结构和<code>Completion Record</code>,<code>Javascript</code> 实现了各种分支合跳出逻辑。</p></div><h2 id="with-语句"><a href="#with-语句" class="header-anchor">#</a> <code>with</code> 语句</h2> <p><code>with</code> 语句的作用是将代码的作用域设置到一个特定的对象中。</p> <blockquote><p>with (expression) statement;</p></blockquote> <p>定义 with 语句的目的主要是为了简化多次编写同一个对象的工作，如下面的例子所示:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> qs <span class="token operator">=</span> location<span class="token punctuation">.</span>search<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> hostName <span class="token operator">=</span> location<span class="token punctuation">.</span>hostname<span class="token punctuation">;</span>
<span class="token keyword">let</span> url <span class="token operator">=</span> location<span class="token punctuation">.</span>href<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>上面几行代码都包含<code>location</code>对象。如果使用<code>with</code>语句，可以把上面的代码改写成如下所示:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">with</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> qs <span class="token operator">=</span> search<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hostName <span class="token operator">=</span> hostname<span class="token punctuation">;</span>
    <span class="token keyword">let</span> url <span class="token operator">=</span> href<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>在这个重写后的例子中，使用 <code>with</code> 语句关联了 <code>location</code> 对象。</p> <p>这意味着在 <code>with</code> 语句的代码块内部，每个变量首先被认为是一个局部变量，而如果在局部环境中找不到该变量的定义，就会查询 <code>location</code> 对象中是否有同名的属性。如果发现了同名属性，则以 <code>location</code> 对象属性的值作为变量的值。</p> <div class="custom-block warning"><p class="title">WARNING</p><p>严格模式下不允许使用with语句，否则将视为语法错误。</p></div><h2 id="执行环境和作用域"><a href="#执行环境和作用域" class="header-anchor">#</a> 执行环境和作用域</h2> <blockquote><p>执行环境（<code>execution context</code>，为简单起见，有时也称为“环境”）是 <code>JavaScript</code> 中最为重要的一个概念。
执行环境定义了变量或函数有权访问的其他数据，决定了它们各自的行为。每个执行环境都有一个与之关联的变量对象（<code>variable object</code>），
环境中定义的所有变量和函数都保存在这个对象中。虽然我们编写的代码无法访问这个对象，但解析器在处理数据时会在后台使用它。</p></blockquote> <p><strong>执行环境</strong></p> <ol><li><p><code>全局执行环境</code>:
这是默认或者说是最基础的执行上下文，一个程序中只会存在一个全局上下文，它在整个 <code>javascript</code> 脚本的生命周期内都会存在于执行堆栈的最底部不会被栈弹出销毁。全局上下文会生成一个全局对象（以浏览器环境为例，这个全局对象是 <code>window</code>），并且将 <code>this</code> 值绑定到这个全局对象上。</p></li> <li><p><code>函数执行环境</code>:
每当一个函数被调用时，都会创建一个新的函数执行上下文（不管这个函数是不是被重复调用的）。当执行流进入一个函数时，函数的环境就会被推入一个环境栈中。而在函数执行之后，栈将其环境弹出，把控制权返回给之前的执行环境。</p></li> <li><p><code>Eval 函数执行上下文</code>:
执行在 <code>eval</code> 函数内部的代码也会有它属于自己的执行上下文，但由于并不经常使用 eval，所以在这里不做分析。</p></li></ol> <div class="custom-block tip"><p class="title">TIP</p><ul><li><p>当函数运行的时候，会生成一个叫做 “执行上下文” 的东西，也可以叫做执行环境，它用于保存函数运行时需要的一些信息,它是一个栈结构数据，全局上下文永远在该栈的最底部，每当一个函数执行生成了新的上下文，该上下文对象就会被压入栈，但是上下文栈有容量限制，如果超出容量就会栈溢出。</p></li> <li><p>执行上下文内部存储了包括：变量对象、作用域链、this 指向 这些函数运行时的必须数据。</p></li> <li><p>变量对象构建的过程中会触发变量和函数的声明提升。</p></li> <li><p>函数内部代码执行时，会先访问本地的变量对象去尝试获取变量，找不到的话就会攀爬作用域链层层寻找，找到目标变量则返回，找不到则 undefined。</p></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 示例代码</span>
<span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">&quot;Jack&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 访问全局作用域</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">&quot;啊哈哈&quot;</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 访问函数内部作用域</span>
<span class="token punctuation">}</span>

<span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Jack</span>
<span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 啊哈哈</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ul><li><p>一个函数能够访问到的上层作用域，在函数创建的时候就已经被确定且保存在函数的 <code>[[scope]]</code> 属性里，和函数拿到哪里去执行没有关系。</p></li> <li><p>一个函数调用时的 this 指向，取决于它的调用者，通常有以下几种方式可以改变函数的 <code>this</code> 值：<code>对象调用</code>、<code>call</code>、<code>bind</code>、<code>apply</code>。</p></li> <li><p>在 Web 浏览器中，全局执行环境被认为是 <code>window</code> 对象，因此所有全局变量和函数都是作为 <code>window</code> 对象的属性和方法创建的。</p></li> <li><p>某个执行环境中的所有代码执行完毕后，该环境被销毁，保存在其中的所有变量和函数定义也随之销毁(<strong>全局执行环境直到应用程序退出——例如关闭网页或浏览器时才会被销毁</strong>)。</p></li></ul></div><h3 id="作用域链"><a href="#作用域链" class="header-anchor">#</a> 作用域链</h3> <p>当代码在一个环境中执行时，会创建变量对象的一个<code>作用域链（scope chain）</code>。</p> <blockquote><p>作用域链的用途，是保证对执行环境有权访问的所有变量和函数的有序访问。作用域链的前端，始终都是当前执行的代码所在环境的变量对象。</p></blockquote> <p>如果这个环境是函数，则将其活动对象（<code>activation object</code>）作为变量对象。活动对象在最开始时只包含一个变量，即 <code>arguments</code> 对象（这个对象在全局环境中是不存在的）。作用域链中的下一个变量对象来自包含（外部）环境，而再下一个变量对象则来自下一个包含环境。这样，一直延 续到全局执行环境；全局执行环境的变量对象始终都是作用域链中的最后一个对象。</p> <p>标识符解析是沿着作用域链一级一级地搜索标识符的过程。搜索过程始终从作用域链的前端开始，然后逐级地向后回溯，直至找到标识符为止（如果找不到标识符，通常会导致错误发生）。</p> <h3 id="延长作用域"><a href="#延长作用域" class="header-anchor">#</a> 延长作用域</h3> <p>虽然执行环境的类型总共只有两种——全局和局部（函数），但还是有其他办法来延长作用域链。这么说是因为有些语句可以在作用域链的前端临时增加一个变量对象，该变量对象会在代码执行后被移除。</p> <ol><li><code>try-catch</code> 语句的 <code>catch</code> 块；</li> <li><code>with</code> 语句。</li></ol> <h3 id="词法作用域"><a href="#词法作用域" class="header-anchor">#</a> 词法作用域</h3> <p>词法作用域（<code>Lexical Scopes</code>）是 <code>javascript</code> 中使用的作用域类型，词法作用域 也可以被叫做 <code>静态作用域</code>，与之相对的还有 <code>动态作用域</code>。那么 <code>javascript</code> 使用的 <code>词法作用域</code> 和 <code>动态作用域</code> 的区别是什么呢？看下面这段代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 结果是: 1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>这个关键的问题就是 <code>javascript</code> 中的作用域类型——<code>词法作用域</code>。</strong></p> <div class="custom-block tip"><p class="title">TIP</p><p>词法作用域，就意味着函数被定义的时候，它的作用域就已经确定了，和拿到哪里执行没有关系，因此词法作用域也被称为 静态作用域。</p></div><p>如果是动态作用域类型，那么上面的代码运行结果应该是 bar 作用域中的 2 。也许你会好奇什么语言是动态作用域？bash 就是动态作用域，感兴趣的小伙伴可以了解一下。</p> <h3 id="块级作用域"><a href="#块级作用域" class="header-anchor">#</a> 块级作用域</h3> <p>什么是块级作用域呢？简单来说，花括号内 {...} 的区域就是块级作用域区域。</p> <p>很多语言本身都是支持块级作用域的。上面我们说，<code>javascript</code> 中大部分情况下，只有两种作用域类型：<code>全局作用域</code> 和 <code>函数作用域</code>，那么 <code>javascript</code> 中有没有块级作用域呢？来看下面的代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 结果:1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>运行后会发现，结果还是 1，花括号内定义并赋值的 a 变量跑到全局了。这足以说明，<code>javascript</code> 不是原生支持块级作用域的。</p> <div class="custom-block tip"><p class="title">TIP</p><p>但是 ES6 标准提出了使用 let 和 const 代替 var 关键字，来创建块级作用域。也就是说，上述代码改成如下方式，块级作用域是有效的：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ReferenceError</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div><h3 id="创建作用域"><a href="#创建作用域" class="header-anchor">#</a> 创建作用域</h3> <p>在 javascript 中，我们有几种创建 / 改变作用域的手段：</p> <ol><li>定义函数，创建函数作用（推荐）：</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 创建了一个 foo 的函数作用域</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="2"><li>使用 let 和 const 创建块级作用域（推荐）：</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ReferenceError</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="3"><li>try catch 创建作用域（不推荐）,err 仅存在于 catch 子句中：</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">undefined</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 强制产生异常</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// TypeError: undefined is not a function</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ReferenceError: `err` not found</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="4"><li>使用 eval “欺骗” 词法作用域（不推荐）：</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">str<span class="token punctuation">,</span> a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">eval</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token string">&quot;var b = 3;&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1 3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ol start="5"><li>使用 <code>with</code> 欺骗词法作用域（不推荐）：</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">with</span> <span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> o1 <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> o2 <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">foo</span><span class="token punctuation">(</span>o1<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o1<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>

<span class="token function">foo</span><span class="token punctuation">(</span>o2<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o2<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2 -- 全局作用域被泄漏了！</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="作用域的应用场景"><a href="#作用域的应用场景" class="header-anchor">#</a> 作用域的应用场景</h3> <p>作用域的一个常见运用场景之一，就是 <code>模块化</code>。</p> <blockquote><p>由于 <code>javascript</code> 并未原生支持模块化导致了很多令人口吐芬芳的问题，比如全局作用域污染和变量名冲突，代码结构臃肿且复用性不高。在正式的模块化方案出台之前，开发者为了解决这类问题，想到了使用函数作用域来创建模块的方案。</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">module1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">module2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">module1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; 1</span>
<span class="token function">module2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; 2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>上面的代码中，构建了 <code>module1</code> 和 <code>module2</code> 两个代表模块的函数，两个函数内分别定义了一个同名变量 <code>a</code> ，由于函数作用域的隔离性质，这两个变量被保存在不同的作用域中（不嵌套），<code>JS</code> 引擎在执行这两个函数时会去不同的作用域中读取，并且外部作用域无法访问到函数内部的 <code>a</code> 变量。这样一来就巧妙地解决了 <code>全局作用域污染</code> 和 <code>变量名冲突</code> 的问题；并且，由于函数的包裹写法，这种方式看起来封装性好多了。</p> <p>然而上面的函数声明式写法，看起来还是有些冗余，更重要的是，<code>module1</code> 和 <code>module2</code> 的函数名本身就已经对全局作用域造成了污染。我们使用匿名函数来继续改写：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// module1.js</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// module2.js</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>将函数声明改写成立即调用函数表达式（<code>Immediately Invoked Function Expression</code> 简写 <code>IIFE</code>），封装性更好，代码也更简洁，解决了模块名污染全局作用域的问题。</p> <div class="custom-block tip"><p class="title">TIP</p><p>函数声明和函数表达式，最简单的区分方法，就是看是不是 function 关键字开头：是 function 开头的就是函数声明，否则就是函数表达式。</p></div><p>上面的代码采用了 <code>IIFE</code> 的写法，已经进化很多了，我们可以再把它强化一下，强化成后浪版，赋予它判断外部环境的权利——选择的权力。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">global</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>global<span class="token operator">...</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// is browser</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>global<span class="token operator">...</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// is nodejs</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="垃圾回收机制"><a href="#垃圾回收机制" class="header-anchor">#</a> 垃圾回收机制</h2> <p><code>JavaScript</code> 具有自动垃圾收集机制，也就是说，执行环境会负责管理代码执行过程中使用的内存。</p> <p>这种垃圾收集机制的原理其实很简单:找出那些不再继续使用的变量，然后释放其占用的内存。为此，垃圾收集器会按照固定的时间间隔(或代码执行中预定的收集时间)，周期性地执行这一操作。</p> <p><strong>分类：</strong></p> <ol><li>标记清除(mark-and-sweep).</li> <li>引用计数(reference counting)</li></ol> <h3 id="标记清除"><a href="#标记清除" class="header-anchor">#</a> <code>标记清除</code></h3> <p><code>JavaScript</code> 中最常用的垃圾收集方式是标记清除。</p> <p>当变量进入环境(例如，在函数中声明一个变量)时，就将这个变量标记为“进入环境”。从逻辑上讲，永远不能释放进入环境的变量所占用的内存，因为只要执行流进入相应的环境，就可能会用到它们。而当变量离开环境时，则将其标记为“离开环境”。</p> <p>垃圾收集器在运行的时候会给存储在内存中的所有变量都加上标记。然后，它会去掉环境中的变量以及被环境中的变量引用的变量的标记。而在此之后再被加上标记的变量将被视为准备删除的变量，原因是环境中的变量已经无法访问到这些变量了。最后，垃圾收集器完成内存清除工作，销毁那些带标记的值并回收它们所占用的内存空间。</p> <h3 id="引用计数"><a href="#引用计数" class="header-anchor">#</a> <code>引用计数</code></h3> <p>引用计数的含义是跟踪记录每个值被引用的次数。</p> <p>当声明了一个变量并将一个引用类型值赋给该变量时，则这个值的引用次数就是1。 如果同一个值又被赋给另一个变量，则该值的引用次数加1。相反，如果包含对这个值引用的变量又取得了另外一个值，则这个值的引用次数减 1。</p> <p>当这个值的引用次数变成0时，则说明没有办法再访问这个值了，因而就可以将其占用的内存空间回收回来。这样，当垃圾收集器下次再运行时，它就会释放那些引用次数为0的值所占用的内存。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">problem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
    <span class="token keyword">let</span> objectA <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token keyword">let</span> objectB <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    objectA<span class="token punctuation">.</span>someOtherObject <span class="token operator">=</span> objectB<span class="token punctuation">;</span> 
    objectB<span class="token punctuation">.</span>anotherObject <span class="token operator">=</span> objectA<span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>在这个例子中，<code>objectA</code> 和 <code>objectB</code> 通过各自的属性相互引用；也就是说，这两个对象的引用次数都是2。</p> <p>在采用标记清除策略的实现中，由于函数执行之后，这两个对象都离开了作用域，因此这种 相互引用不是个问题。</p> <p>但在采用引用计数策略的实现中，当函数执行完毕后，<code>objectA</code> 和 <code>objectB</code> 还 将继续存在，因为它们的引用次数永远不会是0。假如这个函数被重复多次调用，就会导致大量内存得不到回收。</p> <h3 id="管理内存"><a href="#管理内存" class="header-anchor">#</a> 管理内存</h3> <p>确保占用最少的内存可以让页面获得更好的性能。</p> <p>而优化内存占用的最佳方式，就是为执行中的代码只保存必要的数据。一旦数据不再有用，最好通过将其值设置为 <code>null</code> 来释放其引用——这个做法叫做解除引用（<code>dereferencing</code>）。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createPerson</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> localPerson <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    localPerson<span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token keyword">let</span> globalPerson <span class="token operator">=</span> <span class="token function">createPerson</span><span class="token punctuation">(</span><span class="token string">&quot;Nicholas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 手工解除 globalPerson 的引用</span>
globalPerson <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="custom-block tip"><p class="title">TIP</p><p>解除一个值的引用并不意味着自动回收该值所占用的内存。解除引用的真正作用是让值脱离执行环境，以便垃圾收集器下次运行时将其回收。</p></div><h2 id="regexp-正则表达式"><a href="#regexp-正则表达式" class="header-anchor">#</a> <code>RegExp</code> 正则表达式</h2> <ul><li><code>g</code>: 表示全局(<code>global</code>)模式，即模式将被应用于所有字符串，而非在发现第一个匹配项时立即停止。</li> <li><code>i</code>:表示不区分大小写(<code>case-insensitive</code>)模式，即在确定匹配项时忽略模式与字符串的大小写;</li> <li><code>m</code>:表示多行(<code>multiline</code>)模式，即在到达一行文本末尾时还会继续查找下一行中是否存在与模式匹配的项。</li></ul> <h3 id="常用正则表达式字符含义"><a href="#常用正则表达式字符含义" class="header-anchor">#</a> 常用正则表达式字符含义</h3> <ul><li><code>\</code> : 在非特殊字符之前的反斜杠表示下一个字符是特殊字符，不能按照字面理解。</li></ul> <blockquote><p>例如，前面没有 &quot;&quot; 的 &quot;b&quot; 通常匹配小写字母 &quot;b&quot;，即字符会被作为字面理解，无论它出现在哪里。但如果前面加了 &quot;&quot;，它将不再匹配任何字符，而是表示一个字符边界。在特殊字符之前的反斜杠表示下一个字符不是特殊字符，应该按照字面理解。</p></blockquote> <ul><li><code>^</code>: 匹配输入的开始。如果多行标志被设置为 true，那么也匹配换行符后紧跟的位置。</li></ul> <blockquote><p>例如，/^A/ 并不会匹配 &quot;an A&quot; 中的 'A'，但是会匹配 &quot;An E&quot; 中的 'A'。</p></blockquote> <ul><li><code>$</code>: 匹配输入的结束。如果多行标示被设置为 true，那么也匹配换行符前的位置。</li></ul> <blockquote><p>例如，/t$/ 并不会匹配 &quot;eater&quot; 中的 't'，但是会匹配 &quot;eat&quot; 中的 't'。</p></blockquote> <ul><li><code>*</code>: 匹配前一个表达式 0 次或多次。等价于 {0,}。</li></ul> <blockquote><p>例如，/bo*/ 会匹配 &quot;A ghost boooooed&quot; 中的 'booooo' 和 &quot;A bird warbled&quot; 中的 'b'，但是在 &quot;A goat grunted&quot; 中不会匹配任何内容。</p></blockquote> <ul><li><code>+</code>: 匹配前面一个表达式 1 次或者多次。等价于 {1,}。</li></ul> <blockquote><p>例如，/a+/ 会匹配 &quot;candy&quot; 中的 'a' 和 &quot;caaaaaaandy&quot; 中所有的 'a'，但是在 &quot;cndy&quot; 中不会匹配任何内容。</p></blockquote> <ul><li><code>?</code>: 匹配前面一个表达式 0 次或者 1 次。等价于 {0,1}。</li></ul> <blockquote><p>例如，/e?le?/ 匹配 &quot;angel&quot; 中的 'el'、&quot;angle&quot; 中的 'le' 以及 &quot;oslo' 中的 'l'。</p></blockquote> <div class="custom-block tip"><p class="title">TIP</p><p>如果紧跟在任何量词 <code>*</code>、<code>+</code>、<code>?</code> 或 <code>{}</code> 的后面，将会使量词变为非贪婪（匹配尽量少的字符）,和缺省使用的贪婪模式（匹配尽可能多的字符）正好相反。</p> <p>例如，对 &quot;123abc&quot; 使用 /\d+/ 将会匹配 &quot;123&quot;，而使用 /\d+?/ 则只会匹配到 &quot;1&quot;。</p></div><ul><li><code>.</code>: （小数点）默认匹配除换行符之外的任何单个字符。</li></ul> <blockquote><p>例如，/.n/ 将会匹配 &quot;nay, an apple is on the tree&quot; 中的 'an' 和 'on'，但是不会匹配 'nay'。如果 s (&quot;dotAll&quot;) 标志位被设为 true，它也会匹配换行符。</p></blockquote> <ul><li><code>(x)</code>: 像下面的例子展示的那样，它会匹配 'x' 并且记住匹配项。其中括号被称为<code>捕获括号</code>。</li></ul> <blockquote><p>模式<code>/(foo) (bar) \1 \2/ 中的 '(foo)' 和 '(bar)'</code>匹配并记住字符串 <code>foo bar foo bar</code>中前两个单词。 模式中的 \1 和 \2 表示第一个和第二个被捕获括号匹配的子字符串，即 foo 和 bar，匹配了原字符串中的后两个单词。 注意 <code>\1、\2、...、\n</code>是用在正则表达式的匹配环节。 而在正则表达式的替换环节，则要使用像 <code>$1、$2、...、$n</code> 这样的语法， 例如，<code>'bar foo'.replace(/(...) (...)/, '$2 $1')</code>。$&amp; 表示整个用于匹配的原字符串。</p></blockquote> <ul><li><code>x(?=y)</code>: 匹配'x'仅仅当'x'后面跟着'y'.这种叫做先行断言。</li></ul> <blockquote><p>例如，/Jack(?=Sprat)/会匹配到'Jack'仅仅当它后面跟着'Sprat'。 /Jack(?=Sprat|Frost)/匹配‘Jack’仅仅当它后面跟着'Sprat'或者是‘Frost’。但是‘Sprat’和‘Frost’都不是匹配结果的一部分。</p></blockquote> <ul><li><code>(?&lt;=y)x</code>: 匹配'x'仅仅当'x'前面是'y'.这种叫做后行断言。</li></ul> <blockquote><p>例如，/(?&lt;=Jack)Sprat/会匹配到' Sprat '仅仅当它前面是' Jack '。/(?&lt;=Jack|Tom)Sprat/匹配‘ Sprat ’仅仅当它前面是'Jack'或者是‘Tom’。但是‘Jack’和‘Tom’都不是匹配结果的一部分。</p></blockquote> <ul><li><code>x(?!y)</code>: 仅仅当'x'后面不跟着'y'时匹配'x'，这被称为正向否定查找。</li></ul> <blockquote><p>例如，仅仅当这个数字后面没有跟小数点的时候，/\d+(?!.)/ 匹配一个数字。正则表达式/\d+(?!.)/.exec(&quot;3.141&quot;)匹配‘141’而不是‘3.141’</p></blockquote> <ul><li><code>(?&lt;!y)x</code>: 仅仅当'x'前面不是'y'时匹配'x'，这被称为反向否定查找。</li></ul> <blockquote><p>例如, 仅仅当这个数字前面没有负号的时候，/(?&lt;!-)\d+/ 匹配一个数字。/(?&lt;!-)\d+/.exec('3') 匹配到 &quot;3&quot;./(?&lt;!-)\d+/.exec('-3') 因为这个数字前有负号，所以没有匹配到。</p></blockquote> <ul><li><code>x|y</code>: 匹配‘x’或者‘y’。</li></ul> <blockquote><p>例如，/green|red/匹配“green apple”中的‘green’和“red apple”中的‘red’</p></blockquote> <ul><li><code>{n}</code>:n 是一个正整数，匹配了前面一个字符刚好出现了 n 次。</li></ul> <blockquote><p>比如， /a{2}/ 不会匹配“candy”中的'a',但是会匹配“caandy”中所有的 a，以及“caaandy”中的前两个'a'。</p></blockquote> <ul><li><code>{n,}</code>: n是一个正整数，匹配前一个字符至少出现了n次。</li></ul> <blockquote><p>例如, /a{2,}/ 匹配 &quot;aa&quot;, &quot;aaaa&quot; 和 &quot;aaaaa&quot; 但是不匹配 &quot;a&quot;。</p></blockquote> <ul><li><code>{n,m}</code>: n 和 m 都是整数。匹配前面的字符至少n次，最多m次。如果 n 或者 m 的值是0， 这个值被忽略。</li></ul> <blockquote><p>例如，/a{1, 3}/ 并不匹配“cndy”中的任意字符，匹配“candy”中的a，匹配“caandy”中的前两个a，也匹配“caaaaaaandy”中的前三个a。注意，当匹配”caaaaaaandy“时，匹配的值是“aaa”，即使原始的字符串中有更多的a。</p></blockquote> <ul><li><code>\d</code>: 匹配一个数字。等价于[0-9]。</li></ul> <blockquote><p>例如， /\d/ 或者 /[0-9]/ 匹配&quot;B2 is the suite number.&quot;中的'2'。</p></blockquote> <ul><li><code>\D</code>: 匹配一个非数字字符。等价于[^0-9]。</li></ul> <blockquote><p>例如， /\D/ 或者 /[^0-9]/ 匹配&quot;B2 is the suite number.&quot;中的'B' 。</p></blockquote> <ul><li><p>`\n*: 匹配一个换行符 (U+000A)。</p></li> <li><p><code>\f</code> : 匹配一个换页符 (U+000C)。</p></li> <li><p><code>\r</code>: 匹配一个回车符 (U+000D)。</p></li> <li><p><code>\s</code>: 匹配一个空白字符，包括空格、制表符、换页符和换行符。</p></li></ul> <blockquote><p>例如, /\s\w*/ 匹配&quot;foo bar.&quot;中的' bar'。</p></blockquote> <ul><li><code>\S</code>: 匹配一个非空白字符。</li></ul> <blockquote><p>例如，/\S\w*/ 匹配&quot;foo bar.&quot;中的'foo'。</p></blockquote> <ul><li><p><code>\t</code>: 匹配一个水平制表符 (U+0009)。</p></li> <li><p><code>\v</code>: 匹配一个垂直制表符 (U+000B)。</p></li> <li><p><code>\w</code>: 匹配一个单字字符（字母、数字或者下划线）。等价于[A-Za-z0-9_]。</p></li></ul> <blockquote><p>例如, /\w/ 匹配 &quot;apple,&quot; 中的 'a'，&quot;$5.28,&quot;中的 '5' 和 &quot;3D.&quot; 中的 '3'。</p></blockquote> <ul><li><code>\W</code>: 匹配一个非单字字符。等价于 [^A-Za-z0-9_]。</li></ul> <blockquote><p>例如, /\W/ 或者 /[^A-Za-z0-9_]/ 匹配 &quot;50%.&quot; 中的 '%'。</p></blockquote> <ul><li><code>\b</code>: 匹配一个零宽单词边界，即\w和\W之间的位置，或字符串首位与\w或\w与字符串末尾的位置。</li></ul> <blockquote><p>例如, /\b/ 匹配 &quot;aa bb&quot;中的 空格。</p></blockquote> <ul><li><code>\B</code>: 匹配一个零宽非单词边界。</li></ul> <blockquote><p>例如, /\B/ 匹配 &quot;aa bb&quot;中的 空格。</p></blockquote> <p><strong>常用方法与描述</strong></p> <table><thead><tr><th>方法</th> <th>描述</th></tr></thead> <tbody><tr><td><code>exec</code></td> <td>一个在字符串中执行查找匹配的RegExp方法，它返回一个数组（未匹配到则返回null）。</td></tr> <tr><td><code>test</code></td> <td>一个在字符串中测试是否匹配的RegExp方法，它返回 true或 false。</td></tr> <tr><td><code>match</code></td> <td>一个在字符串中执行查找匹配的String方法，它返回一个数组，在未匹配到时会返回 null。</td></tr> <tr><td><code>matchAll</code></td> <td>一个在字符串中执行查找所有匹配的String方法，它返回一个迭代器（iterator）。</td></tr> <tr><td><code>search</code></td> <td>一个在字符串中测试匹配的String方法，它返回匹配到的位置索引，或者在失败时返回-1。</td></tr> <tr><td><code>replace</code></td> <td>一个在字符串中执行查找匹配的String方法，并且使用替换字符串替换掉匹配到的子字符串。</td></tr> <tr><td><code>split</code></td> <td>一个使用正则表达式或者一个固定字符串分隔一个字符串，并将分隔后的子字符串存储到数组中的String 方法。</td></tr></tbody></table> <h2 id="函数"><a href="#函数" class="header-anchor">#</a> 函数</h2> <p>函数是 <code>javascript</code> 中相当重要的一部分,我们通过以下几个方面来理解他。</p> <h3 id="函数中的参数"><a href="#函数中的参数" class="header-anchor">#</a> 函数中的参数</h3> <p><code>ECMAScript</code> 函数的参数与大多数其他语言中函数的参数有所不同。<code>ECMAScript</code> 函数不介意传递进来多少个参数，也不在乎传进来参数是什么数据类型。</p> <p>也就是说，即便你定义的函数只接收两个参数，在调用这个函数时也未必一定要传递两个参数。可以传递一个、三个甚至不传递参数，而解析器永远不会有什么怨言。</p> <p>之所以会这样，原因是 <code>ECMAScript</code> 中的参数在内部是用一个数组来表示的。</p> <p>函数接收到的始终都是这个数组，而不关心数组中包含哪些参数。如果这个数组中不包含任何元素，无所谓；如果包含多个元素，也没有问题。</p> <div class="custom-block tip"><p class="title">TIP</p><p>实际上，在函数体内可以通过 <code>arguments</code> 对象来访问这个参数数组，从而获取传递给函数的每一个参数。</p></div><div class="custom-block warning"><p class="title">WARNING</p><p>由于大量使用 <code>with</code> 语句会导致性能下降，同时也会给调试代码造成困难，因此在开发大型应用程序时，不建议使用 <code>with</code> 语句。</p></div><h3 id="函数中的属性"><a href="#函数中的属性" class="header-anchor">#</a> 函数中的属性</h3> <p>在函数的内部，有两个特殊的对象: <code>arguments</code> 和 <code>this</code>。</p> <p><code>arguments</code> 是一个类数组对象，包含着传入函数中的所有参数,有一个 <code>callee</code> 的属性，该属性是一个指针，指向拥有这个 <code>arguments</code> 对象的函数。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">factorial</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>num <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> num <span class="token operator">*</span> arguments<span class="token punctuation">.</span><span class="token function">callee</span><span class="token punctuation">(</span>num <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 指向了factorial</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>每个函数都包含两个属性：<code>length</code> 和 <code>prototype</code>。</p> <p>其中，<code>length</code> 属性表示函数希望接收的命名参数的个数，如下面的例子所示:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">sayName</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span> num2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> num1 <span class="token operator">+</span> num2<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;hi&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">alert</span><span class="token punctuation">(</span>sayName<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//1</span>
<span class="token function">alert</span><span class="token punctuation">(</span>sum<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//2</span>
<span class="token function">alert</span><span class="token punctuation">(</span>sayHi<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="custom-block tip"><p class="title">TIP</p><p>在 <code>ECMAScript5</code> 中，<code>prototype</code> 属性是不可枚举的，因此使用 <code>for-in</code> 无法发现。 函数是对象，函数名是指针。</p></div><h3 id="apply-与-call"><a href="#apply-与-call" class="header-anchor">#</a> <code>apply</code> 与 <code>call</code></h3> <p>每个函数都包含两个非继承而来的方法:<code>apply()</code>和 <code>call()</code>。</p> <blockquote><p>这两个方法的用途都是在特定的作用域中调用函数，实际上等于设置函数体内 <code>this</code> 对象的值。</p></blockquote> <div class="custom-block tip"><p class="title">TIP</p><p>使用 <code>call()</code>（或 <code>apply()</code>）来扩充作用域的最大好处，就是对象不需要与方法有任何耦合关系。</p></div><ul><li><code>apply()</code>方法接收两个参数:一个是在其中运行函数的作用域，另一个是参数数组。第二个参数可以是 <code>Array</code> 的实例，也可以是 <code>arguments</code> 对象。例如:</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span> num2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> num1 <span class="token operator">+</span> num2<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">callSum1</span><span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span> num2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">sum</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">callSum2</span><span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span> num2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">sum</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>num1<span class="token punctuation">,</span> num2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token function">callSum1</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 20</span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token function">callSum2</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 20</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li><code>call()</code>方法与<code>apply()</code>方法的作用相同，它们的区别仅在于接收参数的方式不同。对于 <code>call()</code>方法而言，第一个参数是 <code>this</code> 值没有变化，变化的是传递给函数的参数必须逐个列举出来。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span> num2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> num1 <span class="token operator">+</span> num2<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">callSum</span><span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span> num2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">sum</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> num1<span class="token punctuation">,</span> num2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token function">callSum</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 20</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="函数声明与函数表达式"><a href="#函数声明与函数表达式" class="header-anchor">#</a> 函数声明与函数表达式</h3> <p>关于函数声明，它最重要的一个特征就是函数声明提升，意思是执行代码之前先读取函数声明。这意味着可以把函数声明放在调用它的语句之后。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 函数声明</span>
<span class="token keyword">function</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">&quot;hello world&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 函数表达式</span>
<span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// VM1155:1 Uncaught ReferenceError: Cannot access 'hello' before initialization</span>

<span class="token comment">// 变量赋值语句</span>
<span class="token keyword">const</span> <span class="token function-variable function">hello</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">&quot;hello world&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="custom-block tip"><p class="title">TIP</p><p>函数声明与函数表达式的区别：</p> <p>函数声明存在变量提升，可以先使用再声明。函数表达式必须先定义再使用。</p> <p>函数表达式中，创建的函数叫做匿名函数，因为 <code>function</code> 关键字后面没有标识符。</p></div><h3 id="匿名函数与具名函数"><a href="#匿名函数与具名函数" class="header-anchor">#</a> 匿名函数与具名函数</h3> <ul><li><code>匿名函数</code>，顾名思义就是没有名字的函数。上面的函数表达式中的创建，实际上是创建一个匿名函数，并将匿名函数赋值给变量 <code>hello</code>,调用 <code>hello</code> 来进行函数的调用，调用的方式就是在变量 <code>hello</code> 后面加上一对括号()。
这是一种常见的匿名函数调用方式,我们再来看看另外一种调用方式:</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5</span>

<span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token string">&quot;x&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;y&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;return x+y&quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>上述的例子中运用到了一个知识点,在 <code>javascript</code> 中，是没有块级作用域这种说法的，以上代码的这种方式就是模仿了块级作用域(通常成为私有作用域)，语法如下所示：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//这里是块级作用域</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>上述代码定义并立即调用了一个匿名函数。经函数声明包含在一对圆括号中，表示它实际上是一个函数表达式。而紧随其后的另一对圆括号会立即调用这个函数。然而要注意一点:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>上面的代码是错误的，因为 <code>javascript</code> 将 <code>function</code> 关键字当作一个函数声明的开始，而函数声明后面不能加圆括号，如果你不显示告诉编译器，它会默认生成一个缺少名字的 <code>function</code>，并且抛出一个语法错误，因为 <code>function</code> 声明需要一个名字。</p> <p>有趣的是，即便你为上面那个错误的代码加上一个名字，他也会提示语法错误，只不过和上面的原因不一样。提示为：<code>Uncaught SyntaxError: Unexpected token (</code>。</p> <div class="custom-block tip"><p class="title">TIP</p><p>在一个表达式后面加上括号()，该表达式会立即执行，但是在一个语句后面加上括号()，是完全不一样的意思，只是分组操作符。</p></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'测试是否弹窗'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// SyntaxError: Unexpected token )</span>
<span class="token comment">// 报错因为分组操作符需要包含表达式</span>

<span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'测试是否弹窗'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment">// (1) =&gt; 等价于 1</span>
<span class="token comment">// 相当于test方法后面个跟了一个无关系的表达式子:(1)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>所以上面代码要是想要得到想要的弹窗提示，就必须要实现赋值，如:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token function-variable function">a</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;测试是否弹窗&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 弹窗提示成功 a 被复制成自动用函数的返回值</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="custom-block tip"><p class="title">TIP</p><p>a= 这个片段告诉了编译器这个是一个函数表达式，而不是函数的声明。因为函数表达式后面可以跟圆括号。
:::``````````````````</p> <p>因此下面两段代码是等价的:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">aa</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token comment">//弹窗显示：5</span>

<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//弹窗显示：5</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>从上面对于函数和匿名函数的了解，我们引申出来了一个概念，即自执行函数。那为什么 <code>a =function(){}()</code> 这种表示方法可以让编译器认为这个是一个函数表达式而不是一个函数的声明？</p> <h3 id="自执行匿名函数"><a href="#自执行匿名函数" class="header-anchor">#</a> 自执行匿名函数</h3> <p>从上面对于函数和匿名函数的了解，我们引申出来了一个概念，即自执行函数。那为什么 <code>a =function(){}()</code> 这种表示方法可以让编译器认为这个是一个函数表达式而不是一个函数的声明？</p> <blockquote><p>自执行函数，即定义和调用合为一体。我们创建了一个匿名的函数，并立即执行它，由于外部无法引用它内部的变量，因此在执行完后很快就会被释放，关键是这种机制不会污染全局对象。</p></blockquote> <p>我们来看看常用的自执行函数方式:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 推荐使用这个</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/* code */</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>由于 <code>括弧()</code>和 JS 的 <code>&amp;&amp; ||</code> 或 <code>，</code>逗号等操作符是在函数表达式和函数声明上消除歧义的,所以一旦解析器知道其中一个已经是表达式了，其它的也都默认为表达式了。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token boolean">true</span> <span class="token operator">&amp;&amp;</span>
  <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/* code */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/* code */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>如果你不在意返回值，或者不怕难以阅读,你甚至可以在 <code>function</code> 前面加一元操作符号:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/* code */</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">~</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/* code */</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">-</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/* code */</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/* code */</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>还有一个情况，使用 new 关键字,也可以用，但不确定执行效率:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/* code */</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/* code */</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 如果需要传递参数，只需要加上括弧()</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="闭包"><a href="#闭包" class="header-anchor">#</a> 闭包</h3> <blockquote><p>闭包是指一个绑定了执行环境的函数。(或者说是函数内部定义的函数，被返回了出去并在外部调用。)</p></blockquote> <p>创建闭包的常见方式，就是在一个函数内部创建另一个函数。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> bar<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> baz <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这就形成了一个闭包</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>我们可以简单剖析一下上面代码的运行流程：</p> <ol><li>编译阶段，变量和函数被声明，作用域即被确定。</li> <li>运行函数 <code>foo()</code>，此时会创建一个 <code>foo</code> 函数的执行上下文，执行上下文内部存储了 <code>foo</code> 中声明的所有变量函数信息。</li> <li>函数 <code>foo</code> 运行完毕，将内部函数 <code>bar</code> 的引用赋值给外部的变量 <code>baz</code> ，此时 <code>baz</code> 指针指向的还是 <code>bar</code> ，因此哪怕它位于 <code>foo</code> 作用域之外，它还是能够获取到 <code>foo</code> 的内部变量。</li> <li><code>baz</code> 在外部被执行，<code>baz</code> 的内部可执行代码 <code>console.log</code> 向作用域请求获取 <code>a</code> 变量，本地作用域没有找到，继续请求父级作用域，找到了 <code>foo</code> 中的 <code>a</code> 变量，返回给 <code>console.log</code>，打印出 <code>2</code>。</li></ol> <p>闭包的执行看起来像是开发者使用的一个小小的 “作弊手段” —— <strong>绕过了作用域的监管机制，从外部也能获取到内部作用域的信息。</strong> 闭包的这一特性极大地丰富了开发人员的编码方式，也提供了很多有效的运用场景。</p> <h3 id="闭包的应用场景"><a href="#闭包的应用场景" class="header-anchor">#</a> 闭包的应用场景</h3> <blockquote><p>闭包的应用，大多数是在需要维护内部变量的场景下。</p></blockquote> <p><strong>单例模式</strong></p> <p>单例模式是一种常见的涉及模式，它保证了一个类只有一个实例。实现方法一般是先判断实例是否存在，如果存在就直接返回，否则就创建了再返回。单例模式的好处就是避免了重复实例化带来的内存开销：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 单例模式</span>
<span class="token keyword">function</span> <span class="token function">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token string">&quot;singleton&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

Singleton<span class="token punctuation">.</span>getInstance <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> instance<span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>instance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> sa <span class="token operator">=</span> Singleton<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> sb <span class="token operator">=</span> Singleton<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sa <span class="token operator">===</span> sb<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sa<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'singleton'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p><strong>模拟私有属性</strong> <code>javascript</code> 没有 <code>java</code> 中那种 <code>public private</code> 的访问权限控制，对象中的所用方法和属性均可以访问，这就造成了安全隐患，内部的属性任何开发者都可以随意修改。虽然语言层面不支持私有属性的创建，但是我们可以用闭包的手段来模拟出私有属性：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 模拟私有属性</span>
<span class="token keyword">function</span> <span class="token function">getGeneratorFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> _name <span class="token operator">=</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> _age <span class="token operator">=</span> <span class="token number">22</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">getName</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> _name<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">getAge</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> _age<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token function">getGeneratorFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// John</span>
obj<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 22</span>
obj<span class="token punctuation">.</span>_age<span class="token punctuation">;</span> <span class="token comment">// undefined</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p><strong>柯里化</strong>
柯里化（currying），是把接受多个参数的函数变换成接受一个单一参数（最初函数的第一个参数）的函数，并且返回接受余下的参数而且返回结果的新函数的技术。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">bind</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">context <span class="token operator">=</span> window</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token keyword">this</span> <span class="token operator">!==</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> selfFunc <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>arguments<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token constant">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 因为返回了一个函数，可以 new F()，所以需要判断</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">F</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">selfFunc</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// bind 可以实现类似这样的代码 f.bind(obj, 1)(2)，所以需要将两边的参数拼接起来</span>
      <span class="token keyword">return</span> <span class="token function">selfFunc</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> args<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>柯里化的优势之一就是 参数的复用，它可以在传入参数的基础上生成另一个全新的函数，来看下面这个类型判断函数：
function typeOf(value) {
return function(obj) {
s;
const map = {
&quot;[object Boolean]&quot;: &quot;boolean&quot;,
&quot;[object Number]&quot;: &quot;number&quot;,
&quot;[object String]&quot;: &quot;string&quot;,
&quot;[object Function]&quot;: &quot;function&quot;,
&quot;[object Array]&quot;: &quot;array&quot;,
&quot;[object Date]&quot;: &quot;date&quot;,
&quot;[object RegExp]&quot;: &quot;regExp&quot;,
&quot;[object Undefined]&quot;: &quot;undefined&quot;,
&quot;[object Null]&quot;: &quot;null&quot;,
&quot;[object Object]&quot;: &quot;object&quot;,
};
return map[Object.prototype.toString.call(obj)] === value;
};
}</p> <p>var isNumber = typeOf(&quot;number&quot;);
var isFunction = typeOf(&quot;function&quot;);
var isRegExp = typeOf(&quot;regExp&quot;);</p> <p>isNumber(0); // =&gt; true
isFunction(function() {}); // true
isRegExp({}); // =&gt; false</p> <h3 id="闭包的问题"><a href="#闭包的问题" class="header-anchor">#</a> 闭包的问题</h3> <p><strong>内存泄露</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> bar<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> baz <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这就形成了一个闭包</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>乍一看，好像没什么问题，然而，它却有可能导致 内存泄露。</p> <p>我们知道，<code>javascript</code> 内部的垃圾回收机制用的是引用计数收集：即当内存中的一个变量被引用一次，计数就加一。垃圾回收机制会以固定的时间轮询这些变量，将计数为 0 的变量标记为失效变量并将之清除从而释放内存。</p> <p>上述代码中，理论上来说， <code>foo</code> 函数作用域隔绝了外部环境，所有变量引用都在函数内部完成，<code>foo</code> 运行完成以后，内部的变量就应该被销毁，内存被回收。然而闭包导致了全局作用域始终存在一个 <code>baz</code> 的变量在引用着 <code>foo</code> 内部的 <code>bar</code> 函数，这就意味着 <code>foo</code> 内部定义的 <code>bar</code> 函数引用数始终为 1，垃圾运行机制就无法把它销毁。更糟糕的是，<code>bar</code> 有可能还要使用到父作用域 <code>foo</code> 中的变量信息，那它们自然也不能被销毁... JS 引擎无法判断你什么时候还会调用闭包函数，只能一直让这些数据占用着内存。</p> <p>:: tip TIP</p> <p>这种由于闭包使用过度而导致的内存占用无法释放的情况，我们称之为：内存泄露。</p></div><h3 id="内存泄露"><a href="#内存泄露" class="header-anchor">#</a> 内存泄露</h3> <blockquote><p>内存泄露 是指当一块内存不再被应用程序使用的时候，由于某种原因，这块内存没有返还给操作系统或者内存池的现象。内存泄漏可能会导致应用程序卡顿或者崩溃</p></blockquote> <ul><li>造成内存泄露的原因有很多，除了闭包以外，还有 <strong>全局变量的无意创建</strong>。开发者的本意是想将变量作为局部变量使用，然而忘记写 <code>var</code> 导致变量被泄露到全局中：</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li>具体来说，如果闭包的作用域链中保存着一个HTML元素，那么就意味着该元素将无法被销毁。来看下面的例子:</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">assignHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;someElement&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> id <span class="token operator">=</span> element<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
  element<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  element <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>在上面的代码中，通过把<code>element.id</code>的一个副本保存在一个变量中，并且在闭包中引用该变量消除了循环引用。但仅仅做到这一步，还是不能解决内存泄漏的问题。</p> <div class="custom-block tip"><p class="title">TIP</p><p>必须要记住：闭包会引用包含函数的整个活动对象，而其中包含着 <code>element</code>。即使闭包不直接引用 <code>element</code>，包含函数的活动对象中也 仍然会保存一个引用。因此，有必要把 <code>element</code> 变量设置为 <code>null</code>。这样就能够解除对 <code>DOM</code> 对象的引用，顺利地减少其引用数，确保正常回收其占用的内存</p></div><ul><li>还有 <code>DOM</code> 的事件绑定，移除 <code>DOM</code> 元素前如果忘记了注销掉其中绑定的事件方法，也会造成内存泄露：</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> wrapDOM <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;wrap&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
wrapDOM<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// some codes ...</span>

<span class="token comment">// remove wrapDOM</span>
wrapDOM<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>wrapDOM<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="内存泄露的排查手段"><a href="#内存泄露的排查手段" class="header-anchor">#</a> 内存泄露的排查手段</h3> <p>我们借助谷歌的开发者工具， <code>Chrome</code> 浏览器，<code>F12</code> 打开开发者工具来看看如何排查。</p> <p><strong>Performance</strong> <img src="/images/base-js17.png" alt="base-js17"> <img src="/images/base-js18.png" alt="base-js18"></p> <p>点击这个按钮启动记录，然后切换到网页进行操作，录制完成后点击 stop 按钮，开发者工具会从录制时刻开始记录当前应用的各项数据情况。</p> <p><img src="/images/base-js19.png" alt="base-js19"></p> <p>选中<code>JS Heap</code>，下面展现出来的一条蓝线，就是代表了这段记录过程中，<code>JS</code> 堆内存信息的变化情况。</p> <p>有大佬说，根据这条蓝线就可以判断是否存在内存泄漏的情况：<code>如果这条蓝线一直成上升趋势，那基本就是内存泄漏了。</code>其实我觉得这么讲有失偏颇，<code>JS</code> 堆内存占用率上升并不一定就是内存泄漏，只能说明有很多未被释放的内存而已，至于这些内存是否真的在使用，还是说确实是内存泄漏，还需要进一步排查。</p> <p><img src="/images/base-js20.png" alt="base-js20"></p> <p><code>memory</code></p> <p>借助开发者工具的 <code>Memory</code> 选项，可以更精确地定位内存使用情况。</p> <p><img src="/images/base-js21.png" alt="base-js21"> <img src="/images/base-js22.png" alt="base-js22"></p> <p>当生成了第一个快照的时候，开发者工具窗口已经显示了很详细的内存占用情况。</p> <p><strong>字段说明:</strong></p> <table><thead><tr><th>字段</th> <th>描述</th></tr></thead> <tbody><tr><td>Constructor</td> <td>占用内存的资源类型</td></tr> <tr><td>Distance</td> <td>当前对象到根的引用层级距离</td></tr> <tr><td>Shallow Size</td> <td>对象所占内存（不包含内部引用的其它对象所占的内存）(单位：字节)</td></tr> <tr><td>Retained Size</td> <td>对象所占总内存（包含内部引用的其它对象所占的内存）(单位：字节)</td></tr></tbody></table> <p>将每项展开可以查看更详细的数据信息。</p> <p>我们再次切回网页，继续操作几次，然后再次生成一个快照。</p> <p><img src="/images/base-js23.png" alt="base-js22"> <img src="/images/base-js24.png" alt="base-js24"> <img src="/images/base-js25.png" alt="base-js25"></p> <p>这边需要特别注意这个 <code>#Delta</code> ，如果是正值，就代表新生成的内存多，释放的内存少。其中的闭包项，如果是正值，就说明存在内存泄漏。</p> <p><img src="/images/base-js26.png" alt="base-js26"></p> <p>下面我们到代码里找一个内存泄漏的问题：</p> <p><img src="/images/base-js27.png" alt="base-js27"></p> <p><img src="/images/base-js28.png" alt="base-js28"></p> <h3 id="内存泄露的解决方案"><a href="#内存泄露的解决方案" class="header-anchor">#</a> 内存泄露的解决方案</h3> <ol><li>使用严格模式，避免不经意间的全局变量泄露：</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ReferenceError: b is not defined</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="2"><li>关注 <code>DOM</code> 生命周期，在销毁阶段记得解绑相关事件：</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isWrapDOM<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="3"><li>避免过度使用闭包。</li></ol> <h3 id="执行上下文"><a href="#执行上下文" class="header-anchor">#</a> 执行上下文</h3> <p><code>javascript</code> 标准把一段代码(包括函数),执行所需的所有信息定义为<code>执行上下文</code>,并且为函数规定了用来保存定义时上下文的私有属性[Environment]。</p> <p><strong>以下是在 <code>ES2018</code> 中的定义:</strong></p> <ul><li><p><code>lexical environment</code>: 词法环境,当前变量或者 this 值时使用。</p></li> <li><p><code>variable environment</code>: 变量环境,当声明变量时使用。</p></li> <li><p><code>code environment state</code>: 用于恢复代码执行位置。</p></li> <li><p><code>Function</code>: 执行的任务是函数时使用,表示正在执行的函数。</p></li> <li><p><code>ScriptOrModule</code>: 执行的任务是脚本或者模块时使用,表示正在被执行的代码。</p></li> <li><p><code>Realm</code>: 使用的基础库和内置对象实例。</p></li> <li><p><code>Generator</code>: 仅生成器上下文有这个属性,表示当前生成器。</p></li></ul> <p>当一个函数执行时,会创建一条新的执行环境,记录的外层词法(<code>outer lexical environment</code>)会被设置成函数的[Environment]。</p> <p>上述的这个动作就是切换上下文。</p> <h3 id="关于-this-对象"><a href="#关于-this-对象" class="header-anchor">#</a> 关于 <code>this</code> 对象</h3> <p>在闭包中使用<code>this</code>对象也可能会导致一些问题。我们知道,<code>this</code>对象是在运行时基于函数的执行环境绑定的：在全局函数中，<code>this</code>等于<code>window</code>，而当函数被作为某个对象的方法调用时，<code>this</code>等于那个对象。</p> <p><strong>不过，匿名函数的执行环境具有全局性，因此其 <code>this</code> 对象通常指向 <code>window</code>。</strong></p> <p>但有时候由于编写闭包的方式不同，这一点可能不会那么明显。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">&quot;The Window&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> object <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;My Object&quot;</span><span class="token punctuation">,</span>
  <span class="token function-variable function">getNameFunc</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>object<span class="token punctuation">.</span><span class="token function">getNameFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&quot;The Window&quot;（在非严格模式下）</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="模仿块级作用域"><a href="#模仿块级作用域" class="header-anchor">#</a> 模仿块级作用域</h3> <p><strong>早期的 <code>JavaScript</code> 没有块级作用域的概念。</strong> 这意味着在块语句中定义的变量，实际上是在包含函数中而非语句中创建的，来看下面的例子:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">outputNumbers</span><span class="token punctuation">(</span><span class="token parameter">count</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 计数</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>这个函数中定义了一个 <code>for</code> 循环，而变量<code>i</code>的初始值被设置为 0。</p> <p>在<code>JavaScrip</code>中，变量i是定义在 <code>ouputNumbers()</code>的活动对象中的，因此从它有定义开始，就可以在函数内部随处访问它。即使像下面这样错误地重新声明同一个变量，也不会改变它的值。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">outputNumbers</span><span class="token punctuation">(</span><span class="token parameter">count</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">var</span> i<span class="token punctuation">;</span> <span class="token comment">//重新声明变量</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//计数</span>
<span class="token punctuation">}</span>
<span class="token function">outputNumbers</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0 1 2 3 4 5 6 7 8 9 10</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="custom-block tip"><p class="title">TIP</p><p>匿名函数可以用来模仿块级作用域并避免这个问题。用作块级作用域（通常称为私有作用域）的匿名函数的语法如下所示:</p></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//这里是块级作用域</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>无论在什么地方，只要临时需要一些变量，就可以使用私有作用域，例如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">outputNumbers</span><span class="token punctuation">(</span><span class="token parameter">count</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">alert</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 导致一个错误！</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>引申: 为什么有的地方会出现以下这种在函数前面加上;的代码?</strong>
在此之前先看下面这段代码:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1111</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2222</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>如果上一行代码不写分号的话,括号就会被解释为上一行代码最末的函数调用,产生完全不符合预期,并且难以调式的行为,加号等运算符也有类似的问题。所以一些推荐不加分号的代码风格规范,会要求在括号前面加上分号。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1111</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>因此也就产生了上述的这种代码风格,当然一种更加推荐的做法是使用<code>void</code>关键字。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1111</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这样既能有效的避免了语法的问题,同时,语义上<code>void运算符</code>表示忽略后面表达式的值,变成了<code>undefined</code>,我们确认也不关心<code>IIFE</code>的返回值,所以语义也更为合理。</p> <h3 id="私有变量"><a href="#私有变量" class="header-anchor">#</a> 私有变量</h3> <p>严格来讲，<code>JavaScript</code> 中没有私有成员的概念；所有对象属性都是公有的。不过，倒是有一个私有变量的概念。任何在函数中定义的变量，都可以认为是私有变量，因为不能在函数的外部访问这些变量。</p> <p>私有变量包括函数的参数、局部变量和在函数内部定义的其他函数。来看下面的例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span> num2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> sum <span class="token operator">=</span> num1 <span class="token operator">+</span> num2<span class="token punctuation">;</span>
  <span class="token keyword">return</span> sum<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>我们把有权访问私有变量和私有函数的公有方法称为特权方法（<code>privileged method</code>）。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">MyObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 私有变量和私有函数</span>
  <span class="token keyword">var</span> privateVariable <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">privateFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 特权方法</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">publicMethod</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    privateVariable<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">privateFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>这个模式在构造函数内部定义了所有私有变量和函数。然后，又继续创建了能够访问这些私有成员的特权方法。能够在构造函数中定义特权方法，是因为特权方法作为闭包有权访问在构造函数中定义的所有变量和函数。</p> <p>对这个例子而言，变量 <code>privateVariable</code> 和函数 <code>privateFunction()</code>只能通过特权方法 <code>publicMethod()</code> 来访问。</p> <p>在创建 <code>MyObject</code> 的实例后，除了使用 <code>publicMethod()</code>这一个途径外，没有任何办法可以直接访问 <code>privateVariable</code> 和 <code>privateFunction()</code>。</p> <p><strong>利用私有和特权成员，可以隐藏那些不应该被直接修改的数据，例如：</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">getName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">setName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    name <span class="token operator">=</span> value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;Nicholas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;Nicholas&quot;</span>
person<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;Greg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;Greg&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <ol><li><p><code>javascript</code> 语言层面只原生支持两种作用域类型：<code>全局作用域</code> 和 <code>函数作用域</code> 。全局作用域程序运行就有，函数作用域只有定义函数的时候才有，它们之间是包含的关系。</p></li> <li><p>作用域之间是可以嵌套的，我们把这种嵌套关系称为 <code>作用域链</code>。</p></li> <li><p>可执行代码在作用域中查询变量时，只能查询 <code>本地作用域</code> 及 <code>上层作用域</code>，不能查找内部的函数作用域。JS 引擎搜索变量时，会先询问本地作用域，找到即返回，找不到再去询问上层作用域...层层往上，直到全局作用域。</p></li> <li><p><code>javascript</code> 中使用的是 词法作用域，因此函数作用域的范围在函数定义时就已经被确定，和函数在哪执行没有关系。</p></li></ol> <p><strong>当在函数内部定义了其他函数时，就创建了闭包。闭包有权访问包含函数内部的所有变量，原理如下:</strong></p> <ul><li><p>在后台执行环境中，闭包的作用域链包含着<code>它自己的作用域</code>、<code>包含函数的作用域</code>和<code>全局作用域</code>。</p></li> <li><p>通常，函数的作用域及其所有变量都会在函数执行结束后被销毁。</p></li> <li><p>但是，当函数返回了一个闭包时，这个函数的作用域将会一直在内存中保存到闭包不存在为止。</p></li> <li><p><strong>使用闭包<code>可以在 JavaScript 中模仿块级作用域（JavaScript 本身没有块级作用域的概念），</code>要点如下:</strong></p></li></ul> <ul><li>创建并立即调用一个函数，这样既可以执行其中的代码，又不会在内存中留下对该函数的引用。</li> <li>结果就是函数内部的所有变量都会被立即销毁——除非将某些变量赋值给了包含作用域（即外部作用域）中的变量。</li></ul> <ul><li><strong>闭包还可以用于在对象中创建私有变量，相关概念和要点如下。</strong></li></ul> <ul><li>即使 <code>JavaScript</code> 中没有正式的私有对象属性的概念，但可以使用闭包来实现公有方法，而通过公有方法可以访问在包含作用域中定义的变量。</li> <li>有权访问私有变量的公有方法叫做特权方法。</li> <li>可以使用<code>构造函数模式</code>、<code>原型模式来实现自定义类型的特权方法</code>，<code>也可以使用模块模式</code>、<code>增强的模块模式</code>来实现单例的特权方法。</li></ul> <p><code>JavaScript</code> 中的<code>函数表达式</code>和<code>闭包</code>都是极其有用的特性，利用它们可以实现很多功能。</p> <p>不过，因为创建闭包必须维护额外的作用域，所以过度使用它们可能会占用大量内存。</p> <h2 id="url编码方式"><a href="#url编码方式" class="header-anchor">#</a> url编码方式</h2> <p>url编码方式主要有两种：</p> <ol><li><code>encodeURI()</code>主要用于整个 URI（例如，http://www.wrox.com/illegal value.htm）。</li> <li><code>encodeURIComponent()</code>主要用于对 URI 中的某一段（例如前面 URI 中的 illegal value.htm）。</li></ol> <div class="custom-block tip"><p class="title">TIP</p><p><code>encodeURI()</code>不会对本身属于 <code>URI</code> 的特殊字符进行编码，例如冒号、正斜杠、问号和井字号； <code>encodeURIComponent()</code>则会对它发现的任何非标准字符进行编码。 对应解码方式为<code>decodeURI()</code>与<code>decodeURIComponent()</code>。</p></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> uri <span class="token operator">=</span> <span class="token string">&quot;http://www.wrox.com/illegal value.htm#start&quot;</span><span class="token punctuation">;</span> 
<span class="token comment">// &quot;http://www.wrox.com/illegal%20value.htm#start&quot; </span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token function">encodeURI</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token function">decodeURI</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 解码 </span>

<span class="token comment">// &quot;http%3A%2F%2Fwww.wrox.com%2Fillegal%20value.htm%23start&quot; </span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token function">decodeURIComponent</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 解码 </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="math对象"><a href="#math对象" class="header-anchor">#</a> Math对象</h2> <h3 id="常用方法"><a href="#常用方法" class="header-anchor">#</a> 常用方法</h3> <ul><li><code>min()</code>和<code>max()</code>方法</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> values <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">var</span> max <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>Math<span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> min <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>Math<span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><p><code>Math.ceil()</code>执行向上舍入，即它总是将数值向上舍入为最接近的整数；</p></li> <li><p><code>Math.floor()</code>执行向下舍入，即它总是将数值向下舍入为最接近的整数；</p></li> <li><p><code>Math.round()</code>执行标准舍入，即它总是将数值四舍五入为最接近的整数。</p></li> <li><p><code>Math.random()</code>返回大于等于0小于1的一个随机数。</p></li> <li><p><code>Math.abs(num)</code>返回<code>num</code>的绝对值。</p></li> <li><p><code>Math.pow(num,power)</code> 返回 <code>num</code> 的 <code>power</code> 次幂。 // 可以用来解决小数精度丢失的问题或者是去小数点位数的处理</p></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 返回指定区间的数</span>
<span class="token keyword">function</span> <span class="token function">selectFrom</span><span class="token punctuation">(</span><span class="token parameter">lowerValue<span class="token punctuation">,</span> upperValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token keyword">let</span> choices <span class="token operator">=</span> upperValue <span class="token operator">-</span> lowerValue <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> 
    <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> choices <span class="token operator">+</span> lowerValue<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token keyword">const</span> num <span class="token operator">=</span> <span class="token function">selectFrom</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">alert</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 介于 2 和 10 之间（包括 2 和 10）的一个数值</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="面向对象编程-oop重点"><a href="#面向对象编程-oop重点" class="header-anchor">#</a> 面向对象编程(oop重点)</h2> <p>面向对象编程(<code>Object Orient Programming</code>)简称<code>OOP</code>，是一种编程技术。</p> <p><code>JavaScript</code> 本身并没有类的概念，js中创建自定义对象的最简单方式就是创建一个 <code>Object</code> 的实例，然后再为它添加属性和方法，如下所示：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
person<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;Nicholas&quot;</span><span class="token punctuation">;</span> 
person<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">29</span><span class="token punctuation">;</span> 
person<span class="token punctuation">.</span>job <span class="token operator">=</span> <span class="token string">&quot;Software Engineer&quot;</span><span class="token punctuation">;</span> 
person<span class="token punctuation">.</span><span class="token function-variable function">sayName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>早期的 <code>JavaScript</code> 开发人员经常使用这个模式创建新对象。几年后，对象字面量成为创建这种对象的首选模式。前面的例子用对象字面量语法可以写成这样：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token punctuation">{</span> 
 <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;Nicholas&quot;</span><span class="token punctuation">,</span> 
 <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">29</span><span class="token punctuation">,</span> 
 <span class="token literal-property property">job</span><span class="token operator">:</span> <span class="token string">&quot;Software Engineer&quot;</span><span class="token punctuation">,</span> 
 <span class="token function-variable function">sayName</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
 	<span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token punctuation">}</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><em><code>ECMAScript</code>中有两种属性：<code>数据属性</code>和<code>访问器属性</code></em></p> <h3 id="数据属性"><a href="#数据属性" class="header-anchor">#</a> 数据属性</h3> <p><strong>数据属性包含一个数据值的位置。在这个位置可以读取和写入值。数据属性有 4 个描述其行为的特性：</strong></p> <ol><li><code>Configurable</code>：表示能否通过<code>delete</code>删除属性从而重新定义属性，能否修改属性的特性，或者能否把属性修改为访问器属性。直接在对象上定义的属性，它们的这个特性默认值为 <code>true</code>。</li> <li><code>Enumerable</code>: 表示能否通过 <code>for-in</code> 循环返回属性。直接在对象上定义的属性，它们的这个特性默认值为 <code>true</code>。</li> <li><code>Writable</code>：表示能否修改属性的值。直接在对象上定义的属性，它们的这个特性默认值为 <code>true</code>。</li> <li><code>Value</code>:包含这个属性的数据值。读取属性值的时候，从这个位置读；写入属性值的时候，把新值保存在这个位置。这个特性的默认值为 <code>undefined</code>。</li></ol> <div class="custom-block warning"><p class="title">WARNING</p><p>要修改属性默认的特性，必须使用 <code>ECMAScript5</code> 的<code>Object.defineProperty()</code>方法。</p></div><p>这个方法接收三个参数：<code>属性所在的对象</code>、<code>属性的名字</code>和<code>一个描述符对象</code>。</p> <p>其中，描述符对象的属性必须是：<code>configurable</code>、<code>enumerable</code>、<code>writable</code> 和 <code>value</code>。设置其中的一或多个值，可以修改对应的特性值。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> 
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> 
 <span class="token literal-property property">writable</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> 
 <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;Nicholas&quot;</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">alert</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;Nicholas&quot; </span>
person<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;Greg&quot;</span><span class="token punctuation">;</span> 
<span class="token function">alert</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;Nicholas&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="访问器属性"><a href="#访问器属性" class="header-anchor">#</a> 访问器属性</h3> <p><strong>访问器属性不包含数据值；它们包含一对儿 <code>getter</code> 和 <code>setter</code> 函数（不过，这两个函数都不是必需的）。</strong></p> <p>访问器属性有如下4个特性:</p> <ol><li><code>Configurable</code>：表示能否通过 <code>delete</code> 删除属性从而重新定义属性，能否修改属性的特性，或者能否把属性修改为数据属性。对于直接在对象上定义的属性，这个特性的默认值为true。</li> <li><code>Enumerable</code>：表示能否通过 <code>for-in</code> 循环返回属性。对于直接在对象上定义的属性，这个特性的默认值为 <code>true</code>。</li> <li><code>Get</code>：在读取属性时调用的函数。默认值为 <code>undefined</code>。</li> <li><code>Set</code>：在写入属性时调用的函数。默认值为 <code>undefined</code>。</li></ol> <div class="custom-block warning"><p class="title">WARNING</p><p>访问器属性不能直接定义，必须使用<code>Object.defineProperty()</code>来定义。</p></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> book <span class="token operator">=</span> <span class="token punctuation">{</span> 
    <span class="token literal-property property">_year</span><span class="token operator">:</span> <span class="token number">2004</span><span class="token punctuation">,</span> 
    <span class="token literal-property property">edition</span><span class="token operator">:</span> <span class="token number">1</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>book<span class="token punctuation">,</span> <span class="token string">&quot;year&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> 
    <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
 	    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_year<span class="token punctuation">;</span> 
    <span class="token punctuation">}</span><span class="token punctuation">,</span> 
    <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">newValue</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
	    <span class="token keyword">if</span> <span class="token punctuation">(</span>newValue <span class="token operator">&gt;</span> <span class="token number">2004</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
		    <span class="token keyword">this</span><span class="token punctuation">.</span>_year <span class="token operator">=</span> newValue<span class="token punctuation">;</span> 
		    <span class="token keyword">this</span><span class="token punctuation">.</span>edition <span class="token operator">+=</span> newValue <span class="token operator">-</span> <span class="token number">2004</span><span class="token punctuation">;</span> 
	    <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
book<span class="token punctuation">.</span>year <span class="token operator">=</span> <span class="token number">2005</span><span class="token punctuation">;</span> 
<span class="token function">alert</span><span class="token punctuation">(</span>book<span class="token punctuation">.</span>edition<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="读取属性的特性"><a href="#读取属性的特性" class="header-anchor">#</a> 读取属性的特性</h3> <p>使用 <code>ECMAScript5</code> 的 <code>Object.getOwnPropertyDescriptor()</code>方法，可以取得给定属性的描述符。</p> <p>这个方法接收两个参数：<code>属性所在的对象</code> 和 <code>要读取其描述符的属性名称</code>,返回值是一个对象。</p> <div class="custom-block tip"><p class="title">TIP</p><p>如果是访问器属性，这个对象的属性有 <code>configurable</code>、<code>enumerable</code>、<code>get</code> 和 <code>set</code>。</p> <p>如果是数据属性，这个对象的属性有 <code>configurable</code>、<code>enumerable</code>、<code>writable</code> 和 <code>value</code>。</p></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> book <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> 
Object<span class="token punctuation">.</span><span class="token function">defineProperties</span><span class="token punctuation">(</span>book<span class="token punctuation">,</span> <span class="token punctuation">{</span> 
    <span class="token literal-property property">_year</span><span class="token operator">:</span> <span class="token punctuation">{</span> 
 	    <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">2004</span> 
    <span class="token punctuation">}</span><span class="token punctuation">,</span> 
    <span class="token literal-property property">edition</span><span class="token operator">:</span> <span class="token punctuation">{</span> 
 	    <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">1</span> 
    <span class="token punctuation">}</span><span class="token punctuation">,</span> 
    <span class="token literal-property property">year</span><span class="token operator">:</span> <span class="token punctuation">{</span> 
	    <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
	 	    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_year<span class="token punctuation">;</span> 
	    <span class="token punctuation">}</span><span class="token punctuation">,</span> 
	    <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">newValue</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
		    <span class="token keyword">if</span> <span class="token punctuation">(</span>newValue <span class="token operator">&gt;</span> <span class="token number">2004</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
		        <span class="token keyword">this</span><span class="token punctuation">.</span>_year <span class="token operator">=</span> newValue<span class="token punctuation">;</span> 
		        <span class="token keyword">this</span><span class="token punctuation">.</span>edition <span class="token operator">+=</span> newValue <span class="token operator">-</span> <span class="token number">2004</span><span class="token punctuation">;</span> 
            <span class="token punctuation">}</span> 
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token keyword">var</span> descriptor <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptor</span><span class="token punctuation">(</span>book<span class="token punctuation">,</span> <span class="token string">&quot;_year&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">alert</span><span class="token punctuation">(</span>descriptor<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2004 </span>
<span class="token function">alert</span><span class="token punctuation">(</span>descriptor<span class="token punctuation">.</span>configurable<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> descriptor<span class="token punctuation">.</span>get<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;undefined&quot; </span>

<span class="token keyword">var</span> descriptor <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptor</span><span class="token punctuation">(</span>book<span class="token punctuation">,</span> <span class="token string">&quot;year&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">alert</span><span class="token punctuation">(</span>descriptor<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined </span>
<span class="token function">alert</span><span class="token punctuation">(</span>descriptor<span class="token punctuation">.</span>enumerable<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false </span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> descriptor<span class="token punctuation">.</span>get<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;function&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h3 id="设计模式"><a href="#设计模式" class="header-anchor">#</a> 设计模式</h3> <ol><li><strong>工厂模式</strong></li></ol> <p><code>工厂模式</code>是软件工程领域一种广为人知的设计模式，<code>这种模式抽象了创建具体对象的过程</code>。</p> <p>考虑到在<code>ECMAScript</code>中无法创建类，开发人员就发明了一种函数，用函数来封装以特定接口创建对象的细节，如下面的例子所示：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createPerson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    o<span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span> 
    o<span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span> 
    o<span class="token punctuation">.</span>job <span class="token operator">=</span> job<span class="token punctuation">;</span> 
    o<span class="token punctuation">.</span><span class="token function-variable function">sayName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span><span class="token punctuation">;</span> 
    <span class="token keyword">return</span> o<span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token keyword">var</span> person1 <span class="token operator">=</span> <span class="token function">createPerson</span><span class="token punctuation">(</span><span class="token string">&quot;Nicholas&quot;</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token string">&quot;Software Engineer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">var</span> person2 <span class="token operator">=</span> <span class="token function">createPerson</span><span class="token punctuation">(</span><span class="token string">&quot;Greg&quot;</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token string">&quot;Doctor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="custom-block tip"><p class="title">TIP</p><p>工厂模式虽然解决了创建多个相似对象的问题，但却没有解决对象识别的问题（即怎样知道一个对象的类型）,随着 <code>JavaScript</code> 的发展，又一个新模式出现了。</p></div><ol start="2"><li><strong>构造函数模式</strong></li></ol> <p>像 <code>Object</code> 和 <code>Array</code> 这样的原生构造函数，在运行时会自动出现在执行环境中。此外，也可以创建自定义的构造函数，从而定义自定义对象类型的属性和方法。例如，可以使用<code>构造函数模式</code>将前面的例子重写如下:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> job</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span> 
    <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span> 
    <span class="token keyword">this</span><span class="token punctuation">.</span>job <span class="token operator">=</span> job<span class="token punctuation">;</span> 
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">sayName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
 	    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token keyword">var</span> person1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;Nicholas&quot;</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token string">&quot;Software Engineer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">var</span> person2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;Greg&quot;</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token string">&quot;Doctor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>要创建 <code>Person</code> 的新实例，必须使用 <code>new</code> 操作符。以这种方式调用构造函数实际上会经历以下4个步骤：</p> <blockquote><ol><li>创建一个新对象；</li> <li>将构造函数的作用域赋给新对象（因此this就指向了这个新对象）；</li> <li>执行构造函数中的代码（为这个新对象添加属性）；</li> <li>返回新对象。</li></ol></blockquote> <p>构造函数模式虽然好用，但也并非没有缺点。使用构造函数的主要问题，<strong>就是每个方法都要在每个实例上重新创建一遍</strong>。</p> <p>在前面的例子中，<code>person1</code> 和 <code>person2</code> 都有一个名为 <code>sayName()</code> 的方法，但那两个方法不是同一个 <code>Function</code> 的实例。不要忘了——<code>ECMAScript</code> 中的<code>函数是对象</code>，因此每定义一个函数，也就是实例化了一个对象。从逻辑角度讲，此时的构造函数也可以这样定义:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> job</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span> 
    <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span> 
    <span class="token keyword">this</span><span class="token punctuation">.</span>job <span class="token operator">=</span> job<span class="token punctuation">;</span> 
    <span class="token keyword">this</span><span class="token punctuation">.</span>sayName <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token string">&quot;alert(this.name)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 与声明函数在逻辑上是等价的</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>从这个角度上来看构造函数，更容易明白每个 <code>Person</code> 实例都包含一个不同的 <code>Function</code> 实例（以显示 <code>name</code> 属性）的本质。 说明白些，以这种方式创建函数，会导致不同的作用域链和标识符解析，但创建 <code>Function</code> 新实例的机制仍然是相同的。因此，不同实例上的同名函数是不相等的，以下代码可以证明这一点。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">alert</span><span class="token punctuation">(</span>person1<span class="token punctuation">.</span>sayName <span class="token operator">==</span> person2<span class="token punctuation">.</span>sayName<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然而，创建两个完成同样任务的<code>Function</code>实例的确没有必要；况且有 <code>this</code> 对象在，根本不用在执行代码前就把函数绑定到特定对象上面。</p> <p>因此，大可像下面这样，通过把函数定义转移到构造函数外部来解决这个问题。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> job</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span> 
    <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span> 
    <span class="token keyword">this</span><span class="token punctuation">.</span>job <span class="token operator">=</span> job<span class="token punctuation">;</span> 
    <span class="token keyword">this</span><span class="token punctuation">.</span>sayName <span class="token operator">=</span> sayName<span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token keyword">function</span> <span class="token function">sayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token keyword">var</span> person1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;Nicholas&quot;</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token string">&quot;Software Engineer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">var</span> person2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;Greg&quot;</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token string">&quot;Doctor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>在这个例子中，我们把 <code>sayName()</code>函数的定义转移到了构造函数外部。而在构造函数内部，我们将 <code>sayName</code> 属性设置成等于全局 <code>sayName</code> 函数。这样一来，由于 <code>sayName</code> 包含的是一个指向函数的指针，因此 <code>person1</code> 和 <code>person2</code> 对象就共享了在全局作用域中定义的同一个 <code>sayName()</code>函数。</p> <p>这样做确实解决了两个函数做同一件事的问题，可是新问题又来了：在全局作用域中定义的函数实际上只能被某个对象调用，这让全局作用域有点名不副实。而更让人无法接受的是：如果对象需要定义很多方法，那么就要定义很多个全局函数，于是我们这个自定义的引用类型就丝毫没有封装性可言了。</p> <p>好在，这些问题可以通过使用<code>原型模式</code>来解决。</p> <ol start="3"><li><strong>原型模式</strong></li></ol> <p>我们创建的每个函数都有一个 <code>prototype（原型）</code>属性，这个属性是一个指针，指向一个对象，而这个对象的用途是包含可以由特定类型的所有实例共享的属性和方法。</p> <p>如果按照字面意思来理解，那么 <code>prototype</code> 就是 <strong>通过调用构造函数而创建的那个对象实例的原型对象</strong>。</p> <p><strong>使用原型对象的好处是可以让所有对象实例共享它所包含的属性和方法</strong>。换句话说，不必在构造函数中定义对象实例的信息，而是可以将这些信息直接添加到原型对象中，如下面的例子所示:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token punctuation">}</span> 

<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;Nicholas&quot;</span><span class="token punctuation">;</span> 
<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">29</span><span class="token punctuation">;</span> 
<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>job <span class="token operator">=</span> <span class="token string">&quot;Software Engineer&quot;</span><span class="token punctuation">;</span> 
<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
 <span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 

<span class="token keyword">var</span> person1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
person1<span class="token punctuation">.</span><span class="token function">sayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;Nicholas&quot; </span>
<span class="token keyword">var</span> person2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
person2<span class="token punctuation">.</span><span class="token function">sayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;Nicholas&quot; </span>
<span class="token function">alert</span><span class="token punctuation">(</span>person1<span class="token punctuation">.</span>sayName <span class="token operator">==</span> person2<span class="token punctuation">.</span>sayName<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>理解原型对象</strong></p> <p>无论什么时候，只要创建了一个新函数，就会根据一组特定的规则为该函数创建一个<code>prototype</code>属性，这个属性<strong>指向函数的原型对象</strong>。</p> <p>在默认情况下，所有原型对象都会自动获得一个 <code>constructor（构造函数）</code>属性，这个属性包含一个指向 <code>prototype</code> 属性所在函数的指针。</p> <p>就拿前面的例子来说，<code>Person.prototype.constructor</code> 指向 <code>Person</code>。而通过这个构造函数，我们还可继续为原型对象添加其他属性和方法。</p> <p>创建了自定义的构造函数之后，其原型对象默认只会取得 <code>constructor</code> 属性；至于其他方法，则都是从 <code>Object</code> 继承而来的。</p> <p>当调用构造函数创建一个新实例后，该实例的内部将包含一个指针（内部属性<code>__proto__</code>），指向构造函数的原型对象。</p> <p><img src="/images/base-js29.png" alt="base-hs29"></p> <div class="custom-block tip"><p class="title">TIP</p><p>虽然可以通过对象实例访问保存在原型中的值，但却不能通过对象实例重写原型中的值。</p></div><p>如果我们在实例中添加了一个属性，而该属性与实例原型中的一个属性同名，那就会优先去实例里面的该属性，该属性将会屏蔽原型中的那个属性。来看下面的例子:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token punctuation">}</span> 

<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;Nicholas&quot;</span><span class="token punctuation">;</span> 
<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">29</span><span class="token punctuation">;</span> 
<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>job <span class="token operator">=</span> <span class="token string">&quot;Software Engineer&quot;</span><span class="token punctuation">;</span> 
<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 

<span class="token keyword">var</span> person1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> person2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
person1<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;Greg&quot;</span><span class="token punctuation">;</span> 

<span class="token function">alert</span><span class="token punctuation">(</span>person1<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;Greg&quot;——来自实例</span>
<span class="token function">alert</span><span class="token punctuation">(</span>person2<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;Nicholas&quot;——来自原型</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>当为对象实例添加一个属性时，这个属性就会屏蔽原型对象中保存的同名属性；换句话说，添加这个属性只会阻止我们访问原型中的那个属性，但不会修改那个属性。</p> <p>即使将这个属性设置为 <code>null</code>，也只会在实例中设置这个属性，而不会恢复其指向原型的连接。</p> <p>不过，使用 <code>delete</code> 操作符则可以完全删除实例属性，从而让我们能够重新访问原型中的属性，如下所示:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token punctuation">}</span> 

<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;Nicholas&quot;</span><span class="token punctuation">;</span> 
<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">29</span><span class="token punctuation">;</span> 
<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>job <span class="token operator">=</span> <span class="token string">&quot;Software Engineer&quot;</span><span class="token punctuation">;</span> 
<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
 <span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 

<span class="token keyword">var</span> person1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">var</span> person2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
person1<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;Greg&quot;</span><span class="token punctuation">;</span> 
<span class="token function">alert</span><span class="token punctuation">(</span>person1<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;Greg&quot;——来自实例</span>
<span class="token function">alert</span><span class="token punctuation">(</span>person2<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;Nicholas&quot;——来自原型</span>

<span class="token keyword">delete</span> person1<span class="token punctuation">.</span>name<span class="token punctuation">;</span> 
<span class="token function">alert</span><span class="token punctuation">(</span>person1<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;Nicholas&quot;——来自原型</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><div class="custom-block tip"><p class="title">TIP</p><p>使用 <code>hasOwnProperty()</code>方法可以检测一个属性是存在于实例中，还是存在于原型中。</p> <p>这个方法（不要忘了它是从 <code>Object</code> 继承来的）只在给定属性存在于对象实例中时，才会返回 <code>true</code>。</p></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span> 

<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;Nicholas&quot;</span><span class="token punctuation">;</span> 
<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">29</span><span class="token punctuation">;</span> 
<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>job <span class="token operator">=</span> <span class="token string">&quot;Software Engineer&quot;</span><span class="token punctuation">;</span> 
<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
 <span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 

<span class="token keyword">var</span> person1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">var</span> person2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token function">alert</span><span class="token punctuation">(</span>person1<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false </span>
person1<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;Greg&quot;</span><span class="token punctuation">;</span> 
<span class="token function">alert</span><span class="token punctuation">(</span>person1<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;Greg&quot;——来自实例</span>
<span class="token function">alert</span><span class="token punctuation">(</span>person1<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true </span>
<span class="token function">alert</span><span class="token punctuation">(</span>person2<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;Nicholas&quot;——来自原型</span>
<span class="token function">alert</span><span class="token punctuation">(</span>person2<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false </span>

<span class="token keyword">delete</span> person1<span class="token punctuation">.</span>name<span class="token punctuation">;</span> 

<span class="token function">alert</span><span class="token punctuation">(</span>person1<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;Nicholas&quot;——来自原型</span>
<span class="token function">alert</span><span class="token punctuation">(</span>person1<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><div class="custom-block tip"><p class="title">TIP</p><p>要取得原型属性的描述符，必须直接在原型对象上调用<code>Object.getOwnPropertyDescriptor()</code>方法。</p> <p>同时使用 <code>hasOwnProperty()</code>方法和 <code>in</code> 操作符，就可以确定该属性到底是存在于对象中，还是存在于原型中。</p></div><p><a href="https://blog.csdn.net/ItDaChuang/article/details/120631851" target="_blank" rel="noopener noreferrer">补充说明<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 判断该属性是否是原型上的属性</span>
<span class="token keyword">function</span> <span class="token function">hasPrototypeProperty</span><span class="token punctuation">(</span><span class="token parameter">object<span class="token punctuation">,</span> name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">!</span>object<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>name <span class="token keyword">in</span> object<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="custom-block tip"><p class="title">TIP</p><p>在使用 <code>for-in</code> 循环时，返回的是所有能够通过对象访问的、可枚举的（<code>enumerated</code>）属性，其中既包括存在于实例中的属性，也包括存在于原型中的属性。屏蔽了原型中不可枚举属性（<code>即将Enumerable标记为false的属性</code>）的实例属性也会在<code>for-in</code>循环中返回。</p> <p>要取得对象上所有可枚举的实例属性，可以使用<code>Object.keys()</code>方法。这个方法接收一个对象作为参数，返回一个包含所有可枚举属性的字符串数组。</p></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span> 

<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;Nicholas&quot;</span><span class="token punctuation">;</span> 
<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">29</span><span class="token punctuation">;</span> 
<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>job <span class="token operator">=</span> <span class="token string">&quot;Software Engineer&quot;</span><span class="token punctuation">;</span> 
<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
 <span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 

<span class="token keyword">var</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">alert</span><span class="token punctuation">(</span>keys<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;name,age,job,sayName&quot; </span>

<span class="token keyword">var</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
p1<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;Rob&quot;</span><span class="token punctuation">;</span> 
p1<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">31</span><span class="token punctuation">;</span> 
<span class="token keyword">var</span> p1keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">alert</span><span class="token punctuation">(</span>p1keys<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;name,age&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><div class="custom-block tip"><p class="title">TIP</p><p>如果你想要得到所有实例属性，无论它是否可枚举，都可以使<code>Object.getOwnPropertyNames()</code>方法。</p></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyNames</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">alert</span><span class="token punctuation">(</span>keys<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;constructor,name,age,job,sayName&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="custom-block warning"><p class="title">WARNING</p><p>注意结果中包含了不可枚举的<code>constructor</code>属性。<code>Object.keys()</code>和 <code>Object.getOwnPropertyNames()</code>方法都可以用来替代<code>for-in</code> 循环。</p></div><p><strong>原型对象的问题</strong></p> <p>原型模式也不是没有缺点。首先，它省略了为构造函数传递初始化参数这一环节，结果所有实例在默认情况下都将取得相同的属性值。虽然这会在某种程度上带来一些不方便，但还不是原型的最大问题。</p> <p>原型模式的最大问题是由其共享的本性所导致的。原型中所有属性是被很多实例共享的，这种共享对于函数非常合适。对于那些包含基本值的属性倒也说得过去，通过在实例上添加一个同名属性，可以隐藏原型中的对应属性。然而，对于包含引用类型值的属性来说，问题就比较突出了,比如直接修改原型链上的数据，因为数据共享会导致其他实例的数据也一起变化。来看下面的例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token punctuation">}</span> 

<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span> 
    <span class="token literal-property property">constructor</span><span class="token operator">:</span> Person<span class="token punctuation">,</span> 
    <span class="token literal-property property">name</span> <span class="token operator">:</span> <span class="token string">&quot;Nicholas&quot;</span><span class="token punctuation">,</span> 
    <span class="token literal-property property">age</span> <span class="token operator">:</span> <span class="token number">29</span><span class="token punctuation">,</span> 
    <span class="token literal-property property">job</span> <span class="token operator">:</span> <span class="token string">&quot;Software Engineer&quot;</span><span class="token punctuation">,</span> 
    <span class="token literal-property property">friends</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Shelby&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Court&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
    <span class="token function-variable function">sayName</span> <span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
 	    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 

<span class="token keyword">var</span> person1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">var</span> person2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
person1<span class="token punctuation">.</span>friends<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;Van&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">alert</span><span class="token punctuation">(</span>person1<span class="token punctuation">.</span>friends<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;Shelby,Court,Van&quot; </span>
<span class="token function">alert</span><span class="token punctuation">(</span>person2<span class="token punctuation">.</span>friends<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;Shelby,Court,Van&quot; </span>
<span class="token function">alert</span><span class="token punctuation">(</span>person1<span class="token punctuation">.</span>friends <span class="token operator">===</span> person2<span class="token punctuation">.</span>friends<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p><code>Person.prototype</code> 对象有一个名为 <code>friends</code> 的属性，该属性包含一个字符串数组。 然后，创建了 <code>Person</code> 的两个实例。 修改了 <code>person1.friends</code> 引用的数组，向数组中添加了一个字符串。 由于 <code>friends</code> 数组存在于 <code>Person.prototype</code> 而非 <code>person1</code> 中，所以刚刚提到的修改也会通过<code>person2.friends</code>（与 <code>person1.friends</code> 指向同一个数组）反映出来。</p> <p>假如我们的初衷就是像这样在所有实例中共享一个数组，那么对这个结果我没有话可说。可是，实例一般都是要有属于自己的全部属性的。而这个问题正是我们很少看到有人单独使用原型模式的原因所在。</p> <ol start="4"><li><strong>组合使用构造函数模式和原型模式</strong></li></ol> <p><strong>创建自定义类型的最常见方式，就是<code>组合使用构造函数模式与原型模式</code>。</strong></p> <ul><li>构造函数模式用于定义实例属性，</li> <li>原型模式用于定义方法和共享的属性。</li></ul> <p>结果，每个实例都会有自己的一份实例属性的副本，但同时又共享着对方法的引用，最大限度地节省了内存。另外，这种混成模式还支持向构造函数传递参数；可谓是集两种模式之长。下面的代码重写了前面的例子:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> job</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span> 
    <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span> 
    <span class="token keyword">this</span><span class="token punctuation">.</span>job <span class="token operator">=</span> job<span class="token punctuation">;</span> 
    <span class="token keyword">this</span><span class="token punctuation">.</span>friends <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;Shelby&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Court&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 

<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span> 
    <span class="token literal-property property">constructor</span> <span class="token operator">:</span> Person<span class="token punctuation">,</span> 
    <span class="token function-variable function">sayName</span> <span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span> 

<span class="token keyword">var</span> person1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;Nicholas&quot;</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token string">&quot;Software Engineer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">var</span> person2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;Greg&quot;</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token string">&quot;Doctor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
person1<span class="token punctuation">.</span>friends<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;Van&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token function">alert</span><span class="token punctuation">(</span>person1<span class="token punctuation">.</span>friends<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;Shelby,Count,Van&quot; </span>
<span class="token function">alert</span><span class="token punctuation">(</span>person2<span class="token punctuation">.</span>friends<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;Shelby,Count&quot; </span>
<span class="token function">alert</span><span class="token punctuation">(</span>person1<span class="token punctuation">.</span>friends <span class="token operator">===</span> person2<span class="token punctuation">.</span>friends<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false </span>
<span class="token function">alert</span><span class="token punctuation">(</span>person1<span class="token punctuation">.</span>sayName <span class="token operator">===</span> person2<span class="token punctuation">.</span>sayName<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><ol start="5"><li>寄生构造函数模式</li></ol> <p>这种模式的基本思想是创建一个函数，该函数的作用仅仅是封装创建对象的代码，然后再返回新创建的对象； 但从表面上看，这个函数又很像是典型的构造函数。下面是一个例子:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> job</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
    <span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    o<span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span> 
    o<span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span> 
    o<span class="token punctuation">.</span>job <span class="token operator">=</span> job<span class="token punctuation">;</span> 
    o<span class="token punctuation">.</span><span class="token function-variable function">sayName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span><span class="token punctuation">;</span> 
    <span class="token keyword">return</span> o<span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token keyword">var</span> friend <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;Nicholas&quot;</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token string">&quot;Software Engineer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
friend<span class="token punctuation">.</span><span class="token function">sayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;Nicholas&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="继承"><a href="#继承" class="header-anchor">#</a> 继承</h3> <p>许多OO语言都支持两种继承方式：<code>接口继承</code> 和 <code>实现继承</code>。</p> <p><strong>接口继承只继承方法签名，而实现继承则继承实际的方法。</strong></p> <p>**如前所述，由于函数没有签名，在 <code>ECMAScript</code> 中无法实现接口继承。<code>ECMAScript</code> 只支持实现继承，而且其实现继承主要是依靠原型链来实现的。</p> <ol><li><strong>原型链继承</strong></li></ol> <blockquote><p>其基本思想是利用原型让一个引用类型继承另一个引用类型的属性和方法。</p></blockquote> <p>每个构造函数都有一个原型对象，原型对象都包含一个指向构造函数的指针，而实例都包含一个指向原型对象的内部指针。</p> <p>那么，假如我们让原型对象等于另一个类型的实例，结果会怎么样呢？</p> <p>显然，此时的原型对象将包含一个指向另一个原型的指针，相应地，另一个原型中也包含着一个指向另一个构造函数的指针。假如另一个原型又是另一个类型的实例，那么上述关系依然成立，如此层层递进，就构成了实例与原型的链条。这就是所谓原型链的基本概念。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// parent</span>
<span class="token keyword">function</span> <span class="token function">SuperType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
    <span class="token keyword">this</span><span class="token punctuation">.</span>property <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>

<span class="token class-name">SuperType</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getSuperValue</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>property<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// children</span>
<span class="token keyword">function</span> <span class="token function">SubType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>subproperty <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>

<span class="token class-name">SubType</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SuperType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">SubType</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getSubValue</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>subproperty<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SubType</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">alert</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span><span class="token function">getSuperValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token function">alert</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span><span class="token function">getSubValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
<span class="token function">alert</span><span class="token punctuation">(</span>instance <span class="token keyword">instanceof</span> <span class="token class-name">SuperType</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token function">alert</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>constructor<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// SuperType</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>实际上，不是<code>SubType</code>的原型的<code>constructor</code>属性被重写了，而是<code>SubType</code>的原型指向了另一个对象——<code>SuperType</code>的原型，而这个原型对象的 <code>constructor</code> 属性指向的是 <code>SuperType</code>。</p> <p>关系图如下:</p> <p><img src="/images/base-js30.png" alt="base-js30"></p> <p>事实上，前面例子中展示的原型链还少一环。我们知道，所有引用类型默认都继承了 <code>Object</code>，而这个继承也是通过原型链实现的。大家要记住，<strong>所有函数的默认原型都是 <code>Object</code> 的实例</strong>，因此默认原型都会包含一个内部指针，指向<code>Object.prototype</code>。这也正是所有自定义类型都会继承<code>toString()</code>、<code>valueOf()</code>等默认方法的根本原因。所以，我们说上面例子展示的原型链中还应该包括另外一个继承层次。</p> <p><img src="/images/base-js31.png" alt="base-js31"></p> <p>还有一点需要提醒读者，<strong>即在通过原型链实现继承时，不能使用对象字面量创建原型方法</strong>。因为这样做就会重写原型链，如下面的例子所示:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">SuperType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
    <span class="token keyword">this</span><span class="token punctuation">.</span>property <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token class-name">SuperType</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getSuperValue</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>property<span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token keyword">function</span> <span class="token function">SubType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
    <span class="token keyword">this</span><span class="token punctuation">.</span>subproperty <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token comment">//继承了 SuperType </span>
<span class="token class-name">SubType</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SuperType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//使用字面量添加新方法，会导致上一行代码无效</span>
<span class="token class-name">SubType</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span> 
 <span class="token function-variable function">getSubValue</span> <span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>subproperty<span class="token punctuation">;</span> 
 <span class="token punctuation">}</span><span class="token punctuation">,</span> 
 <span class="token function-variable function">someOtherMethod</span> <span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> 
 <span class="token punctuation">}</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token keyword">var</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SubType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">alert</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span><span class="token function">getSuperValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//error!</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><div class="custom-block warning"><p class="title">WARNING</p><p>原型链虽然很强大，可以用它来实现继承，但它也存在一些问题。</p> <p>其中，最主要的问题来自包含引用类型值的原型。想必大家还记得，我们前面介绍过包含引用类型值的原型属性会被所有实例共享。</p> <p>而这也正是为什么要在构造函数中，而不是在原型对象中定义属性的原因。在通过原型来实现继承时，原型实际上会变成另一个类型的实例。于是，原先的实例属性也就顺理成章地变成了现在的原型属性了。</p></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">SuperType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
    <span class="token keyword">this</span><span class="token punctuation">.</span>colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;red&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;blue&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;green&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
<span class="token keyword">function</span> <span class="token function">SubType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token punctuation">}</span> 
<span class="token comment">// 继承了 SuperType </span>
<span class="token class-name">SubType</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SuperType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">var</span> instance1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SubType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
instance1<span class="token punctuation">.</span>colors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;black&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">alert</span><span class="token punctuation">(</span>instance1<span class="token punctuation">.</span>colors<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&quot;red,blue,green,black&quot; </span>
<span class="token keyword">var</span> instance2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SubType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">alert</span><span class="token punctuation">(</span>instance2<span class="token punctuation">.</span>colors<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&quot;red,blue,green,black&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>原型链的第二个问题是：<strong>在创建子类型的实例时，不能向超类型的构造函数中传递参数</strong>。</p> <p>实际上应该说是没有办法在不影响所有对象实例的情况下，给超类型的构造函数传递参数。有鉴于此，再加上前面刚刚讨论过的由于原型中包含引用类型值所带来的问题，实践中很少会单独使用原型链。</p> <ol start="2"><li><strong>借用构造函数继承</strong></li></ol> <blockquote><p>这种技术的基本思想相当简单，即在子类型构造函数的内部调用超类型构造函数。</p></blockquote> <p>别忘了，函数只不过是在特定环境中执行代码的对象，因此通过使用 apply()和 call()方法也可以在（将来）新创建的对象上执行构造函数，如下所示：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">SuperType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
 <span class="token keyword">this</span><span class="token punctuation">.</span>colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;red&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;blue&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;green&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token keyword">function</span> <span class="token function">SubType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
 <span class="token comment">//继承了 SuperType </span>
 <span class="token function">SuperType</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token keyword">var</span> instance1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SubType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
instance1<span class="token punctuation">.</span>colors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;black&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">alert</span><span class="token punctuation">(</span>instance1<span class="token punctuation">.</span>colors<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&quot;red,blue,green,black&quot; </span>
<span class="token keyword">var</span> instance2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SubType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">alert</span><span class="token punctuation">(</span>instance2<span class="token punctuation">.</span>colors<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&quot;red,blue,green&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>通过使用 <code>call()</code>方法（或 <code>apply()</code>方法也可以）修改this指向实例本身，避免公用原型数据，我们实际上是在（未来将要）新创建的 <code>SubType</code> 实例的环境下调用了 <code>SuperType</code> 构造函数。</p> <p><strong>这样一来，就会在新 <code>SubType</code> 对象上执行 <code>SuperType()</code>函数中定义的所有对象初始化代码。结果，<code>SubType</code> 的每个实例就都会具有自己的 <code>colors</code> 属性的副本了。</strong></p> <p><strong>传递参数</strong></p> <p>相对于原型链而言，借用构造函数有一个很大的优势，<strong>即可以在子类型构造函数中向超类型构造函数传递参数</strong>。看下面这个例子:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">SuperType</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token keyword">function</span> <span class="token function">SubType</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
    <span class="token comment">// 继承了 SuperType，同时还传递了参数</span>
    <span class="token function">SuperType</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">// 实例属性</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token keyword">var</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SubType</span><span class="token punctuation">(</span><span class="token string">'yh'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">alert</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&quot;Nicholas&quot;; </span>
<span class="token function">alert</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//29</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>借用构造函数的问题</strong></p> <p>如果仅仅是借用构造函数，那么也将无法避免构造函数模式存在的问题——方法都在构造函数中定义，函数复用就无从谈起了。而且，在超类型的原型中定义的方法，对子类型而言也是不可见的，结果所有类型都只能使用构造函数模式。考虑到这些问题，借用构造函数的技术也是很少单独使用的。</p> <ol start="3"><li><strong>组合继承</strong></li></ol> <p><code>组合继承（combination inheritance）</code>，有时候也叫做<code>伪经典继承</code>，指的是将原型链和借用构造函数的技术组合到一块，从而发挥二者之长的一种继承模式。</p> <blockquote><p>其背后的思路是使用原型链实现对原型属性和方法的继承，而通过借用构造函数来实现对实例属性的继承。</p></blockquote> <p>这样，既通过在原型上定义方法实现了函数复用，又能够保证每个实例都有它自己的属性。下面来看一个例子:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">SuperType</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
	<span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span> 
	<span class="token keyword">this</span><span class="token punctuation">.</span>colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;red&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;blue&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;green&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token class-name">SuperType</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
	<span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">SubType</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">// 继承属性</span>
	<span class="token function">SuperType</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age
<span class="token punctuation">}</span>
<span class="token comment">// 继承方法</span>
<span class="token class-name">SubType</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SuperType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">SubType</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> SubType<span class="token punctuation">;</span>
<span class="token class-name">SubType</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayAge</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> instance1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SubType</span><span class="token punctuation">(</span><span class="token string">&quot;Nicholas&quot;</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
instance1<span class="token punctuation">.</span>colors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;black&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">alert</span><span class="token punctuation">(</span>instance1<span class="token punctuation">.</span>colors<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&quot;red,blue,green,black&quot; </span>
instance1<span class="token punctuation">.</span><span class="token function">sayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&quot;Nicholas&quot;; </span>
instance1<span class="token punctuation">.</span><span class="token function">sayAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//29 </span>
<span class="token keyword">var</span> instance2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SubType</span><span class="token punctuation">(</span><span class="token string">&quot;Greg&quot;</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">alert</span><span class="token punctuation">(</span>instance2<span class="token punctuation">.</span>colors<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&quot;red,blue,green&quot; </span>
instance2<span class="token punctuation">.</span><span class="token function">sayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&quot;Greg&quot;; </span>
instance2<span class="token punctuation">.</span><span class="token function">sayAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//27</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><div class="custom-block tip"><p class="title">TIP</p><p>组合继承避免了原型链和借用构造函数的缺陷，融合了它们的优点，成为JavaScript中最常用的继承模式。</p></div><ol start="4"><li><strong>原型式继承</strong></li></ol> <blockquote><p>这种方法并没有使用严格意义上的构造函数。他的想法是借助原型可以基于已有的对象创建新对象，同时还不必因此创建自定义类型。</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">object</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
	<span class="token keyword">function</span> <span class="token constant">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span> 
	<span class="token class-name">F</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> o<span class="token punctuation">;</span> 
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>在<code>object()</code>函数内部，先创建了一个临时性的构造函数，然后将传入的对象作为这个构造函数的原型，最后返回了这个临时类型的一个新实例。从本质上讲，<code>object()</code>对传入其中的对象执行了一次浅复制。来看下面的例子:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">name</span> <span class="token operator">:</span> <span class="token string">&quot;Nicholas&quot;</span><span class="token punctuation">,</span>
	<span class="token literal-property property">frineds</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Shelby&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;court&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Van&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> anotherPerson <span class="token operator">=</span> <span class="token function">object</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
anotherPerson<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;Greg&quot;</span><span class="token punctuation">;</span>
anotherPerson<span class="token punctuation">.</span>friends<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;Rob&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> yetAnotherPerson <span class="token operator">=</span> <span class="token function">object</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
yetAnotherPerson<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;Linda&quot;</span><span class="token punctuation">;</span>
yetAnotherPerson<span class="token punctuation">.</span>friends<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;Barbie&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>friends<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// &quot;Shelby,Court,Van,Rob,Barbie&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="custom-block tip"><p class="title">TIP</p><p><code>Object.create()</code>方法规范化了原型式继承。</p> <p>这个方法接收两个参数：一个用作新对象原型的对象和（可选的）一个为新对象定义额外属性的对象。在传入一个参数的情况下，<code>Object.create()</code>与 <code>object()</code>方法的行为相同。</p></div><ol start="5"><li><strong>寄生式继承</strong></li></ol> <blockquote><p>寄生式继承的思路与寄生构造函数和工厂模式类似，即创建一个仅用于封装继承过程的函数，该函数在内部以某种方式来增强对象，最后再像真地是它做了所有工作一样返回对象。</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createAnother</span><span class="token punctuation">(</span><span class="token parameter">original</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">var</span> clone <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>original<span class="token punctuation">)</span><span class="token punctuation">;</span>
	clone<span class="token punctuation">.</span><span class="token function-variable function">sayHi</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;Hi&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> clone
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>在这个例子中，<code>createAnother()</code>函数接收了一个参数，也就是将要作为新对象基础的对象。然后，把这个对象（<code>original</code>）传递给 <code>object()</code>函数，将返回的结果赋值给 <code>clone</code>。再为 <code>clone</code> 对象添加一个新方法 <code>sayHi()</code>，最后返回 <code>clone</code> 对象。可以像下面这样来使用 <code>createAnother()</code>函数：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token punctuation">{</span> 
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;Nicholas&quot;</span><span class="token punctuation">,</span> 
    <span class="token literal-property property">friends</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Shelby&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Court&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Van&quot;</span><span class="token punctuation">]</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token keyword">var</span> anotherPerson <span class="token operator">=</span> <span class="token function">createAnother</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span> 
anotherPerson<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&quot;hi&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="6"><li><strong>寄生组合式继承</strong></li></ol> <p>前面说过，组合继承是 <code>JavaScript</code> 最常用的继承模式；不过，它也有自己的不足。</p> <p>组合继承最大的问题就是<strong>无论什么情况下，都会调用两次超类型构造函数</strong>：一次是在创建子类型原型的时候，另一次是在子类型构造函数内部。没错，子类型最终会包含超类型对象的全部实例属性，但我们不得不在调用子类型构造函数时重写这些属性。</p> <blockquote><p>所谓<code>寄生组合式继承</code>，即通过借用构造函数来继承属性，通过原型链的混成形式来继承方法。其背后的基本思路是：不必为了指定子类型的原型而调用超类型的构造函数，我们所需要的无非就是超类型原型的一个副本而已。本质上，就是使用寄生式继承来继承超类型的原型，然后再将结果指定给子类型的原型</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">inheritPrototype</span><span class="token punctuation">(</span><span class="token parameter">subType<span class="token punctuation">,</span> superType</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
    <span class="token keyword">var</span> prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>superType<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//创建对象</span>
    prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> subType<span class="token punctuation">;</span> <span class="token comment">//增强对象</span>
    subType<span class="token punctuation">.</span>prototype <span class="token operator">=</span> prototype<span class="token punctuation">;</span> <span class="token comment">//指定对象</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">SuperType</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span> 
    <span class="token keyword">this</span><span class="token punctuation">.</span>colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;red&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;blue&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;green&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token class-name">SuperType</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token keyword">function</span> <span class="token function">SubType</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
    <span class="token function">SuperType</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token function">inheritPrototype</span><span class="token punctuation">(</span>SubType<span class="token punctuation">,</span> SuperType<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token class-name">SubType</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayAge</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SubType</span><span class="token punctuation">(</span><span class="token string">'yh'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>这个例子的高效率体现在它只调用了一次<code>SuperType</code>构造函数，并且因此避免了在 <code>SubType.prototype</code> 上面创建不必要的、多余的属性。与此同时，原型链还能保持不变；因此，还能够正常使用<code>instanceof</code>和 <code>isPrototypeOf()</code>。开发人员普遍认为寄生组合式继承是引用类型最理想的继承范式。</p> <h2 id="原型链"><a href="#原型链" class="header-anchor">#</a> 原型链</h2> <p><code>JavaScript</code> 中没有类的概念的，主要通过原型链来实现继承。通常情况下，继承意味着复制操作，然而 <code>JavaScript</code> 默认并不会复制对象的属性，相反，<code>JavaScript</code> 只是在两个对象之间创建一个关联（原型对象指针），这样，一个对象就可以通过委托访问另一个对象的属性和函数，所以与其叫继承，委托的说法反而更准确些。</p> <h3 id="原型"><a href="#原型" class="header-anchor">#</a> 原型</h3> <hr> <blockquote><p>当我们 <code>new</code> 了一个新的对象实例，明明什么都没有做，就直接可以访问 <code>toString</code> 、<code>valueOf</code> 等原生方法。那么这些方法是从哪里来的呢？答案就是<code>原型</code>。</p></blockquote> <p><img src="/images/base-js32.png" alt="base-js32"></p> <p>在控制台打印一个空对象时，我们可以看到，有很多方法，已经<code>“初始化”</code>挂载在内置的 <code>__proto__</code> 对象上了。</p> <p>这个内置的 <code>__proto__</code> 是一个<strong>指向原型对象的指针</strong>，它会在创建一个新的引用类型对象时（显示或者隐式）自动创建，并挂载到新实例上。</p> <p>当我们尝试访问实例对象上的某一属性或者方法时，如果实例对象上有该属性或者方法时，就返回实例属性或者方法。</p> <p>如果没有，就去 <code>__proto__</code> 指向的原型对象上查找对应的属性或者方法。这就是为什么我们尝试访问空对象的 <code>toString</code> 和 <code>valueOf</code> 等方法依旧能访问到的原因，<code>JavaScript</code> <code>正是以这种方式为基础来实现继承的</code>。</p> <h3 id="构造函数"><a href="#构造函数" class="header-anchor">#</a> 构造函数</h3> <hr> <p>如果说实例的 <code>__proto__</code> 只是一个指向原型对象的指针，那就说明在此之前原型对象就已经创建了，那么原型对象是什么时候被创建的呢？这就要引入<code>构造函数</code>的概念。</p> <p>其实构造函数也就只是一个普通的函数而已，如果这个函数可以使用 <code>new</code> 关键字来创建它的实例对象，那么我们就把这种函数称为 构造函数。</p> <p>原型对象正是在构造函数被声明时一同创建的。构造函数被申明时，原型对象也一同完成创建，然后挂载到构造函数的 <code>prototype</code> 属性上：</p> <p><img src="/images/base-js33.png" alt="base-js33"></p> <p>原型对象被创建时，会自动生成一个 <code>constructor</code> 属性，指向创建它的构造函数。这样它俩的关系就被紧密地关联起来了。</p> <div class="custom-block tip"><p class="title">TIP</p><p>细心的话，你可能会发现，原型对象也有自己的 <code>__proto__</code> ，这也不奇怪，毕竟万物皆对象嘛。</p> <p>原型对象的 <code>__proto__</code> 指向的是 <code>Object.prototype</code>。那么 <code>Object.prototype.__proto__</code> 存不存在呢？其实是不存在的，打印的话会发现是 <code>null</code> 。这也证明了 <code>Object</code> 是 <code>JavaScript</code> 中数据类型的起源。</p></div><p>我们可以用一张图来表示这个关系：</p> <p><img src="/images/base-js34.png" alt="base-js34"></p> <h3 id="原型链-2"><a href="#原型链-2" class="header-anchor">#</a> 原型链</h3> <hr> <p>说完了原型，就可以来说说原型链了，如果理解了原型机制，原型链就很好解释了。其实上面一张图上，那条被 <code>__proto__</code> 链接起来的链式关系，就称为<strong>原型链</strong>。</p> <p>原型链的作用：原型链如此的重要的原因就在于它决定了 <code>JavaScript</code> 中继承的实现方式。当我们访问一个属性时，查找机制如下：</p> <ul><li><p>访问对象实例属性，有则返回，没有就通过 <code>__proto__</code> 去它的原型对象查找。</p></li> <li><p>原型对象找到即返回，找不到，继续通过原型对象的 <code>__proto__</code> 查找。</p></li> <li><p>一层一层一直找到 <code>Object.prototype</code> ，如果找到目标属性即返回，找不到就返回 <code>undefined</code>，不会再往下找，因为在往下找 <code>__proto__</code> 就是 <code>null</code> 了。</p></li></ul> <p>通过上面的解释，对于构造函数生成的实例，我们应该能了解它的原型对象了。<code>JavaScript</code> 中万物皆对象，那么构造函数肯定也是个对象，是对象就有 <code>__proto__</code> ，那么构造函数的 <code>__proto__</code> 是什么？</p> <p>通过上面的解释，对于构造函数生成的实例，我们应该能了解它的原型对象了。<code>JavaScript</code> 中万物皆对象，那么构造函数肯定也是个对象，是对象就有 <code>__proto__</code> ，那么构造函数的 <code>__proto__</code> 是什么？</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Person</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype <span class="token operator">===</span> <span class="token class-name">Function</span><span class="token punctuation">.</span>prototype <span class="token comment">// false</span>
Person<span class="token punctuation">.</span>__proto__  <span class="token operator">===</span> Function<span class="token punctuation">.</span>__proto__ <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这里需要注意的是: <code>Function.__proto__ === Function.prototype</code>。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>String<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> <span class="token class-name">Function</span><span class="token punctuation">.</span>prototype
<span class="token comment">// true</span>
Number<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> <span class="token class-name">Function</span><span class="token punctuation">.</span>prototype
<span class="token comment">// true</span>
Boolean<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> <span class="token class-name">Function</span><span class="token punctuation">.</span>prototype
<span class="token comment">// true</span>
Array<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> <span class="token class-name">Function</span><span class="token punctuation">.</span>prototype
<span class="token comment">// true</span>
Function<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> <span class="token class-name">Function</span><span class="token punctuation">.</span>prototype
<span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>至于为什么 <code>Function.__proto__</code> 等于 <code>Function.prototype</code> 有这么几种说法：</p> <ol><li>为了保持与其他函数保持一致。</li> <li>为了说明一种关系，比如证明所有的函数都是 <code>Function</code> 的实例。</li> <li>函数都是可以调用 <code>call</code>、<code>bind</code> 这些内置 <code>API</code> 的，这么写可以很好的保证函数实例能够使用这些 <code>API</code>。</li></ol> <div class="custom-block warning"><p class="title">WARNING</p><p><strong>关于原型、原型链和构造函数有几点需要注意</strong>：</p> <ul><li><code>__proto__</code> 是非标准属性，如果要访问一个对象的原型，建议使用 <code>ES6</code> 新增的 <code>Reflect.getPrototypeOf</code> 或者 <code>Object.getPrototypeOf()</code> 方法，而不是直接 <code>obj.__proto__</code>，因为非标准属性意味着未来可能直接会修改或者移除该属性。同理，当改变一个对象的原型时，最好也使用 <code>ES6</code> 提供的 <code>Reflect.setPrototypeOf</code> 或 <code>Object.setPrototypeOf</code>。</li></ul> <div class="language-md line-numbers-mode"><pre class="language-md"><code>let target = {};
let newProto = {};
Reflect.getPrototypeOf(target) === newProto; // false
Reflect.setPrototypeOf(target, newProto);
Reflect.getPrototypeOf(target) === newProto; // true
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><p>函数都会有 <code>prototype</code> ，除了 <code>Function.prototype.bind()</code> 之外。</p></li> <li><p>对象都会有 <code>__proto__</code> ，除了 <code>Object.prototype</code> 之外（其实它也是有的，之不过是 <code>null</code>）。</p></li> <li><p>所有函数都由 <code>Function</code> 创建而来，也就是说他们的<code>__proto__</code> 都等于 <code>Function.prototype</code>。</p></li> <li><p><code>Function.prototype</code> 等于 <code>Function.__proto__</code> 。</p></li></ul></div><h3 id="原型污染"><a href="#原型污染" class="header-anchor">#</a> 原型污染</h3> <hr> <blockquote><p>原型污染是指：攻击者通过某种手段修改 <code>JavaScript</code> 对象的原型。</p></blockquote> <p>举个例子,如果我们把 <code>Object.prototype.toString</code> 改成这样：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">toString</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>那么当我们运行这段代码的时候浏览器就会弹出一个 <code>alert</code>，对象原生的 <code>toString</code> 方法被改写了，所有对象当调用 <code>toString</code> 时都会受到影响。</p> <p>你可能会说，怎么可能有人傻到在源码里写这种代码，这不是搬起石头砸自己的脚么？没错，没人会在源码里这么写，但是攻击者可能会通过表单或者修改请求内容等方式使用原型污染发起攻击，来看下面一种情况：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;body-parser&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cookieParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;cookie-parser&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">isObject</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> obj <span class="token operator">&amp;&amp;</span> obj<span class="token punctuation">.</span>constructor <span class="token operator">&amp;&amp;</span> obj<span class="token punctuation">.</span>constructor <span class="token operator">===</span> Object<span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> attr <span class="token keyword">in</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>attr<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isObject</span><span class="token punctuation">(</span>b<span class="token punctuation">[</span>attr<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">merge</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>attr<span class="token punctuation">]</span><span class="token punctuation">,</span> b<span class="token punctuation">[</span>attr<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      a<span class="token punctuation">[</span>attr<span class="token punctuation">]</span> <span class="token operator">=</span> b<span class="token punctuation">[</span>attr<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> a<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">clone</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Constants</span>
<span class="token keyword">const</span> <span class="token constant">PORT</span> <span class="token operator">=</span> <span class="token number">8080</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">HOST</span> <span class="token operator">=</span> <span class="token string">&quot;0.0.0.0&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> admin <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// App</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cookieParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;views&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/signup&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> body <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> copybody <span class="token operator">=</span> <span class="token function">clone</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>copybody<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> copybody<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token string">&quot;cookie set&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">&quot;cookie not set&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/getFlag&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> аdmin <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>cookies<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>admin<span class="token punctuation">.</span>аdmin <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;hackim19{}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;You are not authorized&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token constant">PORT</span><span class="token punctuation">,</span> <span class="token constant">HOST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Running on http://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">HOST</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">PORT</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br></div></div><p>如果服务器中有上述的代码片段，攻击者只要将 <code>cookie</code> 设置成{<code>__proto__: {admin: 1}</code>} 就能完成系统的侵入。</p> <h3 id="原型污染的解决方案"><a href="#原型污染的解决方案" class="header-anchor">#</a> 原型污染的解决方案</h3> <hr> <p>在看原型污染的解决方案之前，我们可以看下 <code>lodash</code> 团队之前解决原型污染问题的手法：</p> <p><img src="/images/base-js35.png" alt="base-js35"></p> <hr> <p><img src="/images/base-js36.png" alt="base-js36"></p> <p>代码很简单，只要是碰到有 <code>constructor</code> 或者 <code>__proto__</code> 这样的敏感词汇，就直接退出执行了。这当然是一种防止原型污染的有效手段，当然我们还有其他手段：</p> <ol><li>使用 <code>Object.create(null)</code>， 方法创建一个原型为 <code>null</code> 的新对象，这样无论对 原型做怎样的扩展都不会生效：</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">hack</span><span class="token operator">:</span> <span class="token string">&quot;污染原型的属性&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; {}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>hack<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; undefined</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li>使用 <code>Object.freeze(obj)</code> 冻结指定对象，使之不能被修改属性，成为不可扩展对象：</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Object<span class="token punctuation">.</span><span class="token function">freeze</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString <span class="token operator">=</span> <span class="token string">&quot;evil&quot;</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// =&gt; ƒ toString() { [native code] }</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="3"><li>建立 <code>JSON schema</code> ，在解析用户输入内容时，通过 <code>JSON schema</code> 过滤敏感键名。</li> <li>规避不安全的递归性合并。这一点类似 <code>lodash</code> 修复手段，完善了合并操作的安全性，对敏感键名跳过处理。</li></ol> <h2 id="form表单脚本"><a href="#form表单脚本" class="header-anchor">#</a> form表单脚本</h2> <hr> <p>###表单的基础知识</p> <p>在 <code>HTML</code> 中，表单是由<code>&lt;form&gt;</code>元素来表示的，而在 <code>JavaScript</code> 中，表单对应的则是 <code>HTMLFormElement类型</code>。<code>HTMLFormElement</code> 继承了 <code>HTMLElement</code>，因而与其他 <code>HTML</code> 元素具有相同的默认属性。不过，<code>HTMLFormElement</code> 也有它自己下列独有的属性和方法。</p> <ul><li><code>acceptCharset</code>：服务器能够处理的字符集；等价于 <code>HTML</code> 中的 <code>accept-charset</code> 特性。</li> <li><code>action</code>：接受请求的 <code>URL</code>；等价于 <code>HTML</code> 中的 <code>action</code> 特性。</li> <li><code>length</code>：表单中控件的数量。</li> <li><code>method</code>：要发送的 <code>HTTP</code> 请求类型，通常是<code>get</code>或<code>post</code>；等价于 <code>HTML</code> 的 <code>method</code> 特性。</li> <li><code>name</code>：表单的名称；等价于 <code>HTML</code> 的 <code>name</code> 特性。</li> <li><code>reset()</code>：将所有表单域重置为默认值。</li> <li><code>submit()</code>：提交表单。</li> <li><code>target</code>：用于发送请求和接收响应的窗口名称；等价于 <code>HTML</code> 的 <code>target</code> 特性。</li></ul> <h3 id="提交表单"><a href="#提交表单" class="header-anchor">#</a> 提交表单</h3> <p>用户单击提交按钮或图像按钮时，就会提交表单。使用<code>&lt;input&gt;</code>或<code>&lt;button&gt;</code>都可以定义提交按钮，只要将其 <code>type</code> 特性的值设置为 <code>submit</code> 即可，而图像按钮则是通过将 <code>&lt;input&gt;的type</code> 特性值设置为<code>image</code>来定义的。因此，只要我们单击以下代码生成的按钮，就可以提交表单。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- 通用提交按钮 --&gt;</span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Submit Form<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> 
<span class="token comment">&lt;!-- 自定义提交按钮 --&gt;</span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Submit Form<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span> 
<span class="token comment">&lt;!-- 图像按钮 --&gt;</span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>image<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>graphic.gif<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>或者使用</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 提交表单</span>
form<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="custom-block warning"><p class="title">WARNING</p><p>提交表单时可能出现的最大问题，就是重复提交表单。在第一次提交表单后，如果长时间没有反应，用户可能会变得不耐烦。这时候，他们也许会反复单击提交按钮。结果往往很麻烦（因为服务器要处理重复的请求），或者会造成错误（如果用户是下订单，那么可能会多订好几份）。</p></div><p><strong>解决这一问题的办法有两个:</strong></p> <p>在第一次提交表单后就禁用提交按钮
利用 <code>onsubmit</code> 事件处理程序取消后续的表单提交操作。</p> <h3 id="重置表单"><a href="#重置表单" class="header-anchor">#</a> 重置表单</h3> <p>在用户单击重置按钮时，表单会被重置。使用 <code>type</code> 特性值为<code>reset</code>的<code>&lt;input&gt;</code>或<code>&lt;button&gt;</code>都可以创建重置按钮，如下面的例子所示：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- 通用重置按钮 --&gt;</span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>reset<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Reset Form<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> 
<span class="token comment">&lt;!-- 自定义重置按钮 --&gt;</span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>reset<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Reset Form<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>与提交表单一样，也可以通过 JavaScript 来重置表单，如下面的例子所示:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 重置表单</span>
form<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="操作富文本"><a href="#操作富文本" class="header-anchor">#</a> 操作富文本</h3> <p>与富文本编辑器交互的主要方式，就是使用 <code>document.execCommand()</code>。这个方法可以对文档执行预定义的命令，而且可以应用大多数格式。</p> <p><img src="/images/base-js38.png" alt="base-js38"> <img src="/images/base-js37.png" alt="base-js37"></p> <h2 id="canvans绘图"><a href="#canvans绘图" class="header-anchor">#</a> canvans绘图</h2> <div class="custom-block tip"><p class="title">TIP</p><p>要使用<code>&lt;canvas&gt;</code>元素，必须先设置其 <code>width</code> 和 <code>height</code> 属性，指定可以绘图的区域大小。</p></div><div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> 
	<span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>drawing<span class="token punctuation">&quot;</span></span> 
	<span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span> 200<span class="token punctuation">&quot;</span></span> 
	<span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>200<span class="token punctuation">&quot;</span></span>
<span class="token punctuation">&gt;</span></span>A drawing of something.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="检测是否支持canvas绘制"><a href="#检测是否支持canvas绘制" class="header-anchor">#</a> 检测是否支持canvas绘制</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> drawing <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;drawing&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>drawing <span class="token operator">&amp;&amp;</span> drawing<span class="token punctuation">.</span>getContext<span class="token punctuation">)</span><span class="token punctuation">{</span>
    	<span class="token keyword">const</span> context <span class="token operator">=</span> drawing<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;2d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="图像导出"><a href="#图像导出" class="header-anchor">#</a> 图像导出</h3> <p>使用 <code>toDataURL()</code>方法，可以导出在<code>&lt;canvas&gt;</code>元素上绘制的图像。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> drawing <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;drawing&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 确定浏览器支持&lt;canvas&gt;元素</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>drawing<span class="token punctuation">.</span>getContext<span class="token punctuation">)</span><span class="token punctuation">{</span> 
    <span class="token comment">// 取得图像的数据 URI </span>
    <span class="token keyword">var</span> imgURI <span class="token operator">=</span> drawing<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token string">&quot;image/png&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">// 显示图像</span>
    <span class="token keyword">var</span> image <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;img&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    image<span class="token punctuation">.</span>src <span class="token operator">=</span> imgURI<span class="token punctuation">;</span> 
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="custom-block tip"><p class="title">TIP</p><p>默认情况下，浏览器会将图像编码为 PNG 格式（除非另行指定）。</p></div><h3 id="_2d-上下文"><a href="#_2d-上下文" class="header-anchor">#</a> 2D 上下文</h3> <p>使用 2D 绘图上下文提供的方法，可以绘制简单的 2D 图形，比如矩形、弧线和路径。2D 上下文的坐标开始于<code>&lt;canvas&gt;</code>元素的左上角，原点坐标是<code>(0,0)</code>。所有坐标值都基于这个原点计算，<code>x</code> 值越大表示越靠右，<code>y</code> 值越大表示越靠下。默认情况下，<code>width</code> 和 <code>height</code> 表示水平和垂直两个方向上可用的像素数目。</p> <p><strong>填充和描边</strong></p> <ul><li>填充:fillStyle。</li> <li>描边:strokeStyle。</li></ul> <p><strong>绘制矩形</strong></p> <p><code>fillRect()</code>、<code>strokeRect()</code>和 <code>clearRect()</code>。</p> <p>这三个方法都能接收 4 个参数：<strong>矩形的 x 坐标</strong>、<strong>矩形的 y 坐标</strong>、<strong>矩形宽度</strong>和<strong>矩形高度</strong>。这些参数的单位都是像素。</p> <h3 id="绘制路径"><a href="#绘制路径" class="header-anchor">#</a> 绘制路径</h3> <blockquote><p>2D 绘制上下文支持很多在画布上绘制路径的方法。通过路径可以创造出复杂的形状和线条。要绘制路径，首先必须调用 <code>beginPath()</code>方法，表示要开始绘制新路径。然后，再通过调用下列方法来实际地绘制路径。</p></blockquote> <ul><li>绘制圆<code>arc(x, y, radius, startAngle, endAngle, counterclockwise)</code>：<code>以(x,y)</code>为圆心绘制一条弧线，弧线半径为 <code>radius</code>，起始和结束角度（用弧度表示）分别为 <code>startAngle</code> 和 <code>endAngle</code>。最后一个参数表示 <code>startAngle</code> 和 <code>endAngle</code> 是否按逆时针方向计算，值为 <code>false</code> 表示按顺时针方向计算</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>    context<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">180</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">360</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">180</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token function">closePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><p>绘制弧线<code>arcTo(x1, y1, x2, y2, radius)</code>：从上一点开始绘制一条弧线，到<code>(x2,y2)</code>为止，并且以给定的半径 <code>radius</code> 穿过<code>(x1,y1)</code>。</p></li> <li><p>绘制贝塞尔曲线<code>bezierCurveTo(c1x, c1y, c2x, c2y, x, y)</code>：从上一点开始绘制一条曲线，到<code>(x,y)</code>为止，并且以<code>(c1x,c1y)</code>和<code>(c2x,c2y)</code>为控制点。</p></li> <li><p><code>lineTo(x, y)</code>：从上一点开始绘制一条直线，到<code>(x,y)</code>为止。</p></li> <li><p><code>moveTo(x, y)</code>：将绘图游标移动到(x,y)，不画线。</p></li> <li><p><code>quadraticCurveTo(cx, cy, x, y)</code>：从上一点开始绘制一条二次曲线，到(x,y)为止，并且以(cx,cy)作为控制点。</p></li> <li><p><code>rect(x, y, width, height)</code>：从点<code>(x,y)</code>开始绘制一个矩形，宽度和高度分别由 <code>width</code> 和 <code>height</code> 指定。这个方法绘制的是矩形路径，而不是 <code>strokeRect()</code> 和 <code>fillRect()</code> 所绘制的独立的形状。</p></li></ul> <p>创建了路径后，接下来有几种可能的选择。</p> <p>如果想绘制一条连接到路径起点的线条，可以调用 <code>closePath()</code>。</p> <p>如果路径已经完成，你想用 <code>fillStyle</code> 填充它，可以调用 <code>fill()</code> 方法。</p> <p>另外，还可以调用 <code>stroke()</code>方法对路径描边，描边使用的是 <code>strokeStyle</code>。</p> <p>最后还可以调用 <code>clip()</code>，这个方法可以在路径上创建一个剪切区域。</p> <div class="custom-block tip"><p class="title">TIP</p><p>由于路径的使用很频繁，所以就有了一个名为 <code>isPointInPath()</code> 的方法。</p> <p>这个方法接收 <code>x</code> 和 <code>y</code> 坐标作为参数，用于在路径被关闭之前确定画布上的某一点是否位于路径上.</p></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">isPointInPath</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;Point (100, 100) is in the path.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>绘制文本</strong></p> <p>绘制文本主要有两个方法：<code>fillText()</code>和 <code>strokeText()</code>。</p> <p>这两个方法都可以接收 4 个参数：要绘制的文本字符串、<code>x</code> 坐标、<code>y</code> 坐标和可选的最大像素宽度。而且，这两个方法都以下列 3 个属性为基础：</p> <ul><li><code>font</code>：表示文本样式、大小及字体，用 CSS 中指定字体的格式来指定，例如&quot;10px Arial&quot;。</li> <li><code>textAlign</code>：表示文本对齐方式，&quot;<code>start</code>&quot;、&quot;end&quot;、&quot;<code>left</code>&quot;、&quot;<code>right</code>&quot;和&quot;<code>center</code>&quot;。建议使用&quot;<code>start</code>&quot;和&quot;<code>end</code>&quot;，不要使用&quot;<code>left</code>&quot;和&quot;<code>right</code>&quot;，因为前两者的意思更稳妥，能同时适合从左到右和从右到左显示（阅读）的语言。</li> <li><code>textBaseline</code>：表示文本的基线,&quot;<code>top</code>&quot;、&quot;<code>hanging</code>&quot;、&quot;<code>middle</code>&quot;、&quot;<code>alphabetic</code>&quot;、 &quot;<code>ideographic</code>&quot;和&quot;<code>bottom</code>&quot;。</li></ul> <p><strong>变换</strong></p> <p>通过上下文的变换，可以把处理后的图像绘制到画布上。2D 绘制上下文支持各种基本的绘制变换。创建绘制上下文时，会以默认值初始化变换矩阵，在默认的变换矩阵下，所有处理都按描述直接绘制。为绘制上下文应用变换，会导致使用不同的变换矩阵应用处理，从而产生不同的结果。</p> <ul><li><code>rotate(angle)</code>：围绕原点旋转图像 <code>angle</code> 弧度。</li> <li><code>scale(scaleX, scaleY)</code>：缩放图像，在 <code>x</code> 方向乘以 <code>scaleX</code>，在 <code>y</code> 方向乘以 <code>scaleY</code>。<code>scaleX和</code> <code>scaleY</code> 的默认值都是 <code>1.0</code>。</li> <li><code>translate(x, y)</code>：将坐标原点移动到<code>(x,y)</code>。执行这个变换之后，坐标(<code>0,0</code>)会变成之前由(<code>x,y</code>)表示的点。</li> <li><code>transform(m1_1, m1_2, m2_1, m2_2, dx, dy)</code>：直接修改变换矩阵，方式是乘以如下矩阵。 <code>m1_1 m1_2 dx m2_1 m2_2 dy 0 0 1</code></li> <li><code>setTransform(m1_1, m1_2, m2_1, m2_2, dx, dy)</code>：将变换矩阵重置为默认状态，然后 再调用 <code>transform()</code>。</li></ul> <p><strong>绘制图像</strong></p> <p>2D 绘图上下文内置了对图像的支持。如果你想把一幅图像绘制到画布上，可以使用 <code>drawImage()</code>方法。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// simple</span>
<span class="token keyword">var</span> image <span class="token operator">=</span> document<span class="token punctuation">.</span>images<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
context<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// img startPoint endPoint width height</span>
context<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// img startPoint endPoint width height targetX targetY targetWidth targetHeight</span>
context<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>阴影</strong></p> <p>2D 上下文会根据以下几个属性的值，自动为形状或路径绘制出阴影。</p> <ul><li><code>shadowColor</code>：用 <code>CSS</code> 颜色格式表示的阴影颜色，默认为黑色。</li> <li><code>shadowOffsetX</code>：形状或路径 <code>x</code> 轴方向的阴影偏移量，默认为 0。</li> <li><code>shadowOffsetY</code>：形状或路径 <code>y</code> 轴方向的阴影偏移量，默认为 0。</li> <li><code>shadowBlur</code>：模糊的像素数，默认 0，即不模糊。</li></ul> <p>这些属性都可以通过 <code>context</code> 对象来修改。只要在绘制前为它们设置适当的值，就能自动产生阴影。例如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> context <span class="token operator">=</span> drawing<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;2d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 设置阴影</span>
context<span class="token punctuation">.</span>shadowOffsetX <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> 
context<span class="token punctuation">.</span>shadowOffsetY <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> 
context<span class="token punctuation">.</span>shadowBlur <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span> 
context<span class="token punctuation">.</span>shadowColor <span class="token operator">=</span> <span class="token string">&quot;rgba(0, 0, 0, 0.5)&quot;</span><span class="token punctuation">;</span> 
<span class="token comment">// 绘制红色矩形</span>
context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">&quot;#ff0000&quot;</span><span class="token punctuation">;</span> 
context<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 绘制蓝色矩形</span>
context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">&quot;rgba(0,0,255,1)&quot;</span><span class="token punctuation">;</span>
context<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>渐变</strong></p> <p>渐变由 <code>CanvasGradient</code> 实例表示，很容易通过 2D 上下文来创建和修改。要创建一个新的线性渐变，可以调用 <code>createLinearGradient()</code> 方法。</p> <p>这个方法接收 4 个参数：起点的 x 坐标、起点的 y 坐标、终点的 x 坐标、终点的 y 坐标。调用这个方法后，它就会创建一个指定大小的渐变，并返回 <code>CanvasGradient</code> 对象的实例。</p> <p>创建了渐变对象后，下一步就是使用 <code>addColorStop()</code> 方法来指定色标。</p> <p>这个方法接收两个参数：色标位置和 <code>CSS</code> 颜色值。色标位置是一个 0（开始的颜色）到 1（结束的颜色）之间的数字。例如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> gradient <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">createLinearGradient</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
gradient<span class="token punctuation">.</span><span class="token function">addColorStop</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;white&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
gradient<span class="token punctuation">.</span><span class="token function">addColorStop</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token string">&quot;skyblue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
gradient<span class="token punctuation">.</span><span class="token function">addColorStop</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;black&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
context<span class="token punctuation">.</span>fillStyle<span class="token operator">=</span>gradient<span class="token punctuation">;</span>
context<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">800</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="webgl"><a href="#webgl" class="header-anchor">#</a> WebGL</h2> <h3 id="类型化数组"><a href="#类型化数组" class="header-anchor">#</a> 类型化数组</h3> <hr> <p><code>WebGL</code> 涉及的复杂计算需要提前知道数值的精度，而标准的 <code>JavaScript</code> 数值无法满足需要。为此，<code>WebGL</code> 引入了一个概念，叫类型化数组（<code>typed arrays</code>）。类型化数组也是数组，只不过其元素被设置为特定类型的值。</p> <p>类型化数组的核心就是一个名为 <code>ArrayBuffer</code> 的类型。每个 <code>ArrayBuffer</code> 对象表示的只是内存中指定的字节数，但不会指定这些字节用于保存什么类型的数据。<strong>通过 <code>ArrayBuffer</code> 所能做的，就是为了将来使用而分配一定数量的字节。</strong> 例如，下面这行代码会在内存中分配 <code>20B</code>。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 内存中分配20B</span>
<span class="token keyword">var</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="webgl上下文"><a href="#webgl上下文" class="header-anchor">#</a> WebGL上下文</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> drawing <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;drawing&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//确定浏览器支持&lt;canvas&gt;元素</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>drawing<span class="token punctuation">.</span>getContext<span class="token punctuation">)</span><span class="token punctuation">{</span> 
<span class="token keyword">var</span> gl <span class="token operator">=</span> drawing<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
	<span class="token keyword">if</span> <span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">{</span> 
 		<span class="token comment">// 使用 WebGL </span>
 	<span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="html5-脚本编程"><a href="#html5-脚本编程" class="header-anchor">#</a> HTML5 脚本编程</h2> <h3 id="跨文档消息传递"><a href="#跨文档消息传递" class="header-anchor">#</a> 跨文档消息传递</h3> <p><strong>跨文档消息传送（<code>cross-document messaging</code>），有时候简称为 <code>XDM</code>，指的是在来自不同域的页面间传递消息。</strong></p> <p>例如，<code>www.wrox.com</code>域中的页面与位于一个内嵌框架中的 <code>p2p.wrox.com</code> 域中的页面通信。</p> <p>在 <code>XDM</code> 机制出现之前，要稳妥地实现这种通信需要花很多工夫。<code>XDM</code> 把这种机制规范化，让我们能既稳妥又简单地实现跨文档通信。</p> <p><code>XDM</code> 的核心是 <code>postMessage()</code>方法。在 <code>HTML5</code> 规范中，除了 <code>XDM</code> 部分之外的其他部分也会提到这个方法名，但都是为了同一个目的：<strong>向另一个地方传递数据。对于 <code>XDM</code> 而言，“另一个地方”指的是包含在当前页面中的<code>&lt;iframe&gt;</code>元素，或者由当前页面弹出的窗口。</strong></p> <div class="custom-block tip"><p class="title">TIP</p><p><code>postMessage()</code>方法接收两个参数：一条消息和一个表示消息接收方来自哪个域的字符串。第二个参数对保障安全通信非常重要，可以防止浏览器把消息发送到不安全的地方。来看下面的例子。</p></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 注意：所有支持 XDM 的浏览器也支持 iframe 的 contentWindow 属性</span>
<span class="token keyword">var</span> iframeWindow <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;myframe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>contentWindow<span class="token punctuation">;</span> 
iframeWindow<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">&quot;A secret&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://www.wrox.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>接收到 <code>XDM</code> 消息时，会触发 <code>window</code> 对象的 <code>message</code> 事件。</p> <p>这个事件是以异步形式触发的，因此从发送消息到接收消息（触发接收窗口的 <code>message</code> 事件）可能要经过一段时间的延迟。触发 <code>message</code> 事件后，传递给 <code>onmessage</code> 处理程序的事件对象包含以下三方面的重要信息。</p> <ul><li><code>data</code>：作为 <code>postMessage()</code> 第一个参数传入的字符串数据。</li> <li><code>origin</code>：发送消息的文档所在的域，例如<code>&quot;http://www.wrox.com&quot;</code>。</li> <li><code>source</code>：发送消息的文档的 <code>window</code> 对象的代理。这个代理对象主要用于在发送上一条消息的窗口中调用 <code>postMessage()</code>方法。如果发送消息的窗口来自同一个域，那这个对象就是 <code>window</code>。</li></ul> <h2 id="cors-跨域处理"><a href="#cors-跨域处理" class="header-anchor">#</a> CORS 跨域处理</h2> <p><code>CROS</code>(跨域资源共享)是一种基于 <code>HTTP</code> 头的机制，该机制通过允许服务器标示除了它自己以外的其它 <code>origin（域，协议和端口）</code>，这样浏览器可以访问加载这些资源。</p> <p>跨源资源共享还通过一种机制来检查服务器是否会允许要发送的真实请求，该机制通过浏览器发起一个到服务器托管的跨源资源的<code>预检</code>请求。在预检中，浏览器发送的头中标示有 <code>HTTP</code> 方法和真实请求中会用到的头。</p> <p>跨源资源共享标准新增了一组 <code>HTTP</code> 首部字段，允许服务器声明哪些源站通过浏览器有权限访问哪些资源。另外，规范要求，对那些可能对服务器数据产生副作用的 <code>HTTP</code> 请求方法（特别是 <code>GET</code> 以外的 <code>HTTP</code> 请求，或者搭配某些 <code>MIME</code> 类型的 <code>POST</code> 请求），浏览器必须首先使用 <code>OPTIONS</code> 方法发起一个预检请求（<code>preflight request</code>），从而获知服务端是否允许该跨源请求。服务器确认允许之后，才发起实际的 <code>HTTP</code> 请求。</p> <p>在预检请求的返回中，服务器端也可以通知客户端，是否需要携带身份凭证（包括 <code>Cookies</code> 和 <code>HTTP</code> 认证相关数据）。</p> <p><code>CORS</code> 请求失败会产生错误，但是为了安全，在 <code>JavaScript</code> 代码层面是无法获知到底具体是哪里出了问题。你只能查看浏览器的控制台以得知具体是哪里出现了错误。</p> <p>由于浏览器同源策略的限制，非同源下的请求，都会产生跨域问题。</p> <blockquote><p>同源策略即：同一协议，同一域名，同一端口号。当其中一个不满足时，我们的请求即会发生跨域问题。</p></blockquote> <ol><li>采用 <code>jsonp</code> 请求</li></ol> <p>不知道大家有没有注意，不管是我们的 <code>script</code> 标签的<code>src</code>还是<code>img</code>标签的<code>src</code>，或者说<code>link</code>标签的<code>href</code>他们没有被通源策略所限制，比如我们有可能使用一个网络上的图片，就可以请求得到。</p> <p><code>jsonp</code> 就是使用通源策略这一“<code>漏洞”</code>，实现的跨域请求（这也是<code>jsonp</code>跨域只能用<code>get</code>请求的原因所在）。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>
<span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">&quot;btn&quot;</span><span class="token operator">&gt;</span>点击<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#btn'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">var</span> frame <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		frame<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'http://localhost:3000/article-list?name=leo&amp;age=30&amp;callback=func'</span><span class="token punctuation">;</span>
		<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>frame<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">function</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">alert</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>message<span class="token operator">+</span>res<span class="token punctuation">.</span>name<span class="token operator">+</span><span class="token string">'你已经'</span><span class="token operator">+</span>res<span class="token punctuation">.</span>age<span class="token operator">+</span><span class="token string">'岁了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>这里可以看到，我们声明了一个<code>func</code>函数，但没有执行，你可以想一下，如果服务端接口到<code>get</code>请求，返回的是<code>func({message:'hello'})</code>，这样的话在服务端不就可以把数据通过函数执行传参的方式实现数据传递了吗。</p> <p>服务端代码</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/article-list'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">,</span> <span class="token string">'123'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'success!'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>age
  <span class="token punctuation">}</span>
  data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'func('</span> <span class="token operator">+</span> data <span class="token operator">+</span> <span class="token string">')'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="custom-block warning"><p class="title">WARNING</p><p>需要注意的是，<code>callback</code> 参数定义的方法是需要前后端定义好的，具体什么名字，商讨好就可以了。</p> <p>其实 <code>jsonp</code> 的整个过程就类似于前端声明好一个函数，后端返回执行函数。执行函数参数中携带所需的数据，整个过程实际非常简单易懂。</p></div><ol start="2"><li>document.domain</li></ol> <p>这种方式常用于 <code>iframe</code> 通信，用在<code>主域名相同子域名不同的跨域访问中</code>。</p> <p><code>http://a.frame.com</code> 和 <code>http://b.frame.com</code> 他们的主域名都是 <code>frame.com</code>。</p> <p>这两个域名中的文件可以用这种方式进行访问，通过在两个域中具体的文件中设置<code>document.domain=&quot;frame.com&quot;</code>就可达到跨域访问的目的。</p> <ol start="3"><li>window.name</li></ol> <p>常用于 <code>iframe</code> 中。</p> <p><code>window</code> 的 <code>name</code> 属性有个特征：在一个窗口(<code>window</code>)的生命周期内,窗口载入的所有的页面都是共享一个<code>window.name</code>的，每个页面对<code>window.name</code>都有读写的权限，<code>window.name</code>是持久存在一个窗口载入过的所有页面中的，并不会因新页面的载入而进行重置。</p> <ol start="4"><li>window.postMessage</li></ol> <p><code>window.postMessages</code>是<code>HTML5</code>中实现跨域访问的一种新方式，可以使用它来向其它的<code>window</code>对象发送消息，无论这个<code>window</code>对象是属于同源或不同源。</p> <p>该方式的使用还是十分简单的，给要发送数据的页面中的<code>window</code>对象调用一个<code>postMessage(message,targetOrigin)</code>方法即可。</p> <p>该方法的第一个参数<code>message</code>为要发送的消息，类型只能为<code>字符串</code>；</p> <p>第二个参数 <code>targetOrigin</code> 用来限定接收消息的那个 <code>window</code> 对象所在的域，如果不想限定域，直接使用通配符 '*' 。</p> <p>再让接收数据页面的 <code>window</code> 对象监听自身的 <code>message</code> 事件来获取传过来的消息，消息内容储存在该事件对象的 <code>data</code> 属性中。</p> <ol start="5"><li>CORS(Cross-Origin Resource Sharing)</li></ol> <p><code>CORS</code> 是官方推荐解决跨域问题的方案。</p> <p><code>CORS</code> 使用一些 <code>HTTP</code> 头信息——包括请求和返回——为了让工作继续开展下去，你必须了解一下的一些头信息：</p> <ul><li><code>Access-Control-Allow-Origin</code></li></ul> <p>这个头部信息由服务器返回，用来明确指定那些客户端的域名允许访问这个资源。它的值可以是：</p> <ol><li><code>*</code> —— 允许任意域名
2.一个完整的域名名字（比如：<code>https://example.com</code>）</li></ol> <ul><li><code>Access-Control-Allow-Credentials</code></li></ul> <p>这个头部信息只会在服务器支持通过 <code>cookies</code> 传递验证信息的返回数据里。它的值只有一个就是 <code>true</code>。</p> <p>跨站点带验证信息时，服务器必须要争取设置这个值，服务器才能获取到用户的 <code>cookie</code>。</p> <ul><li><code>Access-Control-Allow-Headers</code></li></ul> <p>提供一个逗号分隔的列表表示服务器支持的请求数据类型。</p> <p>假如你使用自定义头部(比如：<code>x-authentication-token</code> 服务器需要在返回<code>OPTIONS</code>请求时，要把这个值放到这个头部里，否则请求会被阻止)。</p> <ul><li><code>Access-Control-Expose-Headers</code></li></ul> <p>相似的，这个返回信息里包含了一组头部信息，这些信息表示那些客户端可以使用。其他没有在里面的头部信息将会被限制。</p> <ul><li><code>Access-Control-Allow-Methods</code>
一个逗号分隔的列表，表明服务器支持的请求类型（比如：<code>GET</code>, <code>POST</code>）</li></ul> <ol start="6"><li>配置代理服务器。</li></ol> <p>可以配置<code>nginx</code>服务器,服务器与服务器之间访问是不跨域的。</p> <h2 id="事件循环-event-loop"><a href="#事件循环-event-loop" class="header-anchor">#</a> 事件循环(Event Loop)</h2> <h3 id="javascript-发展历史"><a href="#javascript-发展历史" class="header-anchor">#</a> javascript 发展历史</h3> <p>在我们理解事件循环机制之前先来了解下 <code>Javascript</code> 语言的发展史。</p> <p>首先我们需要知道,一个 <code>Javascript</code> 引擎会常驻于内存中,他等待这我们(宿主)把 <code>Javascript</code> 代码或者函数传递给他执行。</p> <p>在早期的 <code>Javascript</code> 语言版本中,本来并没有异步执行代码的能力,这也叫意味着只能等待宿主环境把代码传递给引擎,然后引擎直接把代码顺次执行,这个任务也就是宿主发起的任务。</p> <p>从 ES6 开始,<code>Javascript</code> 引入了 <code>Promise</code>, 这样，不需要浏览器的安排, <code>Javascript</code> 本身也可以发起任务了。</p> <p><strong>至此,这里就诞生了两个概念, <code>宏观任务</code> 与 <code>微观任务</code>。</strong></p> <ul><li><p>宏观任务: 指代那些有宿主环境发起的任务。</p></li> <li><p>微观任务: 指代由Javascript引擎本身发起的任务。</p></li></ul> <h3 id="执行栈和消息队列"><a href="#执行栈和消息队列" class="header-anchor">#</a> 执行栈和消息队列</h3> <p>在解析 <code>Event Loop</code> 运行机制之前，我们要先理解<code>栈（stack）</code>和<code>队列（queue）</code>的概念。</p> <p><code>栈</code>和<code>队列</code>，两者都是 <code>线性结构</code>。</p> <ul><li><p>但是 <code>栈遵循的是后进先出(last in first off LIFO)</code>，开口封底。</p></li> <li><p>而 <code>队列遵循的是先进先出 (fisrt in first out，FIFO)</code>，两头通透。</p></li></ul> <p><img src="/images/base-js39.png" alt="base-js39"></p> <p><code>Event Loop</code>得以顺利执行，它所依赖的容器环境，就和这两个概念有关。</p> <p>我们知道，在 <code>js</code> 代码执行过程中，会生成一个当前环境的<code>执行上下文（ 执行环境 / 作用域）</code>，用于存放当前环境中的变量，这个上下文环境被生成以后，就会被推入 js 的<code>执行栈</code>。一旦执行完成，那么这个执行上下文就会被执行栈弹出，里面相关的变量会被销毁，在下一轮垃圾收集到来的时候，环境里的变量占据的内存就能得以释放。</p> <p>这个执行栈，也可以理解为 <code>JavaScript</code> 的单一线程，所有代码都跑在这个里面，以同步的方式依次执行，或者阻塞，这就是<code>同步场景</code>。</p> <p>那么异步场景呢？显然就需要一个独立于“执行栈”之外的容器，专门管理这些异步的状态，于是在“<code>主线程</code>”、“<code>执行栈</code>”之外，有了一个 <code>Task</code> 的队列结构，专门用于管理异步逻辑。所有异步操作的回调，都会暂时被塞入这个队列。<code>Event Loop</code> 处在两者之间，扮演一个大管家的角色，它会以一个固定的时间间隔不断轮询，当它发现主线程空闲，就会去到 <code>Task</code> 队列里拿一个异步回调，把它塞入执行栈中执行，一段时间后，主线程执行完成，弹出上下文环境，再次空闲，<code>Event Loop</code> 又会执行同样的操作。。。依次循环，于是构成了一套完整的事件循环运行机制。</p> <p>单线程与之用途有关，单线程能够保证一致性，如果有两个线程，一个线程点击了一个元素，另一个删除了一个元素，浏览器以哪一个为准？</p> <div class="custom-block tip"><p class="title">TIP</p><p>单线程指的是单个脚本只能在一个线程上运行，而不是 <code>JavaScript</code> 引擎只有一个线程。</p></div><p>我们先看一张经典的图</p> <p><img src="/images/base-js40.png" alt="base-js40"></p> <p><code>javascript</code> 中为了协调事务的处理，交互等必须采用 <code>Event Loop</code> 机制。任务主要分为 <code>同步任务</code> 和 <code>异步任务</code>。</p> <p>异步任务分成了 <code>宏任务</code> 和 <code>微任务</code>。</p> <ul><li><p>宏任务：包括整体代码 <code>script</code>、<code>setTimeout</code>、<code>setInterval</code>、<code>UI 渲染</code>、<code>I/O</code>、<code>postMessage</code>、<code>MessageChannel</code>、<code>setImmediate(Node.js 环境)</code></p></li> <li><p>微任务：<code>Promise.then(非new Promise)</code>、<code>process.nextTick(node环境)</code>、<code>MutaionObserver</code></p></li></ul> <blockquote><p>单次循环的事件的执行顺序，是先执行 <code>宏任务</code>，然后执行 <code>微任务</code>，这个是基础，任务可以有同步任务和异步任务，同步的进入主线程，异步的进入 <code>Event Table</code> 并注册函数，异步事件完成后，会将回调函数放入<code>Event Queue</code>中(宏任务和微任务是不同的<code>Event Queue</code>)，同步任务执行完成后，会从<code>Event Queue</code>中读取事件放入主线程执行，回调函数中可能还会包含不同的任务，因此会循环执行上述操作。</p></blockquote> <p><strong>Event Loop</strong></p> <ul><li><p><code>JavaScript</code> 是单线程的，所有的<code>同步任务</code>都会<code>在主线程</code>中执行。</p></li> <li><p>主线程之外，还有一个任务队列。每当一个异步任务有结果了，就往任务队列里塞一个事件。</p></li> <li><p>当主线程中的任务，都执行完之后，系统会 “依次” 读取任务队列里的事件。与之相对应的异步任务进入主线程，开始执行。</p></li> <li><p>异步任务之间，会存在差异，所以它们执行的优先级也会有区别。大致分为 <code>微任务</code> 和 <code>宏任务</code>。<strong>同一次事件循环中，微任务永远在宏任务之前执行</strong>。</p></li> <li><p>主线程会不断重复上面的步骤，直到执行完所有任务。</p></li></ul> <p><img src="/images/base-js41.png" alt="base-js41"></p> <ol><li>主体代码（第一次事件循环开始，所有的 <code>script</code> 代码）作为宏任务进入任务执行栈，但在主线程执行之前要做一系列操作判断。</li> <li>判断当前任务是同步还是异步，同步的由主线程在任务栈中按先进后出顺序（先局部上下文，再全局上下文）执行，异步判断是宏任务还是微任务。</li> <li>异步中的宏任务放入异步的宏任务<code>event Table</code>（异步队列分两种，宏任务队列和微任务队列,<code>event Table</code>也一样），微任务进入微任务<code>event Table</code>，在回调函数注册之后，再次进入它们对应的队列。</li> <li>当主线程的任务执行完后，会检查微任务队列是否有任务，如果有就执行，如此循环，知道微任务队列没有任务。</li> <li>当前事件的微任务执行完后，开始执行下一次事件，即会执行宏任务队列中的宏任务，如此循环下去，直到没有任务</li></ol> <h3 id="浏览器渲染时机"><a href="#浏览器渲染时机" class="header-anchor">#</a> 浏览器渲染时机</h3> <div class="custom-block tip"><p class="title">TIP</p><p>在上面浏览器 <code>Event Loop</code> 的执行机制中，有很重要的一块内容，就是浏览器的渲染时机，</p> <p>浏览器会等到当前的 <code>micro-task</code> 为空的时候，进行一次重新渲染。所以如果你需要在异步的操作后重新渲染 <code>DOM</code> 最好的方法是将它包装成 <code>micro</code> 任务，这样 <code>DOM</code> 渲染将会在本次 <code>Tick</code> 内就完成。</p></div><p><strong>Event Loop 常见面试题</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 start'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 end'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script start'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script end'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 1. script start // 同步任务
 * 2. async1 start // async1函数中的同步任务
 * 3. async2       // async1函数中遇到await先立即执行
 * 4. promise1     // 遇到promise 执行同步任务
 * 5. script end   // 执行外层同步任务
 * 6. async1 end   // 执行微任务中先注册的
 * 7. promise2     // 执行promise中的then 优先级大于setTimeout
 * 8. setTimeout   // 执行setTimeout函数
 * aysnc 只是一个标识符，真正起作用的应该是 await,如果一个异步函数没有await，他跟同步函数没有啥区别
 * await 不仅仅是等待一个值那么简单，当js运行时遇到了await关键字，会记录停止的位置，等到值求得后，js运行时会向消息队列推送一个任务，这个任务会恢复异步函数的执行
 * 即使 await 后面跟着一个立即可用的值，函数的其余部分也会被异步求值。
**/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p><strong>引申：如果我写了一个setTimeout(()=&gt;console.log(1111), 500);这段代码会在 500 毫秒后执行吗?</strong>
不一定会执行，这段代码只是告诉浏览器我往异步任务队列塞了一个延迟 500 毫秒后执行的任务，如果当前异步任务队列是空闲的，在得到执行权后会延时 500 毫秒执行。否则的话必须等到获得执行权。</p> <p><strong>引申: 如何根据此特性实现一个红绿灯,把一个圆形的 div 按照绿色 3s,黄色 1s,红色 2s 循环改变背景色?</strong></p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>light<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>traffic-light<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>[className]<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>方法 1: 思路最简单,使用 <code>setTimeout</code> 来显示递归显示。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  that<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">&quot;green&quot;</span><span class="token punctuation">;</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    that<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">&quot;yellow&quot;</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      that<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">;</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>方法 2： <code>setTimeout</code> 与 <code>Promise</code> 结合,本质上没什么区别</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  that<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">&quot;green&quot;</span><span class="token punctuation">;</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> rej</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      that<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">&quot;yellow&quot;</span><span class="token punctuation">;</span>
      <span class="token function">res</span><span class="token punctuation">(</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> rej</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            that<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">;</span>
            <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token function">res</span><span class="token punctuation">(</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h2 id="深拷贝与浅拷贝"><a href="#深拷贝与浅拷贝" class="header-anchor">#</a> 深拷贝与浅拷贝</h2> <p>众所周知，<code>基本类型</code> 赋值的话并不会影响原有对象，<code>Object</code> 是<code>引用数据类型</code>，存储在内存的<code>堆</code>中，浅拷贝只是拷贝了另一个对象的内存地址，所以在修改时会同时修改另一个对象，而深拷贝会开辟新的内存地址，所以不会影响另一个对象。</p> <ul><li><strong>基本数据类型的深拷贝</strong>
JS对象分为基础类型和引用类型，基础类型(<code>Number</code>, <code>String</code>, <code>Boolean</code>…)直接存储于栈中，引用类型(<code>Object</code>…)栈中存储指向存储在堆中的对象的指针。</li></ul> <p>弱引用：
弱引用与强引用相对， 一个对象若只被弱引用所引用，则被认为是不可访问（或弱可访问）的，并因此可能在任何时刻被回收。
因此使用弱引用可以防止内存泄漏。
在 <code>JavaScript</code> 中弱引用的 <code>WeakMap</code> 和 <code>WeakSet</code>。
WeakMap是一组键/值对的集合，其中的键是弱引用的。其键必须是对象，而值可以是任意的。WeakMap是对对象的弱引用：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> wm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
wm<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
obj <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 将obj置为 null 后，尽管 wm 依然引用了{ b: 2 }，但是由于是弱引用，{ b: 2 } 会在某一时刻被GC。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>正由于这样的弱引用，<code>WeakMap</code> 的 <code>key</code> 是不可枚举的 (没有方法能给出所有的 <code>key</code>)。如果 <code>key</code> 是可枚举的话，其列表将会受垃圾回收机制的影响，从而得到不确定的结果。</p> <p><code>JavaScript</code> 的 <code>WeakMap</code> <strong>并不是真正意义上的弱引用</strong>：实际上，只要键仍然存活，它就强引用其内容。<code>WeakMap</code> 仅在键被垃圾回收之后，才弱引用它的内容。这种关系更准确地称为 <code>ephemeron</code> 。</p> <p>强引用：
<code>JavaScript</code> 中最常见的就是声明一个变量并且将一个引用类型数据（对象）赋值给这个变量,这种情况就是强引用。只要该对象还被引用，垃圾回收机制GC就不会回收该对象或者属性。
对于一个普通对象，将全部引用该对象的变量关系相应设置为 <code>null</code>,便能等待垃圾回收机制GC回收。</p> <p><code>Map</code> 对象保存键值对，并且能够记住键的原始插入顺序。任何值(对象或者原始值) 都可以作为一个键或一个值。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;江流儿&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">18</span>
<span class="token punctuation">}</span>
obj <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">//上面的对象等待GC垃圾回收</span>

<span class="token keyword">const</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
m<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
obj <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 将obj置为null并不会使 { a: 1 } 被垃圾回收，因为还有map引用了 { a: 1 }</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><hr> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> a<span class="token punctuation">;</span>

b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token comment">// a:1, b:2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><strong>一维数组和一维对象的深拷贝</strong> <code>Object.assign()</code>方法用于对象的合并，将源对象（<code>source</code>）的所有可枚举属性，复制到目标对象（<code>target</code>）</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> arr1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> arr2 <span class="token operator">=</span> arr1
<span class="token keyword">const</span> arr3 <span class="token operator">=</span> arr1<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

arr2<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">4</span>
<span class="token comment">// arr1:[1,4,3] arr2:[1,4,3]</span>
arr3<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">5</span>
<span class="token comment">// arr1:[1,4,3] arr2:[1,4,3] arr3:[1,5,3]</span>
<span class="token comment">// Array.slice(),Array.concat()都能实现一维数组的深拷贝</span>

<span class="token keyword">const</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string-property property">'name'</span><span class="token operator">:</span><span class="token string">'xm'</span><span class="token punctuation">,</span>
    <span class="token string-property property">'age'</span><span class="token operator">:</span><span class="token number">24</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> obj2 <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>obj1<span class="token punctuation">)</span><span class="token punctuation">;</span>
obj2<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'dm'</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * obj1 = {
 *  'name':'xm',
 *  'age':24
 * }
 * 
 * obj2 = {
 *  'name':'dm',
 *  'age':24
 * }
 * Object.assign()可以实现一维对象的深拷贝
 */</span>

<span class="token keyword">const</span> fobj1 <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string-property property">'id'</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token string-property property">'name'</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token string-property property">'firstName'</span><span class="token operator">:</span><span class="token string">'Bruce'</span><span class="token punctuation">,</span>
        <span class="token string-property property">'lastName'</span><span class="token operator">:</span><span class="token string">'Li'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> fobj2 <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> fobj1<span class="token punctuation">)</span>

fobj2<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'lastName'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Hu'</span>
<span class="token comment">// fobj2 = fobj1 </span>
<span class="token comment">// Object.assign()如果对象内部仍然存在对象的话 不能进行深拷贝</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><p><strong>实现深拷贝</strong></p> <ol><li>采用 <code>JSON.stringify()</code> 和 <code>JSON.parse()</code> 实现</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">deepClone</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> newObj <span class="token operator">=</span> obj<span class="token punctuation">.</span>constructor <span class="token operator">===</span> Array <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> obj <span class="token operator">!==</span> <span class="token string">'object'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> obj
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span><span class="token constant">JSON</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        newObj <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> newObj
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="custom-block warning"><p class="title">WARNING</p><p><code>JSON.parse(JSON.stringify(obj))</code>方法在序列化过程中，<code>undefined</code>、<code>function</code>、<code>symbol</code> 等值在序列化过程中会被忽略(出现在非数组对象的属性中时)或者被转换成null(出现在数组中)。</p></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">x</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'3310'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">y</span><span class="token operator">:</span><span class="token keyword">undefined</span><span class="token punctuation">,</span>
    <span class="token function-variable function">z</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">a</span><span class="token operator">:</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'11111'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> obj2 <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// obj2: { x: [1, null, null] }</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>虽然使用 <code>JSON</code> 相关方法的深拷贝不能解决这些问题，但是也可以适用绝大部分<code>90%</code>的场景。</p> <ol start="2"><li>递归深拷贝</li></ol> <p>如果是浅拷贝的话，我们可以很容易写出下面的代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 创建一个新的对象，遍历需要克隆的对象，将需要克隆对象的属性依次添加到新对象上，返回。</span>
<span class="token keyword">function</span> <span class="token function">clone</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> cloneTarget <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cloneTarget<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> cloneTarget<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>如果是<code>深拷贝</code>的话，考虑到我们要拷贝的对象是不知道有多少层深度的，我们可以用递归来解决问题，稍微改写上面的代码：</p> <ul><li><p>如果是<code>原始类型</code>，无需继续拷贝，直接返回。</p></li> <li><p>如果是<code>引用类型</code>，创建一个新的对象，遍历需要克隆的对象，将需要克隆对象的属性执行深拷贝后依次添加到新对象上。</p></li></ul> <p>很容易理解，如果有更深层次的对象可以继续递归直到属性为原始类型，这样我们就完成了一个最简单的深拷贝：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">deepClone</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> target <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> cloneTarget <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            cloneTarget<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> cloneTarget<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> target<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>上述代码可以解决常用的95%场景,但是在对象循环引用自身的时候还是会报错。我们来看下面这个测试用例:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">deepClone</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> target <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> cloneTarget <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            cloneTarget<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> cloneTarget<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> target<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">field1</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">field2</span><span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
    <span class="token literal-property property">field3</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">child</span><span class="token operator">:</span> <span class="token string">'child'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">field4</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
target<span class="token punctuation">.</span>target <span class="token operator">=</span> target
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p><strong>由于上面的对象存在循环引用的情况，即对象的属性间接或直接的引用了自身的情况,递归进入死循环导致栈内存溢出了.</strong></p> <div class="custom-block tip"><p class="title">TIP</p><p>解决循环引用问题，我们可以额外开辟一个存储空间，来存储当前对象和拷贝对象的对应关系，当需要拷贝当前对象时，先去存储空间中找，有没有拷贝过这个对象，如果有的话直接返回，如果没有的话继续拷贝，这样就巧妙化解的循环引用的问题。</p></div><p>这个存储空间，需要可以存储key-value形式的数据，且key可以是一个引用类型，我们可以选择Map这种数据结构：</p> <ol><li>检查map中有无克隆过的对象</li> <li>有 - 直接返回</li> <li>没有 - 将当前对象作为key，克隆对象作为value进行存储</li> <li>继续克隆</li></ol> <p>因此我们的代码可以修改为:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> target <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> cloneTarget <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> cloneTarget<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            cloneTarget<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> cloneTarget<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> target<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>修改后执行成功,此时obj2中的target变为了一个 <code>Circular</code> 类型，即循环应用的意思。</p> <p>上述代码中我们使用Map来存储循环引用的对象,实际上浪费了一部分的空间,现在我们优化下上述代码,将 <code>Map</code> 改成 <code>WeakMap</code>。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> target <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> cloneTarget <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> cloneTarget<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            cloneTarget<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> cloneTarget<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> target<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>当我们创建一个对象时：<code>const obj = {}</code>，就默认创建了一个强引用的对象，我们只有手动将 <code>obj = null</code>，它才会被<code>垃圾回收机制</code>进行回收，如果是 <code>弱引用对象</code>，垃圾回收机制会自动帮我们回收。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span> <span class="token operator">:</span> <span class="token string">'Linda'</span><span class="token punctuation">}</span>
<span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
target<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span><span class="token string">'Hello I am Linda'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
obj <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>虽然我们手动将 <code>obj</code>，进行释放，但是 <code>target</code> 依然对 <code>obj</code> 存在强引用关系，所以这部分内存依然无法被释放。</p> <p>如果是 <code>WeakMap</code> 的话，<code>target</code> 和 <code>obj</code> 存在的就是<code>弱引用关系</code>，当下一次垃圾回收机制执行时，这块内存就会被释放掉。</p> <div class="custom-block tip"><p class="title">TIP</p><p>因此,我们在进行深拷贝的时候,我们只是在拷贝过程中使用到了该对象,等拷贝结束后就可以进行回收。</p> <p>设想一下，如果我们要拷贝的对象非常庞大时，使用 <code>Map</code> 会对内存造成非常大的额外消耗，而且我们需要手动清除 <code>Map</code> 的属性才能释放这块内存，而WeakMap会帮我们巧妙化解这个问题。</p></div><p>到这里为止我们已经可以完成对数组和对象的深拷贝了,但是上述方法中我们使用到了for...in...循环,它的执行效率是比较低的。</p> <p>在 <code>for循环</code>、<code>while循环</code>、<code>for-in</code>循环中,<code>while</code> 循环的效率是最高的。我们先实现个自定义循环方法。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/**
 * @param {array} array 需要循环的数组
 * @param {function} iteratee 遍历的回调函数
*/</span>
<span class="token keyword">function</span> <span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">array<span class="token punctuation">,</span> iteratee</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> length <span class="token operator">=</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">++</span>index <span class="token operator">&lt;</span> length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">iteratee</span><span class="token punctuation">(</span>array<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> array<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>代替方式如下</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> target <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> isArray <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> cloneTarget <span class="token operator">=</span> isArray <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> cloneTarget<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">const</span> keys <span class="token operator">=</span> isArray <span class="token operator">?</span> <span class="token keyword">undefined</span> <span class="token operator">:</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">forEach</span><span class="token punctuation">(</span>keys <span class="token operator">||</span> target<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>keys<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                key <span class="token operator">=</span> value<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            cloneTarget<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> cloneTarget<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> target<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>到此我们已经完成了对普通的<code>object</code>和<code>array</code>两种数据类型的深拷贝方法并且进行了性能调优。</p> <ol start="3"><li>使用 <code>loadsh</code> 插件</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">deepClone</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> copy<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> obj <span class="token operator">||</span> <span class="token string">&quot;object&quot;</span> <span class="token operator">!=</span> <span class="token keyword">typeof</span> obj<span class="token punctuation">)</span> <span class="token keyword">return</span> obj<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">Date</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    copy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    copy<span class="token punctuation">.</span><span class="token function">setTime</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> copy<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">Array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    copy <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> obj<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        copy<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> copy<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">Function</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">copy</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">obj</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> copy<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      copy <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> attr <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>attr<span class="token punctuation">)</span><span class="token punctuation">)</span> copy<span class="token punctuation">[</span>attr<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>attr<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> copy<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Unable to copy obj as type isn't supported &quot;</span> <span class="token operator">+</span> obj<span class="token punctuation">.</span>constructor<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><h2 id="settimeout、setimmediate、process-nexttick"><a href="#settimeout、setimmediate、process-nexttick" class="header-anchor">#</a> setTimeout、setImmediate、Process.nextTick</h2> <ul><li><p><code>setTimeount</code>(IO观察者)</p></li> <li><p><code>setImmediate</code>(check观察者)</p></li> <li><p><code>Process.nextTick</code>(idle观察者)</p></li></ul> <h3 id="优先级"><a href="#优先级" class="header-anchor">#</a> 优先级</h3> <p><code>Process.nextTick</code> &gt; <code>setTimeount</code> &gt; <code>setImmediate</code></p> <h3 id="为什么说-settimeout-有个最小-4ms-的延迟"><a href="#为什么说-settimeout-有个最小-4ms-的延迟" class="header-anchor">#</a> 为什么说 <code>setTimeout</code> 有个最小 <code>4ms</code> 的延迟?</h3> <p>我们先来看一下<code>html standard10-13</code>描述中的定义:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token number">10.</span> If timeout is less than <span class="token number">0</span><span class="token punctuation">,</span> then <span class="token keyword">set</span> timeout to <span class="token number">0.</span>
<span class="token number">11.</span> If nesting level is greater than <span class="token number">5</span><span class="token punctuation">,</span> and timeout is less than <span class="token number">4</span><span class="token punctuation">,</span> then <span class="token keyword">set</span> timeout to <span class="token number">4.</span>
<span class="token number">12.</span> Increment nesting level by one<span class="token punctuation">.</span>
<span class="token number">13.</span> Let task's timer nesting level be nesting level<span class="token punctuation">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>从上面的规范可以看出来：</strong></p> <ul><li><p>如果设置的 <code>timeout</code> 小于 <code>0</code>，则设置为 <code>0</code>。</p></li> <li><p>如果嵌套的层级超过了 <code>5</code> 层，并且 <code>timeout</code> 小于 <code>4ms</code>，则设置 <code>timeout</code> 为 <code>4ms</code>。</p></li></ul> <p><strong>看似我们已经找到了问题的原因，但是各大浏览器的厂商实际上并没有按照标准的规范进行设定。</strong></p> <p>在这里我们只展示 <code>chromium</code> 的 <code>source code</code>，其他 <code>webkit</code> 或 <code>Firefox</code> 自行下载查看，在 <code>chromium</code> 的 <code>blink</code> 目录下，有一个 叫做 <code>DOMTimer.cpp</code> 的文件，<code>online</code> 地址，这里也是用来设置计时器延时的地方：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">static</span> <span class="token keyword">const</span> int maxIntervalForUserGestureForwarding <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span> <span class="token comment">// One second matches Gecko.</span>
<span class="token keyword">static</span> <span class="token keyword">const</span> int maxTimerNestingLevel <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">const</span> double oneMillisecond <span class="token operator">=</span> <span class="token number">0.001</span><span class="token punctuation">;</span>
<span class="token comment">// Chromium uses a minimum timer interval of 4ms. We'd like to go</span>
<span class="token comment">// lower; however, there are poorly coded websites out there which do</span>
<span class="token comment">// create CPU-spinning loops.  Using 4ms prevents the CPU from</span>
<span class="token comment">// spinning too busily and provides a balance between CPU spinning and</span>
<span class="token comment">// the smallest possible interval timer.</span>
<span class="token keyword">static</span> <span class="token keyword">const</span> double minimumInterval <span class="token operator">=</span> <span class="token number">0.004</span><span class="token punctuation">;</span>

double intervalMilliseconds <span class="token operator">=</span> std<span class="token operator">:</span><span class="token operator">:</span><span class="token function">max</span><span class="token punctuation">(</span>oneMillisecond<span class="token punctuation">,</span> interval <span class="token operator">*</span> oneMillisecond<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>intervalMilliseconds <span class="token operator">&lt;</span> minimumInterval <span class="token operator">&amp;&amp;</span> m_nestingLevel <span class="token operator">&gt;=</span> maxTimerNestingLevel<span class="token punctuation">)</span>
    intervalMilliseconds <span class="token operator">=</span> minimumInterval<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>代码逻辑很清晰，设置了三个常量：</p> <p>*<code>maxTimerNestingLevel = 5</code>。也就是 <code>HTML standard</code> 当中提到的嵌套层级。</p> <ul><li><code>minimumInterval = 0.004</code>。也就是 <code>HTML standard</code> 当中说的最小延迟。</li></ul> <p>在第二段代码中我们会看到，首先会在 延迟时间 和 <code>1ms</code> 之间取一个最大值。换句话说，在不满足嵌套层级的情况下，最小延迟时间设置为 <code>1ms</code>。</p> <p>在 <code>chromium</code> 的注释中，解释了为什么要设置 <code>minimumInterval = 4ms</code>。简单来讲，本身 chromium 团队想要设置更低的延迟时间（其实他们期望达到亚毫秒级别），但是由于某些网站（比如纽约时报的网站）对 setTimeout 这种计时器不良的使用，设置延迟过低会导致 CPU-spinning（在后面，我们再解释什么是 CPU-spinning），因此 chromium 做了些 benchmark 测试，选定了 4ms 作为其 minimumInterval。</p> <p><strong>到这里为止，从浏览器厂商角度和 <code>HTML standard</code> 规范角度都解释了 <code>4ms</code> 的来源和其更加精确的定义,但是究竟是 <code>HTML standard</code> 先做出的设定，还是 <code>Chromium</code> 这种浏览器厂商先做出的设定。了解先后顺序的意义在于了解其背后历史，规范和厂商是如何相互促进与制衡的</strong></p> <p>这里补充一下操作系统层面的知识:</p> <p>在 <code>windows</code> 下默认情况的 <code>timer resolution</code> 是 <code>10-15.6ms</code>,也就是最初的浏览器 <code>timer</code> 是依赖于操作系统层面的 <code>timer resolution</code> 的。换句话说,早期的 <code>setTimeout</code> 最小的延时至少会是 <code>10ms</code>。但从<code>CPU</code>的性能来讲,现在的<code>CPU</code>每秒计算可以达到<code>4GHZ</code>以上,而<code>windows</code>的默认<code>timer</code>并没有变化。</p> <p>浏览器厂商认为默认计时器影响了网页的表达,如果<code>clock tick</code>很长，意味着浏览器会休眠很长的实际,从某一方面导致浏览器性能的下降。<code>Chrome</code> 本身追求的是亚毫秒级(<code>小于1ms</code>),因此 <code>chrome</code> 团队希望可以改变浏览器对于操作系统 <code>timer</code> 的依赖,在 <code>windows</code> 和 <code>linux</code> 下采取了不同的方案来达到目的。最后 <code>chrome</code> 团队采用了和 <code>Flash</code> 和 <code>Quicktime 统一的 API</code> 来代替系统默认的 <code>timer resolution</code>。</p> <p><code>4ms</code> 的出现是后来市场反馈 <code>1ms</code> 的 <code>timer</code> 导致 <code>CPU Spining</code>等原因，从 <code>1ms</code> 提升到 <code>4ms</code> 之后大部分机器上都不再产生此现象。以致在后续的浏览器厂商的采用了<code>4ms</code>的设定。随后<code>HTML standard</code>才进行了相关规范的设定。</p> <div class="custom-block tip"><p class="title">TIP</p><p>总结</p> <p>不同浏览器的最低时延会不一致，比如 <code>chrome</code> 的最低时延是 <code>1ms</code>。而如果 <code>timer</code> 嵌套层级很多，那么最低时延是 <code>4ms</code>。具体嵌套层级的阈值不同浏览器也不一致，<code>HTML Standard</code> 当中是 <code>&gt;5</code>，<code>chrome</code> 当中是 <code>&gt;=5</code>。</p></div><h2 id="ajax、fetch与axios"><a href="#ajax、fetch与axios" class="header-anchor">#</a> ajax、fetch与axios</h2> <h3 id="ajax"><a href="#ajax" class="header-anchor">#</a> Ajax</h3> <p><code>Ajax</code> 技术的核心是 <code>XMLHttpRequest</code> 对象（简称 <code>XHR</code>）,意味着用户可以不必刷新页面也能取得新数据。 也就是说，可以使用 <code>XHR</code> 对象取得新数据，然后再通过 DOM 将新数据插入到页面中。另外，虽然名字中包含 XML 的成分，但 Ajax 通信与数据格式无关；</p> <p>这里讨论的原生XHR不考虑<code>IE7</code>之前的版本。</p> <p>Q: 如何创建一个<code>XHR</code>?</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>XHR</code> 的用法</p> <p>在使用 <code>XHR</code> 对象时，要调用的第一个方法是 <code>open()</code>，它接受 3 个参数：</p> <ol><li>要发送的请求的类型（&quot;<code>get</code>&quot;、&quot;<code>post</code>&quot;等）、</li> <li>请求的 <code>URL</code></li> <li>表示是否异步发送请求的布尔值。</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code>xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;example.php&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="custom-block tip"><p class="title">TIP</p><p>这行代码会启动一个针对<code>example.php</code> 的 <code>GET</code> 请求。有关这行代码，需要说明两点：</p> <p><code>URL</code> 相对于执行代码的当前页面（当然也可以使用绝对路径）；
调用 <code>open()</code> 方法并不会真正发送请求，而只是启动一个请求以备发送。</p></div><div class="custom-block warning"><p class="title">WARNING</p><p>只能向同一个域中使用相同端口和协议的 <code>URL</code> 发送请求。如果 <code>URL</code> 与启动请求的页面有任何差别，都会引发安全错误。</p></div><p>要发送特定的请求，必须像下面这样调用 <code>send()</code>方法：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;example.txt&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>这里的 <code>send()</code>方法接收一个参数，即要作为请求主体发送的数据。</p> <p>如果不需要通过请求主体发送数据，则必须传入 <code>null</code>，因为这个参数对有些浏览器来说是必需的。调用 <code>send()</code>之后，请求就会被分派到服务器。</p> <p>在收到响应后，响应的数据会自动填充 <code>XHR</code> 对象的属性，相关的属性简介如下。</p> <ul><li><code>responseText</code>：作为响应主体被返回的文本。</li> <li><code>responseXML</code>：如果响应的内容类型是<code>text/xml</code>或<code>application/xml</code>，这个属性中将保存包含着响应数据的 <code>XML DOM</code> 文档。</li> <li><code>status</code>：响应的 <code>HTTP</code> 状态。</li></ul> <div class="language-markdown line-numbers-mode"><pre class="language-markdown"><code>0：未初始化，还没有调用send()方法；

1：载入，已调用send()方法，正在发送请求；

2：载入完成，send()方法执行完成，已经接收到全部响应内容；

3：交互，正在解析响应内容；

4：完成，响应内容解析完成，可以在客户端进行调用了；
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li><code>statusText</code>：<code>HTTP</code> 状态的说明。</li></ul> <p>在接收到响应后，第一步是检查 <code>status</code> 属性，以确定响应已经成功返回。</p> <p>一般来说，可以将 <code>HTTP</code> 状态代码为 <code>200</code> 作为成功的标志。此时，<code>responseText</code> 属性的内容已经就绪，而且在内容类型正确的 情况下，<code>responseXML</code> 也应该能够访问了。</p> <div class="language-markdown line-numbers-mode"><pre class="language-markdown"><code><span class="token list punctuation">*</span> 1 表示消息
<span class="token list punctuation">*</span> 2 表示成功
<span class="token list punctuation">*</span> 3 表示重定向
<span class="token list punctuation">*</span> 4 表示请求错误
<span class="token list punctuation">*</span> 5 表示服务器错误

1xx

代表请求已被接受，需要继续处理。这类响应是临时响应，只包含状态行和某些可选的响应头信息，并以空行结束

常见的有：

100（客户端继续发送请求，这是临时响应）：这个临时响应是用来通知客户端它的部分请求已经被服务器接收，且仍未被拒绝。客户端应当继续发送请求的剩余部分，或者如果请求已经完成，忽略这个响应。服务器必须在请求完成后向客户端发送一个最终响应
101：服务器根据客户端的请求切换协议，主要用于websocket或http2升级
2xx

代表请求已成功被服务器接收、理解、并接受

常见的有：

200（成功）：请求已成功，请求所希望的响应头或数据体将随此响应返回
201（已创建）：请求成功并且服务器创建了新的资源
202（已创建）：服务器已经接收请求，但尚未处理
203（非授权信息）：服务器已成功处理请求，但返回的信息可能来自另一来源
204（无内容）：服务器成功处理请求，但没有返回任何内容
205（重置内容）：服务器成功处理请求，但没有返回任何内容
206（部分内容）：服务器成功处理了部分请求
3xx

表示要完成请求，需要进一步操作。通常，这些状态代码用来重定向

常见的有：

300（多种选择）：针对请求，服务器可执行多种操作。服务器可根据请求者 (user agent) 选择一项操作，或提供操作列表供请求者选择
301（永久移动）：请求的网页已永久移动到新位置。服务器返回此响应（对 GET 或 HEAD 请求的响应）时，会自动将请求者转到新位置
302（临时移动）：服务器目前从不同位置的网页响应请求，但请求者应继续使用原有位置来进行以后的请求
303（查看其他位置）：请求者应当对不同的位置使用单独的 GET 请求来检索响应时，服务器返回此代码
305 （使用代理）：请求者只能使用代理访问请求的网页。如果服务器返回此响应，还表示请求者应使用代理
307 （临时重定向）：服务器目前从不同位置的网页响应请求，但请求者应继续使用原有位置来进行以后的请求
4xx

代表了客户端看起来可能发生了错误，妨碍了服务器的处理

常见的有：

400（错误请求）：服务器不理解请求的语法
401（未授权）：请求要求身份验证。对于需要登录的网页，服务器可能返回此响应。
403（禁止）：服务器拒绝请求
404（未找到）：服务器找不到请求的网页
405（方法禁用）：禁用请求中指定的方法
406（不接受）：无法使用请求的内容特性响应请求的网页
407（需要代理授权）：此状态代码与 401（未授权）类似，但指定请求者应当授权使用代理
408（请求超时）：服务器等候请求时发生超时
5xx

表示服务器无法完成明显有效的请求。这类状态码代表了服务器在处理请求的过程中有错误或者异常状态发生

常见的有：

500（服务器内部错误）：服务器遇到错误，无法完成请求
501（尚未实施）：服务器不具备完成请求的功能。例如，服务器无法识别请求方法时可能会返回此代码
502（错误网关）：服务器作为网关或代理，从上游服务器收到无效响应
503（服务不可用）：服务器目前无法使用（由于超载或停机维护）
504（网关超时）：服务器作为网关或代理，但是没有及时从上游服务器收到请求
505（HTTP 版本不受支持）：服务器不支持请求中所用的 HTTP 协议版本

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br></div></div><p>此外，状态代码为 <code>304</code> 表示请求的资源并没有被修改，可以直接使用浏览器中缓存的版本；当然，也意味着响应是有效的。为确保接收到适当的响应，应该像下面这样检查上述这两种状态代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;example.txt&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token operator">||</span> xhr<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">304</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
    <span class="token function">alert</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> 
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;Request Fail: &quot;</span> <span class="token operator">+</span> xhr<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>建议通过检测 <code>status</code> 来决定下一步的操作，不要依赖 <code>statusText</code>，因为后者在跨浏览器使用时不太可靠。另外，无论内容类型是什么，响应主体的内容都会保存到 <code>responseText</code> 属性中；而对于非 <code>XML</code> 数据而言，<code>responseXML</code> 属性的值将为 <code>null</code>。</p> <p><strong>异步XHR</strong></p> <p>像前面这样发送<code>同步请求</code>当然没有问题，但多数情况下，我们还是要发送<code>异步请求</code>，才能让 <code>JavaScript</code> 继续执行而不必等待响应。</p> <p>此时，可以检测 <code>XHR</code> 对象的 <code>readyState</code> 属性，该属性表示请求/响应过程的当前活动阶段。这个属性可取的值如下:</p> <ul><li>0：未初始化。尚未调用 <code>open()</code>方法。</li> <li>1：启动。已经调用 <code>open()</code>方法，但尚未调用 <code>send()</code>方法。</li> <li>2：发送。已经调用 <code>send()</code>方法，但尚未接收到响应。</li> <li>3：接收。已经接收到部分响应数据。</li> <li>4：完成。已经接收到全部响应数据，而且已经可以在客户端使用了。</li></ul> <p>只要 <code>readyState</code> 属性的值由一个值变成另一个值，都会触发一次 <code>readystatechange</code> 事件。可以利用这个事件来检测每次状态变化后 <code>readyState</code> 的值。</p> <p>通常，我们只对 <code>readyState</code> 值为 <code>4</code> 的阶段感兴趣，因为这时所有数据都已经就绪。</p> <p>不过，必须在调用 <code>open()</code>之前指定 <code>onreadystatechange</code> 事件处理程序才能确保跨浏览器兼容性。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
    <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token operator">||</span> xhr<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">304</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
            <span class="token function">alert</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> 
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;Request Fail: &quot;</span> <span class="token operator">+</span> xhr<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;example.txt&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>另外，在接收到响应之前还可以调用 <code>abort()</code>方法来取消异步请求，如下所示：</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>xhr<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>调用这个方法后，<code>XHR</code> 对象会停止触发事件，而且也不再允许访问任何与响应有关的对象属性。</p> <p><strong>设置HTTP头部信息</strong></p> <p>每个 <code>HTTP</code> 请求和响应都会带有相应的<code>头部信息</code>，<code>XHR</code> 对象也提供了操作这两种头部（即<code>请求头部</code>和<code>响应头部</code>）信息的方法。</p> <p>默认情况下，在发送 <code>XHR</code> 请求的同时，还会发送下列头部信息。</p> <ul><li><code>Accept</code>：浏览器能够处理的内容类型。</li> <li><code>Accept-Charset</code>：浏览器能够显示的字符集。</li> <li><code>Accept-Encoding</code>：浏览器能够处理的压缩编码。</li> <li><code>Accept-Language</code>：浏览器当前设置的语言。</li> <li><code>Connection</code>：浏览器与服务器之间连接的类型。</li> <li><code>Cookie</code>：当前页面设置的任何 Cookie。</li> <li><code>Host</code>：发出请求的页面所在的域 。</li> <li><code>Referer</code>：发出请求的页面的 URI。注意，HTTP 规范将这个头部字段拼写错了，而为保证与规范一致，也只能将错就错了。（这个英文单词的正确拼法应该是 referrer。）</li> <li><code>User-Agent</code>：浏览器的用户代理字符串。</li></ul> <p>使用 <code>setRequestHeader()</code>方法可以设置自定义的请求头部信息。</p> <p>这个方法接受两个参数：头部字段的名称和头部字段的值。</p> <p>要成功发送请求头部信息，必须在调用 <code>open()</code> 方法之后且调用 <code>send()</code> 方法之前调用 <code>setRequestHeader()</code>，如下面的例子所示。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
    <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token operator">||</span> xhr<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">304</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
            <span class="token function">alert</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> 
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;Request Fail: &quot;</span> <span class="token operator">+</span> xhr<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;example.php&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">&quot;token&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;112233&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>调用 <code>XHR</code> 对象的 <code>getResponseHeader()</code>方法并传入头部字段名称，可以取得相应的响应头部信息。而调用 <code>getAllResponseHeaders()</code>方法则可以取得一个包含所有头部信息的长字符串。来看下面的例子。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> myHeader <span class="token operator">=</span> xhr<span class="token punctuation">.</span><span class="token function">getResponseHeader</span><span class="token punctuation">(</span><span class="token string">&quot;MyHeader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">let</span> allHeaders <span class="token operator">=</span> xhr<span class="token punctuation">.</span><span class="token function">getAllResponseHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>在服务器端，也可以利用头部信息向浏览器发送额外的、结构化的数据。在没有自定义信息的情况下，<code>getAllResponseHeaders()</code>方法通常会返回如下所示的多行文本内容：</p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>Date: Sun, 14 Nov 2004 18:04:03 GMT 
Server: Apache/1.3.29 (Unix) 
Vary: Accept 
X-Powered-By: PHP/4.3.8 
Connection: close 
Content-Type: text/html; charset=iso-8859-1 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>这种格式化的输出可以方便我们检查响应中所有头部字段的名称，而不必一个一个地检查某个字段是否存在。</p> <p><strong>XHR使用GET请求</strong></p> <p><code>GET</code> 是最常见的请求类型，最常用于向服务器查询某些信息。<code>GET</code> 请求的参数需要追加到 <code>URL</code> 的末尾，以便将信息发送给服务器。对 <code>XHR</code> 而言，位于传入 <code>open()</code>方法的 <code>URL</code> 末尾的查询字符串必须经过正确的编码才行。</p> <p>查询字符串中每个参数的名称和值都必须使用 <code>encodeURIComponent()</code>进行编码，然后才能放到 <code>URL</code> 的末尾；而且所有名-值对 儿都必须由和号（<code>&amp;</code>）分隔，如下面的例子所示。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;example.php?name1=value1&amp;name2=value2&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>下面这个函数可以辅助向现有 URL 的末尾添加查询字符串参数：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">addURLParam</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> name<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    url <span class="token operator">+=</span> <span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;?&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">?</span> <span class="token string">&quot;?&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;&amp;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    url <span class="token operator">+=</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;=&quot;</span> <span class="token operator">+</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token keyword">return</span> url<span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>下面是使用这个函数来构建请求 URL 的示例。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token string">&quot;example.php&quot;</span><span class="token punctuation">;</span> 
<span class="token comment">//添加参数</span>
url <span class="token operator">=</span> <span class="token function">addURLParam</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Nicholas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
url <span class="token operator">=</span> <span class="token function">addURLParam</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token string">&quot;book&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Professional JavaScript&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//初始化请求</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>在这里使用 <code>addURLParam()</code>函数可以确保查询字符串的格式良好，并可靠地用于 <code>XHR</code> 对象。</p> <p><strong>XHR使用POST请求</strong></p> <p><code>POST</code> 请求把数据作为请求的主体提交，请求的主体可以包含非常多的数据，而且格式不限。在 <code>open()</code>方法第一个参数的位置传入<code>post</code>，就可以初始化一个 <code>POST</code> 请求，如下面的例子所示。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;post&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;example.php&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>发送 <code>POST</code> 请求的第二步就是向 <code>send()</code>方法中传入某些数据。由于 <code>XHR</code> 最初的设计主要是为了处理 <code>XML</code>，因此可以在此传入 <code>XML DOM</code> 文档，传入的文档经序列化之后将作为请求主体被提交到服务器。当然，也可以在此传入任何想发送到服务器的字符串。</p> <p><strong>FormData</strong></p> <p>现代 <code>Web</code> 应用中频繁使用的一项功能就是表单数据的序列化，<code>XMLHttpRequest 2</code> 级为此定义了 <code>FormData</code> 类型。<code>FormData</code> 为序列化表单以及创建与表单格式相同的数据（用于通过 <code>XHR</code> 传输）提供了便利。下面的代码创建了一个 <code>FormData</code> 对象，并向其中添加了一些数据。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
data<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Nicholas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>这个 <code>append()</code> 方法接收两个参数：<code>键和值</code>，分别对应表单字段的名字和字段中包含的值。可以像这样添加任意多个键值对。而通过向 <code>FormData</code> 构造函数中传入表单元素，也可以用表单元素的数据预先向其中填入键值对儿：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>forms<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>创建了 <code>FormData</code> 的实例后，可以将它直接传给 <code>XHR</code> 的 <code>send()</code> 方法，如下所示：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
    <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token operator">||</span> xhr<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">304</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
            <span class="token function">alert</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> 
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;Request Fail: &quot;</span> <span class="token operator">+</span> xhr<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;post&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;example.php&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">&quot;token&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;112233&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">let</span> form <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;user-info&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span>form<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="custom-block tip"><p class="title">TIP</p><p>使用 <code>FormData</code> 的方便之处体现在不必明确地在 <code>XHR</code> 对象上设置请求头部。<code>XHR</code> 对象能够识别传入的数据类型是 <code>FormData</code> 的实例，并配置适当的头部信息。</p></div><p><strong>超时设定</strong></p> <p><code>IE8</code> 为 <code>XHR</code> 对象添加了一个 <code>timeout</code> 属性，表示请求在等待响应多少毫秒之后就终止。在给 <code>timeout</code> 设置一个数值后，如果在规定的时间内浏览器还没有接收到响应，那么就会触发 <code>timeout</code> 事件，进而会调用 <code>ontimeout</code> 事件处理程序。这项功能后来也被收入了 <code>XMLHttpRequest 2</code> 级规范中。来看下面的例子。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
    <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
        <span class="token keyword">try</span> <span class="token punctuation">{</span> 
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token operator">||</span> xhr<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">304</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
                <span class="token function">alert</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> 
                <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;Request was unsuccessful: &quot;</span> <span class="token operator">+</span> xhr<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token punctuation">}</span> 
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">{</span> 
            <span class="token comment">// 假设由 ontimeout 事件处理程序处理</span>
        <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;timeout.php&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
xhr<span class="token punctuation">.</span>timeout <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span> <span class="token comment">// 将超时设置为 1 秒钟（仅适用于 IE8+）</span>
xhr<span class="token punctuation">.</span><span class="token function-variable function">ontimeout</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;Request Timeout.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><strong><code>overrideMimeType()</code>方法</strong></p> <p><code>Firefox</code> 最早引入了 <code>overrideMimeType()</code>方法，用于重写 <code>XHR</code> 响应的 <code>MIME</code> 类型。这个方法后来也被纳入了 <code>XMLHttpRequest 2</code> 级规范。</p> <p>因为返回响应的 <code>MIME</code> 类型决定了 <code>XHR</code> 对象如何处理它，所以提供一种方法能够重写服务器返回的 <code>MIME</code> 类型是很有用的。</p> <p>比如，服务器返回的 <code>MIME</code> 类型是 <code>text/plain</code>，但数据中实际包含的是 <code>XML</code>。根据 <code>MIME</code> 类型，即使数据是 <code>XML</code>，<code>responseXML</code> 属性中仍然是 <code>null</code>。通过调用 <code>overrideMimeType()</code>方法，可以保证把响应当作 <code>XML</code> 而非纯文本来处理。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text.php&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
xhr<span class="token punctuation">.</span><span class="token function">overrideMimeType</span><span class="token punctuation">(</span><span class="token string">&quot;text/xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="custom-block warning"><p class="title">WARNING</p><p>这个例子强迫 <code>XHR</code> 对象将响应当作 <code>XML</code> 而非纯文本来处理。调用 <code>overrideMimeType()</code>必须在<code>send()</code>方法之前，才能保证重写响应的 <code>MIME</code> 类型。</p></div><p><strong>进度事件</strong></p> <p><code>Progress Events</code>定义了与客户端服务器通信有关的事件。这些事件最早其实只针对 <code>XHR</code> 操作，但目前也被其它 <code>API</code> 借鉴。有以下6个进度事件。</p> <ul><li><code>loadstart</code>：在接收到相应数据的第一个字节时触发。</li> <li><code>progress</code>：在接收相应期间持续不断触发。</li> <li><code>error</code>：在请求发生错误时触发。</li> <li><code>abort</code>：在因为调用 <code>abort()</code> 方法而终止链接时触发。</li> <li><code>load</code>：在接收到完整的相应数据时触发。</li> <li><code>loadend</code>：在通信完成或者触发 <code>error</code>、<code>abort</code> 或 <code>load</code> 事件后触发。</li></ul> <p>每个请求从触发 <code>Loadstart</code> 事件开始，接下来是一或多个 <code>progress</code> 事件，然后触发 <code>error</code>、<code>abort</code> 或 <code>load</code> 事件中的一个，最后以触发 <code>loadend</code> 事件结束。</p> <p><strong><code>load</code>事件</strong></p> <p><code>Firefox</code> 在实现 <code>XHR</code> 对象的某个版本时，曾致力于简化异步交互模型。最终，<code>Firefox</code> 实现中引入了 <code>load</code> 事件，用以替代 <code>readystatechange</code> 事件。</p> <p>响应接收完毕后将触发 <code>load</code> 事件，因此也就没有必要去检查 <code>readyState</code> 属性了。而 <code>onload</code> 事件处理程序会接收到一个 <code>event</code> 对象，其 <code>target</code> 属性就指向 <code>XHR</code> 对象实例，因而可以访问到 <code>XHR</code> 对象的所有方法和属性。</p> <p>然而，并非所有浏览器都为这个事件实现了适当的事件对象。结果，开发人员还是要像下面这样被迫使用 <code>XHR</code> 对象变量。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> xhr <span class="token operator">=</span> <span class="token function">createXHR</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token operator">||</span> xhr<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">304</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
        <span class="token function">alert</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> 
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;Request was unsuccessful: &quot;</span> <span class="token operator">+</span> xhr<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>   
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;altevents.php&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="custom-block tip"><p class="title">TIP</p><p>只要浏览器接收到服务器的响应，不管其状态如何，都会触发 <code>load</code> 事件。而这意味着你必须要检查 <code>status</code> 属性，才能确定数据是否真的已经可用了。</p> <p><code>Firefox</code>、<code>Opera</code>、<code>Chrome</code> 和 <code>Safari</code> 都支持 <code>load</code> 事件。</p></div><p><strong><code>progress</code>事件</strong></p> <p><code>Mozilla</code> 对 <code>XHR</code> 的另一个革新是添加了 <code>progress</code> 事件，这个事件会在浏览器接收新数据期间周期性地触发。</p> <p>而 <code>onprogress</code> 事件处理程序会接收到一个 <code>event</code> 对象，其 <code>target</code> 属性是 <code>XHR</code> 对象，但包含着三个额外的属性：<code>lengthComputable</code>、<code>position</code> 和 <code>totalSize</code>。</p> <ul><li><code>lengthComputable</code>:表示进度信息是否可用的布尔值，</li> <li><code>position</code>: 表示已经接收的字节数，</li> <li><code>totalSize</code>: 表示根据 <code>Content-Length</code> 响应头部确定的预期字节数。</li></ul> <p>有了这些信息，我们就可以为用户创建一个进度指示器了。下面展示了为用户创建进度指示器的一个示例:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> xhr <span class="token operator">=</span> <span class="token function">createXHR</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token operator">||</span> xhr<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">304</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
        <span class="token function">alert</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> 
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;Request was unsuccessful: &quot;</span> <span class="token operator">+</span> xhr<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
xhr<span class="token punctuation">.</span><span class="token function-variable function">onprogress</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
    <span class="token keyword">let</span> divStatus <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;status&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>lengthComputable<span class="token punctuation">)</span><span class="token punctuation">{</span> 
        divStatus<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">&quot;Received &quot;</span> <span class="token operator">+</span> event<span class="token punctuation">.</span>position <span class="token operator">+</span> <span class="token string">&quot; of &quot;</span> <span class="token operator">+</span> event<span class="token punctuation">.</span>totalSize <span class="token operator">+</span><span class="token string">&quot; bytes&quot;</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;altevents.php&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><div class="custom-block warning"><p class="title">WARNING</p><p>为确保正常执行，必须在调用 <code>open()</code> 方法之前添加 <code>onprogress</code> 事件处理程序。</p></div><p>在前面的例子中，每次触发 <code>progress</code> 事件，都会以新的状态信息更新 <code>HTML</code> 元素的内容。如果响应头部中包含 <code>Content-Length</code> 字段，那么也可以利用此信息来计算从响应中已经接收到的数据的百分比。</p> <p><strong>跨源资源共享</strong></p> <p>通过 <code>XHR</code> 实现 <code>Ajax</code> 通信的一个主要限制，来源于跨域安全策略。</p> <p>默认情况下，<code>XHR</code> 对象只能访问与包含它的页面位于同一个域中的资源。这种安全策略可以预防某些恶意行为。但是，实现合理的跨域请求对开发某些浏览器应用程序也是至关重要的。</p> <p><code>CORS（Cross-Origin Resource Sharing，跨源资源共享）</code>定义了在必须访问跨源资源时，浏览器与服务器应该如何沟通。</p> <p><code>CORS</code> 背后的基本思想，就是使用自定义的 <code>HTTP</code> 头部让浏览器与服务器进行沟通，从而决定请求或响应是应该成功，还是应该失败。</p> <p>比如一个简单的使用 <code>GET</code> 或 <code>POST</code> 发送的请求，它没有自定义的头部，而主体内容是 <code>text/plain</code>。在发送该请求时，需要给它附加一个额外的 <code>Origin</code> 头部，其中包含请求页面的源信息（协议、域名和端口），以便服务器根据这个头部信息来决定是否给予响应。下面是 <code>Origin</code> 头部的一个示例：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Origin: http://www.nczonline.net
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果服务器认为这个请求可以接受，就在 <code>Access-Control-Allow-Origin</code> 头部中回发相同的源信息（如果是公共资源，可以回发<code>*</code>）。例如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Access<span class="token operator">-</span>Control<span class="token operator">-</span>Allow<span class="token operator">-</span>Origin<span class="token operator">:</span> http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>nczonline<span class="token punctuation">.</span>net
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果没有这个头部，或者有这个头部但源信息不匹配，浏览器就会驳回请求。正常情况下，浏览器会处理请求。</p> <div class="custom-block warning"><p class="title">WARNING</p><p>注意，请求和响应都不包含 cookie 信息。</p> <p>要请求位于另一个域中的资源，使用标准的 XHR 对象并在 open()方法中传入绝对 URL 即可(IE除外)</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>xhr.open(&quot;get&quot;, &quot;http://www.somewhere-else.com/page/&quot;, true);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div><p><strong>带凭据的请求</strong></p> <p>默认情况下，跨源请求不提供凭据（<code>cookie</code>、<code>HTTP</code> 认证及客户端 <code>SSL</code> 证明等 ）。</p> <p>通过将 <code>withCredentials</code> 属性设置为 <code>true</code>，可以指定某个请求应该发送凭据。如果服务器接受带凭据的请求，会用下面的 <code>HTTP</code> 头部来响应。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Access-Control-Allow-Credentials: true
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果发送的是带凭据的请求，但服务器的响应中没有包含这个头部，那么浏览器就不会把响应交给 <code>JavaScript</code>（于是，<code>responseText</code> 中将是空字符串，<code>status</code> 的值为 0，而且会调用 <code>onerror()</code> 事件处理程序）。</p> <p>另外，服务器还可以在 <code>Preflight</code> 响应中发送这个 <code>HTTP</code> 头部，表示允许源发送带凭据的请求。</p> <p><strong><code>Fetch</code></strong></p> <p><code>fetch</code> 是一种 <code>HTTP</code> 数据请求的方式，是 <code>XMLHttpRequest</code> 的一种替代方案。<code>fetch</code> 不是 <code>ajax</code> 的进一步封装，而是<code>原生js</code>,直接挂载在 <code>window</code> 对象上。</p> <p>它的<code>API</code>是基于 <code>Promise</code> 设计的，旧版本的浏览器不支持 <code>Promise</code>，需要使用<code>polyfill es6-promise</code>。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 原生XHR</span>
<span class="token keyword">let</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span>   <span class="token comment">// 从服务器获取数据</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// fetch</span>
<span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// fetch + async</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><div class="custom-block warning"><p class="title">WARNING</p><p>从 <code>MDN</code> 上看，<code>fetch</code> 规范与 <code>jQuery.ajax()</code> 主要有三种方式的不同：</p> <p>当接收到一个代表错误的 <code>HTTP</code> 状态码时，从 <code>fetch()</code> 返回的 <code>Promise</code> 不会被标记为 <code>reject</code>， 即使响应的 <code>HTTP</code> 状态码是 <code>404</code> 或 <code>500</code>。相反，它会将 <code>Promise</code> 状态标记为 <code>resolve</code> （但是会将 <code>resolve</code> 的返回值的 <code>ok</code> 属性设置为 <code>false</code>），仅当网络故障时或请求被阻止时，才会标记为 <code>reject</code>。</p> <p><code>fetch()</code> 不会接受跨域 <code>cookies</code>；你也不能使用 <code>fetch()</code> 建立起跨域会话。其他网站的 <code>Set-Cookie</code> 头部字段将会被无视。</p> <p><code>fetch</code> 不会发送 <code>cookies</code>。除非你使用了 <code>credentials</code> 的初始化选项。（自2017年8月25日以后，默认的 <code>credentials</code> 政策变更为 <code>same-origin</code>。<code>Firefox</code> 也在 <code>61.0b13</code> 版本中进行了修改）。</p></div><blockquote><p>fetch(input, options)</p></blockquote> <p><code>input</code> 定义要获取的资源。这可能是： 一个 <code>String</code> 字符串，包含要获取资源的 <code>URL</code> 或者一个 <code>Request</code> 对象。</p> <p><code>init</code> 可选 一个配置项对象，包括所有对请求的设置。可选的参数有：</p> <ul><li><code>method</code>: 请求使用的方法，如 <code>GET</code>、<code>POST</code>。</li> <li><code>headers</code>: 请求的头信息，形式为 <code>Headers</code> 对象或 <code>ByteString</code>。</li> <li><code>body</code>: 请求的 <code>body</code> 信息：可能是一个 <code>Blob</code>、<code>BufferSource</code>、<code>FormData</code>、<code>URLSearchParams</code> 或者 <code>USVString</code> 对象。</li> <li><code>mode</code>: 请求的模式，如 <code>cors</code>、 <code>no-cors</code> 或者 <code>same-origin</code>。</li> <li><code>credentials</code>: 请求的 <code>credentials</code>，如 <code>omit</code>、<code>same-origin</code> 或者 <code>include</code>。</li> <li><code>cache</code>: 请求的 <code>cache</code> 模式: <code>default</code>, <code>no-store</code>, <code>reload</code>, <code>no-cache</code>, <code>force-cache</code>, or <code>only-if-cached</code>.</li></ul> <div class="custom-block warning"><p class="title">WARNING</p><p>注意 <code>GET</code> 或 <code>HEAD</code> 方法的请求不能包含 <code>body</code> 信息。</p></div><p>一个封装的fetch列子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> codeMessage <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token number">200</span><span class="token operator">:</span> <span class="token string">'服务器成功返回请求的数据。'</span><span class="token punctuation">,</span>
  <span class="token number">201</span><span class="token operator">:</span> <span class="token string">'新建或修改数据成功。'</span><span class="token punctuation">,</span>
  <span class="token number">202</span><span class="token operator">:</span> <span class="token string">'一个请求已经进入后台排队（异步任务）。'</span><span class="token punctuation">,</span>
  <span class="token number">204</span><span class="token operator">:</span> <span class="token string">'删除数据成功。'</span><span class="token punctuation">,</span>
  <span class="token number">400</span><span class="token operator">:</span> <span class="token string">'发出的请求有错误，服务器没有进行新建或修改数据的操作。'</span><span class="token punctuation">,</span>
  <span class="token number">401</span><span class="token operator">:</span> <span class="token string">'登录失效,请重新登录。'</span><span class="token punctuation">,</span>
  <span class="token number">403</span><span class="token operator">:</span> <span class="token string">'用户得到授权，但是访问是被禁止的。'</span><span class="token punctuation">,</span>
  <span class="token number">404</span><span class="token operator">:</span> <span class="token string">'发出的请求针对的是不存在的记录，服务器没有进行操作。'</span><span class="token punctuation">,</span>
  <span class="token number">406</span><span class="token operator">:</span> <span class="token string">'请求的格式不可得。'</span><span class="token punctuation">,</span>
  <span class="token number">410</span><span class="token operator">:</span> <span class="token string">'请求的资源被永久删除，且不会再得到的。'</span><span class="token punctuation">,</span>
  <span class="token number">422</span><span class="token operator">:</span> <span class="token string">'当创建一个对象时，发生一个验证错误。'</span><span class="token punctuation">,</span>
  <span class="token number">500</span><span class="token operator">:</span> <span class="token string">'服务器发生错误，请检查服务器。'</span><span class="token punctuation">,</span>
  <span class="token number">502</span><span class="token operator">:</span> <span class="token string">'网关错误。'</span><span class="token punctuation">,</span>
  <span class="token number">503</span><span class="token operator">:</span> <span class="token string">'服务不可用，服务器暂时过载或维护。'</span><span class="token punctuation">,</span>
  <span class="token number">504</span><span class="token operator">:</span> <span class="token string">'网关超时。'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">checkStatus</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> response<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> response<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> errortext <span class="token operator">=</span> codeMessage<span class="token punctuation">[</span>response<span class="token punctuation">.</span>status<span class="token punctuation">]</span> <span class="token operator">||</span> response<span class="token punctuation">.</span>statusText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> error <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>errortext<span class="token punctuation">)</span><span class="token punctuation">;</span>
  error<span class="token punctuation">.</span>name <span class="token operator">=</span> response<span class="token punctuation">.</span>status<span class="token punctuation">;</span>
  error<span class="token punctuation">.</span>response <span class="token operator">=</span> response<span class="token punctuation">;</span>
  <span class="token keyword">throw</span> error<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * Requests a URL, returning a promise.
 *
 * @param  {string} url       The URL we want to request
 * @param  {object} [options] The options we want to pass to &quot;fetch&quot;
 * @return {object}           An object containing either &quot;data&quot; or &quot;err&quot;
 */</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> defaultOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// 携带cookie </span>
    <span class="token literal-property property">credentials</span><span class="token operator">:</span> <span class="token string">'include'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> newOptions <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>defaultOptions<span class="token punctuation">,</span> <span class="token operator">...</span>options <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>newOptions<span class="token punctuation">.</span>method <span class="token operator">===</span> <span class="token string">'POST'</span> <span class="token operator">||</span> newOptions<span class="token punctuation">.</span>method <span class="token operator">===</span> <span class="token string">'PUT'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>newOptions<span class="token punctuation">.</span>body <span class="token keyword">instanceof</span> <span class="token class-name">FormData</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      newOptions<span class="token punctuation">.</span>headers <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">Accept</span><span class="token operator">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
        <span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json; charset=utf-8'</span><span class="token punctuation">,</span>
        <span class="token operator">...</span>newOptions<span class="token punctuation">.</span>headers<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      newOptions<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>newOptions<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// newOptions.body is FormData</span>
      newOptions<span class="token punctuation">.</span>headers <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">Accept</span><span class="token operator">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
        <span class="token operator">...</span>newOptions<span class="token punctuation">.</span>headers<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> newOptions<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>checkStatus<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>newOptions<span class="token punctuation">.</span>method <span class="token operator">===</span> <span class="token string">'DELETE'</span> <span class="token operator">||</span> response<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">204</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> dispatch <span class="token punctuation">}</span> <span class="token operator">=</span> store<span class="token punctuation">;</span>
      <span class="token keyword">const</span> status <span class="token operator">=</span> e<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>status <span class="token operator">===</span> <span class="token number">401</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br></div></div><p><strong>Q:Fetch请求本身不支持超时如何支持?</strong></p> <p><strong><code>Promise.race</code></strong></p> <p><code>Promise.race</code>接收一个<code>promise</code>对象数组为参数,只要有一个<code>promise</code>对象进入 <code>Resolved</code> 或者 <code>Rejected</code> 状态的话，就会继续进行后面的处理。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">_fetch</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">requestPromise<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">30000</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> timeoutAction <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> timerPromise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">timeoutAction</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'请求超时'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">timeoutAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> timeout<span class="token punctuation">)</span>
  <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>requestPromise<span class="token punctuation">,</span>timerPromise<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong><code>axios</code></strong></p> <p><code>axios</code> 是一个基于 <code>Promise</code> 的库，它是对原生 <code>XHR</code> 的封装。它有以下几大特性:</p> <ul><li>可以在<code>node.js</code>中使用</li> <li>提供了并发请求的接口</li> <li>支持<code>Promise API</code></li></ul> <p><strong>简单的get请求</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token constant">ID</span><span class="token operator">:</span> <span class="token number">12345</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>简单的post请求</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">firstName</span><span class="token operator">:</span> <span class="token string">'Fred'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">lastName</span><span class="token operator">:</span> <span class="token string">'Flintstone'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>使用并发请求:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getUserAccount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user/12345'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">getUserPermissions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user/12345/permissions'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

axios<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">getUserAccount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getUserPermissions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>axios<span class="token punctuation">.</span><span class="token function">spread</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">acct<span class="token punctuation">,</span> perms</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Both requests are now complete</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>自定义配置新建一个 <code>axios</code> 实例</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> instance <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">baseURL</span><span class="token operator">:</span> <span class="token string">'https://some-domain.com/api/'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
  <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">'X-Custom-Header'</span><span class="token operator">:</span> <span class="token string">'foobar'</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong><code>axios</code>请求配置</strong></p> <p>这些是创建请求时可以用的配置选项。只有 <code>url</code> 是必需的。如果没有指定 <code>method</code>，请求将默认使用 <code>get</code> 方法。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
   <span class="token comment">// `url` 是用于请求的服务器 URL</span>
  <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'/user'</span><span class="token punctuation">,</span>

  <span class="token comment">// `method` 是创建请求时使用的方法</span>
  <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'get'</span><span class="token punctuation">,</span> <span class="token comment">// default</span>

  <span class="token comment">// `baseURL` 将自动加在 `url` 前面，除非 `url` 是一个绝对 URL。</span>
  <span class="token comment">// 它可以通过设置一个 `baseURL` 便于为 axios 实例的方法传递相对 URL</span>
  <span class="token literal-property property">baseURL</span><span class="token operator">:</span> <span class="token string">'https://some-domain.com/api/'</span><span class="token punctuation">,</span>

  <span class="token comment">// `transformRequest` 允许在向服务器发送前，修改请求数据</span>
  <span class="token comment">// 只能用在 'PUT', 'POST' 和 'PATCH' 这几个请求方法</span>
  <span class="token comment">// 后面数组中的函数必须返回一个字符串，或 ArrayBuffer，或 Stream</span>
  <span class="token literal-property property">transformRequest</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> headers</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 对 data 进行任意转换处理</span>
    <span class="token keyword">return</span> data<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

  <span class="token comment">// `transformResponse` 在传递给 then/catch 前，允许修改响应数据</span>
  <span class="token literal-property property">transformResponse</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 对 data 进行任意转换处理</span>
    <span class="token keyword">return</span> data<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

  <span class="token comment">// `headers` 是即将被发送的自定义请求头</span>
  <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">'X-Requested-With'</span><span class="token operator">:</span> <span class="token string">'XMLHttpRequest'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// `params` 是即将与请求一起发送的 URL 参数</span>
  <span class="token comment">// 必须是一个无格式对象(plain object)或 URLSearchParams 对象</span>
  <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token constant">ID</span><span class="token operator">:</span> <span class="token number">12345</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

   <span class="token comment">// `paramsSerializer` 是一个负责 `params` 序列化的函数</span>
  <span class="token comment">// (e.g. https://www.npmjs.com/package/qs, http://api.jquery.com/jquery.param/)</span>
  <span class="token function-variable function">paramsSerializer</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Qs<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">arrayFormat</span><span class="token operator">:</span> <span class="token string">'brackets'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// `data` 是作为请求主体被发送的数据</span>
  <span class="token comment">// 只适用于这些请求方法 'PUT', 'POST', 和 'PATCH'</span>
  <span class="token comment">// 在没有设置 `transformRequest` 时，必须是以下类型之一：</span>
  <span class="token comment">// - string, plain object, ArrayBuffer, ArrayBufferView, URLSearchParams</span>
  <span class="token comment">// - 浏览器专属：FormData, File, Blob</span>
  <span class="token comment">// - Node 专属： Stream</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">firstName</span><span class="token operator">:</span> <span class="token string">'Fred'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// `timeout` 指定请求超时的毫秒数(0 表示无超时时间)</span>
  <span class="token comment">// 如果请求话费了超过 `timeout` 的时间，请求将被中断</span>
  <span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>

   <span class="token comment">// `withCredentials` 表示跨域请求时是否需要使用凭证</span>
  <span class="token literal-property property">withCredentials</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// default</span>

  <span class="token comment">// `adapter` 允许自定义处理请求，以使测试更轻松</span>
  <span class="token comment">// 返回一个 promise 并应用一个有效的响应 (查阅 [response docs](#response-api)).</span>
  <span class="token function-variable function">adapter</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

 <span class="token comment">// `auth` 表示应该使用 HTTP 基础验证，并提供凭据</span>
  <span class="token comment">// 这将设置一个 `Authorization` 头，覆写掉现有的任意使用 `headers` 设置的自定义 `Authorization`头</span>
  <span class="token literal-property property">auth</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token string">'janedoe'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token string">'s00pers3cret'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

   <span class="token comment">// `responseType` 表示服务器响应的数据类型，可以是 'arraybuffer', 'blob', 'document', 'json', 'text', 'stream'</span>
  <span class="token literal-property property">responseType</span><span class="token operator">:</span> <span class="token string">'json'</span><span class="token punctuation">,</span> <span class="token comment">// default</span>

  <span class="token comment">// `responseEncoding` indicates encoding to use for decoding responses</span>
  <span class="token comment">// Note: Ignored for `responseType` of 'stream' or client-side requests</span>
  <span class="token literal-property property">responseEncoding</span><span class="token operator">:</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token comment">// default</span>

   <span class="token comment">// `xsrfCookieName` 是用作 xsrf token 的值的cookie的名称</span>
  <span class="token literal-property property">xsrfCookieName</span><span class="token operator">:</span> <span class="token string">'XSRF-TOKEN'</span><span class="token punctuation">,</span> <span class="token comment">// default</span>

  <span class="token comment">// `xsrfHeaderName` is the name of the http header that carries the xsrf token value</span>
  <span class="token literal-property property">xsrfHeaderName</span><span class="token operator">:</span> <span class="token string">'X-XSRF-TOKEN'</span><span class="token punctuation">,</span> <span class="token comment">// default</span>

   <span class="token comment">// `onUploadProgress` 允许为上传处理进度事件</span>
  <span class="token function-variable function">onUploadProgress</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">progressEvent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Do whatever you want with the native progress event</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// `onDownloadProgress` 允许为下载处理进度事件</span>
  <span class="token function-variable function">onDownloadProgress</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">progressEvent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 对原生进度事件的处理</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

   <span class="token comment">// `maxContentLength` 定义允许的响应内容的最大尺寸</span>
  <span class="token literal-property property">maxContentLength</span><span class="token operator">:</span> <span class="token number">2000</span><span class="token punctuation">,</span>

  <span class="token comment">// `validateStatus` 定义对于给定的HTTP 响应状态码是 resolve 或 reject  promise 。如果 `validateStatus` 返回 `true` (或者设置为 `null` 或 `undefined`)，promise 将被 resolve; 否则，promise 将被 rejecte</span>
  <span class="token function-variable function">validateStatus</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">status</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">;</span> <span class="token comment">// default</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// `maxRedirects` 定义在 node.js 中 follow 的最大重定向数目</span>
  <span class="token comment">// 如果设置为0，将不会 follow 任何重定向</span>
  <span class="token literal-property property">maxRedirects</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token comment">// default</span>

  <span class="token comment">// `socketPath` defines a UNIX Socket to be used in node.js.</span>
  <span class="token comment">// e.g. '/var/run/docker.sock' to send requests to the docker daemon.</span>
  <span class="token comment">// Only either `socketPath` or `proxy` can be specified.</span>
  <span class="token comment">// If both are specified, `socketPath` is used.</span>
  <span class="token literal-property property">socketPath</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// default</span>

  <span class="token comment">// `httpAgent` 和 `httpsAgent` 分别在 node.js 中用于定义在执行 http 和 https 时使用的自定义代理。允许像这样配置选项：</span>
  <span class="token comment">// `keepAlive` 默认没有启用</span>
  <span class="token literal-property property">httpAgent</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">http<span class="token punctuation">.</span>Agent</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">keepAlive</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">httpsAgent</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">https<span class="token punctuation">.</span>Agent</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">keepAlive</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

  <span class="token comment">// 'proxy' 定义代理服务器的主机名称和端口</span>
  <span class="token comment">// `auth` 表示 HTTP 基础验证应当用于连接代理，并提供凭据</span>
  <span class="token comment">// 这将会设置一个 `Proxy-Authorization` 头，覆写掉已有的通过使用 `header` 设置的自定义 `Proxy-Authorization` 头。</span>
  <span class="token literal-property property">proxy</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">9000</span><span class="token punctuation">,</span>
    <span class="token literal-property property">auth</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token string">'mikeymike'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token string">'rapunz3l'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// `cancelToken` 指定用于取消请求的 cancel token</span>
  <span class="token comment">// （查看后面的 Cancellation 这节了解更多）</span>
  <span class="token literal-property property">cancelToken</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">CancelToken</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">cancel</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br></div></div><p><strong><code>axios</code>响应结构</strong></p> <p>某个请求的响应包含以下信息:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token comment">// `data` 由服务器提供的响应</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// `status` 来自服务器响应的 HTTP 状态码</span>
  <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>

  <span class="token comment">// `statusText` 来自服务器响应的 HTTP 状态信息</span>
  <span class="token literal-property property">statusText</span><span class="token operator">:</span> <span class="token string">'OK'</span><span class="token punctuation">,</span>

  <span class="token comment">// `headers` 服务器响应的头</span>
  <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>

   <span class="token comment">// `config` 是为请求提供的配置信息</span>
  <span class="token literal-property property">config</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token comment">// 'request'</span>
  <span class="token comment">// `request` is the request that generated this response</span>
  <span class="token comment">// It is the last ClientRequest instance in node.js (in redirects)</span>
  <span class="token comment">// and an XMLHttpRequest instance the browser</span>
  <span class="token literal-property property">request</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p><strong><code>axios</code>配置默认值</strong></p> <p>你可以指定将被用在各个请求的配置默认值:</p> <ul><li>全局的 <code>axios</code> 默认值</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>baseURL <span class="token operator">=</span> <span class="token string">'https://api.example.com'</span><span class="token punctuation">;</span>
axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>common<span class="token punctuation">[</span><span class="token string">'Authorization'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant">AUTH_TOKEN</span><span class="token punctuation">;</span>
axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>post<span class="token punctuation">[</span><span class="token string">'Content-Type'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'application/json'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>自定义实例默认值</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// Set config defaults when creating the instance</span>
<span class="token keyword">const</span> instance <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">baseURL</span><span class="token operator">:</span> <span class="token string">'https://api.example.com'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Alter defaults after instance has been created</span>
instance<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>common<span class="token punctuation">[</span><span class="token string">'Authorization'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant">AUTH_TOKEN</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong><code>axios</code>配置的优先顺序:</strong></p> <p>配置会以一个优先顺序进行合并。这个顺序是：在 <code>lib/defaults.js</code> 找到的库的默认值，然后是实例的 <code>defaults</code> 属性，最后是请求的 <code>config</code> 参数。后者将优先于前者。这里是一个例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 使用由库提供的配置的默认值来创建实例</span>
<span class="token comment">// 此时超时配置的默认值是 `0`</span>
<span class="token keyword">var</span> instance <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 覆写库的超时默认值</span>
<span class="token comment">// 现在，在超时前，所有请求都会等待 2.5 秒</span>
instance<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>timeout <span class="token operator">=</span> <span class="token number">2500</span><span class="token punctuation">;</span>

<span class="token comment">// 为已知需要花费很长时间的请求覆写超时设置</span>
instance<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/longRequest'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token number">5000</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong><code>axios</code>拦截器:</strong></p> <p>在请求或响应被 <code>then</code> 或 <code>catch</code> 处理前拦截它们。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 添加请求拦截器</span>
axios<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 在发送请求之前做些什么</span>
    <span class="token keyword">return</span> config<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 对请求错误做些什么</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 添加响应拦截器</span>
axios<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 对响应数据做点什么</span>
    <span class="token keyword">return</span> response<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 对响应错误做点什么</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>::: TIP</p> <p>如果你想在稍后移除拦截器，可以这样：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> myInterceptor <span class="token operator">=</span> axios<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">/*...*/</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
axios<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">eject</span><span class="token punctuation">(</span>myInterceptor<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>可以为自定义 axios 实例添加拦截器:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> instance <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
instance<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">/*...*/</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>:::</p> <p><strong><code>axios</code>错误处理:</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user/12345'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// The request was made and the server responded with a status code</span>
      <span class="token comment">// that falls out of the range of 2xx</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>response<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>response<span class="token punctuation">.</span>headers<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// The request was made but no response was received</span>
      <span class="token comment">// `error.request` is an instance of XMLHttpRequest in the browser and an instance of</span>
      <span class="token comment">// http.ClientRequest in node.js</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// Something happened in setting up the request that triggered an Error</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Error'</span><span class="token punctuation">,</span> error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 也可以使用 `validateStatus` 配置选项定义一个自定义 `HTTP` 状态码的错误范围。</span>

axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user/12345'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">validateStatus</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">status</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> status <span class="token operator">&lt;</span> <span class="token number">500</span><span class="token punctuation">;</span> <span class="token comment">// Reject only if the status code is greater than or equal to 500</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h2 id="节流与防抖"><a href="#节流与防抖" class="header-anchor">#</a> 节流与防抖</h2> <blockquote><p>在前端开发的过程中，我们经常会需要绑定一些持续触发的事件，如 resize、scroll、mousemove、touchmove 等等，但有些时候我们并不希望在事件持续触发的过程中那么频繁地去执行函数。这时候就用到防抖与节流。</p></blockquote> <p><strong>函数防抖（<code>debounce</code>）：</strong></p> <blockquote><p>给一个固定时间例如5s，如果触发动作后，并且在这个固定时间内不再触发，那么就执行相应的回调，否则会重新开始计时。</p></blockquote> <p><strong>防抖应用场景</strong></p> <ol><li><p>搜索框输入查询，如果用户一直在输入中，没有必要不停地调用去请求服务端接口，等用户停止输入的时候，再调用，设置一个合适的时间间隔，有效减轻服务端压力。</p></li> <li><p>表单验证。</p></li> <li><p>按钮提交事件。</p></li> <li><p>浏览器窗口缩放，<code>resize</code> 事件(如窗口停止改变大小之后重新计算布局)等。</p></li></ol> <p><strong>防抖(非立即执行版)</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 非立即执行版的意思是触发事件后函数不会立即执行，而是在 n 秒后执行</span>
<span class="token comment">// 如果在 n 秒内又触发了事件，则会重新计算函数执行时间。</span>
<span class="token keyword">function</span> <span class="token function">debounce</span><span class="token punctuation">(</span><span class="token parameter">func<span class="token punctuation">,</span> delay</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> context <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> args <span class="token operator">=</span> arguments<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> args<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>     
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><strong>防抖(立即执行版)</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 立即执行版的意思是触发事件后函数会立即执行，然后 n 秒内不触发事件才能继续执行函数的效果</span>
<span class="token keyword">function</span> <span class="token function">debounce</span><span class="token punctuation">(</span><span class="token parameter">func<span class="token punctuation">,</span> delay</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> context <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> args <span class="token operator">=</span> arguments<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>timer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">let</span> callNow <span class="token operator">=</span> <span class="token operator">!</span>timer<span class="token punctuation">;</span>
        timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>callNow<span class="token punctuation">)</span> <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><strong>函数节流(<code>throttle</code>)</strong></p> <blockquote><p>规定在一个指定时间内，函数只会触发一次。如果在这个时间内多次触发调用函数的事件，只有一次会生效。</p></blockquote> <p><strong>函数节流应用场景</strong></p> <ol><li><p>按钮点击事件</p></li> <li><p>拖拽事件</p></li> <li><p><code>onScoll</code> 事件</p></li> <li><p>计算鼠标移动的距离(<code>mousemove</code>)</p></li></ol> <p>::tip TIP</p> <p>函数节流主要有两种实现方法：时间戳和定时器
:::</p> <p><strong>函数节流时间戳版</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">throttle</span><span class="token punctuation">(</span><span class="token parameter">func<span class="token punctuation">,</span> delay</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> previous <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> now <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> context <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> args <span class="token operator">=</span> arguments<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>now <span class="token operator">-</span> previous <span class="token operator">&gt;</span> delay<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
            previous <span class="token operator">=</span> now<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>函数节流定时器版</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">throttle</span><span class="token punctuation">(</span><span class="token parameter">func<span class="token punctuation">,</span> delay</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> context <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> args <span class="token operator">=</span> arguments<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>timer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> args<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>总结</strong></p> <ul><li><p><code>函数防抖</code>：将几次操作合并为一此操作进行。原理是维护一个计时器，规定在delay时间后触发函数，但是在delay时间内再次触发的话，就会取消之前的计时器而重新设置。这样一来，只有最后一次操作能被触发。</p></li> <li><p><code>函数节流</code>：使得一定时间内只触发一次函数。原理是通过判断是否到达一定时间来触发函数。</p></li></ul> <p><strong>区别：</strong></p> <p>函数节流不管事件触发有多频繁，都会保证在规定时间内一定会执行一次真正的事件处理函数，而函数防抖只是在最后一次事件后才触发一次函数。 比如在页面的无限加载场景下，我们需要用户在滚动页面时，每隔一段时间发一次 Ajax 请求，而不是在用户停下滚动页面操作时才去请求数据。这样的场景，就适合用节流技术来实现。</p> <h2 id="观察者模式"><a href="#观察者模式" class="header-anchor">#</a> 观察者模式</h2> <p><strong>简单的观察者模式</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">EventEmitter</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>maxListener <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>observes <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">on</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>observes<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>observes<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>observes<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>fn<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">emit</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>observes<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token operator">=&gt;</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> eventEmitter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p><strong>使用观察者模式实现</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> ret <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> next<span class="token punctuation">,</span> complete<span class="token punctuation">,</span> error <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">function</span> <span class="token function">nextFn</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>ret<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token function">next</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">function</span> <span class="token function">completeFn</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">complete</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
            ret <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">function</span> <span class="token function">errorFn</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">error</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">next</span><span class="token operator">:</span> nextFn<span class="token punctuation">,</span>
            <span class="token literal-property property">complete</span><span class="token operator">:</span> completeFn<span class="token punctuation">,</span>
            <span class="token literal-property property">error</span><span class="token operator">:</span> errorFn
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>ret <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> observerable <span class="token operator">=</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token parameter">observer</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        observer<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    observer<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    observer<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> subject <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">next</span><span class="token operator">:</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token literal-property property">complete</span><span class="token operator">:</span> console<span class="token punctuation">.</span>log<span class="token punctuation">,</span>
    <span class="token literal-property property">error</span><span class="token operator">:</span> console<span class="token punctuation">.</span>error
<span class="token punctuation">}</span>

<span class="token keyword">let</span> unsubscribe <span class="token operator">=</span> <span class="token function">observerable</span><span class="token punctuation">(</span>subject<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 2 3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><h2 id="target和currenttarget的区别"><a href="#target和currenttarget的区别" class="header-anchor">#</a> target和currentTarget的区别</h2> <div class="custom-block tip"><p class="title">TIP</p><ul><li><p><code>target</code> 表示的是当前触发事件的<code>DOM元素</code>(事件触发的目标)。</p></li> <li><p><code>currentTarget</code> 表示引用事件侦听器正在侦听的<code>DOM元素</code>(事件的真实注册者)。</p></li></ul></div><div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>todo-list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Walk your dog<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> list <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;.todo-list&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

list<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Output: &lt;li class=&quot;item&quot;&gt;Walk your dog&lt;/li&gt;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>currentTarget<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Output: &lt;ul class=&quot;todo-list&quot;&gt;&lt;/ul&gt;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>上述例子中,我们点击了<code>li</code>然后冒泡到<code>ul</code>上,触发了<code>ul</code>上绑定的事件,这个触发上事件事件的触发目标是<code>li(target)</code>,而事件是监听在<code>ul(currentTarget)</code>上的。</p> <h2 id="async-错误捕获"><a href="#async-错误捕获" class="header-anchor">#</a> <code>async</code> 错误捕获</h2> <p><code>async/await</code>很好用，帮助我们用同步的方式去处理异步请求,虽然它仅仅是 <code>Promise</code> 的语法糖。在<code>Promise</code>中处理错误很容易，使用 <code>catch</code> 即可，如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">task</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">Promise1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">Promise2</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">&quot;promise2 error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">&quot;promise1 error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>但是，在<code>async</code>怎么处理错误呢?</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">task</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> res1 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> res2 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch2</span><span class="token punctuation">(</span>res1<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> res2<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>我们总结后有如下几种处理方式:</p> <p><strong>集中处理</strong></p> <ol><li>在调用的地方处理</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">task</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> res1 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> res2 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch2</span><span class="token punctuation">(</span>res1<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> res2<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">task</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;fetch error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="custom-block tip"><p class="title">TIP</p><p>使用该种方式处理的话,处理起来是比较方便的,异常处理逻辑和请求逻辑进行了拆分,但是这种方式不利于我们排查错误,只要 <code>promise</code> 发生了异常,就都会被 <code>catch</code> 到,但是我们不知道是哪个请求报错异常,难道我们还要去维护每个请求的 <code>error</code> 信息?</p> <p>我们试着使用 <code>try {} catch {}</code>的方式去处理。</p></div><ol start="2"><li>使用 <code>try catch</code></li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">task</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> res1 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> res2 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch2</span><span class="token punctuation">(</span>res1<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> res2<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;fetch error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="custom-block tip"><p class="title">TIP</p><p>统一处理方式下的 <code>try-catch</code> 方式与在调用的方式 <code>catch</code> 无太大的异常都无法解决定位错误信息的问题。</p> <p>单独处理</p></div><p><strong>单独处理</strong></p> <ol><li>使用 try catch 单独处理</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">task</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> res1<span class="token punctuation">,</span> res2<span class="token punctuation">;</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    res1 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;fetch1 error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    res2 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch2</span><span class="token punctuation">(</span>res1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;fetch2 error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><div class="custom-block tip"><p class="title">TIP</p><p>使用单独的 <code>try-catch</code> 可以解决上述的定位问题,但是假如我们的请求比较多,篇幅就会很长，代码不美观、不优雅。</p> <p>是否还有更加优雅的处理方式呢?</p></div><ol start="2"><li>使用 <code>Promise</code> 处理 <code>async</code> 异常</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">task</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> res1 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> res2 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch2</span><span class="token punctuation">(</span>res1<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> res2<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>然后我们把抛出的异常再处理一下:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">task</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>err1<span class="token punctuation">,</span> res1<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token keyword">null</span><span class="token punctuation">,</span> res<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>err<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>err1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;fetch1 error&quot;</span> <span class="token operator">+</span> err1<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> <span class="token punctuation">[</span>err2<span class="token punctuation">,</span> res2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch2</span><span class="token punctuation">(</span>res1<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token keyword">null</span><span class="token punctuation">,</span> res<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>err<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>err2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;fetch2 error&quot;</span> <span class="token operator">+</span> err2<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> res2<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>这样我们就可以把错误信息和正确返回的数据都进行了处理,但是如果每个请求都这样去写的话,代码量和可阅读性就不高了。是的,通用的方法我们可以进行封装,于是又有了下面的版本:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">asyncPromise</span><span class="token punctuation">(</span><span class="token parameter">promise</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>promise <span class="token operator">||</span> <span class="token operator">!</span><span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">isPrototypeOf</span><span class="token punctuation">(</span>promise<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> rej</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">rej</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;参数必须是 promise&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">[</span>err<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> promise
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token keyword">null</span><span class="token punctuation">,</span> data<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">[</span>err<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">task</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>err1<span class="token punctuation">,</span> res1<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">asyncPromise</span><span class="token punctuation">(</span><span class="token function">fetch1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>err1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;fetch1 error&quot;</span> <span class="token operator">+</span> err1<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> <span class="token punctuation">[</span>err2<span class="token punctuation">,</span> res2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">asyncPromise</span><span class="token punctuation">(</span><span class="token function">fetch2</span><span class="token punctuation">(</span>res1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>err2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;fetch2 error&quot;</span> <span class="token operator">+</span> err2<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> res2<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h2 id="空值合并运算符"><a href="#空值合并运算符" class="header-anchor">#</a> 空值合并运算符 ??</h2> <blockquote><p>空值合并运算符（<code>nullish coalescing operator</code>）的写法为两个问号 ??。</p></blockquote> <div class="custom-block tip"><p class="title">TIP</p><p>本文中，我们将值既不是 <code>null</code> 也不是 <code>undefined</code> 的表达式称为已定义的（<code>defined</code>）。</p></div><p>我们来看看执行的结果，<code>a ?? b</code> 的结果是：</p> <p>如果 <code>a</code> 是已定义的，则结果为 <code>a</code>。
如果 <code>a</code> 不是已定义的，则结果为 <code>b</code>。
换句话说也就是,如果第一个参数不是 <code>null</code>、<code>undefined</code>，则 ?? 返回第一个参数。否则，返回第二个参数。</p> <p>换做以前的写法也就是:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>result <span class="token operator">=</span> a <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> a <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> a <span class="token operator">:</span> b<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>使用场景</strong></p> <p>通常 ?? 的使用场景是，为可能是未定义的变量提供一个默认值。</p> <p>比如，由于 user 没有定义赋值一个默认值。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> user<span class="token punctuation">;</span>

  <span class="token keyword">return</span> user <span class="token operator">??</span> <span class="token string">&quot;Jack&quot;</span><span class="token punctuation">;</span> <span class="token comment">// Jack</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>当然，如果 <code>user</code> 的值为除 <code>null</code>、<code>undefined</code> 外的任意值，那么我们看到的将是它：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> user <span class="token operator">??</span> <span class="token string">&quot;Jack&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 空字符串</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>与 <code>||</code> 运算符 比较</strong></p> <p>某些场景下或运算符 <code>||</code> 可以以与 <code>??</code> 运算符相同的方式使用。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> user<span class="token punctuation">;</span>

  <span class="token keyword">return</span> user <span class="token operator">||</span> <span class="token string">&quot;Jack&quot;</span><span class="token punctuation">;</span> <span class="token comment">// Jack</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>但是它们之间重要的区别是：</strong></p> <ul><li><p>|| 返回第一个 真 值。会根据数据真假进行判断，布尔的隐式转换</p></li> <li><p>?? 返回第一个 已定义的 值。</p></li></ul> <div class="custom-block tip"><p class="title">TIP</p><p>换句话说，<code>||</code> 无法区分 <code>false</code>、<code>0</code>、<code>空字符串</code>, <code>&quot;&quot;</code> 和 <code>null</code>、<code>undefined</code>。它们都一样 —— 假值（<code>falsy values</code>）。如果其中任何一个是 <code>||</code> 的第一个参数，那么我们将得到第二个参数作为结果。</p> <p>不过在实际中，我们可能只想在变量的值为 <code>null</code>、<code>undefined</code> 时使用默认值。也就是说，当该值确实未知或未被设置时。</p></div><p><strong>优先级</strong></p> <p><code>??</code> 运算符的优先级相当低：在 <code>MDN table</code> 中为 5。因此，<code>??</code> 在 <code>=</code> 和 <code>?</code> 之前计算，但在大多数其他运算符（例如，<code>+</code> 和 <code>*</code>）之后计算。</p> <p>因此，如果我们需要在还有其他运算符的表达式中使用 <code>??</code> 进行取值，需要考虑加括号：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> height <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> width <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token comment">// 重要：使用括号</span>
<span class="token keyword">let</span> area <span class="token operator">=</span> <span class="token punctuation">(</span>height <span class="token operator">??</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>width <span class="token operator">??</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">alert</span><span class="token punctuation">(</span>area<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5000</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>否则，如果我们省略了括号，则由于 <code>*</code> 的优先级比 <code>??</code> 高，它会先执行，进而导致错误的结果。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 没有括号</span>
<span class="token keyword">let</span> area <span class="token operator">=</span> height <span class="token operator">??</span> <span class="token number">100</span> <span class="token operator">*</span> width <span class="token operator">??</span> <span class="token number">50</span><span class="token punctuation">;</span>

<span class="token comment">// ……与下面这行代码的计算方式相同（应该不是我们所期望的）：</span>
<span class="token keyword">let</span> area <span class="token operator">=</span> height <span class="token operator">??</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">(100 * width)</span><span class="token template-punctuation string">`</span></span> <span class="token operator">??</span> <span class="token number">50</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong><code>??</code> 与 <code>&amp;&amp;</code> 或 <code>||</code> 一起使用</strong></p> <p>出于安全原因，<code>JavaScript</code> 禁止将 <code>??</code> 运算符与 <code>&amp;&amp;</code> 和 <code>||</code> 运算符一起使用，除非使用括号明确指定了优先级。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token number">2</span> <span class="token operator">??</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// Syntax error</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这个限制无疑是值得商榷的，但它被添加到语言规范中是为了避免人们从 <code>||</code> 切换到 <code>??</code> 时的编程错误。</p> <p>可以明确地使用括号来解决这个问题：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// 正常工作了</span>

<span class="token function">alert</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>总结</strong></p> <ul><li><p>空值合并运算符 <code>??</code> 提供了一种从列表中选择第一个已定义的值的简便方式。</p> <p>它被用于为变量分配默认值：</p></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 当 height 的值为 null 或 undefined 时，将 height 的值设置为 100</span>
height <span class="token operator">=</span> height <span class="token operator">??</span> <span class="token number">100</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><p><code>??</code> 运算符的优先级非常低，仅略高于 <code>?</code> 和 <code>=</code>，因此在表达式中使用它时请考虑添加括号。</p></li> <li><p>如果没有明确添加括号，不能将其与 <code>||</code> 或 &amp;&amp; 一起使用。</p></li></ul> <h2 id="json数据处理"><a href="#json数据处理" class="header-anchor">#</a> JSON数据处理</h2> <p><strong>JSON.stringify</strong></p> <blockquote><p>用于将 <code>JavaScript</code> 值转换为 JSON 字符串。</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>value<span class="token punctuation">[</span><span class="token punctuation">,</span> replacer<span class="token punctuation">[</span><span class="token punctuation">,</span> space<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><code>value</code>：（必传)。 待转换的值。</li> <li><code>replacer</code>：（可选)。用于转换结果的函数或数组。</li></ul> <ol><li>如果该参数是一个函数，则在序列化过程中，被序列化的值的每个属性都会经过该函数的转换和处理；</li> <li>如果该参数是一个数组，则只有包含在这个数组中的属性名才会被序列化到最终的 JSON 字符串中；</li> <li>如果该参数为 null 或者未提供，则对象所有的属性都会被序列化。</li></ol> <ul><li><code>space</code>：（可选)。指定缩进用的空白字符串，用于美化输出（pretty-print）。</li></ul> <ol><li>如果参数是个数字，它代表有多少的空格；上限为10。</li> <li>该值若小于1，则意味着没有空格；</li> <li>如果该参数为字符串（当字符串长度超过10个字母，取其前10个字母），该字符串将被作为空格；</li> <li>如果该参数没有提供（或者为 null），将没有空格。</li></ol> <p><strong>基本使用</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 1. 用来转化对象</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '{&quot;key&quot;:1,&quot;value&quot;:22}'</span>

<span class="token comment">// 2. 用来转化基本类型</span>
<span class="token keyword">const</span> num <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token string">'hello'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> none <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> un <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> sym <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> big <span class="token operator">=</span> <span class="token function">BigInt</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '1' </span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'hello'</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'null'</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>un<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// undefined</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'true'</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>sym<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>big<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Uncaught TypeError: Do not know how to serialize a BigInt at JSON.stringify</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>使用自定义 <code>replacer</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">,</span>
    <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
    <span class="token literal-property property">label2</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 1. 如果该参数是一个函数，则在序列化过程中，被序列化的值的每个属性都会经过该函数的转换和处理；</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">typeof</span> value <span class="token operator">===</span> <span class="token string">'number'</span> <span class="token operator">?</span> <span class="token keyword">undefined</span> <span class="token operator">:</span> value
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '{}'</span>

<span class="token comment">// 2. 如果该参数是一个数组，则只有包含在这个数组中的属性名才会被序列化到最终的 JSON 字符串中；</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'value'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '{&quot;value&quot;:22}'</span>

<span class="token comment">// 3. 如果该参数为 `null` 或者未提供，则对象所有的属性都会被序列化。</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '{&quot;key&quot;:1,&quot;value&quot;:22, label2: null}'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p><strong>使用美化参数<code>space</code></strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">,</span>
    <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 如果参数是个数字，它代表有多少的空格；上限为10。</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '{\n          &quot;key&quot;: 1,\n          &quot;value&quot;: 22\n}'</span>

<span class="token comment">// 如果该参数为字符串（当字符串长度超过10个字母，取其前10个字母），该字符串将被作为空格；</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '{\nhello&quot;key&quot;: 1,\nhello&quot;value&quot;: 22\n}'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>9大特性</strong></p> <p><strong>特性一</strong></p> <ol><li><code>undefined</code>、任意的函数以及<code>symbol</code>值，出现在非数组对象的属性值中时在序列化过程中会被忽略。</li> <li><code>undefined</code>、任意的函数以及<code>symbol</code>值出现在数组对象中时会被转换成 <code>null</code>。</li> <li><code>undefined</code>、任意的函数以及<code>symbol</code>值被单独转换时，会返回 <code>undefined</code>。</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">x</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'3310'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">y</span><span class="token operator">:</span><span class="token keyword">undefined</span><span class="token punctuation">,</span>
    <span class="token function-variable function">z</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">a</span><span class="token operator">:</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'11111'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> obj2 <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// { x: [1, null, null] }</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>特性二</strong></p> <blockquote><p><code>布尔值</code>、<code>数字</code>、<code>字符串</code> 的包装对象在序列化过程中会自动转换成对应的原始值。</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> flag <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Boolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> num <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">'123'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'false'</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// '11'</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// '&quot;123&quot;'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>特性三</strong></p> <blockquote><p><code>symbol</code> 类型的值都会被忽略，即便 <code>replacer</code> 参数中强制指定包含了它们。</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'123'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// '{&quot;key&quot;:1}'</span>

<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> key <span class="token operator">===</span> <span class="token string">'symbol'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// undefined</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>特性四</strong></p> <blockquote><p><code>NaN</code> 和 <code>Infinity</code> 格式的数值及 <code>null</code> 都会被当做 <code>null</code>。</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">NaN</span><span class="token punctuation">,</span>
  <span class="token literal-property property">age2</span><span class="token operator">:</span> <span class="token number">Infinity</span><span class="token punctuation">,</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// '{&quot;age&quot;:null,&quot;age2&quot;:null,&quot;name&quot;:null}'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>特性五</strong></p> <blockquote><p>转换值如果包含 <code>toJSON()</code> 方法，将使用该方法的返回值。</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token function-variable function">toJSON</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">'hello world'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '&quot;hello world&quot;'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>特性六</strong></p> <blockquote><p>对 <code>Date类型</code> 调用 <code>toJSON()</code> 会将其转化为字符串来处理。</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> d <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

d<span class="token punctuation">.</span><span class="token function">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '2021-10-11T12:04:20.224Z'</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '&quot;2021-10-11T12:04:20.224Z&quot;'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>特性七</strong></p> <blockquote><p>对包含循环引用的对象（对象之间相互引用，形成无限循环）执行此方法，会抛出错误。</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

obj<span class="token punctuation">.</span>obj <span class="token operator">=</span> obj<span class="token punctuation">;</span>

<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Uncaught TypeError: Converting circular structure to JSON</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>特性八</strong></p> <blockquote><p>Map/Set/WeakMap/WeakSet 等类型，仅会序列化可枚举的属性。</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

Object<span class="token punctuation">.</span><span class="token function">defineProperties</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">{</span> 
    <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'1234'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '{&quot;key&quot;:1}'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>特性九</strong></p> <blockquote><p>尝试去转换 <code>BigInt</code> 类型的值会抛出错误</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> big <span class="token operator">=</span> <span class="token function">BigInt</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>big<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Uncaught TypeError: Do not know how to serialize a BigInt</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">7/19/2022, 6:02:18 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/base-js/liu-lan-qi-dui-xiang.html" class="prev">
            浏览器对象
          </a></span> <span class="next"><a href="/base-js/es6-es12te-xing-zong-jie.html">
            ES6-ES12特性总结
          </a></span></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-cb1513f6><li class="level-2" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#script标签" class="sidebar-link reco-side-script标签" data-v-cb1513f6>script标签</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#noscript标签" class="sidebar-link reco-side-noscript标签" data-v-cb1513f6>noscript标签</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#script脚本解析顺序问题" class="sidebar-link reco-side-script脚本解析顺序问题" data-v-cb1513f6>script脚本解析顺序问题</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#严格模式与非严格模式" class="sidebar-link reco-side-严格模式与非严格模式" data-v-cb1513f6>严格模式与非严格模式</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#var关键字与变量生命周期" class="sidebar-link reco-side-var关键字与变量生命周期" data-v-cb1513f6>var关键字与变量生命周期</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#变量提升" class="sidebar-link reco-side-变量提升" data-v-cb1513f6>变量提升</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#数据类型" class="sidebar-link reco-side-数据类型" data-v-cb1513f6>数据类型</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#基本数据类型" class="sidebar-link reco-side-基本数据类型" data-v-cb1513f6>基本数据类型</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#复杂数据类型" class="sidebar-link reco-side-复杂数据类型" data-v-cb1513f6>复杂数据类型</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#变量在内存中存储的方式" class="sidebar-link reco-side-变量在内存中存储的方式" data-v-cb1513f6>变量在内存中存储的方式</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#复制基本类型" class="sidebar-link reco-side-复制基本类型" data-v-cb1513f6>复制基本类型</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#复制引用类型" class="sidebar-link reco-side-复制引用类型" data-v-cb1513f6>复制引用类型</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#变量类型检测" class="sidebar-link reco-side-变量类型检测" data-v-cb1513f6>变量类型检测</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#变量之间比较" class="sidebar-link reco-side-变量之间比较" data-v-cb1513f6>变量之间比较</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#值传递和引用传递" class="sidebar-link reco-side-值传递和引用传递" data-v-cb1513f6>值传递和引用传递</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#引用类型与基本类型生命周期" class="sidebar-link reco-side-引用类型与基本类型生命周期" data-v-cb1513f6>引用类型与基本类型生命周期</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#null、underfined、void-0" class="sidebar-link reco-side-null、underfined、void-0" data-v-cb1513f6>null、underfined、void 0</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#void-0-与-undefined" class="sidebar-link reco-side-void-0-与-undefined" data-v-cb1513f6>void 0 与 undefined</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#数值转换" class="sidebar-link reco-side-数值转换" data-v-cb1513f6>数值转换</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#number-函数的转换规则如下" class="sidebar-link reco-side-number-函数的转换规则如下" data-v-cb1513f6>Number()函数的转换规则如下</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#parseint-转换规则" class="sidebar-link reco-side-parseint-转换规则" data-v-cb1513f6>parseInt()转换规则</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#parsefloat-转换规则" class="sidebar-link reco-side-parsefloat-转换规则" data-v-cb1513f6>parseFloat()转换规则</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#运算符转换规则的区别" class="sidebar-link reco-side-运算符转换规则的区别" data-v-cb1513f6>+ - 运算符转换规则的区别</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#、-比较运算符的规则" class="sidebar-link reco-side-、-比较运算符的规则" data-v-cb1513f6>&gt;、&lt; 比较运算符的规则</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#运算法比较规则" class="sidebar-link reco-side-运算法比较规则" data-v-cb1513f6>== === 运算法比较规则</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#、-、-逻辑运算符" class="sidebar-link reco-side-、-、-逻辑运算符" data-v-cb1513f6>&amp;&amp; 、 || 、!逻辑运算符</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#补充部分" class="sidebar-link reco-side-补充部分" data-v-cb1513f6>补充部分</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#数值类型转换" class="sidebar-link reco-side-数值类型转换" data-v-cb1513f6>数值类型转换</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#装箱和拆箱" class="sidebar-link reco-side-装箱和拆箱" data-v-cb1513f6>装箱和拆箱</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#连续赋值的问题" class="sidebar-link reco-side-连续赋值的问题" data-v-cb1513f6>连续赋值的问题</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#tostring-方法介绍" class="sidebar-link reco-side-tostring-方法介绍" data-v-cb1513f6>toString 方法介绍</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#object-类型" class="sidebar-link reco-side-object-类型" data-v-cb1513f6>Object 类型</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#创建object类型的方式" class="sidebar-link reco-side-创建object类型的方式" data-v-cb1513f6>创建object类型的方式</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#javascript-对象的特征" class="sidebar-link reco-side-javascript-对象的特征" data-v-cb1513f6>javascript 对象的特征</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#对象具有唯一标识性" class="sidebar-link reco-side-对象具有唯一标识性" data-v-cb1513f6>对象具有唯一标识性</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#对象有状态和行为" class="sidebar-link reco-side-对象有状态和行为" data-v-cb1513f6>对象有状态和行为</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#array类型" class="sidebar-link reco-side-array类型" data-v-cb1513f6>Array类型</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#数组常用方法" class="sidebar-link reco-side-数组常用方法" data-v-cb1513f6>数组常用方法</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#或与非" class="sidebar-link reco-side-或与非" data-v-cb1513f6>或与非 || &amp;&amp; ！</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#try-catch-简单介绍" class="sidebar-link reco-side-try-catch-简单介绍" data-v-cb1513f6>try.catch 简单介绍</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#with-语句" class="sidebar-link reco-side-with-语句" data-v-cb1513f6>with 语句</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#执行环境和作用域" class="sidebar-link reco-side-执行环境和作用域" data-v-cb1513f6>执行环境和作用域</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#作用域链" class="sidebar-link reco-side-作用域链" data-v-cb1513f6>作用域链</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#延长作用域" class="sidebar-link reco-side-延长作用域" data-v-cb1513f6>延长作用域</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#词法作用域" class="sidebar-link reco-side-词法作用域" data-v-cb1513f6>词法作用域</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#块级作用域" class="sidebar-link reco-side-块级作用域" data-v-cb1513f6>块级作用域</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#创建作用域" class="sidebar-link reco-side-创建作用域" data-v-cb1513f6>创建作用域</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#作用域的应用场景" class="sidebar-link reco-side-作用域的应用场景" data-v-cb1513f6>作用域的应用场景</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#垃圾回收机制" class="sidebar-link reco-side-垃圾回收机制" data-v-cb1513f6>垃圾回收机制</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#标记清除" class="sidebar-link reco-side-标记清除" data-v-cb1513f6>标记清除</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#引用计数" class="sidebar-link reco-side-引用计数" data-v-cb1513f6>引用计数</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#管理内存" class="sidebar-link reco-side-管理内存" data-v-cb1513f6>管理内存</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#regexp-正则表达式" class="sidebar-link reco-side-regexp-正则表达式" data-v-cb1513f6>RegExp 正则表达式</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#常用正则表达式字符含义" class="sidebar-link reco-side-常用正则表达式字符含义" data-v-cb1513f6>常用正则表达式字符含义</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#函数" class="sidebar-link reco-side-函数" data-v-cb1513f6>函数</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#函数中的参数" class="sidebar-link reco-side-函数中的参数" data-v-cb1513f6>函数中的参数</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#函数中的属性" class="sidebar-link reco-side-函数中的属性" data-v-cb1513f6>函数中的属性</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#apply-与-call" class="sidebar-link reco-side-apply-与-call" data-v-cb1513f6>apply 与 call</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#函数声明与函数表达式" class="sidebar-link reco-side-函数声明与函数表达式" data-v-cb1513f6>函数声明与函数表达式</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#匿名函数与具名函数" class="sidebar-link reco-side-匿名函数与具名函数" data-v-cb1513f6>匿名函数与具名函数</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#自执行匿名函数" class="sidebar-link reco-side-自执行匿名函数" data-v-cb1513f6>自执行匿名函数</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#闭包" class="sidebar-link reco-side-闭包" data-v-cb1513f6>闭包</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#闭包的应用场景" class="sidebar-link reco-side-闭包的应用场景" data-v-cb1513f6>闭包的应用场景</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#闭包的问题" class="sidebar-link reco-side-闭包的问题" data-v-cb1513f6>闭包的问题</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#内存泄露" class="sidebar-link reco-side-内存泄露" data-v-cb1513f6>内存泄露</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#内存泄露的排查手段" class="sidebar-link reco-side-内存泄露的排查手段" data-v-cb1513f6>内存泄露的排查手段</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#内存泄露的解决方案" class="sidebar-link reco-side-内存泄露的解决方案" data-v-cb1513f6>内存泄露的解决方案</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#执行上下文" class="sidebar-link reco-side-执行上下文" data-v-cb1513f6>执行上下文</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#关于-this-对象" class="sidebar-link reco-side-关于-this-对象" data-v-cb1513f6>关于 this 对象</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#模仿块级作用域" class="sidebar-link reco-side-模仿块级作用域" data-v-cb1513f6>模仿块级作用域</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#私有变量" class="sidebar-link reco-side-私有变量" data-v-cb1513f6>私有变量</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#总结" class="sidebar-link reco-side-总结" data-v-cb1513f6>总结</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#url编码方式" class="sidebar-link reco-side-url编码方式" data-v-cb1513f6>url编码方式</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#math对象" class="sidebar-link reco-side-math对象" data-v-cb1513f6>Math对象</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#常用方法" class="sidebar-link reco-side-常用方法" data-v-cb1513f6>常用方法</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#面向对象编程-oop重点" class="sidebar-link reco-side-面向对象编程-oop重点" data-v-cb1513f6>面向对象编程(oop重点)</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#数据属性" class="sidebar-link reco-side-数据属性" data-v-cb1513f6>数据属性</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#访问器属性" class="sidebar-link reco-side-访问器属性" data-v-cb1513f6>访问器属性</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#读取属性的特性" class="sidebar-link reco-side-读取属性的特性" data-v-cb1513f6>读取属性的特性</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#设计模式" class="sidebar-link reco-side-设计模式" data-v-cb1513f6>设计模式</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#继承" class="sidebar-link reco-side-继承" data-v-cb1513f6>继承</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#原型链" class="sidebar-link reco-side-原型链" data-v-cb1513f6>原型链</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#原型" class="sidebar-link reco-side-原型" data-v-cb1513f6>原型</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#构造函数" class="sidebar-link reco-side-构造函数" data-v-cb1513f6>构造函数</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#原型链-2" class="sidebar-link reco-side-原型链-2" data-v-cb1513f6>原型链</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#原型污染" class="sidebar-link reco-side-原型污染" data-v-cb1513f6>原型污染</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#原型污染的解决方案" class="sidebar-link reco-side-原型污染的解决方案" data-v-cb1513f6>原型污染的解决方案</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#form表单脚本" class="sidebar-link reco-side-form表单脚本" data-v-cb1513f6>form表单脚本</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#提交表单" class="sidebar-link reco-side-提交表单" data-v-cb1513f6>提交表单</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#重置表单" class="sidebar-link reco-side-重置表单" data-v-cb1513f6>重置表单</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#操作富文本" class="sidebar-link reco-side-操作富文本" data-v-cb1513f6>操作富文本</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#canvans绘图" class="sidebar-link reco-side-canvans绘图" data-v-cb1513f6>canvans绘图</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#检测是否支持canvas绘制" class="sidebar-link reco-side-检测是否支持canvas绘制" data-v-cb1513f6>检测是否支持canvas绘制</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#图像导出" class="sidebar-link reco-side-图像导出" data-v-cb1513f6>图像导出</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#_2d-上下文" class="sidebar-link reco-side-_2d-上下文" data-v-cb1513f6>2D 上下文</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#绘制路径" class="sidebar-link reco-side-绘制路径" data-v-cb1513f6>绘制路径</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#webgl" class="sidebar-link reco-side-webgl" data-v-cb1513f6>WebGL</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#类型化数组" class="sidebar-link reco-side-类型化数组" data-v-cb1513f6>类型化数组</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#webgl上下文" class="sidebar-link reco-side-webgl上下文" data-v-cb1513f6>WebGL上下文</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#html5-脚本编程" class="sidebar-link reco-side-html5-脚本编程" data-v-cb1513f6>HTML5 脚本编程</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#跨文档消息传递" class="sidebar-link reco-side-跨文档消息传递" data-v-cb1513f6>跨文档消息传递</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#cors-跨域处理" class="sidebar-link reco-side-cors-跨域处理" data-v-cb1513f6>CORS 跨域处理</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#事件循环-event-loop" class="sidebar-link reco-side-事件循环-event-loop" data-v-cb1513f6>事件循环(Event Loop)</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#javascript-发展历史" class="sidebar-link reco-side-javascript-发展历史" data-v-cb1513f6>javascript 发展历史</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#执行栈和消息队列" class="sidebar-link reco-side-执行栈和消息队列" data-v-cb1513f6>执行栈和消息队列</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#浏览器渲染时机" class="sidebar-link reco-side-浏览器渲染时机" data-v-cb1513f6>浏览器渲染时机</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#深拷贝与浅拷贝" class="sidebar-link reco-side-深拷贝与浅拷贝" data-v-cb1513f6>深拷贝与浅拷贝</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#settimeout、setimmediate、process-nexttick" class="sidebar-link reco-side-settimeout、setimmediate、process-nexttick" data-v-cb1513f6>setTimeout、setImmediate、Process.nextTick</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#优先级" class="sidebar-link reco-side-优先级" data-v-cb1513f6>优先级</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#为什么说-settimeout-有个最小-4ms-的延迟" class="sidebar-link reco-side-为什么说-settimeout-有个最小-4ms-的延迟" data-v-cb1513f6>为什么说 setTimeout 有个最小 4ms 的延迟?</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#ajax、fetch与axios" class="sidebar-link reco-side-ajax、fetch与axios" data-v-cb1513f6>ajax、fetch与axios</a></li><li class="level-3" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#ajax" class="sidebar-link reco-side-ajax" data-v-cb1513f6>Ajax</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#节流与防抖" class="sidebar-link reco-side-节流与防抖" data-v-cb1513f6>节流与防抖</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#观察者模式" class="sidebar-link reco-side-观察者模式" data-v-cb1513f6>观察者模式</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#target和currenttarget的区别" class="sidebar-link reco-side-target和currenttarget的区别" data-v-cb1513f6>target和currentTarget的区别</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#async-错误捕获" class="sidebar-link reco-side-async-错误捕获" data-v-cb1513f6>async 错误捕获</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#空值合并运算符" class="sidebar-link reco-side-空值合并运算符" data-v-cb1513f6>空值合并运算符 ??</a></li><li class="level-2" data-v-cb1513f6><a href="/base-js/javascriptji-chu-zhi-shi.html#json数据处理" class="sidebar-link reco-side-json数据处理" data-v-cb1513f6>JSON数据处理</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><canvas id="vuepress-canvas-cursor"></canvas></div></div>
    <script src="/assets/js/app.ab7ccc71.js" defer></script><script src="/assets/js/3.4edb9727.js" defer></script><script src="/assets/js/1.8fa44146.js" defer></script><script src="/assets/js/23.86990ac5.js" defer></script>
  </body>
</html>

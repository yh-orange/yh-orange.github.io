<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>css滤镜filter函数，让照片随意变色，一个属性让网站变黑白效果，就这样任性 | yh-orange 学习笔记</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/images/icon.png">
    <meta name="description" content="Personal Website">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.31114bff.css" as="style"><link rel="preload" href="/assets/js/app.ab7ccc71.js" as="script"><link rel="preload" href="/assets/js/3.4edb9727.js" as="script"><link rel="preload" href="/assets/js/1.8fa44146.js" as="script"><link rel="preload" href="/assets/js/55.0b081e5c.js" as="script"><link rel="prefetch" href="/assets/js/10.117c3e7a.js"><link rel="prefetch" href="/assets/js/11.92bc9c31.js"><link rel="prefetch" href="/assets/js/12.f9afe2d3.js"><link rel="prefetch" href="/assets/js/13.814b4335.js"><link rel="prefetch" href="/assets/js/14.07ec2310.js"><link rel="prefetch" href="/assets/js/15.75624940.js"><link rel="prefetch" href="/assets/js/16.1b7695b0.js"><link rel="prefetch" href="/assets/js/17.3ebd7f2b.js"><link rel="prefetch" href="/assets/js/18.74427907.js"><link rel="prefetch" href="/assets/js/19.6afca700.js"><link rel="prefetch" href="/assets/js/20.62ea23cc.js"><link rel="prefetch" href="/assets/js/21.2a1e282a.js"><link rel="prefetch" href="/assets/js/22.3e86ef0c.js"><link rel="prefetch" href="/assets/js/23.86990ac5.js"><link rel="prefetch" href="/assets/js/24.901bce47.js"><link rel="prefetch" href="/assets/js/25.1dd59c95.js"><link rel="prefetch" href="/assets/js/26.d382260a.js"><link rel="prefetch" href="/assets/js/27.4f928d65.js"><link rel="prefetch" href="/assets/js/28.3b826946.js"><link rel="prefetch" href="/assets/js/29.6c5a6671.js"><link rel="prefetch" href="/assets/js/30.236895e5.js"><link rel="prefetch" href="/assets/js/31.b8047fdd.js"><link rel="prefetch" href="/assets/js/32.1d2b663c.js"><link rel="prefetch" href="/assets/js/33.a3528f35.js"><link rel="prefetch" href="/assets/js/34.03511400.js"><link rel="prefetch" href="/assets/js/35.de42440a.js"><link rel="prefetch" href="/assets/js/36.0fc211d4.js"><link rel="prefetch" href="/assets/js/37.26759b23.js"><link rel="prefetch" href="/assets/js/38.588a7518.js"><link rel="prefetch" href="/assets/js/39.15e5c940.js"><link rel="prefetch" href="/assets/js/4.e9ad93dd.js"><link rel="prefetch" href="/assets/js/40.c97b3712.js"><link rel="prefetch" href="/assets/js/41.303f2a45.js"><link rel="prefetch" href="/assets/js/42.73ca30bd.js"><link rel="prefetch" href="/assets/js/43.953b4c7c.js"><link rel="prefetch" href="/assets/js/44.6792b66b.js"><link rel="prefetch" href="/assets/js/45.0c7776f3.js"><link rel="prefetch" href="/assets/js/46.c0458285.js"><link rel="prefetch" href="/assets/js/47.926765f5.js"><link rel="prefetch" href="/assets/js/48.8fa5c2c8.js"><link rel="prefetch" href="/assets/js/49.7495e132.js"><link rel="prefetch" href="/assets/js/5.4c32532b.js"><link rel="prefetch" href="/assets/js/50.d63aadc0.js"><link rel="prefetch" href="/assets/js/51.9a363be7.js"><link rel="prefetch" href="/assets/js/52.28410924.js"><link rel="prefetch" href="/assets/js/53.acc6026d.js"><link rel="prefetch" href="/assets/js/54.e030fc14.js"><link rel="prefetch" href="/assets/js/56.833ab305.js"><link rel="prefetch" href="/assets/js/57.b1608b93.js"><link rel="prefetch" href="/assets/js/58.be51ba8c.js"><link rel="prefetch" href="/assets/js/59.aec83a30.js"><link rel="prefetch" href="/assets/js/6.132c57c0.js"><link rel="prefetch" href="/assets/js/60.08ff5ee8.js"><link rel="prefetch" href="/assets/js/61.94a50c42.js"><link rel="prefetch" href="/assets/js/62.b2db71be.js"><link rel="prefetch" href="/assets/js/63.2a0181c3.js"><link rel="prefetch" href="/assets/js/64.7f023a4a.js"><link rel="prefetch" href="/assets/js/65.17b400ef.js"><link rel="prefetch" href="/assets/js/66.794f64c3.js"><link rel="prefetch" href="/assets/js/67.ce97d267.js"><link rel="prefetch" href="/assets/js/68.12100ad3.js"><link rel="prefetch" href="/assets/js/69.31abf334.js"><link rel="prefetch" href="/assets/js/7.49a9a74a.js"><link rel="prefetch" href="/assets/js/70.dcd9c229.js"><link rel="prefetch" href="/assets/js/71.6eb3c080.js"><link rel="prefetch" href="/assets/js/72.741c9df7.js"><link rel="prefetch" href="/assets/js/73.30fe6803.js"><link rel="prefetch" href="/assets/js/74.b146fd8c.js"><link rel="prefetch" href="/assets/js/75.b3e38e76.js"><link rel="prefetch" href="/assets/js/76.73926b71.js"><link rel="prefetch" href="/assets/js/77.65ea9d49.js"><link rel="prefetch" href="/assets/js/78.1d532daa.js"><link rel="prefetch" href="/assets/js/79.07ccc890.js"><link rel="prefetch" href="/assets/js/8.17f9c4ab.js"><link rel="prefetch" href="/assets/js/9.71be61be.js">
    <link rel="stylesheet" href="/assets/css/0.styles.31114bff.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-1aefc0b4><div data-v-1aefc0b4><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-1aefc0b4 data-v-1aefc0b4><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-25ba6db2 data-v-1aefc0b4 data-v-1aefc0b4><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>yh-orange 学习笔记</h3> <p class="description" data-v-25ba6db2 data-v-25ba6db2>Personal Website</p> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><span data-v-25ba6db2>yh-orange</span>
            
          <!---->
          2024
        </a></span></div></div> <div class="hide" data-v-1aefc0b4><header class="navbar" data-v-1aefc0b4><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/images/hero.jpg" alt="yh-orange 学习笔记" class="logo"> <span class="site-name">yh-orange 学习笔记</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/base-js/" class="nav-link"><i class="undefined"></i>
  前端基础资料
</a></div><div class="nav-item"><a href="/informal-essay/" class="nav-link router-link-active"><i class="undefined"></i>
  随笔
</a></div><div class="nav-item"><a href="/front-end-engineering/" class="nav-link"><i class="undefined"></i>
  前端工程化
</a></div><div class="nav-item"><a href="/ps/" class="nav-link"><i class="undefined"></i>
  拍照修图
</a></div><div class="nav-item"><a href="/other/" class="nav-link"><i class="undefined"></i>
  其他资料
</a></div><div class="nav-item"><a href="/mini-program/" class="nav-link"><i class="undefined"></i>
  小程序资料
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-1aefc0b4></div> <aside class="sidebar" data-v-1aefc0b4><div class="personal-info-wrapper" data-v-39576ba9 data-v-1aefc0b4><!----> <h3 class="name" data-v-39576ba9>
    yh-orange
  </h3> <div class="num" data-v-39576ba9><div data-v-39576ba9><h3 data-v-39576ba9>60</h3> <h6 data-v-39576ba9>Articles</h6></div> <div data-v-39576ba9><h3 data-v-39576ba9>0</h3> <h6 data-v-39576ba9>Tags</h6></div></div> <ul class="social-links" data-v-39576ba9></ul> <hr data-v-39576ba9></div> <nav class="nav-links"><div class="nav-item"><a href="/base-js/" class="nav-link"><i class="undefined"></i>
  前端基础资料
</a></div><div class="nav-item"><a href="/informal-essay/" class="nav-link router-link-active"><i class="undefined"></i>
  随笔
</a></div><div class="nav-item"><a href="/front-end-engineering/" class="nav-link"><i class="undefined"></i>
  前端工程化
</a></div><div class="nav-item"><a href="/ps/" class="nav-link"><i class="undefined"></i>
  拍照修图
</a></div><div class="nav-item"><a href="/other/" class="nav-link"><i class="undefined"></i>
  其他资料
</a></div><div class="nav-item"><a href="/mini-program/" class="nav-link"><i class="undefined"></i>
  小程序资料
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>随笔-零碎学习记录</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/informal-essay/" aria-current="page" class="sidebar-link">零碎</a></li><li><a href="/informal-essay/qian-duan-qi-qi-guai-guai-de-ji-shu.html" aria-current="page" class="active sidebar-link">前端奇奇怪怪的技术</a></li><li><a href="/informal-essay/mian-shi-ti.html" class="sidebar-link">面试题</a></li><li><a href="/informal-essay/xi-huan-de-wen-zi.html" class="sidebar-link">喜欢的文字</a></li><li><a href="/informal-essay/md-study-note/" class="sidebar-link">Markdown基础使用</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-25ba6db2 data-v-1aefc0b4><h3 class="title" data-v-25ba6db2 data-v-25ba6db2></h3> <!----> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><span data-v-25ba6db2>yh-orange</span>
            
          <!---->
          2024
        </a></span></div></div> <div data-v-1aefc0b4><main class="page"><section><div class="page-title"><h1 class="title">css滤镜filter函数，让照片随意变色，一个属性让网站变黑白效果，就这样任性</h1> <div data-v-f875f3fc><i class="iconfont reco-account" data-v-f875f3fc><span data-v-f875f3fc>yh-orange</span></i> <!----> <i class="iconfont reco-eye" data-v-f875f3fc><span id="/informal-essay/qian-duan-qi-qi-guai-guai-de-ji-shu.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-f875f3fc><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <!----></div></div> <div class="theme-reco-content content__default"><h2 id="css滤镜filter函数-让照片随意变色-一个属性让网站变黑白效果-就这样任性"><a href="#css滤镜filter函数-让照片随意变色-一个属性让网站变黑白效果-就这样任性" class="header-anchor">#</a> css滤镜filter函数，让照片随意变色，一个属性让网站变黑白效果，就这样任性</h2> <p><strong>一、常用filter函数，语法【filter：xxx】</strong></p> <ol><li><p>blur()，函数将高斯模糊应用于输入图像；</p></li> <li><p>contrast()，函数可调整输入图像的对比度，值是 0% 的话，图像会全黑。值是 100%，图像不变。值可以超过 100%，意味着会运用更低的对比。若没有设置值，默认是 1；</p></li> <li><p>grayscale()，函数将改变输入图像灰度。amount 的值定义了转换的比例。值为 100% 则完全转为灰度图像，值为 0% 图像无变化。值在 0% 到 100% 之间，则是效果的线性乘数。若未设置值，默认是 0；</p></li> <li><p>drop-shadow()，函数对输入图像应用阴影效果；</p></li> <li><p>hue-rotate()，函数在输入图像上应用色相旋转。</p></li></ol> <p>dome</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>IE=edge<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
        <span class="token selector">body</span> <span class="token punctuation">{</span>
            <span class="token comment">/* grayscale百分比越大，黑白感越强烈 */</span>
            <span class="token comment">/* filter: grayscale(110%); */</span>
        <span class="token punctuation">}</span>
        <span class="token selector">ul</span> <span class="token punctuation">{</span>
            <span class="token property">list-style</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
            <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
            <span class="token property">flex-wrap</span><span class="token punctuation">:</span> wrap<span class="token punctuation">;</span>
            <span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token selector">.logo</span> <span class="token punctuation">{</span>
            <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
            <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token selector">.filter</span> <span class="token punctuation">{</span> <span class="token property">filter</span><span class="token punctuation">:</span> <span class="token function">blur</span><span class="token punctuation">(</span>5px<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token selector">.filter1</span> <span class="token punctuation">{</span> <span class="token property">filter</span><span class="token punctuation">:</span> <span class="token function">contrast</span><span class="token punctuation">(</span>200%<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token selector">.filter2</span> <span class="token punctuation">{</span> <span class="token property">filter</span><span class="token punctuation">:</span> <span class="token function">grayscale</span><span class="token punctuation">(</span>80%<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token selector">.filter3</span> <span class="token punctuation">{</span> <span class="token property">filter</span><span class="token punctuation">:</span> <span class="token function">hue-rotate</span><span class="token punctuation">(</span>90deg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token selector">.filter4</span> <span class="token punctuation">{</span> <span class="token property">filter</span><span class="token punctuation">:</span> <span class="token function">drop-shadow</span><span class="token punctuation">(</span>0 0 2em #646cffaa<span class="token punctuation">)</span> <span class="token punctuation">}</span>
        <span class="token selector">.li-image</span> <span class="token punctuation">{</span>
            <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>
            <span class="token property">width</span><span class="token punctuation">:</span> 301px<span class="token punctuation">;</span>
            <span class="token property">height</span><span class="token punctuation">:</span> 301px<span class="token punctuation">;</span>
            <span class="token property">margin</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token selector">.li-image &gt; .filter-name</span> <span class="token punctuation">{</span>
            <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
            <span class="token property">font-size</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>
            <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
            <span class="token property">left</span><span class="token punctuation">:</span> 42px<span class="token punctuation">;</span>
            <span class="token property">top</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token attr-name">align</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>center<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>li-image<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>logo<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://ms.bdimg.com/pacific/0/pic/-285567587_-1080009450.jpg?x=0&amp;y=0&amp;h=150&amp;w=242&amp;vh=150.00&amp;vw=242.00&amp;oh=150.00&amp;ow=242.00<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>图片<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>filter-name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>无滤镜<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>li-image<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>logo filter<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://ms.bdimg.com/pacific/0/pic/-285567587_-1080009450.jpg?x=0&amp;y=0&amp;h=150&amp;w=242&amp;vh=150.00&amp;vw=242.00&amp;oh=150.00&amp;ow=242.00<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>图片<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>filter-name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>blur(5px)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>li-image<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>logo filter1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://ms.bdimg.com/pacific/0/pic/-285567587_-1080009450.jpg?x=0&amp;y=0&amp;h=150&amp;w=242&amp;vh=150.00&amp;vw=242.00&amp;oh=150.00&amp;ow=242.00<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>图片<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>filter-name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>contrast(200%);<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>li-image<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>logo filter2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://ms.bdimg.com/pacific/0/pic/-285567587_-1080009450.jpg?x=0&amp;y=0&amp;h=150&amp;w=242&amp;vh=150.00&amp;vw=242.00&amp;oh=150.00&amp;ow=242.00<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>图片<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>filter-name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>grayscale(80%);<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>li-image<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>logo filter3<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://ms.bdimg.com/pacific/0/pic/-285567587_-1080009450.jpg?x=0&amp;y=0&amp;h=150&amp;w=242&amp;vh=150.00&amp;vw=242.00&amp;oh=150.00&amp;ow=242.00<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>图片<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>filter-name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>hue-rotate(90deg);<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>li-image<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>logo filter4<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://ms.bdimg.com/pacific/0/pic/-285567587_-1080009450.jpg?x=0&amp;y=0&amp;h=150&amp;w=242&amp;vh=150.00&amp;vw=242.00&amp;oh=150.00&amp;ow=242.00<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>图片<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>filter-name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>drop-shadow(0 0 2em #646cffaa)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br></div></div><p><strong>滤镜调试技巧：编写基础滤镜样式，用浏览器打开，f12控制台，鼠标点击控制台工具左上角三角形图标，然后选择对应带滤镜的element元素，就会看到滤镜样式，调节滤镜值大小就能实时看到效果。</strong></p> <p><strong>一个属性让网站变黑白效果</strong></p> <p><code>注意：body开启filter: grayscale(110%);属性后，所有html标签样式都会失效。</code></p> <div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">body</span> <span class="token punctuation">{</span>
      <span class="token comment">/* grayscale百分比越大，黑白感越强烈 */</span>
     <span class="token property">filter</span><span class="token punctuation">:</span> <span class="token function">grayscale</span><span class="token punctuation">(</span>110%<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="javascript中-等于多少"><a href="#javascript中-等于多少" class="header-anchor">#</a> JavaScript中,{}+{}等于多少?</h2> <p><strong>JavaScript-wat</strong>
在 <code>JavaScript</code> 中,加法的规则其实很简单,只有两种情况:你只能把数字和数字相加,或者字符串和字符串相加,所有其他类型的值都会被自动转换成这两种类型的值. 为了能够弄明白这种隐式转换是如何进行的,我们首先需要搞懂一些基础知识.注意:在下面的文章中提到某一章节的时候(比如§9.1),指的都是ECMA-262语言规范(<a href="https://262.ecma-international.org/5.1/" target="_blank" rel="noopener noreferrer">ECMAScript 5.1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)中的章节.</p> <p>让我们快速的复习一下.在JavaScript中,一共有两种类型的值:原始值(<code>primitives</code>)和对象值(<code>objects</code>).原始值有:<code>undefined</code>, <code>null</code>, <code>布尔值(booleans)</code>, <code>数字(numbers)</code>,还有<code>字符串(strings)</code>.其他的所有值都是对象类型的值,包括数组(<code>arrays</code>)和函数(<code>functions</code>).</p> <h2 id="web-worker"><a href="#web-worker" class="header-anchor">#</a> Web Worker</h2> <p>在HTML5的新规范中，实现了 Web Worker 来引入 js 的 “多线程” 技术, 可以让我们可以在页面主运行的 js 线程中加载运行另外单独的一个或者多个 js 线程。</p> <p><strong>一句话： Web Worker专门处理复杂计算的，从此让前端拥有后端的计算能力</strong></p> <ol><li><p>安装<code>worker-loader</code> <code>npm install worker-loader</code></p></li> <li><p>编写<code>worker.js</code></p></li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// onmessage获取传入的初始值</span>
  <span class="token keyword">let</span> sum <span class="token operator">=</span> e<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">200000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      sum <span class="token operator">+=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 将计算的结果传递出去</span>
  <span class="token function">postMessage</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ol start="3"><li><p>通过行内 <code>loader</code> 引入 <code>worker.js</code> <code>import Worker from &quot;worker-loader!./worker&quot;</code></p></li> <li><p>最终代码</p></li></ol> <div class="language-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>makeWorker<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>开始线程<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--在计算时 往input输入值时 没有发生卡顿--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">import</span> Worker <span class="token keyword">from</span> <span class="token string">&quot;worker-loader!./worker&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token function">makeWorker</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 获取计算开始的时间</span>
                <span class="token keyword">let</span> start <span class="token operator">=</span> performance<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 新建一个线程</span>
                <span class="token keyword">let</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 线程之间通过postMessage进行通信</span>
                worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 监听message事件</span>
                worker<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 关闭线程</span>
                    worker<span class="token punctuation">.</span><span class="token function">terminate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// 获取计算结束的时间</span>
                    <span class="token keyword">let</span> end <span class="token operator">=</span> performance<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// 得到总的计算时间</span>
                    <span class="token keyword">let</span> durationTime <span class="token operator">=</span> end <span class="token operator">-</span> start<span class="token punctuation">;</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'计算结果:'</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">代码执行了 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>durationTime<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 毫秒</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p><strong>计算过程中，在input框输入值，页面一直未发生卡顿</strong> <img src="/images/informal-essay4.png" alt="worker"></p> <p>如果直接把这段代码直接丢到主线程中
计算过程中，页面一直处于假死状态，input框无法输入</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">200000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      sum <span class="token operator">+=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="开启多线程-并行计算"><a href="#开启多线程-并行计算" class="header-anchor">#</a> 开启多线程，并行计算</h3> <p>回到要解决的问题
执行多种运算时，给每种运算开启单独的线程，线程计算完成后要及时关闭</p> <p><strong>多线程代码</strong></p> <div class="language-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>makeWorker<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>开始线程<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--在计算时 往input输入值时 没有发生卡顿--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">import</span> Worker <span class="token keyword">from</span> <span class="token string">&quot;worker-loader!./worker&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
        <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 模拟数据</span>
          <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">let</span> weightedList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">let</span> calcList <span class="token operator">=</span> <span class="token punctuation">[</span>
              <span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'sum'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'总和'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'average'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'算术平均'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'weightedAverage'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'加权平均'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'max'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'最大'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'middleNum'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'中位数'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'min'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'最小'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'variance'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'样本方差'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'popVariance'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'总体方差'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'stdDeviation'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'样本标准差'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'popStandardDeviation'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'总体标准差'</span><span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
          <span class="token keyword">return</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">workerList</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 用来存储所有的线程</span>
              calcList<span class="token punctuation">,</span> <span class="token comment">// 计算类型</span>
              arr<span class="token punctuation">,</span> <span class="token comment">// 数据</span>
              weightedList <span class="token comment">// 加权因子</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token function">makeWorker</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>calcList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">let</span> workerName <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">worker</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>workerList<span class="token punctuation">.</span>length<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
                    <span class="token keyword">let</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">let</span> start <span class="token operator">=</span> performance<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">arr</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>arr<span class="token punctuation">,</span> <span class="token literal-property property">type</span><span class="token operator">:</span> item<span class="token punctuation">.</span>type<span class="token punctuation">,</span> <span class="token literal-property property">weightedList</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>weightedList<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    worker<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        worker<span class="token punctuation">.</span><span class="token function">terminate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token keyword">let</span> tastName <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span>calcList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                            <span class="token keyword">if</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>type <span class="token operator">===</span> e<span class="token punctuation">.</span>data<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                item<span class="token punctuation">.</span>value <span class="token operator">=</span> e<span class="token punctuation">.</span>data<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
                                tastName <span class="token operator">=</span> item<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span>

                        <span class="token keyword">let</span> end <span class="token operator">=</span> performance<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">let</span> duration <span class="token operator">=</span> end <span class="token operator">-</span> start<span class="token punctuation">;</span>
                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">当前任务: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>tastName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, 计算用时: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>duration<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 毫秒</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>workerList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token punctuation">[</span>workerName<span class="token punctuation">]</span><span class="token operator">:</span> worker <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function">clearWorker</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>workerList<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>workerList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        item<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">worker</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">.</span>terminate <span class="token operator">&amp;&amp;</span> item<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">worker</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">terminate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 终止所有线程</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">// 页面关闭，如果还没有计算完成，要销毁对应线程</span>
        <span class="token function">beforeDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clearWorker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br></div></div><p><a href="https://mp.weixin.qq.com/s?__biz=MzA4Nzg0MDM5Nw==&amp;mid=2247515242&amp;idx=1&amp;sn=a76f66bf6a7b5f413f058c675fe57714&amp;chksm=9031bf88a746369e68465078ecc0ab956409fb74614d62b4bd1878cd7669c9cb8156b9a0a7ce&amp;scene=126&amp;&amp;sessionid=1662599122#rd" target="_blank" rel="noopener noreferrer">原文<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="async-await"><a href="#async-await" class="header-anchor">#</a> async-await</h2> <p><strong>关于异步处理问题，ES5的回调让我们陷入回调地狱轮回，后来ES6的Promise（Promise不了解？点这了解[1]）让我们脱离轮回，终于，ES7的async-await带我们走向光明。今天我们就来学习一夏 async-await，看看与Promise有何联系和区别。</strong></p> <h3 id="走进async-await原理"><a href="#走进async-await原理" class="header-anchor">#</a> 走进Async-await原理</h3> <ol><li><ul><li><strong>async函数返回一个 Promise 对象，可以使用then方法添加回调函数</strong></li></ul></li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// async返回的是Promise对象？</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">testAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'hello'</span><span class="token punctuation">;</span><span class="token comment">//上篇文章Promise对象的返回值如果不是Promise，会通过Promise.resolve()转化为Promise，再进行处理</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">testAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Promise { 'hello' }  说明async返回的是Promise对象</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>那既然async返回的是<code>Promise对象</code>，那么async后面的函数可以接.then()或者.catch()...嘛？我们试一试就知道了。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// async返回的是Promise对象,并且可以接Promise的方法？</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">testAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// await await等待还是promise对象</span>
    <span class="token keyword">return</span> <span class="token string">'hello'</span>
<span class="token punctuation">}</span>
<span class="token function">testAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//hello  妈耶！打印了！说明async返回的是Promise对象，并且可以接Promise的方法，并且！！！默认状态是resolved的</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>上面代码说明，<code>async函数内部return语句返回的值，会成为then方法回调函数的参数</code></p> <ol start="2"><li><ul><li><strong><code>当async函数内部抛出错误的时候，会导致返回的 Promise 对象变为reject状态</code>。抛出的错误对象会被.then()方法的第二个回调函数接收或者.catch()方法回调函数接收到。</strong></li></ul></li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// async函数内部抛出错误或者Promise状态为reject</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">testError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//throw new Error('出错啦~~');</span>
    <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'出错了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//await前面有return和没有return效果一样</span>
<span class="token punctuation">}</span> 
<span class="token function">testError</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// .then(()=&gt;{},(error)=&gt;{console.log(error);})</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//Error: 出错啦~~</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ol start="3"><li><ul><li><strong>await命令后面是一个 Promise 对象，返回该对象的结果。如果不是 Promise 对象，就直接返回对应的值。</strong></li></ul></li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// await</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// return '来自星星的你';</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token string">'来自星星的你'</span><span class="token punctuation">;</span><span class="token comment">//上面直接return等价于这个return</span>
<span class="token punctuation">}</span>
<span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//来自星星的你</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ol start="4"><li><strong>await的使用，必须要有async。</strong>
这便是async-await的浪漫所在了：async返回的是一个Promise对象，await等待的就是这个Promise对象，所以await不能没有async（但是async可以没有await）。有没有被浪漫到？反正我是醉了。如果await没有async会怎么样？报错：</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// await没有async会报错</span>
<span class="token keyword">function</span> <span class="token function">testAwait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token string">'西红柿炒辣椒'</span>
<span class="token punctuation">}</span>
<span class="token function">testAwait</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//SyntaxError: await is only valid in async function</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="深入async-await规则"><a href="#深入async-await规则" class="header-anchor">#</a> 深入Async-await规则</h3> <ol><li>** async封装Promise**</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// async封装Promise</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'喜羊羊与灰太狼'</span><span class="token punctuation">;</span><span class="token comment">// //相当于return Promise.resolve('喜羊羊与灰太狼')</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//接收data值</span>
<span class="token punctuation">}</span>
<span class="token function">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//执行async函数，返回的是一个Promise对象</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'content ='</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//content = 喜羊羊与灰太狼</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ol start="2"><li><strong>await相当于then</strong></li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// await---.then()</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> operate<span class="token operator">=</span>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'白雪公主'</span><span class="token punctuation">)</span><span class="token comment">//执行函数</span>
    <span class="token keyword">const</span> name<span class="token operator">=</span> <span class="token keyword">await</span> operate <span class="token comment">//await相当于Promise的then  operate.then(name=&gt;{})</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'name:'</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> person<span class="token operator">=</span><span class="token keyword">await</span> <span class="token string">'七个小矮人'</span> <span class="token comment">//await Promise.resolve('七个小矮人') await后面不跟Promise，也会被封装成Promise</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'person:'</span><span class="token punctuation">,</span>person<span class="token punctuation">)</span><span class="token comment">//400</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//自执行函数</span>

<span class="token comment">//name: 白雪公主</span>
<span class="token comment">//person: 七个小矮人</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ol start="3"><li><strong>多个await时，按时序执行</strong>
当函数执行的时候，一旦遇到await就会先返回，等到异步操作完成，再接着执行函数体内后面的语句。<code>任何一个await语句后面的 Promise 对象变为reject状态，那么整个async函数都会中断执行</code>。</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">testOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'出错了'</span><span class="token punctuation">)</span><span class="token comment">//UnhandledPromiseRejectionWarning: 出错了</span>
    <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 不会执行</span>
<span class="token punctuation">}</span>
<span class="token function">testOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="4"><li><strong>try…catch相当于catch</strong>
如果希望即使前一个异步操作失败，也不要中断后面的异步操作。<code>可将第一个await放在try...catch结构里面</code>，这样不管这个异步操作是否成功，第二个await都会执行。</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// try...catch</span>
<span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> testError <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'出错啦~~~'</span><span class="token punctuation">)</span><span class="token comment">//rejected状态</span>
    <span class="token comment">// const testError=throw new Error('出错啦~~~');</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> testError<span class="token punctuation">;</span> <span class="token comment">//await相当于then，但是reject不会触发then</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'success:'</span><span class="token operator">+</span>result<span class="token punctuation">)</span> <span class="token comment">//不会输出，因为const result = await testError被报错，被catch捕获</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'error:'</span><span class="token operator">+</span>error<span class="token punctuation">)</span><span class="token comment">//try...catch 相当于Promise的catch</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//error:出错啦~~~</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>当await后面是Promise对象的时候，我们<code>也可直接在await后面直接.catch捕获</code>错误：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">testError</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'出错了'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//这里捕获错误，不会影响下一个await执行</span>
    
    <span class="token keyword">return</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">testError</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="解析async-await语法"><a href="#解析async-await语法" class="header-anchor">#</a> 解析Async-await语法</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 面试题</span>
<span class="token keyword">function</span> <span class="token function">getJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">testAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">getJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">testAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//2</span>
<span class="token comment">//3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>根据现在的知识面，我们必须知道：</p> <blockquote><p>（1）await不能单独出现，其函数前面一定要有async。
（2）await会干两件事：
第一，将写在await后面的代码放到async创建的那个Promise里面执行。
第二、将写在await下面的代码放到前一个创建的那个Promise对象的.then里面执行。
3）await返回的也是Promise对象，他只是把await下面的代码放到了await返回的promise的.then里面执行。</p></blockquote> <p>这样的话，是不是如鱼得水了。翻译如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 编译成Promise原理</span>
<span class="token keyword">function</span> <span class="token function">testAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">getJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">testAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="拓展async-await应用"><a href="#拓展async-await应用" class="header-anchor">#</a> 拓展Async-await应用</h3> <ol><li>场景1 解决地狱回调</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// Promise解决方式</span>
<span class="token keyword">function</span> <span class="token function">doCallback</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> myPromise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>   
        <span class="token comment">//处理异步任务</span>
        <span class="token keyword">var</span> flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'失败'</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> myPromise<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">doCallback</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">//then是成功执行的方法 返回的还是一个Promise对象</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//打印张三  res是执行</span>
        <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">//catch是失败执行的方法</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">//好多.then,形成.then链啦</span>
<span class="token comment">//1</span>
<span class="token comment">//2</span>
<span class="token comment">//3</span>
<span class="token comment">//4</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><p>通过以上Promise方法，可以明显解决回调地狱“向右移”的浮夸表现，但是，<code>Promise是基于 then, catch 的链式调用，但也是基于回调函数</code>。.then链多多少少还是违背原生代码，显得也不是很优雅。作为回调终极武器，async-await更加贴近于原生代码，我们看一下吧：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//封装一个返回promise的异步任务</span>
<span class="token keyword">function</span> <span class="token function">doCallback</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> myPromise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'处理失败'</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> myPromise<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//封装一个执行上述异步任务的async函数</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">testAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> result1 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">doCallback</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//await直接拿到fn()返回的promise的数据，并且赋值给result</span>
    <span class="token keyword">var</span> result2 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">doCallback</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//await 后面的代码，都可以看做是异步回调 callback 里的内容，都是异步的</span>
    <span class="token keyword">var</span> result3 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">doCallback</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> result4 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">doCallback</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result4<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token comment">//这样是不是简洁优雅多了呢？</span>
<span class="token comment">//执行函数</span>
<span class="token function">testAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//1</span>
<span class="token comment">//2</span>
<span class="token comment">//3</span>
<span class="token comment">//4</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>有了 async-await、promise 还有必要学习吗？通过上面async-await的解决方案可以瞧见，async / await 和 Promise 并不互斥，二者相辅相成。同时async / await 并不能改变异步的本质</p> <h2 id="localstorage-的高阶用法"><a href="#localstorage-的高阶用法" class="header-anchor">#</a> localStorage 的高阶用法</h2> <h3 id="设计"><a href="#设计" class="header-anchor">#</a> 设计</h3> <p>封装之前先梳理下所需功能，并要做成什么样，采用什么样的规范，部分主要代码片段是以 <code>localStorage</code>作为示例，最后会贴出完整代码的。可以结合项目自行优化，也可以直接使用。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 区分存储类型 type</span>
<span class="token comment">// 自定义名称前缀 prefix</span>
<span class="token comment">// 支持设置过期时间 expire</span>
<span class="token comment">// 支持加密可选，开发环境下未方便调试可关闭加密</span>

<span class="token comment">// 支持数据加密 这里采用 crypto-js 加密 也可使用其他方式</span>

<span class="token comment">// 判断是否支持 Storage isSupportStorage</span>

<span class="token comment">// 设置 setStorage</span>

<span class="token comment">// 获取 getStorage</span>

<span class="token comment">// 是否存在 hasStorage</span>

<span class="token comment">// 获取所有key getStorageKeys</span>

<span class="token comment">// 根据索引获取key getStorageForIndex</span>

<span class="token comment">// 获取localStorage长度 getStorageLength</span>

<span class="token comment">// 获取全部 getAllStorage</span>

<span class="token comment">// 删除 removeStorage</span>

<span class="token comment">// 清空 clearStorage</span>

<span class="token comment">//定义参数 类型 window.localStorage,window.sessionStorage,</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'localStorage'</span><span class="token punctuation">,</span> <span class="token comment">// 本地存储类型 localStorage/sessionStorage</span>
    <span class="token literal-property property">prefix</span><span class="token operator">:</span> <span class="token string">'SDF_0.0.1'</span><span class="token punctuation">,</span> <span class="token comment">// 名称前缀 建议：项目名 + 项目版本</span>
    <span class="token literal-property property">expire</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">//过期时间 单位：秒</span>
    <span class="token literal-property property">isEncrypt</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 默认加密 为了调试方便, 开发过程中可以不加密</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h3 id="设置-setstorage"><a href="#设置-setstorage" class="header-anchor">#</a> 设置 setStorage</h3> <p><code>Storage</code> 本身是不支持过期时间设置的，要支持设置过期时间，可以效仿 <code>Cookie</code> 的做法，<code>setStorage(key,value,expire)</code> 方法，
接收三个参数，第三个参数就是设置过期时间的，用相对时间，单位秒，要对所传参数进行类型检查。可以设置统一的过期时间，
也可以对单个值得过期时间进行单独配置。两种方式按需配置。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 设置 setStorage</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">setStorage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span>value<span class="token punctuation">,</span>expire<span class="token operator">=</span><span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token string">''</span> <span class="token operator">||</span> value <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">||</span> value <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        value <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNaN</span><span class="token punctuation">(</span>expire<span class="token punctuation">)</span> <span class="token operator">||</span> expire <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Expire must be a number&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    expire <span class="token operator">=</span> <span class="token punctuation">(</span>expire<span class="token operator">?</span>expire<span class="token operator">:</span>config<span class="token punctuation">.</span>expire<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">60000</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> value<span class="token punctuation">,</span> <span class="token comment">// 存储值</span>
        <span class="token literal-property property">time</span><span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//存值时间戳</span>
        <span class="token literal-property property">expire</span><span class="token operator">:</span> expire <span class="token comment">// 过期时间</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    window<span class="token punctuation">[</span>config<span class="token punctuation">.</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="获取-getstorage"><a href="#获取-getstorage" class="header-anchor">#</a> 获取 getStorage</h3> <p>首先要对 <code>key</code> 是否存在进行判断，防止获取不存在的值而报错。对获取方法进一步扩展，只要在有效期内获取 <code>Storage</code> 值，
就对过期时间进行续期，如果过期则直接删除该值。并返回 <code>null</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getStorage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// key 不存在判断</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">[</span>config<span class="token punctuation">.</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>window<span class="token punctuation">[</span>config<span class="token punctuation">.</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'null'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 优化 持续使用中续期</span>
    <span class="token keyword">const</span> storage <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>window<span class="token punctuation">[</span>config<span class="token punctuation">.</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>storage<span class="token punctuation">)</span>
    <span class="token keyword">let</span> nowTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>expire<span class="token operator">*</span><span class="token number">6000</span> <span class="token punctuation">,</span><span class="token punctuation">(</span>nowTime <span class="token operator">-</span> storage<span class="token punctuation">.</span>time<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// 过期删除</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>storage<span class="token punctuation">.</span>expire <span class="token operator">&amp;&amp;</span> config<span class="token punctuation">.</span>expire<span class="token operator">*</span><span class="token number">6000</span> <span class="token operator">&lt;</span> <span class="token punctuation">(</span>nowTime <span class="token operator">-</span> storage<span class="token punctuation">.</span>time<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">removeStorage</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 未过期期间被调用 则自动续期 进行保活</span>
        <span class="token function">setStorage</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>storage<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> storage<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p><strong>获取所有值</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 获取全部 getAllStorage</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getAllStorage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> len <span class="token operator">=</span> window<span class="token punctuation">[</span>config<span class="token punctuation">.</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token comment">// 获取长度</span>
    <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 定义数据集</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取key 索引从0开始</span>
        <span class="token keyword">let</span> getKey <span class="token operator">=</span> window<span class="token punctuation">[</span>config<span class="token punctuation">.</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        <span class="token comment">// 获取key对应的值</span>
        <span class="token keyword">let</span> getVal <span class="token operator">=</span> window<span class="token punctuation">[</span>config<span class="token punctuation">.</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>getKey<span class="token punctuation">)</span>
        <span class="token comment">// 放进数组</span>
        arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string-property property">'key'</span><span class="token operator">:</span> getKey<span class="token punctuation">,</span> <span class="token string-property property">'val'</span><span class="token operator">:</span> getVal<span class="token punctuation">,</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> arr
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>删除 removeStorage</strong>
// 名称前自动添加前缀
const autoAddPrefix = (key) =&gt; {
const prefix = config.prefix ? config.prefix + '_' : '';
return  prefix + key;
}</p> <p>// 删除 removeStorage
export const removeStorage = (key) =&gt; {
window[config.type].removeItem(autoAddPrefix(key));
}</p> <p><strong>清空 clearStorage</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 清空 clearStorage</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">clearStorage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">[</span>config<span class="token punctuation">.</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>加密、解密</strong></p> <p>加密采用的是 <code>crypto-js</code></p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>// 安装crypto-js
npm install crypto-js

// 引入 crypto-js 有以下两种方式
import CryptoJS from &quot;crypto-js&quot;;
// 或者
const CryptoJS = require(&quot;crypto-js&quot;);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>对 <code>crypto-js</code> 设置密钥和密钥偏移量,可以采用将一个私钥经 <code>MD5</code> 加密生成16位密钥获得。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 十六位十六进制数作为密钥</span>
<span class="token keyword">const</span> <span class="token constant">SECRET_KEY</span> <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">&quot;3333e6e143439161&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 十六位十六进制数作为密钥偏移量</span>
<span class="token keyword">const</span> <span class="token constant">SECRET_IV</span> <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">&quot;e3bbe7e3ba84431a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>对加密方法进行封装</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/**
 * 加密方法
 * @param data
 * @returns {string}
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">encrypt</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> data <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;encrypt error:&quot;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> dataHex <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> encrypted <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span><span class="token constant">AES</span><span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span>dataHex<span class="token punctuation">,</span> <span class="token constant">SECRET_KEY</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">iv</span><span class="token operator">:</span> <span class="token constant">SECRET_IV</span><span class="token punctuation">,</span>
    <span class="token literal-property property">mode</span><span class="token operator">:</span> CryptoJS<span class="token punctuation">.</span>mode<span class="token punctuation">.</span><span class="token constant">CBC</span><span class="token punctuation">,</span>
    <span class="token literal-property property">padding</span><span class="token operator">:</span> CryptoJS<span class="token punctuation">.</span>pad<span class="token punctuation">.</span>Pkcs7
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> encrypted<span class="token punctuation">.</span>ciphertext<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>对解密方法进行封装
/**</p> <ul><li>解密方法</li> <li>@param data</li> <li>@returns {string}
*/
export function decrypt(data) {
const encryptedHexStr = CryptoJS.enc.Hex.parse(data);
const str = CryptoJS.enc.Base64.stringify(encryptedHexStr);
const decrypt = CryptoJS.AES.decrypt(str, SECRET_KEY, {
iv: SECRET_IV,
mode: CryptoJS.mode.CBC,
padding: CryptoJS.pad.Pkcs7
});
const decryptedStr = decrypt.toString(CryptoJS.enc.Utf8);
return decryptedStr.toString();
}
在存储数据及获取数据中进行使用：</li></ul> <h3 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h3> <p>使用的时候你可以通过 import 按需引入，也可以挂载到全局上使用，一般建议少用全局方式或全局变量，为后来接手项目继续开发维护的人，追查代码留条便捷之路！不要为了封装而封装，尽可能基于项目需求和后续的通用，以及使用上的便捷。比如获取全部存储变量，如果你项目上都未曾用到过，倒不如删减掉，留着过年也不见得有多香，不如为减小体积做点贡献！</p> <h3 id="完整代码"><a href="#完整代码" class="header-anchor">#</a> 完整代码</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/***
 * title: storage.js
 * Author: Gaby
 * Email: xxx@126.com
 * Time: 2022/6/1 17:30
 * last: 2022/6/2 17:30
 * Desc: 对存储的简单封装
 */</span>
 
<span class="token keyword">import</span> CryptoJS <span class="token keyword">from</span> <span class="token string">'crypto-js'</span><span class="token punctuation">;</span>

<span class="token comment">// 十六位十六进制数作为密钥</span>
<span class="token keyword">const</span> <span class="token constant">SECRET_KEY</span> <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">&quot;3333e6e143439161&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 十六位十六进制数作为密钥偏移量</span>
<span class="token keyword">const</span> <span class="token constant">SECRET_IV</span> <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">&quot;e3bbe7e3ba84431a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 类型 window.localStorage,window.sessionStorage,</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'localStorage'</span><span class="token punctuation">,</span> <span class="token comment">// 本地存储类型 sessionStorage</span>
    <span class="token literal-property property">prefix</span><span class="token operator">:</span> <span class="token string">'SDF_0.0.1'</span><span class="token punctuation">,</span> <span class="token comment">// 名称前缀 建议：项目名 + 项目版本</span>
    <span class="token literal-property property">expire</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">//过期时间 单位：秒</span>
    <span class="token literal-property property">isEncrypt</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 默认加密 为了调试方便, 开发过程中可以不加密</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 判断是否支持 Storage</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">isSupportStorage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token punctuation">(</span>Storage<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 设置 setStorage</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">setStorage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> expire <span class="token operator">=</span> <span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token string">''</span> <span class="token operator">||</span> value <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">||</span> value <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        value <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNaN</span><span class="token punctuation">(</span>expire<span class="token punctuation">)</span> <span class="token operator">||</span> expire <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Expire must be a number&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    expire <span class="token operator">=</span> <span class="token punctuation">(</span>expire <span class="token operator">?</span> expire <span class="token operator">:</span> config<span class="token punctuation">.</span>expire<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> value<span class="token punctuation">,</span> <span class="token comment">// 存储值</span>
        <span class="token literal-property property">time</span><span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//存值时间戳</span>
        <span class="token literal-property property">expire</span><span class="token operator">:</span> expire <span class="token comment">// 过期时间</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    
    <span class="token keyword">const</span> encryptString <span class="token operator">=</span> config<span class="token punctuation">.</span>isEncrypt 
    <span class="token operator">?</span> <span class="token function">encrypt</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    window<span class="token punctuation">[</span>config<span class="token punctuation">.</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token function">autoAddPrefix</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> encryptString<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 获取 getStorage</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getStorage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    key <span class="token operator">=</span> <span class="token function">autoAddPrefix</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// key 不存在判断</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">[</span>config<span class="token punctuation">.</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>window<span class="token punctuation">[</span>config<span class="token punctuation">.</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'null'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 优化 持续使用中续期</span>
    <span class="token keyword">const</span> storage <span class="token operator">=</span> config<span class="token punctuation">.</span>isEncrypt 
    <span class="token operator">?</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token function">decrypt</span><span class="token punctuation">(</span>window<span class="token punctuation">[</span>config<span class="token punctuation">.</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
    <span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>window<span class="token punctuation">[</span>config<span class="token punctuation">.</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">let</span> nowTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 过期删除</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>storage<span class="token punctuation">.</span>expire <span class="token operator">&amp;&amp;</span> config<span class="token punctuation">.</span>expire <span class="token operator">*</span> <span class="token number">6000</span> <span class="token operator">&lt;</span> <span class="token punctuation">(</span>nowTime <span class="token operator">-</span> storage<span class="token punctuation">.</span>time<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">removeStorage</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 未过期期间被调用 则自动续期 进行保活</span>
        <span class="token function">setStorage</span><span class="token punctuation">(</span><span class="token function">autoRemovePrefix</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> storage<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> storage<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 是否存在 hasStorage</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">hasStorage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    key <span class="token operator">=</span> <span class="token function">autoAddPrefix</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token function">getStorageAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> item<span class="token punctuation">.</span>key <span class="token operator">===</span> key<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> arr<span class="token punctuation">.</span>length <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 获取所有key</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getStorageKeys</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> items <span class="token operator">=</span> <span class="token function">getStorageAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> keys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> index <span class="token operator">&lt;</span> items<span class="token punctuation">.</span>length<span class="token punctuation">;</span> index<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        keys<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>items<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>key<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> keys
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 根据索引获取key</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getStorageForIndex</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> window<span class="token punctuation">[</span>config<span class="token punctuation">.</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 获取localStorage长度</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getStorageLength</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> window<span class="token punctuation">[</span>config<span class="token punctuation">.</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span>length
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 获取全部 getAllStorage</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getStorageAll</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> len <span class="token operator">=</span> window<span class="token punctuation">[</span>config<span class="token punctuation">.</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token comment">// 获取长度</span>
    <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 定义数据集</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取key 索引从0开始</span>
        <span class="token keyword">let</span> getKey <span class="token operator">=</span> window<span class="token punctuation">[</span>config<span class="token punctuation">.</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取key对应的值</span>
        <span class="token keyword">let</span> getVal <span class="token operator">=</span> window<span class="token punctuation">[</span>config<span class="token punctuation">.</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>getKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 放进数组</span>
        arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string-property property">'key'</span><span class="token operator">:</span> getKey<span class="token punctuation">,</span> <span class="token string-property property">'val'</span><span class="token operator">:</span> getVal<span class="token punctuation">,</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> arr
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 删除 removeStorage</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">removeStorage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">[</span>config<span class="token punctuation">.</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span><span class="token function">autoAddPrefix</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 清空 clearStorage</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">clearStorage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">[</span>config<span class="token punctuation">.</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 名称前自动添加前缀</span>
<span class="token keyword">const</span> <span class="token function-variable function">autoAddPrefix</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> prefix <span class="token operator">=</span> config<span class="token punctuation">.</span>prefix <span class="token operator">?</span> config<span class="token punctuation">.</span>prefix <span class="token operator">+</span> <span class="token string">'_'</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span>  prefix <span class="token operator">+</span> key<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 移除已添加的前缀</span>
<span class="token keyword">const</span> <span class="token function-variable function">autoRemovePrefix</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> len <span class="token operator">=</span> config<span class="token punctuation">.</span>prefix <span class="token operator">?</span> config<span class="token punctuation">.</span>prefix<span class="token punctuation">.</span>length<span class="token operator">+</span><span class="token number">1</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> key<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span>len<span class="token punctuation">)</span>
    <span class="token comment">// const prefix = config.prefix ? config.prefix + '_' : '';</span>
    <span class="token comment">// return  prefix + key;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 加密方法
 * @param data
 * @returns {string}
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">encrypt</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> data <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;encrypt error:&quot;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> dataHex <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> encrypted <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span><span class="token constant">AES</span><span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span>dataHex<span class="token punctuation">,</span> <span class="token constant">SECRET_KEY</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">iv</span><span class="token operator">:</span> <span class="token constant">SECRET_IV</span><span class="token punctuation">,</span>
        <span class="token literal-property property">mode</span><span class="token operator">:</span> CryptoJS<span class="token punctuation">.</span>mode<span class="token punctuation">.</span><span class="token constant">CBC</span><span class="token punctuation">,</span>
        <span class="token literal-property property">padding</span><span class="token operator">:</span> CryptoJS<span class="token punctuation">.</span>pad<span class="token punctuation">.</span>Pkcs7
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> encrypted<span class="token punctuation">.</span>ciphertext<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 解密方法
 * @param data
 * @returns {string}
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">decrypt</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> encryptedHexStr <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Hex<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> str <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Base64<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>encryptedHexStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> decrypt <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span><span class="token constant">AES</span><span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token constant">SECRET_KEY</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">iv</span><span class="token operator">:</span> <span class="token constant">SECRET_IV</span><span class="token punctuation">,</span>
        <span class="token literal-property property">mode</span><span class="token operator">:</span> CryptoJS<span class="token punctuation">.</span>mode<span class="token punctuation">.</span><span class="token constant">CBC</span><span class="token punctuation">,</span>
        <span class="token literal-property property">padding</span><span class="token operator">:</span> CryptoJS<span class="token punctuation">.</span>pad<span class="token punctuation">.</span>Pkcs7
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> decryptedStr <span class="token operator">=</span> decrypt<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> decryptedStr<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br></div></div><h2 id="前端性能优化到底该怎么做"><a href="#前端性能优化到底该怎么做" class="header-anchor">#</a> 前端性能优化到底该怎么做</h2> <p><strong>前端性能优化核心就是两点</strong></p> <ul><li><strong>保证资源更快的 加载速度</strong>：达到越快渲染越快，视图展现就越快</li> <li><strong>保证视图更快的 渲染速度/交互速度</strong>：用户与页面交互，前提是页面要渲染出来，其次是页面需要尽早反馈，目的就是保证用户良好的体验性</li></ul> <blockquote><p>从输入 <code>URL</code> 到页面加载完成发生了什么？</p></blockquote> <p>在这还是要简单的总结一下核心内容：</p> <ul><li>进行 <code>DNS</code> 解析</li> <li>建立 <code>TCP</code> 连接</li> <li>客户端发送 <code>HTTP</code> 请求</li> <li>服务端响应 <code>HTTP</code> 资源</li> <li>浏览器获取响应内容，进行解析和渲染</li></ul> <hr> <h3 id="rail-模型"><a href="#rail-模型" class="header-anchor">#</a> RAIL 模型</h3> <p><code>Google</code> 为前端页面性能的评估提出了 <code>RAIL</code> 模型，核心内容如下：</p> <ul><li><code>Response</code> 响应</li> <li><code>Animation</code> 动画</li> <li><code>Idle</code> 空闲</li> <li><code>Load</code> 加载</li></ul> <p><a href="/images/informal-essay5.png">RAIL 模型</a></p> <h3 id="常规性能指标"><a href="#常规性能指标" class="header-anchor">#</a> 常规性能指标</h3> <p>性能指标其实有不少的内容，但在这我们指列举比较常用的几种：</p> <ul><li><p><strong>首次绘制（<code>First Paint，FP</code>）</strong></p> <ul><li>在渲染进程确认要渲染当前响应资源后，渲染进程会先创建一个空白页面，通常把创建空白页面的这个时间点称为 <code>First Paint</code>，简称 <code>FP</code></li> <li>所谓的 <code>白屏时间</code> 其实指的就是创建这个空白页面到浏览器开始渲染非空白内容的时间，比如页面背景发生变化等</li></ul></li> <li><p><strong>首次内容绘制（<code>First Contentful Paint，FCP</code>）</strong></p> <ul><li>当用户看见一些 &quot;内容&quot; 元素被绘制在页面上的时间点，和白屏是不一样，它可以是 <code>文本</code> 首次绘制，或 <code>SVG</code> 首次出现，或 <code>Canvas</code> 首次绘制等，即当页面中绘制了第一个 <code>像素</code> 时，这个时间点称为 <code>First Content Paint</code>，简称 <code>FCP</code></li></ul></li> <li><p><strong>首屏时间 / 最大内容绘制（<code>Largest Contentful Paint, LCP</code>）</strong></p> <ul><li><code>LCP</code> 是一种新的性能度量标准，<code>LCP</code> 侧重于用户体验的性能度量标准，与现有度量标准相比，更容易理解与推理，当首屏内容完全绘制完成时，这个时间点称为 <code>Largest Content Paint</code>，简称 <code>LCP</code></li> <li>最大内容绘制应在 <code>2.5s</code> 内完成</li></ul></li> <li><p><strong>首次输入延迟（<code>First Input Delay, FID</code>）</strong></p> <ul><li><code>FID</code> 测量的是当用户第一次在页面上交互的时候（<strong>点击链接</strong>、<strong>点击按钮</strong> 或 <strong>自定义基于 js 的事件</strong>），到浏览器实际开始处理这个事件的时间</li> <li>首次输入延迟应在 <strong>100ms</strong> 内完成</li></ul></li> <li><p><strong>累积布局偏移（<code>Cumulative Layout Shift, CLS</code>)</strong></p> <ul><li><code>CLS</code> 是为了测量 视觉稳定性，以便提供良好的用户体验</li> <li>累积布局偏移应保持在 <code>0.1</code> 或更少</li></ul></li> <li><p><strong>首字节达到时间（<code>Time to First Byte，TTFB</code>）</strong></p> <ul><li>指的是浏览器开始收到服务器响应数据的时间（<strong>后台处理时间</strong> + <strong>重定向时间</strong>），是反映服务端响应速度的重要指标</li> <li><strong><code>TTFB</code> 时间如果超过 <code>500ms</code>，用户在打开网页的时就会感觉到明显的等待</strong></li></ul></li></ul> <p>通过上述内容了解了性能指标的相关内容和一些阀值，那么接下来的问题是我们怎么获取一个网站的具体性能指标数据呢？</p> <p>为了方便还是得使用工具或者说是 <code>API</code>，当然可以 <strong>自定义页面性能指标</strong> 的计算方式，比如有些就是通过计算当前页面 <code>DOM</code> 的 <strong>总节点数</strong> 和 <strong>嵌套层级</strong> 来计算一个网站的分数等，这里就不再额外介绍。</p> <hr> <h3 id="performance-面板-google"><a href="#performance-面板-google" class="header-anchor">#</a> Performance 面板（Google）</h3> <h2 id="打印时-这个单分到下一页"><a href="#打印时-这个单分到下一页" class="header-anchor">#</a> 打印时， 这个单分到下一页，</h2> <p>主要看：initPrintDiv这个方法
思路: 是知道A4纸大小。然后循环div中的元素一个一个高的的累加，如果达到A4纸大小，将下一个元素加上class。最后控制class给个margin</p> <div class="language-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>order-info<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>data table-border-color<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>data-value table-border-color image-uploader title<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        {{ orderName }}
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>(item, index) in orderData<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>
          <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>
            <span class="token punctuation">'</span>data-item table-border-color image-uploader <span class="token punctuation">'</span> +
            (!item.value ? <span class="token punctuation">'</span> no-uploader<span class="token punctuation">'</span> : <span class="token punctuation">'</span><span class="token punctuation">'</span>)
          <span class="token punctuation">&quot;</span></span>
          <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.type === <span class="token punctuation">'</span>image-uploader<span class="token punctuation">'</span><span class="token punctuation">&quot;</span></span>
          <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.uKey + index<span class="token punctuation">&quot;</span></span>
        <span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>data-title background-color-2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.label<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            {{ item.label }}
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>data-value table-border-color<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.value<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.type === <span class="token punctuation">'</span>image-uploader<span class="token punctuation">'</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span>
                <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>(file, fileIndex) in getFileList(item.value)<span class="token punctuation">&quot;</span></span>
                <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>`form_data_${item}_${fileIndex}`<span class="token punctuation">&quot;</span></span>
                <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span>
                <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form-image<span class="token punctuation">&quot;</span></span>
                <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>showBigImg(getFileList(item.value))<span class="token punctuation">&quot;</span></span>
              <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>
          <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">'</span>data-item table-border-color location <span class="token punctuation">'</span><span class="token punctuation">&quot;</span></span>
          <span class="token attr-name">v-else-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.type === <span class="token punctuation">'</span>location-and-position<span class="token punctuation">'</span><span class="token punctuation">&quot;</span></span>
          <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.uKey + index<span class="token punctuation">&quot;</span></span>
        <span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>data-title background-color-2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.label<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            {{ item.label }}
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>data-value table-border-color<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.value<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            {{ item.value.address || &quot;&quot; }}
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>
          <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">'</span>data-item table-border-color file-list <span class="token punctuation">'</span><span class="token punctuation">&quot;</span></span>
          <span class="token attr-name">v-else-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.type === <span class="token punctuation">'</span>upload-file<span class="token punctuation">'</span><span class="token punctuation">&quot;</span></span>
          <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.uKey + index<span class="token punctuation">&quot;</span></span>
        <span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>data-title background-color-2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.label<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            {{ item.label }}
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>data-value table-border-color<span class="token punctuation">&quot;</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file-list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file-name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>val in item.value<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>val.id<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
              {{ val.name }}
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>
          <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>data-item table-border-color<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.type === <span class="token punctuation">'</span>textarea<span class="token punctuation">'</span> ? <span class="token punctuation">'</span>textarea<span class="token punctuation">'</span> : <span class="token punctuation">'</span><span class="token punctuation">'</span><span class="token punctuation">&quot;</span></span>
          <span class="token attr-name">v-else</span>
          <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.uKey + index<span class="token punctuation">&quot;</span></span>
        <span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>data-title background-color-2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.label<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            {{ item.label }}
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>data-value table-border-color<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.value<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            {{ item.value }}
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> discData <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@/utils/getDicts.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> dictionaryPageList <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@/api/basicData.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&quot;viewerjs/dist/viewer.css&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// import Viewer from 'v-viewer'</span>
<span class="token comment">// import Vue from 'vue'</span>
<span class="token comment">// Vue.use(Viewer)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> Object<span class="token punctuation">,</span>
      <span class="token function-variable function">default</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">subType</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> Array<span class="token punctuation">,</span>
      <span class="token function-variable function">default</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">isPrint</span><span class="token operator">:</span> Boolean<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">orderName</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">orderData</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">initPrintDiv</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> arr <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">&quot;#pdfDom .data-item&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 第一页纸有所不同 有学生姓名以及二维码 所以第一次需要计算这个高度</span>
      <span class="token keyword">let</span> newNum <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#pdfDom .data-value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>offsetHeight<span class="token punctuation">;</span>
      <span class="token comment">// 循环页面上的所有答题框</span>
      <span class="token keyword">var</span> flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> addFlag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//15</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 加上间距 严谨点可以再加上边框</span>
        <span class="token keyword">var</span> classList <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>classList<span class="token punctuation">;</span>
        <span class="token comment">// console.log(i, arr[i].offsetHeight, JSON.stringify(classList));</span>
        <span class="token keyword">var</span> extreaHeight <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>
          <span class="token operator">!</span>classList<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;textarea&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
          <span class="token operator">!</span>classList<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;image-uploader&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
          <span class="token operator">!</span>classList<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;file-list&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 处理一行两列情况</span>
          flag<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>flag <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 代表上方还有一行半列占位</span>
            extreaHeight <span class="token operator">=</span> arr<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>offsetHeight<span class="token punctuation">;</span>
            arr<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;single-column&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
              i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span>
              arr<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>offsetHeight<span class="token punctuation">,</span>
              <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>classList<span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          flag <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">var</span> currentHeight <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>offsetHeight<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>
          classList<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;image-uploader&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
          <span class="token operator">!</span>classList<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;no-uploader&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span> <span class="token punctuation">{</span>
          currentHeight <span class="token operator">=</span> <span class="token number">160</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        currentHeight <span class="token operator">+=</span> extreaHeight<span class="token punctuation">;</span>

        <span class="token comment">// if (flag === 2 &amp;&amp; (newNum + currentHeight + addFlag) / 750 &gt;= 1.4) {</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>flag <span class="token operator">===</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> newNum <span class="token operator">+</span> currentHeight <span class="token operator">+</span> addFlag <span class="token operator">&gt;=</span> <span class="token number">22</span> <span class="token operator">*</span> <span class="token number">51</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// console.log(</span>
          <span class="token comment">//   &quot;a4&quot;,</span>
          <span class="token comment">//   newNum,</span>
          <span class="token comment">//   newNum + currentHeight + addFlag,</span>
          <span class="token comment">//   arr[i].offsetWidth</span>
          <span class="token comment">// );</span>
          <span class="token comment">// 如果答题框的比例 大于或者等于一张a4纸的比例（1.3）</span>
          <span class="token comment">// 那么就在上一个答题框上面加上类名 dataTest</span>
          <span class="token comment">// 类名样式 dataTest: page-break-after:always; 强制让这个元素跳到下一页</span>
          <span class="token comment">// 且初始化 newNum</span>
          arr<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;dataTest&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">var</span> currentMarginValue <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>offsetHeight<span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>
            arr<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;image-uploader&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
            <span class="token operator">!</span>arr<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;no-uploader&quot;</span><span class="token punctuation">)</span>
          <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            currentMarginValue <span class="token operator">=</span> <span class="token number">160</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token comment">// arr[i - 1].setAttribute(</span>
          <span class="token comment">//   &quot;style&quot;,</span>
          <span class="token comment">//   `margin-top:${currentMarginValue}px`</span>
          <span class="token comment">// );</span>
          newNum <span class="token operator">=</span> currentHeight <span class="token operator">+</span> <span class="token number">120</span><span class="token punctuation">;</span>
          flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token comment">// 如果没有超过正常a4的比例就继续累加下一个答题框的高度和间距</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>flag <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 处理一行两列情况</span>
            newNum <span class="token operator">+=</span> currentHeight <span class="token operator">+</span> addFlag<span class="token punctuation">;</span>
            flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token comment">// console.log(i, arr[i].offsetHeight, JSON.stringify(classList));</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * 处理工单数据
     */</span>
    <span class="token function">handleData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> disabledTypes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;group&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;next-info&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;handler&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token comment">// 可展示数据</span>
      <span class="token keyword">let</span> orderDataMap <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;eric&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>diyAttrs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> item <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>diyAttrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// if (this.data.linkName === '结束流程' || this.data.formOpt[item.uKey] !== 'vif') {</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>label <span class="token operator">===</span> <span class="token string">&quot;工单类型&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>orderName <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>subTypeName<span class="token punctuation">;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">&quot;updateOrderName&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>orderName<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>label <span class="token operator">===</span> <span class="token string">&quot;承办处&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          item<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>undertakerMap<span class="token punctuation">[</span>item<span class="token punctuation">.</span>value<span class="token punctuation">]</span><span class="token punctuation">.</span>dictLabel<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>label <span class="token operator">===</span> <span class="token string">&quot;是否伤人&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          item<span class="token punctuation">.</span>value <span class="token operator">=</span> item<span class="token punctuation">.</span>value <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token string">&quot;是&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;否&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;dictionary&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;radio&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>form <span class="token operator">&amp;&amp;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>form<span class="token punctuation">.</span>formDesc <span class="token operator">&amp;&amp;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>form<span class="token punctuation">.</span>formDesc<span class="token punctuation">[</span>item<span class="token punctuation">.</span>uKey<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>form<span class="token punctuation">.</span>formDesc<span class="token punctuation">[</span>item<span class="token punctuation">.</span>uKey<span class="token punctuation">]</span><span class="token punctuation">.</span>isOptions
          <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> itemOption <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>form<span class="token punctuation">.</span>formDesc<span class="token punctuation">[</span>item<span class="token punctuation">.</span>uKey<span class="token punctuation">]</span><span class="token punctuation">.</span>options<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">&quot;dictionary&quot;</span> <span class="token operator">&amp;&amp;</span> itemOption<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">var</span> dicParams <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">condition</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                  <span class="token literal-property property">dictTypeId</span><span class="token operator">:</span> itemOption<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token literal-property property">pageNum</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token literal-property property">pageSize</span><span class="token operator">:</span> <span class="token number">10000</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">;</span>
              <span class="token function">dictionaryPageList</span><span class="token punctuation">(</span>dicParams<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">var</span> dicResultItem <span class="token operator">=</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>data <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>
                  <span class="token punctuation">(</span><span class="token parameter">f</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> f<span class="token punctuation">.</span>id <span class="token operator">===</span> item<span class="token punctuation">.</span>value
                <span class="token punctuation">)</span><span class="token punctuation">;</span>

                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;res.data)&quot;</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>data<span class="token punctuation">,</span> dicResultItem<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>dicResultItem<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  item<span class="token punctuation">.</span>value <span class="token operator">=</span> dicResultItem<span class="token punctuation">.</span>dictLabel<span class="token punctuation">;</span>
                  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;item.value&quot;</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
              <span class="token keyword">var</span> dicItem <span class="token operator">=</span> <span class="token punctuation">(</span>itemOption <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>
                <span class="token punctuation">(</span><span class="token parameter">f</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> f<span class="token punctuation">.</span>value <span class="token operator">===</span> item<span class="token punctuation">.</span>value
              <span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>dicItem<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                item<span class="token punctuation">.</span>value <span class="token operator">=</span> dicItem<span class="token punctuation">.</span>text<span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>disabledTypes<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          orderDataMap<span class="token punctuation">[</span>item<span class="token punctuation">.</span>uKey<span class="token punctuation">]</span> <span class="token operator">=</span> item<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// }</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>form<span class="token punctuation">.</span>order<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>orderDataMap<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>orderDataMap<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      result<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">&quot;工单编号&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>number <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>orderData <span class="token operator">=</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * 保存为PDF
     */</span>
    <span class="token function">saveAsPDF</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * 确认打印
     */</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">getFileList</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> baseUrl <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$Api</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>MediaInfoController<span class="token punctuation">.</span>get_preview<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>
        <span class="token string">&quot;{mediaInfoId}&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;&quot;</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> data <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        result <span class="token operator">=</span> <span class="token punctuation">[</span>baseUrl <span class="token operator">+</span> data<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        result <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>v<span class="token punctuation">.</span>fileId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> baseUrl <span class="token operator">+</span> v<span class="token punctuation">.</span>fileId<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">showBigImg</span><span class="token punctuation">(</span><span class="token parameter">urls</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      window<span class="token punctuation">.</span>parent<span class="token punctuation">.</span><span class="token function">frameEvent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;imagePerview&quot;</span><span class="token punctuation">,</span>
        urls<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">subTypeMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>subType<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        map<span class="token punctuation">[</span>item<span class="token punctuation">.</span>value<span class="token punctuation">]</span> <span class="token operator">=</span> item<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> map<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">undertakerMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>discData<span class="token punctuation">.</span>undertaker<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      discData<span class="token punctuation">.</span>undertaker<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        map<span class="token punctuation">[</span>item<span class="token punctuation">.</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> item<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> map<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>isPrint<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initPrintDiv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>scss<span class="token punctuation">&quot;</span></span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">.order-info</span> <span class="token punctuation">{</span>
  <span class="token selector">.data</span> <span class="token punctuation">{</span>
    <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
    <span class="token property">flex-wrap</span><span class="token punctuation">:</span> wrap<span class="token punctuation">;</span>
    // <span class="token property">margin-top</span><span class="token punctuation">:</span> 2 * $margin-size<span class="token punctuation">;</span>
    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>
    // <span class="token property">border</span><span class="token punctuation">:</span>1px solid<span class="token punctuation">;</span>
    <span class="token selector">&amp;::before</span> <span class="token punctuation">{</span>
      <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">;</span>
      <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
      <span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>100% - 1px<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token property">height</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>100% - 1px<span class="token punctuation">)</span><span class="token punctuation">;</span>
      // <span class="token property">background</span><span class="token punctuation">:</span> #f00<span class="token punctuation">;</span>
      // <span class="token property">z-index</span><span class="token punctuation">:</span> -1<span class="token punctuation">;</span>
      // <span class="token property">border</span><span class="token punctuation">:</span> 1px solid<span class="token punctuation">;</span>
      <span class="token property">border-color</span><span class="token punctuation">:</span> inherit<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token selector">.title</span> <span class="token punctuation">{</span>
      <span class="token property">line-height</span><span class="token punctuation">:</span> 49px<span class="token punctuation">;</span>
      <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
      <span class="token property">font-size</span><span class="token punctuation">:</span> 18px<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token selector">.data-item</span> <span class="token punctuation">{</span>
      <span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>50% + 1px<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
      <span class="token property">border</span><span class="token punctuation">:</span> 1px solid<span class="token punctuation">;</span>
      <span class="token property">margin-right</span><span class="token punctuation">:</span> -1px<span class="token punctuation">;</span>
      <span class="token property">margin-bottom</span><span class="token punctuation">:</span> -1px<span class="token punctuation">;</span>
      // <span class="token property">margin-left</span><span class="token punctuation">:</span> -1px<span class="token punctuation">;</span>
      // <span class="token property">margin-top</span><span class="token punctuation">:</span> -1px<span class="token punctuation">;</span>
      // <span class="token property">height</span><span class="token punctuation">:</span> 48px<span class="token punctuation">;</span>
      // <span class="token property">line-height</span><span class="token punctuation">:</span> 48px<span class="token punctuation">;</span>
      <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>

      <span class="token selector">.data-title</span> <span class="token punctuation">{</span>
        <span class="token property">width</span><span class="token punctuation">:</span> 144px<span class="token punctuation">;</span>
        <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
        <span class="token property">padding</span><span class="token punctuation">:</span> 15px 2 * $margin-size<span class="token punctuation">;</span>
        // <span class="token property">white-space</span><span class="token punctuation">:</span> nowrap<span class="token punctuation">;</span>
        // <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
        // <span class="token property">text-overflow</span><span class="token punctuation">:</span> ellipsis<span class="token punctuation">;</span>
        <span class="token property">flex-shrink</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.data-value</span> <span class="token punctuation">{</span>
        <span class="token property">border-left</span><span class="token punctuation">:</span> 1px solid<span class="token punctuation">;</span>
        <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
        <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
        <span class="token property">padding</span><span class="token punctuation">:</span> 15px 2 * $margin-size<span class="token punctuation">;</span>
        // <span class="token property">white-space</span><span class="token punctuation">:</span> nowrap<span class="token punctuation">;</span>
        // <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
        // <span class="token property">text-overflow</span><span class="token punctuation">:</span> ellipsis<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    // 安装地址
    $<span class="token property">width100</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>100% + 2px<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token selector">.data-item.textarea,
    .data-item.single-column</span> <span class="token punctuation">{</span>
      <span class="token property">width</span><span class="token punctuation">:</span> $width100<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token selector">// 图片
    .image-uploader</span> <span class="token punctuation">{</span>
      <span class="token property">width</span><span class="token punctuation">:</span> $width100<span class="token punctuation">;</span>
      // <span class="token property">padding</span><span class="token punctuation">:</span> $margin-size<span class="token punctuation">;</span>
      <span class="token property">height</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
      <span class="token selector">.data-value</span> <span class="token punctuation">{</span>
        <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
        <span class="token property">flex-wrap</span><span class="token punctuation">:</span> wrap<span class="token punctuation">;</span>
        <span class="token selector">.form-image</span> <span class="token punctuation">{</span>
          <span class="token property">max-height</span><span class="token punctuation">:</span> 140px<span class="token punctuation">;</span>
          <span class="token property">margin</span><span class="token punctuation">:</span> $margin-size<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token selector">.file-list</span> <span class="token punctuation">{</span>
      <span class="token property">width</span><span class="token punctuation">:</span> $width100<span class="token punctuation">;</span>
      <span class="token selector">.data-value</span> <span class="token punctuation">{</span>
        <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
        <span class="token property">flex-wrap</span><span class="token punctuation">:</span> wrap<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.file-name</span> <span class="token punctuation">{</span>
        <span class="token property">margin</span><span class="token punctuation">:</span> 4px 10px<span class="token punctuation">;</span>
        <span class="token property">flex-shrink</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token selector">.location</span> <span class="token punctuation">{</span>
      <span class="token property">width</span><span class="token punctuation">:</span> $width100<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token selector">.upload-file</span> <span class="token punctuation">{</span>
      <span class="token property">width</span><span class="token punctuation">:</span> $width100<span class="token punctuation">;</span>
      <span class="token property">height</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
      <span class="token selector">.data-value</span> <span class="token punctuation">{</span>
        <span class="token property">white-space</span><span class="token punctuation">:</span> inherit<span class="token punctuation">;</span>
        <span class="token property">line-height</span><span class="token punctuation">:</span> 24px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br><span class="line-number">323</span><br><span class="line-number">324</span><br><span class="line-number">325</span><br><span class="line-number">326</span><br><span class="line-number">327</span><br><span class="line-number">328</span><br><span class="line-number">329</span><br><span class="line-number">330</span><br><span class="line-number">331</span><br><span class="line-number">332</span><br><span class="line-number">333</span><br><span class="line-number">334</span><br><span class="line-number">335</span><br><span class="line-number">336</span><br><span class="line-number">337</span><br><span class="line-number">338</span><br><span class="line-number">339</span><br><span class="line-number">340</span><br><span class="line-number">341</span><br><span class="line-number">342</span><br><span class="line-number">343</span><br><span class="line-number">344</span><br><span class="line-number">345</span><br><span class="line-number">346</span><br><span class="line-number">347</span><br><span class="line-number">348</span><br><span class="line-number">349</span><br><span class="line-number">350</span><br><span class="line-number">351</span><br><span class="line-number">352</span><br><span class="line-number">353</span><br><span class="line-number">354</span><br><span class="line-number">355</span><br><span class="line-number">356</span><br><span class="line-number">357</span><br><span class="line-number">358</span><br><span class="line-number">359</span><br><span class="line-number">360</span><br><span class="line-number">361</span><br><span class="line-number">362</span><br><span class="line-number">363</span><br><span class="line-number">364</span><br><span class="line-number">365</span><br><span class="line-number">366</span><br><span class="line-number">367</span><br><span class="line-number">368</span><br><span class="line-number">369</span><br><span class="line-number">370</span><br><span class="line-number">371</span><br><span class="line-number">372</span><br><span class="line-number">373</span><br><span class="line-number">374</span><br><span class="line-number">375</span><br><span class="line-number">376</span><br><span class="line-number">377</span><br><span class="line-number">378</span><br><span class="line-number">379</span><br><span class="line-number">380</span><br><span class="line-number">381</span><br><span class="line-number">382</span><br><span class="line-number">383</span><br><span class="line-number">384</span><br><span class="line-number">385</span><br><span class="line-number">386</span><br><span class="line-number">387</span><br><span class="line-number">388</span><br><span class="line-number">389</span><br><span class="line-number">390</span><br><span class="line-number">391</span><br><span class="line-number">392</span><br><span class="line-number">393</span><br><span class="line-number">394</span><br><span class="line-number">395</span><br><span class="line-number">396</span><br><span class="line-number">397</span><br><span class="line-number">398</span><br><span class="line-number">399</span><br><span class="line-number">400</span><br><span class="line-number">401</span><br><span class="line-number">402</span><br><span class="line-number">403</span><br><span class="line-number">404</span><br><span class="line-number">405</span><br><span class="line-number">406</span><br><span class="line-number">407</span><br><span class="line-number">408</span><br><span class="line-number">409</span><br><span class="line-number">410</span><br><span class="line-number">411</span><br><span class="line-number">412</span><br><span class="line-number">413</span><br><span class="line-number">414</span><br><span class="line-number">415</span><br><span class="line-number">416</span><br><span class="line-number">417</span><br><span class="line-number">418</span><br><span class="line-number">419</span><br><span class="line-number">420</span><br><span class="line-number">421</span><br></div></div><h3 id="v-print-nb"><a href="#v-print-nb" class="header-anchor">#</a> v-print-nb</h3> <ol><li>安装v-print-nb插件</li></ol> <div class="language-text line-numbers-mode"><pre class="language-text"><code>npm install vue-print-nb --save
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="2"><li>数据加载</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/*打印预览*/</span>
    <span class="token keyword">const</span> <span class="token function-variable function">printPdf</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">mergeEbeln</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>signal <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>dylist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token function">getPrintList</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">mergeEbeln</span><span class="token operator">:</span>mergeEbeln<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">/*分页*/</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>listdetail<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>inServForm <span class="token operator">=</span> response<span class="token punctuation">.</span>data
          <span class="token comment">//使用 .replace(/[\t]/g,''); 替换\t转义符，防止页面变形</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>inServForm<span class="token punctuation">.</span>modeldes <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>inServForm<span class="token punctuation">.</span>modeldes<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\t]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>dylist <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">doSplice</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>listdetail<span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">)</span>
          <span class="token comment">/*判断最后的签名信息是否单独起一页*/</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dylist<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>dylist<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>signal <span class="token operator">=</span> <span class="token boolean">true</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>printShow <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><ol start="3"><li>排版</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">changeFormat</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token comment">/*排版*/</span>
      <span class="token keyword">var</span> declareHeight <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>declare<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span><span class="token comment">/*合同文本像素高度*/</span>
      <span class="token keyword">var</span> changeFormatDIVHeight <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>changeFormatDIV<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span><span class="token comment">/*2cm*/</span>
      <span class="token keyword">var</span> decalreReallyHeight <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token punctuation">(</span>declareHeight<span class="token operator">/</span>changeFormatDIVHeight<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/*合同文本厘米高度*/</span>
      <span class="token keyword">var</span> leftHeight <span class="token operator">=</span> <span class="token number">29.7</span><span class="token operator">-</span><span class="token number">1.5</span><span class="token operator">-</span>decalreReallyHeight<span class="token punctuation">;</span><span class="token comment">/*剩余部分高度*/</span>
      <span class="token keyword">var</span> colunmNum <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>leftHeight<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/*能放下几行*/</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>dylist<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token comment">/*分页*/</span>
      <span class="token keyword">var</span> tempList <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>inServForm<span class="token punctuation">.</span>listdetail<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>tempList<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> colunmNum<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dylist <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">doSpliceFormat</span><span class="token punctuation">(</span>tempList<span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">,</span>colunmNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dylist<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>tempList<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">/*判断最后的签名信息是否单独起一页*/</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dylist<span class="token punctuation">.</span>length<span class="token operator">&gt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dylist<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>dylist<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>signal <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>signal <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dylist<span class="token punctuation">.</span>length<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>colunmNum <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dylist<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token operator">&lt;</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>signal <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>signal <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>printShow <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>printHandle<span class="token punctuation">.</span>$el<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><ol start="4"><li>打印预览</li></ol> <div class="language-vue line-numbers-mode"><pre class="language-vue"><code><span class="token comment">&lt;!--打印页面--&gt;</span>
    <span class="token comment">&lt;!--startprint--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-dialog</span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>打印预览<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:visible.sync</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>printShow<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>22cm<span class="token punctuation">&quot;</span></span> <span class="token attr-name">append-to-body</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form</span> <span class="token attr-name">:model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>inServForm<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>inServForm<span class="token punctuation">&quot;</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>small<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>  <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>changeFormatDIV<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">height</span><span class="token punctuation">:</span> 2cm</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span>
              <span class="token attr-name">v-print</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">'</span>#printPage<span class="token punctuation">'</span><span class="token punctuation">&quot;</span></span>
              <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>primary<span class="token punctuation">&quot;</span></span>
              <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>el-icon-printer<span class="token punctuation">&quot;</span></span>
              <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>printHandle<span class="token punctuation">&quot;</span></span>
            <span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span>
              <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>danger<span class="token punctuation">&quot;</span></span>
              <span class="token attr-name">plain</span>
              <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>el-icon-printer<span class="token punctuation">&quot;</span></span>
              <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>changeFormat<span class="token punctuation">&quot;</span></span>
              <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">margin-left</span><span class="token punctuation">:</span> -50px<span class="token punctuation">;</span><span class="token property">width</span><span class="token punctuation">:</span> 2cm</span><span class="token punctuation">&quot;</span></span></span>
            <span class="token punctuation">&gt;</span></span>打印
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>printPage<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>printPage<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> 21cm<span class="token punctuation">;</span><span class="token property">page-break-before</span><span class="token punctuation">:</span>always<span class="token punctuation">;</span><span class="token property">margin</span><span class="token punctuation">:</span> 0cm 1cm 1cm 0.5cm<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
           <span class="token comment">&lt;!-- el-table 或其他待打印内容 --&gt;</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">text-align</span><span class="token punctuation">:</span> right</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span>
            <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>danger<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">plain</span>
            <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>el-icon-printer<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>changeFormat<span class="token punctuation">&quot;</span></span>
            <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> 2cm</span><span class="token punctuation">&quot;</span></span></span>
          <span class="token punctuation">&gt;</span></span>打印
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span>
            <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>warning<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">plain</span>
            <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>el-icon-d-arrow-left<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cancelPrint<span class="token punctuation">&quot;</span></span>
          <span class="token punctuation">&gt;</span></span>返回
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-dialog</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--endprint--&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><p><a href="https://www.jb51.net/article/245567.htm" target="_blank" rel="noopener noreferrer">VUE如何利用vue-print-nb实现打印功能详解<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="抓包技能"><a href="#抓包技能" class="header-anchor">#</a> 抓包技能</h2> <h3 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h3> <p>时隔 3 年，重新接触了移动端 h5 页面开发，上一次还是大四实习。这一次是 hybrid 开发，涉及到 h5 页面与原生 app 的交互，h5 页面需要与原生打通登录态，以及调用原生app 的接口，比如调用原生相机进行二维码扫描。跟微信小程序开发不同，本地开发时微信有提供微信开发者工具，可以本地模拟调用而我这边需要每次都打包静态文件，上传服务器才能调试，非常麻烦。</p> <p>能不能在原生 app 加载线上 h5 时，跑本地的代码呢？答案是可以的，通过抓包工具比如 whistle 就可以做到拦截线上页面请求数据，再响应本地代码，本文主要讲述抓包的原理和抓包工具 whistle 使用。</p> <h3 id="抓包的原理"><a href="#抓包的原理" class="header-anchor">#</a> 抓包的原理</h3> <p><em>什么是抓包</em>
抓包就是将网络传输发送与接收的数据包进行截获、重发、编辑、转存等操作，通过抓包可以：</p> <ul><li>分析网络问题</li> <li>业务分析</li> <li>分析网络信息流通量</li> <li>网络大数据金融风险控制</li> <li>探测企图入侵网络的攻击</li> <li>探测由内部和外部的用户滥用网络资源</li> <li>探测网络入侵后的影响</li> <li>监测链接互联网宽频流量</li> <li>监测网络使用流量（包括内部用户，外部用户和系统）</li> <li>监测互联网和用户电脑的安全状态</li> <li>渗透与欺骗</li> <li>...</li></ul> <p>回顾下计算机网络知识，数据在网络上是以很小的帧的单位传输的，帧通过特定的称为网络驱动程序的程序进行成型，然后通过网卡发送到网线上，通过网线到达目的机器，在目的机器的一端执行相反的过程。</p> <p>接收端机器的以太网捕获到这些帧，并告诉操作系统帧已到达，然后对其进行存储。在这个传输和接收的过程，就可以使用抓包工具（Sniffers）进行抓包，作为前端开发者，通常是抓取应用层的 HTTP/HTTPS 的包。</p> <p>回顾下计算机网络知识，数据在网络上是以很小的帧的单位传输的，帧通过特定的称为网络驱动程序的程序进行成型，然后通过网卡发送到网线上，通过网线到达目的机器，在目的机器的一端执行相反的过程。</p> <p>接收端机器的以太网捕获到这些帧，并告诉操作系统帧已到达，然后对其进行存储。在这个传输和接收的过程，就可以使用抓包工具（Sniffers）进行抓包，作为前端开发者，通常是抓取应用层的 HTTP/HTTPS 的包。</p> <p><em>HTTP/HTTPS 抓包原理</em></p> <p>HTTP/HTTPS 是应用层使用的通信协议，常见的应用层体系结构是客户端-服务器体系。</p> <p>对运行在不同端系统上的客户端程序和服务端程序是如何互相通信的么？实际上，在操作系统上的术语中，进行通信的实际上是进程而不是程序，一个进程可以被认为是运行在端系统中的一个程序。</p> <p>在 web 应用程序中，一个客户浏览器进程与一台服务器进程进行会话交换报文。</p> <p>浏览器进程需要知道接收进程的主机地址，以及定义在目的主机中的接收进程的标识符，也就是目的端口。</p> <p>多数应用程序由通信进程对组成，每对中的两个进程互相发送报文。进程通过一个称为套接字的软件接口向网络发送报文和从网络接收报文。</p> <p>进程可以类比一座房子，而它的套接字可以是它的门，套接字是应用层与运输层之间的端口。</p> <p><strong>HTTP 抓包原理</strong>
在 http 标准中，没有对通信端身份验证的标准。对于服务器来说，它接收的 HTTP 请求报文只要格式符合规范，就发送响应报文。</p> <p>对于客户端来说也是如此，它无法校验服务器的身份，比如它连接的 <code>http://www.jecyu.com</code> 的主机，但由于中间节点的存在，最终连接的可能是 <code>http://www.jerry.com</code> 的主机。</p> <p>因此，对于 HTTP 抓包，无需做过多的处理，只需要让中间人负责转发客户端和服务端的数据包。</p> <p><strong>HTTPS 抓包原理</strong>
HTTP 是明文传输，容易受到中间人攻击，不安全。</p> <p>HTTPS 语义仍然是 HTTP，只不过是在 HTTP 协议栈中 http 与 tcp 之间插入安全层 SSL/TSL。</p> <p>安全层采用对称加密的方式加密传输数据和非对称加密的方式来传输对称密钥，解决 http 数据没有加密、无法验证身份、数据容易纂改三个核心问题。</p> <blockquote><p>HTTP + 加密 + 认证 + 完整性保护 = HTTPS</p></blockquote> <p><strong>其中验证身份问题是通过验证服务器的证书来实现的，证书是第三方组织（CA 证书签发机构）使用数字签名技术管理的</strong>，包括创建证书、存储证书、更新证书、撤销证书。</p> <p>浏览器连接至一个 HTTPS 网站，服务器发送的不仅仅只是服务器实体证书，而是一个证书链，但不包含根证书，根证书会被内嵌在 Windows, Linux, macOS, Android, iOS 这些操作系统里。</p> <p>其中校验证书分为两步，证书的签发者校验和服务器实体证书校验</p> <ol><li><p>证书链校验：</p> <ul><li><p>1.1 浏览器从服务器实体证书的上一级证书（比如 B 证书）获取公钥，用来校验服务器实体证书的签名（签名是通过 CA 机构的私钥签名的），校验成功则继续，否则证书校验失败。</p></li> <li><p>1.2 浏览器从 B 证书的上一级证书（比如 C 证书）获取公钥，用来校验 B 证书的签名，</p></li></ul></li></ol> <p>校验成功则继续，否则证书校验失败。
* 1.3 浏览器迭代校验每张证书的签名，最后会找到自签名的根证书（签发者和使用者是同一个人），由于浏览器已经集成了根证书，可以充分信任根证书的公钥，完成最后的签名。</p> <ol start="2"><li>服务器实体证书校验：访问的域名信息是否与证书一致、日期、证书扩展校验等。
了解完证书校验后，我们来看看具体的 https 通信流程：
<ul><li>首先是 <strong>tcp</strong> 的三次握手建立连接</li> <li>接着是非对称加密的握手过程</li> <li><strong>client</strong> 发送随机数 <strong>random1</strong> + 支持的加密算法集合</li> <li><strong>server</strong> 收到信息，返回选择的一个加密算法+ 证书 （包含S_公钥） + <strong>random2</strong></li> <li><strong>client</strong> 验证证书有效性，并用 <strong>random1 + random2</strong> 生成 <strong>pre-master-secure</strong>，通过服务端公钥加密发送给 <strong>server</strong></li> <li><strong>server</strong> 收到 <strong>pre-master-secure</strong>，根据约定的算法使用S_私钥对 <strong>pre-master-secure</strong> 解密，</li> <li>然后用加密算法生成 <strong>master-secure</strong>（对称加密的密钥），然后发送给 <strong>client</strong></li> <li><strong>client</strong> 收到生成的 <strong>master-secure</strong>，对称加密密钥传输完毕</li> <li>最后，就可以使用 <strong>master-secure</strong> 进行真正的数据对称加密传输。</li></ul></li></ol> <p><strong>中间人想要抓包，需在 HTTPS 加密通信之前：</strong></p> <ol><li><p>截取客户端发送的包含证书的报文，伪装成服务端，把自己的证书发给客户端，然后拿到【客户端返回的包含对称加密通信密钥的报文】，生成中间人与客户端对称加密的密钥。</p></li> <li><p>同样伪装成客户端，以服务端自己的非对称公钥加密【客户端返回的包含对称加密通信密钥的报文】发给服务端，获得服务端生成的对称加密密钥。</p></li> <li><p>这样一来，加密通信建立完成，而中间人拿到了通信的数据密钥，可以查看、修改 <strong>HTTPS</strong> 的通信报文。</p></li> <li><p>这里客户端与中间人通信、中间人与服务端通信，都是正常建立了 <strong>HTTPS</strong> 加密连接的。</p></li></ol> <p>其中很重要的一步是<strong>浏览器的根证书校验</strong>，CA 机构不可能随便给一个中间人签发不属于它的域名证书，也就不在客户端的操作系统上了，因此只能把<strong>中间人的根证书，导入到客户端的操作系统</strong>了，以此完成建立加密通信时对中间人证书的验证。</p> <h3 id="电脑如何抓手机的包"><a href="#电脑如何抓手机的包" class="header-anchor">#</a> 电脑如何抓手机的包</h3> <p>要想通过电脑端获取手机 Web 应用的数据包，根据前面所学，就需要中间人策略。</p> <p>PC 端建立一个服务器中间人进程，伪装为 web 应用的目标服务器。手机端 web 应用发送的请求数据先经过中间人，中间人进行拦截处理再发送给目标服务器。反过来，目标服务器发送的数据包先通过中间人，再由中间人响应给浏览器客户端。</p> <p>这里要注意的是，无论是个人电脑PC，还是移动端手机，都需要接入互联网网络，可以相互找到对方才能建立通信。</p> <p>一般对开发来说，个人电脑本地起的服务器进程，在公网上是访问不到的。一般是无线局域网，个人电脑与手机端连接同一个路由器发出的 Wi-Fi，就可以相互通信。</p> <p>具体步骤：
在 PC 电脑本地起一个服务器进程，监听一个端口比如 8899</p> <p>在手机上连接同一个局域网，配置网络代理，指向 PC 端的 IP 地址和 8899 端口</p> <p>这样一来，手机上所有的网络通信都会被先转发到 PC 端的 8899 端口，就可以对数据包进行分析处理</p> <p>拿访问 youtuBe 来说，比如电脑已经使用【服务器软件】成功访问，此时只要手机配置代理指向电脑 ip 地址和指定端口，手机就可以同样访问 youtuBe了。</p> <h3 id="抓包工具-whistle"><a href="#抓包工具-whistle" class="header-anchor">#</a> 抓包工具 whistle</h3> <p><strong>whistle 是什么</strong>
Whistle 是基于 Node 实现的跨平台抓包免费调试工具，其主要特点：</p> <ol><li><p>完全跨平台：支持 Mac、Windows 等桌面系统，且支持服务端等命令行系统</p></li> <li><p>功能强大：</p> <ul><li>支持作为 HTTP、HTTPS、SOCKS 代理及反向代理</li> <li>支持抓包及修改 HTTP、HTTPS、HTTP2、WebSocket、TCP 请求</li> <li>支持重放及构造 HTTP、HTTPS、HTTP2、WebSocket、TCP 请求</li> <li>支持设置上游代理、PAC 脚本、Hosts、延迟（限速）请求响应等</li> <li>支持查看远程页面的 console 日志及 DOM 节点</li> <li>支持用 Node 开发插件扩展功能，也可以作为独立 npm 包引用</li></ul></li> <li><p>操作简单</p> <ul><li>直接通过浏览器查看抓包、修改请求</li> <li>所有修改操作都可以通过配置方式实现（类似系统 Hosts），并支持分组管理</li> <li>项目可以自带代理规则并一键配置到本地 Whistle 代理，也可以通过定制插件简化操作</li></ul></li></ol> <p><strong>如何快速使用 whistle</strong></p> <ol><li>先安装 node，建议用 nvm 管理</li> <li>全局安装 whistle</li></ol> <div class="language-text line-numbers-mode"><pre class="language-text"><code>npm i -g whistle &amp;amp; w2 start
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>安装后，可以在电脑上设置全局代理，代理的端口为 8899.</p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>w2 proxy // 设置全局代理

w2 proxy off // 关闭全局代理
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>就可以通过浏览器访问 http://127.0.0.1:8899/ 查看抓包、修改请求等。</p> <p>如果你不想使用全局代理，就可以安装 <strong>SwitchyOmega</strong> 插件，按需对某些网站设置 <strong>whistle</strong> 代理。</p> <ol><li>选择 Whistle 代理</li> <li>设置 Whistle 代理</li></ol> <p><a href="https://mp.weixin.qq.com/s/9hkf4-s2FNlAKD8MfwfJsQ" target="_blank" rel="noopener noreferrer">原文地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="w文件上传工具-sftp"><a href="#w文件上传工具-sftp" class="header-anchor">#</a> w文件上传工具 sftp</h2> <p><strong>putty</strong>
生产密钥
<strong>winscp</strong>
下载 登录就可以远程修改文件
<a href="https://winscp.net/eng/index.php" target="_blank" rel="noopener noreferrer">官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="从-微信-js-sdk-认识-jsbridge"><a href="#从-微信-js-sdk-认识-jsbridge" class="header-anchor">#</a> 从 微信 JS-SDK 认识 JSBridge</h2> <p><a href="https://mp.weixin.qq.com/s/z0m4-m135I_xl78mqcwBGw" target="_blank" rel="noopener noreferrer">原文地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>Node 架构</strong>
核心内容如下：</p> <ul><li>顶层 <code>Node Api</code> <ul><li>提供 <code>http</code> 模块、流模块、fs文件模块等等，可以通过 <code>JavaScript</code> 直接调用</li></ul></li> <li>中间层 <code>Node Bindings</code> <ul><li>主要是使 <code>JavaScript</code> 和 C/C++ 进行通信，原因是 <code>JavaScript</code> 无法直接调用 <code>C/C++</code> 的库（<code>libuv</code>），需要一个中间的桥梁，<code>node</code> 中提供了很多 <code>binding</code>，这些称为 <code>Node bindings</code></li></ul></li> <li>底层 <code>V8 + libuv</code> <ul><li>v8 负责解释、执行顶层的 <code>JavaScript</code> 代码</li> <li><code>libuv</code> 负责提供 <code>I/O</code> 相关的操作，其主要语言是 <code>C/C++</code> 语言，其目的就是实现一个 跨平台（如 <code>Windows</code>、<code>Linux</code> 等）的异步 <code>I/O</code> 库，它直接与操作系统进行交互
这里不难发现 <code>Node Bindings</code> 就有点类似 <code>JSBridge</code> 的功能，所以 <code>JSBridge</code> 本身是一个很简单的东西，其更多的是 一种形式、一种思想。</li></ul></li></ul> <h3 id="为什么叫-jsbridge"><a href="#为什么叫-jsbridge" class="header-anchor">#</a> 为什么叫 JSBridge？</h3> <p>Stack Overflow 联合创始人 Jeff Atwood 在 2007 年的博客<code>《The Principle of Least Power》</code>中认为 “任何可以使用 <code>JavaScript</code> 来编写的应用，并最终也会由 <code>JavaScript</code> 编写”，后来 <code>JavaScript</code> 的发展确实非常惊人，现在我们可以基于 JavaScript 来做各种事情，比如 网页、APP、小程序、后端等，并且各种相关的生态越来越丰富。</p> <p>作为 Web 技术逻辑核心的 JavaScript 自然而然就需要承担与 其他技术 进行『桥接』的职责，而且任何一个 移动操作系统 中都会包含 运行 JavaScript 的容器环境，例如 WebView、JSCore 等，这就意味着 运行 JavaScript 不用像运行其他语言时需要额外添加相应的运行环境。</p> <div class="custom-block warning"><p class="title"></p><p><code>JSBridge</code> 应用在国内真正流行起来则是因为 <code>微信</code> 的出现，当时微信的一个主要功能就是可以在网页中通过 <code>JSBridge</code> 来实现 内容分享。</p></div><p><code>JSBridge</code> 作为 <code>JavaScript</code> 与 <code>Native</code> 之间的一个 桥梁，表面上看是允许 <code>JavaScript</code> 调用 <code>Native</code> 的功能，但其核心是建立 <code>Native</code> 和 非 <code>Native</code> 间消息 双向通信 通道。
双向通信的通道：</p> <p>*<code>JavaScript</code> 向 <code>Native</code> 发送消息:
* 调用 <code>Native</code> 功能
* 通知 <code>Native</code> 当前 <code>JavaScript</code> 的相关状态等</p> <ul><li><code>Native</code> 向 <code>JavaScript</code> 发送消息:
<ul><li>回溯调用结果</li> <li>消息推送</li> <li>通知 <code>JavaScript</code> 当前 <code>Native</code> 的状态等</li></ul></li></ul> <p><strong>JSBridge 是如何实现的？</strong>
JavaScript 的运行需要 JS 引擎的支持，包括 Chrome V8、Firefox SpiderMonkey、Safari JavaScriptCore 等，总之 JavaScript 运行环境 是和 原生运行环境 是天然隔离的，因此，在 JSBridge 的设计中我们可以把它 类比 成 JSONP 的流程：
* 客户端通过 JavaScript 定义一个回调函数，如: function callback(res) {...}，并把这个回调函数的名称以参数的形式发送给服务端
* 服务端获取到 callback 并携带对应的返回数据，以 JS 脚本形式返回给客户端
* 客户端接收并执行对应的 JS 脚本即可</p> <ul><li>JSBridge 实现 JavaScript 调用的方式有两种，如下：
<ul><li>JavaScript 调用 Native</li> <li>Native 调用 JavaScript
在开始分析具体内容之前，还是有必要了解一下前置知识 WebView。</li></ul></li></ul> <p><strong>WebView 是什么？WebView 是什么？</strong>
WebView 是 原生系统 用于 移动端 APP 嵌入 Web 的技术，方式是内置了一款高性能 webkit 内核浏览器，一般会在 SDK 中封装为一个 WebView 组件。</p> <p>WebView 具有一般 View 的属性和设置外，还对 url 进行请求、页面加载、渲染、页面交互进行增强处理，提供更强大的功能。</p> <p>WebView 的优势 在于当需要 更新页面布局 或 业务逻辑发生变更 时，能够更便捷的提供 APP 更新：</p> <p>对于 WebView 而言只需要修改前端部分的 Html、Css、JavaScript 等，通知用户端进行刷新即可
对于 Native 而言需要修改前端内容后，再进行打包升级，重新发布，通知用户下载更新，安装后才可以使用最新的内容</p> <p><strong>JavaScript 调用 Native — 实现方案一</strong></p> <h2 id="一文教你实现pdf-预览和下载"><a href="#一文教你实现pdf-预览和下载" class="header-anchor">#</a> 一文教你实现PDF 预览和下载</h2> <p><a href="https://mp.weixin.qq.com/s/vQYWEmcBbCvGTe8Gcsfc1Q" target="_blank" rel="noopener noreferrer">原文地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <strong>基本要求：</strong></p> <p>*支持 <code>pdf 文件</code> 内容的 完整预览
*<code>多页 pdf 文件</code> 支持 <code>分页查看</code>
*<code>PC 端</code> 和 <code>移动端</code> 都需支持 <strong>下载</strong> 和 <strong>预览</strong></p> <hr> <p><strong>产品要求：</strong></p> <ul><li><code>PC 端</code> 的预览要支持在 <strong>当前页</strong> 进行预览</li> <li><code>pdf 文件</code> 预览时的字体要 和 实际文件的 <strong>字体保证一致性</strong></li></ul> <h3 id="目前实现-pdf-预览的几种常用方式"><a href="#目前实现-pdf-预览的几种常用方式" class="header-anchor">#</a> 目前实现 PDF 预览的几种常用方式：</h3> <ul><li>借助各种类库，基于代码实现预览，如基于 <strong><code>pdfjs-dist</code></strong> 的包</li> <li>直接基于各个浏览器内置的 PDF 预览插件，如 <code>&lt;iframe src=&quot;xxx&quot;&gt;、&lt;embed src=&quot;xxx&quot; &gt;</code></li> <li>服务端将 PDF 文件转换成图片</li></ul> <p><strong><embed> 标签</strong> <code>&lt;embed&gt;</code> 元素 将外部内容嵌入文档中的指定位置，此内容由 外部应用程序 或 其他交互式内容源（如 浏览器插件）提供。</p> <p>说简单点，就是使用 <code>&lt;embed&gt;</code> 来展示的资源是完全交由它所在的环境提供的展示功能，即如果当前的应用环境支持这个资源的展示那么就可以正常展示，如果不支持那就无法展示。</p> <p>使用起来也是非常简单：
&lt;!-- ```html
<embed type="application/pdf" width="800" height="600"></p> <div class="language---&gt; line-numbers-mode"><pre class="language-text"><code>
多数现代浏览器已经弃用并取消了对浏览器插件的支持，现在已经不建议使用 `&lt;embed&gt; `标签，但可以使用 `&lt;img&gt;`、`&lt;iframe&gt;`、`&lt;video&gt;`、`&lt;audio&gt;` 等标签代替。

**&lt;iframe&gt; 标签**

基于 `&lt;iframe&gt;` 的方式和以上差不多，整体效果也一致，这里这就不在额外展示：

```html
&lt;iframe :src=&quot;pdfUrl&quot; width=&quot;800&quot; height=&quot;600&quot; &gt;&lt;/iframe&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>vue3-pdfjs 实现预览</strong></p> <p><strong>pdf.js</strong> 几个明显的可吐槽的点：</p> <ul><li>包名称不统一，<code>npm</code> 上的包名叫 <code>pdfjs-dist</code>，然而在 <code>Readme</code> 中自己又称其为 <code>pdf.js</code></li> <li>没有清晰的文档作为指引，只能通过其仓库中的 <code>examples</code> 目录的内容作为参考</li> <li>官方示例不够友好，例如没有提供 <code>vue/react</code> 等相关的示例</li> <li>直接使用需要引入很多文档没有指明的内容</li> <li>有时展示的 <code>pdf</code> 内容文字模糊或缺少部分等</li></ul> <p>因此，既然已经有基于 <code>vue/react</code> 封装好的包，这里就直接用来作为演示。</p> <p>安装和使用过程可参考 <strong><code>vue3-pdfjs</code></strong> ，具体 Vue3 示例代码如下：</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token operator">&lt;</span>script setup lang<span class="token operator">=</span><span class="token string">&quot;ts&quot;</span><span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> onMounted<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> VuePdf<span class="token punctuation">,</span> createLoadingTask <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue3-pdfjs/esm'</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> VuePdfPropsType <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue3-pdfjs/components/vue-pdf/vue-pdf-props'</span> <span class="token comment">// Prop type definitions can also be imported</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> PDFDocumentProxy <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'pdfjs-dist/types/src/display/api'</span>
<span class="token keyword">import</span> pdfUrl <span class="token keyword">from</span> <span class="token string">'./assets/You-Dont-Know-JS.pdf'</span>

<span class="token keyword">const</span> pdfSrc <span class="token operator">=</span> <span class="token generic-function"><span class="token function">ref</span><span class="token generic class-name"><span class="token operator">&lt;</span>VuePdfPropsType<span class="token punctuation">[</span><span class="token string">'src'</span><span class="token punctuation">]</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>pdfUrl<span class="token punctuation">)</span>
<span class="token keyword">const</span> numOfPages <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> loadingTask <span class="token operator">=</span> <span class="token function">createLoadingTask</span><span class="token punctuation">(</span>pdfSrc<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
  loadingTask<span class="token punctuation">.</span>promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>pdf<span class="token operator">:</span> PDFDocumentProxy<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    numOfPages<span class="token punctuation">.</span>value <span class="token operator">=</span> pdf<span class="token punctuation">.</span>numPages
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>VuePdf v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">&quot;page in numOfPages&quot;</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">&quot;page&quot;</span> <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">&quot;pdfSrc&quot;</span> <span class="token operator">:</span>page<span class="token operator">=</span><span class="token string">&quot;page&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>
@<span class="token keyword">import</span> <span class="token string">'@/assets/base.css'</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h2 id="手把手教你用-node-写一个爬虫-超简单"><a href="#手把手教你用-node-写一个爬虫-超简单" class="header-anchor">#</a> 手把手教你用 node 写一个爬虫，超简单！</h2> <h3 id="准备工作"><a href="#准备工作" class="header-anchor">#</a> 准备工作</h3> <hr> <ol><li><p>通过指令<code>npm init</code>初始化文件夹，会获得<code>package.json</code>项目说明书。</p></li> <li><p>爬虫必备工具：<code>cheerio</code>；通过在终端输入<code>npm i cheerio</code>，即可将文件装到项目里。<code>cheerio</code> 是 <code>jquery</code> 核心功能的一个快速灵活而又简洁的实现，主要是为了用在服务器端需要对 <code>DOM</code> 进行操作的地方。大家可以简单的理解为用来解析 <code>html</code> 非常方便的工具。</p></li></ol> <h3 id="开始"><a href="#开始" class="header-anchor">#</a> 开始</h3> <ol><li>用<code>https模块</code>(<code>node</code>直接提供给我们的)获取网站地址，通过<code>get</code>方法读取网站地址上的数据。</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> https <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'https'</span><span class="token punctuation">)</span>
https<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'https://movie.douban.com/top250'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">let</span> html <span class="token operator">=</span> <span class="token string">''</span>
 res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token comment">//console.log(chunk + '');</span>
 <span class="token comment">//得到数据流，通过字符串拼接得到html结构</span>
 html <span class="token operator">+=</span> chunk
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
 <span class="token comment">// 这样会读取到整个页面的html结构。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ol start="2"><li><p>通过 <code>res.on('end', function () {})</code>，保证读取完了才会去做操作。</p></li> <li><p>引入 <code>cheerio</code> <code>const cheerio = require('cheerio')</code></p></li> <li><p>获取<code>html</code>中的数据</p></li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> $ <span class="token operator">=</span> cheerio<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span>
 <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'li .item'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">const</span> title <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.title'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token keyword">const</span> star <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.info .bd .rating_num'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token keyword">const</span> pic <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.pic img'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
 <span class="token comment">// 这里需要注意的是我们可以去页面上看我们需要拿到哪个类名里面的内容，通过$符号可以拿到内容。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="5"><li>创建一个空数组，把数据以对象的形式存放在数组中</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> allFiles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
 allFiles<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
 <span class="token literal-property property">title</span><span class="token operator">:</span> title<span class="token punctuation">,</span>
 <span class="token literal-property property">star</span><span class="token operator">:</span> star<span class="token punctuation">,</span>
 <span class="token literal-property property">pic</span><span class="token operator">:</span> pic
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>我们可以通过<code>console.log(allFiles)</code>来检查是否打印出来了我们需要的结果。</p> <ol start="6"><li><p>将数据写入文件，引用 <code>node</code> 官方提供的模块 <code>fs</code> <code>const fs = require('fs')</code></p></li> <li><p>创建文件夹<code>files.json</code>，向其中写入数据</p></li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code>fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">'./files.json'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>allFiles<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">throw</span> err
 <span class="token punctuation">}</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文件保存成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>到这之后，我们可以看到在当前文件夹下自动创建了文件<code>files.json</code>，里面已经有了我们想要的数据。</p> <h3 id="完整代码-2"><a href="#完整代码-2" class="header-anchor">#</a> 完整代码</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//引入模块</span>
<span class="token keyword">const</span> https <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'https'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> cheerio <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cheerio'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token comment">//获取页面的html结构</span>
https<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'https://movie.douban.com/top250'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">let</span> html <span class="token operator">=</span> <span class="token string">''</span>
 res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token comment">//console.log(chunk + '');</span>
 html <span class="token operator">+=</span> chunk
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
 res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token comment">// 获取html中的数据</span>
 <span class="token keyword">const</span> $ <span class="token operator">=</span> cheerio<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span>
 <span class="token keyword">let</span> allFiles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
 <span class="token comment">//拿到每一个item中我们需要的数据</span>
 <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'li .item'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">const</span> title <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.title'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token keyword">const</span> star <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.info .bd .rating_num'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token keyword">const</span> pic <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.pic img'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span>
 <span class="token comment">//数据以对象的形式存放在数组中</span>
 allFiles<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
 <span class="token literal-property property">title</span><span class="token operator">:</span> title<span class="token punctuation">,</span>
 <span class="token literal-property property">star</span><span class="token operator">:</span> star<span class="token punctuation">,</span>
 <span class="token literal-property property">pic</span><span class="token operator">:</span> pic
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
 <span class="token comment">//console.log(allFiles);</span>
 <span class="token comment">//将数据写入文件中</span>
 fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">'./files.json'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>allFiles<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">throw</span> err
 <span class="token punctuation">}</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文件保存成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><h3 id="前端换肤功能"><a href="#前端换肤功能" class="header-anchor">#</a> 前端换肤功能</h3> <ol><li><strong>利用prefers-color-scheme特性</strong></li></ol> <p><code>prefers-color-scheme</code> 是 <code>CSS</code> <code>媒体特性【@media】</code>用于检测用户是否有将操作系统的主题色设置为亮色<code>【light】</code>或者暗色<code>【dark】</code>。</p> <p>当前 <code>prefers-color-scheme</code> <code>新特性支持各大主流电脑（window</code> 和 <code>IOS</code> 系统，<code>Linux</code> 系统可以用第三方工具）端浏览器谷歌、火狐等，包括手机端的安卓和苹果，足以说明<code>prefers-color-scheme</code>属性已经稳定成熟，可以用于生产环境了。</p> <p><code>prefers-color-scheme</code> 的使用也很简单，直接需要在全局<code>css</code>文件中添加以下代码</p> <div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">:root</span> <span class="token punctuation">{</span>
  <span class="token property">color-scheme</span><span class="token punctuation">:</span> light dark<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>js可以通过 <code>window.matchMedia()</code> 来监听系统主题。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> scheme <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">matchMedia</span><span class="token punctuation">(</span><span class="token string">&quot;(prefers-color-scheme: dark)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>scheme<span class="token punctuation">.</span>matches<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;深色模式&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;浅色模式&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>除了自动跟随系统外，也可以手动切换。不过需要结合<code>css</code>变量，详情请看第四点。</p> <ul><li>优点：简单</li> <li>缺点：1.不能自定义深浅主题样式2.只能自动跟随系统外</li></ul> <hr> <ol start="2"><li>** 切换 link**
通过改变link的href。</li></ol> <ul><li>优点: 1.按需加载</li> <li>缺点: 1.动态加载样式，样式文件过大或者网络较慢的情况下会导致样式切换不流畅2.存在样式优先级问题3.后续新增样式或者修改比较麻烦</li></ul> <hr> <ol start="3"><li><strong>引入所有主题样式，通过类名切换</strong>
类似第二种，不过为了解决反复加载样式文件问题采用提前将样式全部引入的方式，在需要切换主题的时候将指定的根元素类名更换，相当于直接做了样式覆盖，在该类名下的各个样式就统一地更换了</li></ol> <div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">.light-scheme</span> <span class="token punctuation">{</span>
  <span class="token property">background</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.dark-scheme</span> <span class="token punctuation">{</span>
  <span class="token property">background</span><span class="token punctuation">:</span> #1b1b1b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">change</span><span class="token punctuation">(</span><span class="token parameter">scheme</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> content <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">&quot;body&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	content<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;class&quot;</span><span class="token punctuation">,</span> scheme<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>优点：1.不用重新加载样式文件，切换时不会卡顿</li> <li>缺点：1.文件较大会导致首屏加载慢2.存在优先级问题3.后续新增样式或者修改比较麻烦</li></ul> <hr> <ol start="4"><li><strong>css 变量 + 类名切换</strong>
大体思路跟方案 2 相似，依然是提前将样式文件载入，切换时将指定的根元素类名更换。不过这里相对灵活的是，默认在根作用域下定义好 <code>CSS</code> 变量，只需要在不同的主题下更改 <code>CSS</code> 变量对应的取值即可。</li></ol> <div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">:root</span> <span class="token punctuation">{</span>
  <span class="token property">--color-background</span><span class="token punctuation">:</span> #1b1b1b<span class="token punctuation">;</span>
  <span class="token property">--color-text-default</span><span class="token punctuation">:</span> #0b1016<span class="token punctuation">;</span>
  <span class="token property">--white-color-background</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.light-scheme</span> <span class="token punctuation">{</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--white-color-background<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--color-text-default<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.dark-scheme</span> <span class="token punctuation">{</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--color-background<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> content <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">&quot;body&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> but <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">&quot;button&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
but<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  flag <span class="token operator">=</span> <span class="token operator">!</span>flag<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    content<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;class&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;light-scheme&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    content<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;class&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;dark-scheme&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li>优点：1.不用重新加载样式文件，在样式切换时不会有卡顿2.在需要切换主题的地方利用 <code>var()</code> 绑定变量即可，不存在优先级问题3.新增或修改主题方便灵活，仅需新增或修改 <code>CSS</code> 变量即可，在 <code>var()</code>绑定样式变量的地方就会自动更换</li> <li>缺点：1.首屏加载时会牺牲一些时间加载样式资源2.前面提到css变量还可以结合<code>prefers-color-scheme</code>一起使用实现跟随系统的自定义深浅主题样式。</li></ul> <div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">:root</span> <span class="token punctuation">{</span>
  <span class="token property">--color-background</span><span class="token punctuation">:</span> #1b1b1b<span class="token punctuation">;</span>
  <span class="token property">--color-text-default</span><span class="token punctuation">:</span> #0b1016<span class="token punctuation">;</span>
  <span class="token property">--white-color-background</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/* 监听操作系统主题模式 */</span>
<span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span><span class="token property">prefers-color-scheme</span><span class="token punctuation">:</span> dark<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>
  <span class="token selector">body</span> <span class="token punctuation">{</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--color-background<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span><span class="token property">prefers-color-scheme</span><span class="token punctuation">:</span> light<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>
  <span class="token selector">body</span> <span class="token punctuation">{</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--white-color-background<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><hr> <ol start="5"><li><strong>css 变量 + 动态 setProperty</strong>
适合自定义颜色背景</li></ol> <p>只需在全局中设置好预设的全局 <code>CSS</code> 变量样式，无需单独为每一个主题类名下重新设定 <code>CSS</code> 变量值，因为主题是由用户动态决定。</p> <p>定义一个工具类方法，用于修改指定的 <code>CSS</code> 变量值，调用的是 <code>CSSStyleDeclaration.setProperty</code></p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> <span class="token function-variable function">setCssVar</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>prop<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> val<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> dom<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">=</span> document<span class="token punctuation">.</span>documentElemen<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  dom<span class="token punctuation">.</span>style<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span>prop<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> setCssVar <span class="token operator">=</span> <span class="token punctuation">(</span>prop <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span>val <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span>dom <span class="token operator">=</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  dom<span class="token punctuation">.</span>style<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span>prop<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>在样式发生改变时调用此方法即可</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">setCssVar</span><span class="token punctuation">(</span><span class="token string">&quot;--theme-color&quot;</span><span class="token punctuation">,</span> color<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>优点：1.不用重新加载样式文件，在样式切换时不会有卡顿2.仔细琢磨可以发现其原理跟方案 5 利用 <code>Vue3</code> 的新特性 <code>v-bind</code> 是一致的，只不过此方案只在<code>:root</code> 上动态更改 <code>CSS</code> 变量而 <code>Vue3</code> 中会将 <code>CSS</code> 变量绑定到任何依赖该变量的节点上。3.需要切换主题的地方只用在<code>:root</code> 上动态更改 <code>CSS</code> 变量值即可，不存在优先级问题4.新增或修改主题方便灵活</li> <li>缺点：1.首屏加载时会牺牲一些时间加载样式资源（相对于前几种预设好的主题，这种方式的样式定义在首屏加载基本可以忽略不计）</li></ul> <hr> <ol start="6"><li><strong>vue3 专属的 v-bind</strong></li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>script setup<span class="token operator">&gt;</span>
  <span class="token comment">// 这里可以是原始对象值，也可以是ref()或reactive()包裹的值，根据具体需求而定</span>
  <span class="token keyword">const</span> theme <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>hello<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>style scoped<span class="token operator">&gt;</span>
  p <span class="token punctuation">{</span>
    <span class="token literal-property property">color</span><span class="token operator">:</span> v<span class="token operator">-</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token string">&quot;theme.color&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="报错-referenceerror-require-is-not-defined-in-es-module-scope-you-can-use-import-instead"><a href="#报错-referenceerror-require-is-not-defined-in-es-module-scope-you-can-use-import-instead" class="header-anchor">#</a> 报错 <code>ReferenceError require is not defined in ES module scope, you can use import instead</code></h2> <p>当我用 <code>require</code> 引入模块的时候，报错了，如标题</p> <p>这是由于从 <code>node.js 14</code>版及以上版本中， <code>require</code> 作为 <code>COMMONJS</code> 的一个命令已不再直接支持使用，所以我们需要导入 <code>createRequire</code> 命令才可以</p> <p>方案
在 <code>require</code> 前引入两行代码</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createRequire <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'module'</span><span class="token punctuation">;</span> 
<span class="token keyword">const</span> require <span class="token operator">=</span> <span class="token function">createRequire</span><span class="token punctuation">(</span><span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="npm的workspaces-特性"><a href="#npm的workspaces-特性" class="header-anchor">#</a> npm的workspaces 特性</h2> <ol><li>使用或不使用包管理工具的对比</li></ol> <ul><li><p><code>vue-cli</code> 这个脚手架使用 <code>Lerna</code> 管理，它的项目显得非常清晰</p></li> <li><p>在 <code>vue-cli</code> 中包含很多 <code>package</code> 点开进去，每一个包都有 <code>package.json</code></p></li> <li><p>它里面有很多项目，再没有 Lerna 之前去维护和管理这么多包是会非常困难的</p></li> <li><p>而 <code>webpack</code> 至今还没有用任何的包管理工具，在其 <code>lib</code> 下会有非常多的模块</p></li> <li><p>而且它还自己写了很多脚本来进行管理各种功能</p></li> <li><p>同上上述正反两个例子，可见，不使用包管理工具，整个项目维护起来会很麻烦</p></li> <li><p>比如说你想去给 <code>webpack</code> 做一些贡献，很麻烦很困难，因为你不太清楚，你的改动对整体一个影响</p></li> <li><p>如果使用包管理以后，它就会拆的很清楚，你的改动就是聚合在一个 <code>package</code> 里面的，这个就是用包管理一些好处</p></li> <li><p>包管理目前流行的两种方式是 <code>workspaces</code> 和 <code>Lerna</code></p></li></ul> <ol start="2"><li>workspaces 的基本使用</li></ol> <ul><li><p>在一个脚手架项目中，比如xyzcli项目中(之前一直用这个脚手架演示)创建workspaces 目录</p> <ul><li><code>$ mkdir workspaces &amp;&amp; cd workspaces</code></li></ul></li> <li><p>在 workspaces 目录中执行</p> <ul><li><code>$ npm init -y</code></li> <li>其实，在使用 <code>npm init</code> 的过程中，通过 <code>$ npm init --help</code></li> <li>可以看到 <code>Options</code> 中存在 <code>[-w|--workspace &lt;workspace-name&gt; [-w|--workspace &lt;workspace-name&gt; ...]]</code></li> <li>也就是 <code>-w</code>的参数, 比如：<code>$ npm init -w a -w b</code> 默认一路回车</li> <li>这样，就会在 workspaces 目录下新建了两个包：a 和 b，每个包中，都存在package.json，其name属性分别为 a 和 b</li> <li>在 <code>workspace/node_modules</code>下 生成a和b的两个软链</li> <li>在<code>workspace/package.json</code> 中，存在 <code>workspaces</code> 的配置</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;workspaces&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;b&quot;</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>好，现在结构基本搭建完成，现在我要在 <code>workspaces</code> 目录对a包进行安装依赖</p> <ul><li><code>$ npm i vue -w a</code></li> <li>这时候，a包中安装了 <code>chalk</code> 的依赖，但是a包中没有生成 <code>node_modules</code> 目录</li> <li>在 workspaces 目录下的 node_modules 中安装了 <code>chalk</code>, 而 a 的 <code>package.json</code> 中的 <code>dependencies</code> 是 <code>chalk</code></li> <li>同时，b包中的 <code>package.json</code> 中是没有的</li></ul></li> <li><p>这是 <code>workspace</code> 非常有意思的特性，它把各个内层包的依赖抽象到了最外层来进行管理</p></li> <li><p>这里借助了 <code>commonjs</code> 中对 <code>node_moduels</code> 查找的特性，如果当前查找不到，去上一层目录中去查找</p></li> <li><p>由于此特性，可以通过最外层来管理依赖包，这样的好处是非常明显的</p></li> <li><p>现在在a包中使用 <code>chalk</code> , 在 <code>package.json</code> 中添加 <code>&quot;type&quot;: &quot;module&quot;</code> 在 <code>a/index.js</code> 中编写</p></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>
<span class="token keyword">import</span>  chalk <span class="token keyword">from</span> <span class="token string">'chalk'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">red</span><span class="token punctuation">(</span><span class="token string">'Hello workspace'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li><p>现在继续修改 <code>a/package.json</code> 中的name属性，修改为<code>：“@somegroup/a”</code></p></li> <li><p>这时候，a包就会在后续发布中，自动在 <code>somegroup</code> 分组中了，这个 <code>somegroup</code> 可以是自己起的任意组名</p></li> <li><p>好现在在 <code>workspaces</code> 目录中新增一个具有cli 功能的包，比如就叫做 cli 这个脚手架包</p></li> <li><p><code>$ npm init -w cli</code> 一路回车, 创建了 cli 这个脚手架包</p></li> <li><p>将 cli 包的 <code>package.json</code> 目录中的name属性改成和a包同组，如：<code>&quot;name&quot;: &quot;@somegroup/cli&quot;</code></p></li> <li><p>同时在 <code>workspaces/cli</code> 的 <code>package.json</code> 中添加 <code>bin</code> 属性</p></li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code>  <span class="token punctuation">{</span>
  <span class="token property">&quot;bin&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;cli&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bin/cli.mjs&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><p>因为这时候 cli 脚手架包的 name 不是在一开始创建的，而是一路回车之后，要确定和a同组的，需要执行下 <code>$ npm i -ws</code> 来更新下分组</p> <ul><li>这时候可以看到 <code>workspaces/node_modules/@somegroup/</code> 下存在 a 和 cli 两个软链</li> <li>同时，可以删除 <code>workspaces/node_modules/cli</code> 这个软链</li></ul></li> <li><p>这时候，想要在 <code>cli</code> 这个脚手架包中引用 a包来调试，需要 在 <code>workspaces</code> 目录下执行</p> <ul><li><code>$ npm i @somegroup/a -w cli</code></li> <li>这时候，会在 <code>cli</code> 脚手架目录中添加了 <code>@somegroup/a</code> 这个 dependencies</li></ul></li> <li><p>新建 <code>bin/cli.mjs</code>编写</p></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token hashbang comment">#!/usr/bin/env node</span>

<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> a <span class="token keyword">from</span> <span class="token string">'@somegroup/a'</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> print <span class="token punctuation">}</span> <span class="token operator">=</span> a<span class="token punctuation">.</span>default<span class="token punctuation">;</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li><p>这时候在 <code>workspaces</code> 下执行 <code>$ npm run cli</code>, 这样，我们的脚手架就可以直接使用了</p></li> <li><p>以上就是使用 <code>workspace</code> 来进行包的管理，这里生成了3个包，其中包a和包cli都在<code>@somegroup</code>组下</p></li> <li><p>好，现在发布之前, 还需要处理一下b包，毕竟建立这个包是有用的，不在远程发布有问题的包</p></li> <li><p>将b包的name修改成 <code>&quot;name&quot;: &quot;@somegroup/b&quot;</code>, 目前这三个包都在 <code>@somegroup</code> 组中了</p></li> <li><p>在b中新建 <code>index.js</code>, 在<code>b/package.json</code>中同步<code>&quot;main&quot;: &quot;index.js&quot;</code>, 并添加 <code>&quot;type&quot;: &quot;module&quot;</code></p></li> <li><p>给b包安装 <code>ora</code> 依赖，在 <code>workspaces</code> 目录下执行 <code>$ npm i ora -w b</code></p></li> <li><p>编写 <code>b/index.js</code></p></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> ora <span class="token keyword">from</span> <span class="token string">'ora'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> spinner <span class="token operator">=</span> <span class="token function">ora</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token string">'loading'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		spinner<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li><p>因为修改了 b 的<code>package.json</code>的<code>name</code>属性，需要同步下 <code>$ npm i -ws</code></p></li> <li><p>并且注意删除下之前 <code>workspaces/node_modules/b</code> 这个叫b的软链</p></li> <li><p>好，现在b包作为工具库为 <code>cli</code> 脚手架提供方法，为cli安装b包, 回到 <code>workspaces</code> 目录下</p></li> <li><p>执行 <code>$ npm i @somegroup/b -w cli</code>, 修改 <code>cli/bin/cli.js</code> 文件</p></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token hashbang comment">#!/usr/bin/env node</span>

<span class="token keyword">import</span> a <span class="token keyword">from</span> <span class="token string">'@somegroup/a'</span>
<span class="token keyword">import</span> bLoading <span class="token keyword">from</span> <span class="token string">'@somegroup/b'</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> print <span class="token punctuation">}</span> <span class="token operator">=</span> a<span class="token punctuation">;</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'----------'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">bLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ul><li>这时候万事俱备了，就可以发布上线了, 在 worksapces 目录中
<ul><li><code>npm publish -ws</code> 发布所有 <code>workspace</code> 包内容，这个是全部包发布的举例</li> <li><code>npm publish -w a</code> 发布a包，这个是单个包发布的举例</li></ul></li> <li>注意，如果包存在发布报错，可能是因为权限问题，可修改对应包的package.json</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code>  <span class="token punctuation">{</span>
	<span class="token property">&quot;publishConfig&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;access&quot;</span><span class="token operator">:</span> <span class="token string">&quot;public&quot;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>这样就顺利发布成功了，注意， <code>Lerna</code> 使用时会帮助我们考虑到这一点， <code>Lerna</code>  会省事一些</li></ul></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">6/3/2024, 8:19:22 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/informal-essay/" class="prev router-link-active">
            零碎
          </a></span> <span class="next"><a href="/informal-essay/mian-shi-ti.html">
            面试题
          </a></span></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-cb1513f6><li class="level-2" data-v-cb1513f6><a href="/informal-essay/qian-duan-qi-qi-guai-guai-de-ji-shu.html#css滤镜filter函数-让照片随意变色-一个属性让网站变黑白效果-就这样任性" class="sidebar-link reco-side-css滤镜filter函数-让照片随意变色-一个属性让网站变黑白效果-就这样任性" data-v-cb1513f6>css滤镜filter函数，让照片随意变色，一个属性让网站变黑白效果，就这样任性</a></li><li class="level-2" data-v-cb1513f6><a href="/informal-essay/qian-duan-qi-qi-guai-guai-de-ji-shu.html#javascript中-等于多少" class="sidebar-link reco-side-javascript中-等于多少" data-v-cb1513f6>JavaScript中,{}+{}等于多少?</a></li><li class="level-2" data-v-cb1513f6><a href="/informal-essay/qian-duan-qi-qi-guai-guai-de-ji-shu.html#web-worker" class="sidebar-link reco-side-web-worker" data-v-cb1513f6>Web Worker</a></li><li class="level-3" data-v-cb1513f6><a href="/informal-essay/qian-duan-qi-qi-guai-guai-de-ji-shu.html#开启多线程-并行计算" class="sidebar-link reco-side-开启多线程-并行计算" data-v-cb1513f6>开启多线程，并行计算</a></li><li class="level-2" data-v-cb1513f6><a href="/informal-essay/qian-duan-qi-qi-guai-guai-de-ji-shu.html#async-await" class="sidebar-link reco-side-async-await" data-v-cb1513f6>async-await</a></li><li class="level-3" data-v-cb1513f6><a href="/informal-essay/qian-duan-qi-qi-guai-guai-de-ji-shu.html#走进async-await原理" class="sidebar-link reco-side-走进async-await原理" data-v-cb1513f6>走进Async-await原理</a></li><li class="level-3" data-v-cb1513f6><a href="/informal-essay/qian-duan-qi-qi-guai-guai-de-ji-shu.html#深入async-await规则" class="sidebar-link reco-side-深入async-await规则" data-v-cb1513f6>深入Async-await规则</a></li><li class="level-3" data-v-cb1513f6><a href="/informal-essay/qian-duan-qi-qi-guai-guai-de-ji-shu.html#解析async-await语法" class="sidebar-link reco-side-解析async-await语法" data-v-cb1513f6>解析Async-await语法</a></li><li class="level-3" data-v-cb1513f6><a href="/informal-essay/qian-duan-qi-qi-guai-guai-de-ji-shu.html#拓展async-await应用" class="sidebar-link reco-side-拓展async-await应用" data-v-cb1513f6>拓展Async-await应用</a></li><li class="level-2" data-v-cb1513f6><a href="/informal-essay/qian-duan-qi-qi-guai-guai-de-ji-shu.html#localstorage-的高阶用法" class="sidebar-link reco-side-localstorage-的高阶用法" data-v-cb1513f6>localStorage 的高阶用法</a></li><li class="level-3" data-v-cb1513f6><a href="/informal-essay/qian-duan-qi-qi-guai-guai-de-ji-shu.html#设计" class="sidebar-link reco-side-设计" data-v-cb1513f6>设计</a></li><li class="level-3" data-v-cb1513f6><a href="/informal-essay/qian-duan-qi-qi-guai-guai-de-ji-shu.html#设置-setstorage" class="sidebar-link reco-side-设置-setstorage" data-v-cb1513f6>设置 setStorage</a></li><li class="level-3" data-v-cb1513f6><a href="/informal-essay/qian-duan-qi-qi-guai-guai-de-ji-shu.html#获取-getstorage" class="sidebar-link reco-side-获取-getstorage" data-v-cb1513f6>获取 getStorage</a></li><li class="level-3" data-v-cb1513f6><a href="/informal-essay/qian-duan-qi-qi-guai-guai-de-ji-shu.html#使用" class="sidebar-link reco-side-使用" data-v-cb1513f6>使用</a></li><li class="level-3" data-v-cb1513f6><a href="/informal-essay/qian-duan-qi-qi-guai-guai-de-ji-shu.html#完整代码" class="sidebar-link reco-side-完整代码" data-v-cb1513f6>完整代码</a></li><li class="level-2" data-v-cb1513f6><a href="/informal-essay/qian-duan-qi-qi-guai-guai-de-ji-shu.html#前端性能优化到底该怎么做" class="sidebar-link reco-side-前端性能优化到底该怎么做" data-v-cb1513f6>前端性能优化到底该怎么做</a></li><li class="level-3" data-v-cb1513f6><a href="/informal-essay/qian-duan-qi-qi-guai-guai-de-ji-shu.html#rail-模型" class="sidebar-link reco-side-rail-模型" data-v-cb1513f6>RAIL 模型</a></li><li class="level-3" data-v-cb1513f6><a href="/informal-essay/qian-duan-qi-qi-guai-guai-de-ji-shu.html#常规性能指标" class="sidebar-link reco-side-常规性能指标" data-v-cb1513f6>常规性能指标</a></li><li class="level-3" data-v-cb1513f6><a href="/informal-essay/qian-duan-qi-qi-guai-guai-de-ji-shu.html#performance-面板-google" class="sidebar-link reco-side-performance-面板-google" data-v-cb1513f6>Performance 面板（Google）</a></li><li class="level-2" data-v-cb1513f6><a href="/informal-essay/qian-duan-qi-qi-guai-guai-de-ji-shu.html#打印时-这个单分到下一页" class="sidebar-link reco-side-打印时-这个单分到下一页" data-v-cb1513f6>打印时， 这个单分到下一页，</a></li><li class="level-3" data-v-cb1513f6><a href="/informal-essay/qian-duan-qi-qi-guai-guai-de-ji-shu.html#v-print-nb" class="sidebar-link reco-side-v-print-nb" data-v-cb1513f6>v-print-nb</a></li><li class="level-2" data-v-cb1513f6><a href="/informal-essay/qian-duan-qi-qi-guai-guai-de-ji-shu.html#抓包技能" class="sidebar-link reco-side-抓包技能" data-v-cb1513f6>抓包技能</a></li><li class="level-3" data-v-cb1513f6><a href="/informal-essay/qian-duan-qi-qi-guai-guai-de-ji-shu.html#前言" class="sidebar-link reco-side-前言" data-v-cb1513f6>前言</a></li><li class="level-3" data-v-cb1513f6><a href="/informal-essay/qian-duan-qi-qi-guai-guai-de-ji-shu.html#抓包的原理" class="sidebar-link reco-side-抓包的原理" data-v-cb1513f6>抓包的原理</a></li><li class="level-3" data-v-cb1513f6><a href="/informal-essay/qian-duan-qi-qi-guai-guai-de-ji-shu.html#电脑如何抓手机的包" class="sidebar-link reco-side-电脑如何抓手机的包" data-v-cb1513f6>电脑如何抓手机的包</a></li><li class="level-3" data-v-cb1513f6><a href="/informal-essay/qian-duan-qi-qi-guai-guai-de-ji-shu.html#抓包工具-whistle" class="sidebar-link reco-side-抓包工具-whistle" data-v-cb1513f6>抓包工具 whistle</a></li><li class="level-2" data-v-cb1513f6><a href="/informal-essay/qian-duan-qi-qi-guai-guai-de-ji-shu.html#w文件上传工具-sftp" class="sidebar-link reco-side-w文件上传工具-sftp" data-v-cb1513f6>w文件上传工具 sftp</a></li><li class="level-2" data-v-cb1513f6><a href="/informal-essay/qian-duan-qi-qi-guai-guai-de-ji-shu.html#从-微信-js-sdk-认识-jsbridge" class="sidebar-link reco-side-从-微信-js-sdk-认识-jsbridge" data-v-cb1513f6>从 微信 JS-SDK 认识 JSBridge</a></li><li class="level-3" data-v-cb1513f6><a href="/informal-essay/qian-duan-qi-qi-guai-guai-de-ji-shu.html#为什么叫-jsbridge" class="sidebar-link reco-side-为什么叫-jsbridge" data-v-cb1513f6>为什么叫 JSBridge？</a></li><li class="level-2" data-v-cb1513f6><a href="/informal-essay/qian-duan-qi-qi-guai-guai-de-ji-shu.html#一文教你实现pdf-预览和下载" class="sidebar-link reco-side-一文教你实现pdf-预览和下载" data-v-cb1513f6>一文教你实现PDF 预览和下载</a></li><li class="level-3" data-v-cb1513f6><a href="/informal-essay/qian-duan-qi-qi-guai-guai-de-ji-shu.html#目前实现-pdf-预览的几种常用方式" class="sidebar-link reco-side-目前实现-pdf-预览的几种常用方式" data-v-cb1513f6>目前实现 PDF 预览的几种常用方式：</a></li><li class="level-2" data-v-cb1513f6><a href="/informal-essay/qian-duan-qi-qi-guai-guai-de-ji-shu.html#手把手教你用-node-写一个爬虫-超简单" class="sidebar-link reco-side-手把手教你用-node-写一个爬虫-超简单" data-v-cb1513f6>手把手教你用 node 写一个爬虫，超简单！</a></li><li class="level-3" data-v-cb1513f6><a href="/informal-essay/qian-duan-qi-qi-guai-guai-de-ji-shu.html#准备工作" class="sidebar-link reco-side-准备工作" data-v-cb1513f6>准备工作</a></li><li class="level-3" data-v-cb1513f6><a href="/informal-essay/qian-duan-qi-qi-guai-guai-de-ji-shu.html#开始" class="sidebar-link reco-side-开始" data-v-cb1513f6>开始</a></li><li class="level-3" data-v-cb1513f6><a href="/informal-essay/qian-duan-qi-qi-guai-guai-de-ji-shu.html#完整代码-2" class="sidebar-link reco-side-完整代码-2" data-v-cb1513f6>完整代码</a></li><li class="level-3" data-v-cb1513f6><a href="/informal-essay/qian-duan-qi-qi-guai-guai-de-ji-shu.html#前端换肤功能" class="sidebar-link reco-side-前端换肤功能" data-v-cb1513f6>前端换肤功能</a></li><li class="level-2" data-v-cb1513f6><a href="/informal-essay/qian-duan-qi-qi-guai-guai-de-ji-shu.html#报错-referenceerror-require-is-not-defined-in-es-module-scope-you-can-use-import-instead" class="sidebar-link reco-side-报错-referenceerror-require-is-not-defined-in-es-module-scope-you-can-use-import-instead" data-v-cb1513f6>报错 ReferenceError require is not defined in ES module scope, you can use import instead</a></li><li class="level-2" data-v-cb1513f6><a href="/informal-essay/qian-duan-qi-qi-guai-guai-de-ji-shu.html#npm的workspaces-特性" class="sidebar-link reco-side-npm的workspaces-特性" data-v-cb1513f6>npm的workspaces 特性</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><canvas id="vuepress-canvas-cursor"></canvas></div></div>
    <script src="/assets/js/app.ab7ccc71.js" defer></script><script src="/assets/js/3.4edb9727.js" defer></script><script src="/assets/js/1.8fa44146.js" defer></script><script src="/assets/js/55.0b081e5c.js" defer></script>
  </body>
</html>
